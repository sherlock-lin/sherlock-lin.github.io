[{"content":"å¼•è¨€ ç¼“å­˜ï¼Œè¿™æ˜¯ä¸€ä¸ªç»ä¹…ä¸è¡°çš„è¯é¢˜ï¼Œå®ƒé€šè¿‡â€œç©ºé—´æ¢æ—¶é—´â€çš„æˆ˜æœ¯ä¸ä»…èƒ½å¤Ÿæå¤§æå‡å¤„ç†æŸ¥è¯¢æ€§èƒ½è¿˜èƒ½å¾ˆå¥½çš„ä¿æŠ¤åº•å±‚èµ„æºã€‚æœ€è¿‘é’ˆå¯¹ç³»ç»Ÿæ•°æ®ç¼“å­˜çš„ä¼˜åŒ–åï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„åœºæ™¯å¹¶ä¸”æœ‰äº†ä¸€ç‚¹å¿ƒå¾—å› æ­¤åœ¨è¿™é‡Œåˆ†äº«å‡ºæ¥ã€‚\næ¡ˆä¾‹ æ— è®ºæ˜¯ä¼ ç»ŸWebåç«¯åº”ç”¨è¿˜æ˜¯å¤§æ•°æ®å¹³å°æœåŠ¡åº”ç”¨ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªJavaè¿›ç¨‹å¹¶ä¸”åº”ç”¨ç›¸å…³æ•°æ®ä¸€èˆ¬éƒ½æ˜¯å­˜åœ¨Mysqlã€‚ä»æŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼Œæ‰€æœ‰è¯·æ±‚åŸºæœ¬éƒ½è¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªæµç¨‹ï¼šå‚æ•°æ ¡éªŒã€é‰´æƒã€è¯·æ±‚å¤„ç†ã€è¯·æ±‚å“åº”ã€‚è¿™å‡ ä¸ªæµç¨‹ç‰¹åˆ«æ˜¯å‰å‡ ä¸ªå¾€å¾€éœ€è¦ä¾èµ–å­˜åœ¨MySQLä¸­çš„ç³»ç»Ÿæ•°æ®ï¼Œä¾‹å¦‚åˆ¤æ–­è¯·æ±‚ä¸­æºå¸¦çš„çš„æœåŠ¡IDåœ¨ç³»ç»Ÿä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æœåŠ¡ã€è·å–æœåŠ¡å¯¹åº”çš„è®¤è¯ä¿¡æ¯è¿›è¡Œèº«ä»½æ ¡éªŒã€è¯·æ±‚å¤„ç†æ—¶å¸¸å¸¸ä¾èµ–çš„ä¸€äº›æ•°æ®å¦‚æŸä¸ªå˜åŠ¨éå¸¸ä½é¢‘çš„å°è¡¨æˆ–è€…ä¸€äº›é…ç½®åœ¨MySQLä¸­çš„ç³»ç»Ÿé…ç½®ç­‰ï¼Œæ­¤æ—¶å¦‚æœæ˜¯ä½ ï¼Œä¼šæ€ä¹ˆå»è®¾è®¡çš„è¿™ä¸ªç¼“å­˜ï¼Ÿæˆ‘å…ˆä¸¾ä¸¤ä¸ªè´Ÿè´£è¿‡çš„é¡¹ç›®ä¹‹å‰æ˜¯å¦‚ä½•è®¾è®¡çš„\nAé¡¹ç›® æœåŠ¡å¯åŠ¨çš„æ—¶å€™è¯»å–MySQLä¸­çš„ç³»ç»Ÿæ•°æ®å¹¶ä»¥HashMapçš„æ ¼å¼å­˜åœ¨Javaè¿›ç¨‹ä¸­ï¼Œä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œåœ¨æœ‰é…ç½®å˜åŠ¨æ—¶å¾ªç¯è°ƒç”¨æ‰€æœ‰æœåŠ¡å™¨çš„ipæ¥å£è§¦å‘é‡æ–°åŠ è½½æ•°æ®ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹\nè¿™ç§è®¾è®¡çš„ä¼˜ç‚¹å¦‚ä¸‹\nå®ç°ç®€å•ï¼Œä¸ä¾èµ–å¤–éƒ¨ç»„ä»¶ æœ‰æ•°æ®å˜æ›´ç«‹é©¬æ›´æ–°æ‰€æœ‰ç¼“å­˜æ•°æ®ï¼ŒåŸºæœ¬ä¸ä¼šåœ¨ç¼“å­˜ä¸­è¯»åˆ°æ—§æ•°æ®çš„é€»è¾‘ ä»¥ä¸Šæ˜¯è¿™ç§è®¾è®¡çš„ä¼˜ç‚¹ï¼Œå¯èƒ½ä¹Ÿæ˜¯è®¾è®¡è€…è¿™ä¹ˆè®¾è®¡çš„åŸå› ã€‚ä½†æ˜¯éšç€ç»´æŠ¤ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜\næ‰€æœ‰æœåŠ¡å™¨çš„ipæ˜¯é…ç½®åœ¨apolloä¸­çš„ï¼Œå› æ­¤æ¯æ¬¡æ‰©å®¹æœºå™¨æ—¶éƒ½è¦å°†æ–°çš„ipå¢åŠ åˆ°apolloä¸­ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°ç¼“å­˜ä¸æ›´æ–°ç°è±¡ åœ¨æœåŠ¡ä»ECSè¿ç§»åˆ°K8såï¼ŒæœåŠ¡çš„ipæ˜¯åŠ¨æ€åˆ†é…çš„å¹¶ä¸”æ¯æ¬¡é‡å¯åéƒ½ä¸ä¸€æ ·ï¼Œå› æ­¤å½“æœ‰é…ç½®å˜åŠ¨æ—¶åªèƒ½æ‰‹åŠ¨é‡å¯æœåŠ¡æˆ–è€…æ‰§è¡Œcurlè°ƒç”¨æ¥å£æ¥è§¦å‘å„ä¸ªèŠ‚ç‚¹è¿›è¡Œé…ç½®æ›´æ–° Bé¡¹ç›® æœåŠ¡å¯åŠ¨çš„æ—¶å€™è¯»å–MySQLä¸­çš„ç³»ç»Ÿæ•°æ®å¹¶ä»¥HashMapçš„æ ¼å¼å­˜åœ¨Javaè¿›ç¨‹ä¸­ï¼Œå¹¶è®°å½•å½“å‰æ›´æ–°æ—¶é—´ï¼Œåœ¨æŸ¥è¯¢ç¼“å­˜æ—¶ä¼šåˆ¤æ–­æ­¤æ—¶è·ç¦»ä¸Šæ¬¡æ›´æ–°æ—¶é—´æ˜¯å¦å·²ç»è¶…è¿‡30ç§’(ç¡¬ç¼–ç )ï¼Œå¦‚æœè¶…è¿‡åˆ™é‡æ–°è§¦å‘æŸ¥è¯¢MySQLæ›´æ–°ç¼“å­˜ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹\nè¿™ç§è®¾è®¡çš„ä¼˜ç‚¹å¦‚ä¸‹\næœåŠ¡ä¹‹é—´æ— éœ€é€šä¿¡ï¼Œç›¸æ¯”AæœåŠ¡æ¥è¯´æ˜¯ä¼šè‡ªå·±ä¸»åŠ¨æ›´æ–° é™¤äº†ä¸Šé¢è¿™ä¸€ä¸ªä¼˜ç‚¹è²Œä¼¼æ—§æ²¡æœ‰äº†ï¼Œå€¼å¾—åæ§½çš„ç‚¹å¾ˆå¤šï¼Œå¤§è‡´åˆ—ä¸¾ä¸€ä¸‹å®ƒå®ç°çš„é—®é¢˜\né’ˆå¯¹æ¯ä¸€ä¸ªéœ€è¦æ›´æ–°çš„ç¼“å­˜éƒ½æ–°å»ºä¸€ä¸ªè‡ªå·±ç‹¬ç«‹çš„ç±»æ¥å®ç°CommandLineRunneræ¥å£ ç¡¬ç¼–ç 30sè¿‡æœŸçš„é€»è¾‘ä»¥åŠæŸ¥è¯¢æ—¶å†å»åšæ›´æ–°åŠ¨ä½œ(ç±»ä¼¼ç¬¬ä¸€æ¬¡æƒ©ç½š) æ›´æ–°ç¼“å­˜æ—¶çš„é€»è¾‘æ˜¯ï¼Œå…ˆå…¨é‡æŸ¥è¯¢Mysqlå¯¹åº”çš„è¡¨ï¼Œç„¶åå¾ªç¯å¯¹æ¯”ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œæœ‰æ–°å¢çš„å°±è¿½åŠ åˆ°ç¼“å­˜ï¼Œå†å»è·Ÿç¼“å­˜æ¯”è¾ƒæ˜¯å¦æœ‰åˆ é™¤çš„ï¼Œæœ‰çš„è¯å†å»ç¼“å­˜ä¸­åˆ é™¤ åˆ†æ è¿™ä¸¤ä¸ªæœåŠ¡åœ¨æ›´æ–°ç³»ç»Ÿæ•°æ®ç¼“å­˜ä¸Šéƒ½å­˜åœ¨ä¸å°‘é—®é¢˜ï¼Œç°åœ¨å†å›è¿‡å¤´æ¥æ€è€ƒğŸ¤”ä¸‹ï¼Œæˆ‘ä»¬ç†æƒ³çš„ç³»ç»Ÿæ•°æ®ç¼“å­˜çš„å®ç°åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿæˆ‘å¤§æ¦‚æ•´ç†äº†ä¸€ä¸‹å¤§è‡´å¦‚ä¸‹\næœåŠ¡å¯åŠ¨æ—¶è¦å…¨é‡è¯»å–å¯¹åº”çš„æ•°æ®ä»¥Mapæ ¼å¼å­˜åœ¨Javaè¿›ç¨‹çš„å†…å­˜ä¸­ æœåŠ¡åº”è¯¥æ˜¯å®šæ—¶è‡ªè¡Œå»MysqlåŒæ­¥æœ€æ–°çš„æ•°æ®ï¼Œå¹¶ä¸”å®šæ—¶å‘¨æœŸæ˜¯å…è®¸å¯é…ç½®çš„ ä¸€äº›é‡è¦é…ç½®å˜æ›´æ—¶è§¦å‘å„ä¸ªæœåŠ¡ç«‹é©¬å»MysqlåŒæ­¥æ•°æ®(å¯é€‰ï¼Œéœ€è¦å‚è€ƒå…·ä½“ä¸šåŠ¡åœºæ™¯) åŸºäºè¿™ä¸ªåœºæ™¯æˆ‘å¯¹æ¯”äº†ä¸‹å½“å‰æ¯”è¾ƒçƒ­é—¨çš„ç¼“å­˜å·¥å…·Guavaå’ŒCaffeineï¼Œæœ€ç»ˆå‘ç°å®ƒä»¬éƒ½ä¸é€‚åˆå’±ä»¬çš„è¿™ä¸ªåœºæ™¯ã€‚å®ƒä»¬çš„è®¾è®¡æ›´åå‘äºè§£å†³ç¼“å­˜çƒ­ç‚¹æ•°æ®çš„é—®é¢˜ï¼Œç®€å•æ¥è¯´å°±æ˜¯å’±ä»¬çš„åœºæ™¯æ˜¯Javaå†…å­˜æœ‰10Gï¼Œè€Œå­˜åœ¨Mysqlä¸­çš„æ•°æ®æœ‰100Mï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™100Mçš„æ•°æ®å­˜åœ¨Javaå†…å­˜ä¸­è¿›è¡Œè¯·æ±‚åŠ é€Ÿï¼Œéœ€è¦è§£å†³çš„æ˜¯å¦‚ä½•å…¨é‡åŠ è½½åˆ°å†…å­˜çš„é—®é¢˜ã€‚è€ŒGuavaå’ŒCaffeineçš„è®¾è®¡è¦è§£å†³çš„é—®é¢˜æ—¶ï¼Œå¦‚ä½•æ›´æœ‰æ•ˆçš„åˆç†çš„åˆ©ç”¨å†…å­˜ï¼Œä¾‹å¦‚Javaå†…å­˜åªæœ‰10Gï¼Œè€Œå­˜åœ¨MySQLçš„æ•°æ®æœ‰100Gï¼Œå› æ­¤éœ€è¦å°†è¿™100Gä¸­çš„çƒ­ç‚¹æ•°æ®å­˜åœ¨Javaå†…å­˜ä¸­æ¥æå‡æ€§èƒ½å’Œé™ä½é«˜é¢‘è®¿é—®Mysqlï¼Œå®ƒå…·ä½“è¦è€ƒè™‘çš„é—®é¢˜å¤§è‡´æœ‰ä»¥ä¸‹å‡ ç‚¹\né€šè¿‡LRUç®—æ³•æˆ–è€…å˜ç§æ¥ä¿ç•™çƒ­ç‚¹æ•°æ® é€šè¿‡å¤§å°é™åˆ¶ä»¥åŠæ—¶é—´é™åˆ¶æ¥å‰”é™¤æ‰ç¼“å­˜æ•°æ®ä»è€Œä¿è¯Javaå†…å­˜ä¸ä¼šè¢«æ’‘çˆ† åœ¨æœ‰æ–°æ•°æ®å†™å…¥æˆ–è€…æ•°æ®æ›´æ–°æ—¶ï¼ŒåŒæ­¥æ›´æ–°ç¼“å­˜ä¸­çš„æ•°æ® \u0026hellip;. é€šè¿‡è¿™äº›ä½ ä¼šå‘ç°å…¶å®è¿™ä¸ªåœºæ™¯çœŸä¸é€‚åˆç”¨Guavaå’ŒCaffeineï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿç¿»é˜…äº†ä¸€äº›å¤§ä½¬çš„å®ç°ï¼Œä½†æ˜¯å‘ç°éƒ½æœ‰ç‚¹è·‘åäº†ï¼Œæœ‰ç§ä¸ºäº†ç”¨Caffeineè€Œå¼ºè¡Œç”¨çš„å‘³é“ã€‚ä¾‹å¦‚ https://www.vincentli.top/2020/09/01/jvm-local-cache-case-caffeine/ï¼Œè¿™é‡Œæœ¬è´¨ä¸Šè¿˜æ˜¯è·ŸBé¡¹ç›®çš„å®ç°ä¸€æ ·ï¼Œåªä¸è¿‡ç”¨Caffeineæ›¿æ¢äº†Javaçš„HashMapç½¢äº†ã€‚åœ¨è¿™é‡Œè¡¥å……è¯´ä¸‹ï¼ŒCaffeineæ˜¯éå¸¸ä¼˜ç§€çš„ç¼“å­˜å·¥å…·ï¼Œç°åœ¨å¾ˆå¤šä¼˜ç§€çš„å¼€æºç»„ä»¶ä¾‹å¦‚ Pulsar ä¸­ä¹Ÿä¼šç”¨å®ƒæ¥åŠ é€ŸæŸ¥è¯¢ï¼Œä½†ç›²ç›®çš„ä½¿ç”¨æ˜¯ä¸å¯å–çš„ï¼Œå¹¶ä¸”è¿™è‚¯å®šä¹Ÿä¸æ˜¯Caffeineè®¾è®¡è€…æƒ³çœ‹åˆ°çš„ã€‚\næˆ‘çš„å®ç° ä¸Šé¢è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘åˆ†äº«ä¸‹è‡ªå·±çš„å®ç°ä¾›å¤§å®¶å‚è€ƒä»¥åŠæ‰¹åˆ¤ã€‚åœ¨è¿™é‡Œé€šè¿‡ä¸€ä¸ªå®šæ—¶çº¿ç¨‹æ± å®ç°å³å¯ï¼Œåœ¨å¯åŠ¨æ—¶è§¦å‘ä¸€æ¬¡å¹¶åœ¨åç»­å‘¨æœŸæ€§çš„åˆ·æ–°é…ç½®å³å¯ï¼Œæ ¸å¿ƒä»£ç ä¹Ÿå°±ä¸¤ä¸‰è¡Œã€‚å…ˆçœ‹ä¸‹æµç¨‹\nä»£ç å®ç°å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 public class CacheManager implements CommandLineRunner { private static final Long DEFAULT_INTERVAL = 36000L; private final ScheduledExecutorService apiSystemConfigExecutorService = Executors.newSingleThreadScheduledExecutor(); private static Map\u0026lt;String, String\u0026gt; apiSysConfig = new HashMap\u0026lt;\u0026gt;(); @Override public void run(String... args) throws Exception { apiSystemConfigExecutorService.scheduleAtFixedRate(this::loadApiSysConfigDataFromDB, 0, Optional.ofNullable(PropertyConfigurer.getLong(\u0026#34;SYSTEM_CONFIG_UPDATE_PERIOD\u0026#34;)).orElse(DEFAULT_INTERVAL), TimeUnit.SECONDS); } public void loadApiSysConfigDataFromDB(){ ApisDao apisDao = SpringContextHolder.getBean(ApisDao.class); List\u0026lt;ApiSysConfigEntity\u0026gt; sysConfigEntityList = apisDao.selectSystemConfig(); if (null == sysConfigEntityList || sysConfigEntityList.size() == 0){ return; } logger.info(\u0026#34;load ApiSysConfigEntity from api_sys_config in mysql ,the size of api in cache is \u0026#34; + sysConfigEntityList.size()); apiSysConfig = sysConfigEntityList.stream() .collect(Collectors.toMap(ApiSysConfigEntity::getName, ApiSysConfigEntity::getValue)); } } æ€»ç»“ åœ¨å·¥ä½œä¸­åªè¦æˆ‘ä»¬è§‚å¯Ÿå’Œæ€è€ƒï¼Œå°±ä¼šå‘ç°å…¶å®æ˜¯å­˜åœ¨ä¸å°‘å€¼å¾—å®Œå–„çš„åœ°æ–¹ï¼Œæ­¤æ—¶åº”è¯¥è€ƒè™‘å¯¹å®ƒä»¬è¿›è¡Œå®Œå–„ï¼Œå¦åˆ™å¦‚æœé•¿æœŸç»´æŠ¤ä¸€ä¸ªâ€œä¸‘é™‹â€çš„ç³»ç»Ÿï¼Œä½ çš„æ€ç»´ã€ä»¥åŠå®¡ç¾ä¹Ÿä¼šéšä¹‹è·Ÿç€é™ä½ï¼Œä»¥è‡³äºä¹…è€Œä¹…ä¹‹å°±è§‰å¾—è¿™ç§è®¾è®¡ä¹ŸæŒºå¥½çš„ï¼Œç”šè‡³åç»­å†æœ‰ç±»ä¼¼çš„åœºæ™¯æ—¶ä½ è¿˜æ˜¯ä¼šé€‰æ‹©è¿™ç§è®¾è®¡ã€‚å·¥ä½œçš„æœ¬è´¨ä¹Ÿæ˜¯ä¸€åœºä¿®è¡Œï¼Œåœ¨å¯¹ç³»ç»Ÿè¿›è¡Œæ”¹è¿›å®Œå–„çš„è¿‡ç¨‹ä¹Ÿæ˜¯è‡ªæˆ‘å®Œå–„çš„è¿‡ç¨‹ï¼Œç®€ç§°â€œå€Ÿç‰©å¾—é“â€ï¼ŒåŒæ—¶å¦‚æœè¯»è€…é’ˆå¯¹è¿™ä¸ªåœºæ™¯æœ‰æ›´åˆé€‚çš„è®¾è®¡ä¹Ÿæ¬¢è¿åœ¨ä¸‹æ–¹ä¸€èµ·è®¨è®ºã€‚\n","date":"2024-10-14T00:15:06+08:00","image":"https://sherlock-lin.github.io/p/%E5%8E%8B%E5%88%B6es-hadoop%E8%BF%99%E5%A4%B4%E9%87%8E%E5%85%BD%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E4%BA%86/image-20240412140549821_hu14806540156354507896.png","permalink":"https://sherlock-lin.github.io/p/%E5%8E%8B%E5%88%B6es-hadoop%E8%BF%99%E5%A4%B4%E9%87%8E%E5%85%BD%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E4%BA%86/","title":"å‹åˆ¶es Hadoopè¿™å¤´é‡å…½çš„æ–¹å¼æ¥äº†"},{"content":"å¼•è¨€ ç¼“å­˜ï¼Œè¿™æ˜¯ä¸€ä¸ªç»ä¹…ä¸è¡°çš„è¯é¢˜ï¼Œå®ƒé€šè¿‡â€œç©ºé—´æ¢æ—¶é—´â€çš„æˆ˜æœ¯ä¸ä»…èƒ½å¤Ÿæå¤§æå‡å¤„ç†æŸ¥è¯¢æ€§èƒ½è¿˜èƒ½å¾ˆå¥½çš„ä¿æŠ¤åº•å±‚èµ„æºã€‚æœ€è¿‘é’ˆå¯¹ç³»ç»Ÿæ•°æ®ç¼“å­˜çš„ä¼˜åŒ–åï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„åœºæ™¯å¹¶ä¸”æœ‰äº†ä¸€ç‚¹å¿ƒå¾—å› æ­¤åœ¨è¿™é‡Œåˆ†äº«å‡ºæ¥ã€‚\næ¡ˆä¾‹ æ— è®ºæ˜¯ä¼ ç»ŸWebåç«¯åº”ç”¨è¿˜æ˜¯å¤§æ•°æ®å¹³å°æœåŠ¡åº”ç”¨ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªJavaè¿›ç¨‹å¹¶ä¸”åº”ç”¨ç›¸å…³æ•°æ®ä¸€èˆ¬éƒ½æ˜¯å­˜åœ¨Mysqlã€‚ä»æŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼Œæ‰€æœ‰è¯·æ±‚åŸºæœ¬éƒ½è¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªæµç¨‹ï¼šå‚æ•°æ ¡éªŒã€é‰´æƒã€è¯·æ±‚å¤„ç†ã€è¯·æ±‚å“åº”ã€‚è¿™å‡ ä¸ªæµç¨‹ç‰¹åˆ«æ˜¯å‰å‡ ä¸ªå¾€å¾€éœ€è¦ä¾èµ–å­˜åœ¨MySQLä¸­çš„ç³»ç»Ÿæ•°æ®ï¼Œä¾‹å¦‚åˆ¤æ–­è¯·æ±‚ä¸­æºå¸¦çš„çš„æœåŠ¡IDåœ¨ç³»ç»Ÿä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æœåŠ¡ã€è·å–æœåŠ¡å¯¹åº”çš„è®¤è¯ä¿¡æ¯è¿›è¡Œèº«ä»½æ ¡éªŒã€è¯·æ±‚å¤„ç†æ—¶å¸¸å¸¸ä¾èµ–çš„ä¸€äº›æ•°æ®å¦‚æŸä¸ªå˜åŠ¨éå¸¸ä½é¢‘çš„å°è¡¨æˆ–è€…ä¸€äº›é…ç½®åœ¨MySQLä¸­çš„ç³»ç»Ÿé…ç½®ç­‰ï¼Œæ­¤æ—¶å¦‚æœæ˜¯ä½ ï¼Œä¼šæ€ä¹ˆå»è®¾è®¡çš„è¿™ä¸ªç¼“å­˜ï¼Ÿæˆ‘å…ˆä¸¾ä¸¤ä¸ªè´Ÿè´£è¿‡çš„é¡¹ç›®ä¹‹å‰æ˜¯å¦‚ä½•è®¾è®¡çš„\nAé¡¹ç›® æœåŠ¡å¯åŠ¨çš„æ—¶å€™è¯»å–MySQLä¸­çš„ç³»ç»Ÿæ•°æ®å¹¶ä»¥HashMapçš„æ ¼å¼å­˜åœ¨Javaè¿›ç¨‹ä¸­ï¼Œä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œåœ¨æœ‰é…ç½®å˜åŠ¨æ—¶å¾ªç¯è°ƒç”¨æ‰€æœ‰æœåŠ¡å™¨çš„ipæ¥å£è§¦å‘é‡æ–°åŠ è½½æ•°æ®ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹\nè¿™ç§è®¾è®¡çš„ä¼˜ç‚¹å¦‚ä¸‹\nå®ç°ç®€å•ï¼Œä¸ä¾èµ–å¤–éƒ¨ç»„ä»¶ æœ‰æ•°æ®å˜æ›´ç«‹é©¬æ›´æ–°æ‰€æœ‰ç¼“å­˜æ•°æ®ï¼ŒåŸºæœ¬ä¸ä¼šåœ¨ç¼“å­˜ä¸­è¯»åˆ°æ—§æ•°æ®çš„é€»è¾‘ ä»¥ä¸Šæ˜¯è¿™ç§è®¾è®¡çš„ä¼˜ç‚¹ï¼Œå¯èƒ½ä¹Ÿæ˜¯è®¾è®¡è€…è¿™ä¹ˆè®¾è®¡çš„åŸå› ã€‚ä½†æ˜¯éšç€ç»´æŠ¤ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜\næ‰€æœ‰æœåŠ¡å™¨çš„ipæ˜¯é…ç½®åœ¨apolloä¸­çš„ï¼Œå› æ­¤æ¯æ¬¡æ‰©å®¹æœºå™¨æ—¶éƒ½è¦å°†æ–°çš„ipå¢åŠ åˆ°apolloä¸­ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°ç¼“å­˜ä¸æ›´æ–°ç°è±¡ åœ¨æœåŠ¡ä»ECSè¿ç§»åˆ°K8såï¼ŒæœåŠ¡çš„ipæ˜¯åŠ¨æ€åˆ†é…çš„å¹¶ä¸”æ¯æ¬¡é‡å¯åéƒ½ä¸ä¸€æ ·ï¼Œå› æ­¤å½“æœ‰é…ç½®å˜åŠ¨æ—¶åªèƒ½æ‰‹åŠ¨é‡å¯æœåŠ¡æˆ–è€…æ‰§è¡Œcurlè°ƒç”¨æ¥å£æ¥è§¦å‘å„ä¸ªèŠ‚ç‚¹è¿›è¡Œé…ç½®æ›´æ–° Bé¡¹ç›® æœåŠ¡å¯åŠ¨çš„æ—¶å€™è¯»å–MySQLä¸­çš„ç³»ç»Ÿæ•°æ®å¹¶ä»¥HashMapçš„æ ¼å¼å­˜åœ¨Javaè¿›ç¨‹ä¸­ï¼Œå¹¶è®°å½•å½“å‰æ›´æ–°æ—¶é—´ï¼Œåœ¨æŸ¥è¯¢ç¼“å­˜æ—¶ä¼šåˆ¤æ–­æ­¤æ—¶è·ç¦»ä¸Šæ¬¡æ›´æ–°æ—¶é—´æ˜¯å¦å·²ç»è¶…è¿‡30ç§’(ç¡¬ç¼–ç )ï¼Œå¦‚æœè¶…è¿‡åˆ™é‡æ–°è§¦å‘æŸ¥è¯¢MySQLæ›´æ–°ç¼“å­˜ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹\nè¿™ç§è®¾è®¡çš„ä¼˜ç‚¹å¦‚ä¸‹\næœåŠ¡ä¹‹é—´æ— éœ€é€šä¿¡ï¼Œç›¸æ¯”AæœåŠ¡æ¥è¯´æ˜¯ä¼šè‡ªå·±ä¸»åŠ¨æ›´æ–° é™¤äº†ä¸Šé¢è¿™ä¸€ä¸ªä¼˜ç‚¹è²Œä¼¼æ—§æ²¡æœ‰äº†ï¼Œå€¼å¾—åæ§½çš„ç‚¹å¾ˆå¤šï¼Œå¤§è‡´åˆ—ä¸¾ä¸€ä¸‹å®ƒå®ç°çš„é—®é¢˜\né’ˆå¯¹æ¯ä¸€ä¸ªéœ€è¦æ›´æ–°çš„ç¼“å­˜éƒ½æ–°å»ºä¸€ä¸ªè‡ªå·±ç‹¬ç«‹çš„ç±»æ¥å®ç°CommandLineRunneræ¥å£ ç¡¬ç¼–ç 30sè¿‡æœŸçš„é€»è¾‘ä»¥åŠæŸ¥è¯¢æ—¶å†å»åšæ›´æ–°åŠ¨ä½œ(ç±»ä¼¼ç¬¬ä¸€æ¬¡æƒ©ç½š) æ›´æ–°ç¼“å­˜æ—¶çš„é€»è¾‘æ˜¯ï¼Œå…ˆå…¨é‡æŸ¥è¯¢Mysqlå¯¹åº”çš„è¡¨ï¼Œç„¶åå¾ªç¯å¯¹æ¯”ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œæœ‰æ–°å¢çš„å°±è¿½åŠ åˆ°ç¼“å­˜ï¼Œå†å»è·Ÿç¼“å­˜æ¯”è¾ƒæ˜¯å¦æœ‰åˆ é™¤çš„ï¼Œæœ‰çš„è¯å†å»ç¼“å­˜ä¸­åˆ é™¤ åˆ†æ è¿™ä¸¤ä¸ªæœåŠ¡åœ¨æ›´æ–°ç³»ç»Ÿæ•°æ®ç¼“å­˜ä¸Šéƒ½å­˜åœ¨ä¸å°‘é—®é¢˜ï¼Œç°åœ¨å†å›è¿‡å¤´æ¥æ€è€ƒğŸ¤”ä¸‹ï¼Œæˆ‘ä»¬ç†æƒ³çš„ç³»ç»Ÿæ•°æ®ç¼“å­˜çš„å®ç°åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿæˆ‘å¤§æ¦‚æ•´ç†äº†ä¸€ä¸‹å¤§è‡´å¦‚ä¸‹\næœåŠ¡å¯åŠ¨æ—¶è¦å…¨é‡è¯»å–å¯¹åº”çš„æ•°æ®ä»¥Mapæ ¼å¼å­˜åœ¨Javaè¿›ç¨‹çš„å†…å­˜ä¸­ æœåŠ¡åº”è¯¥æ˜¯å®šæ—¶è‡ªè¡Œå»MysqlåŒæ­¥æœ€æ–°çš„æ•°æ®ï¼Œå¹¶ä¸”å®šæ—¶å‘¨æœŸæ˜¯å…è®¸å¯é…ç½®çš„ ä¸€äº›é‡è¦é…ç½®å˜æ›´æ—¶è§¦å‘å„ä¸ªæœåŠ¡ç«‹é©¬å»MysqlåŒæ­¥æ•°æ®(å¯é€‰ï¼Œéœ€è¦å‚è€ƒå…·ä½“ä¸šåŠ¡åœºæ™¯) åŸºäºè¿™ä¸ªåœºæ™¯æˆ‘å¯¹æ¯”äº†ä¸‹å½“å‰æ¯”è¾ƒçƒ­é—¨çš„ç¼“å­˜å·¥å…·Guavaå’ŒCaffeineï¼Œæœ€ç»ˆå‘ç°å®ƒä»¬éƒ½ä¸é€‚åˆå’±ä»¬çš„è¿™ä¸ªåœºæ™¯ã€‚å®ƒä»¬çš„è®¾è®¡æ›´åå‘äºè§£å†³ç¼“å­˜çƒ­ç‚¹æ•°æ®çš„é—®é¢˜ï¼Œç®€å•æ¥è¯´å°±æ˜¯å’±ä»¬çš„åœºæ™¯æ˜¯Javaå†…å­˜æœ‰10Gï¼Œè€Œå­˜åœ¨Mysqlä¸­çš„æ•°æ®æœ‰100Mï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™100Mçš„æ•°æ®å­˜åœ¨Javaå†…å­˜ä¸­è¿›è¡Œè¯·æ±‚åŠ é€Ÿï¼Œéœ€è¦è§£å†³çš„æ˜¯å¦‚ä½•å…¨é‡åŠ è½½åˆ°å†…å­˜çš„é—®é¢˜ã€‚è€ŒGuavaå’ŒCaffeineçš„è®¾è®¡è¦è§£å†³çš„é—®é¢˜æ—¶ï¼Œå¦‚ä½•æ›´æœ‰æ•ˆçš„åˆç†çš„åˆ©ç”¨å†…å­˜ï¼Œä¾‹å¦‚Javaå†…å­˜åªæœ‰10Gï¼Œè€Œå­˜åœ¨MySQLçš„æ•°æ®æœ‰100Gï¼Œå› æ­¤éœ€è¦å°†è¿™100Gä¸­çš„çƒ­ç‚¹æ•°æ®å­˜åœ¨Javaå†…å­˜ä¸­æ¥æå‡æ€§èƒ½å’Œé™ä½é«˜é¢‘è®¿é—®Mysqlï¼Œå®ƒå…·ä½“è¦è€ƒè™‘çš„é—®é¢˜å¤§è‡´æœ‰ä»¥ä¸‹å‡ ç‚¹\né€šè¿‡LRUç®—æ³•æˆ–è€…å˜ç§æ¥ä¿ç•™çƒ­ç‚¹æ•°æ® é€šè¿‡å¤§å°é™åˆ¶ä»¥åŠæ—¶é—´é™åˆ¶æ¥å‰”é™¤æ‰ç¼“å­˜æ•°æ®ä»è€Œä¿è¯Javaå†…å­˜ä¸ä¼šè¢«æ’‘çˆ† åœ¨æœ‰æ–°æ•°æ®å†™å…¥æˆ–è€…æ•°æ®æ›´æ–°æ—¶ï¼ŒåŒæ­¥æ›´æ–°ç¼“å­˜ä¸­çš„æ•°æ® \u0026hellip;. é€šè¿‡è¿™äº›ä½ ä¼šå‘ç°å…¶å®è¿™ä¸ªåœºæ™¯çœŸä¸é€‚åˆç”¨Guavaå’ŒCaffeineï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿç¿»é˜…äº†ä¸€äº›å¤§ä½¬çš„å®ç°ï¼Œä½†æ˜¯å‘ç°éƒ½æœ‰ç‚¹è·‘åäº†ï¼Œæœ‰ç§ä¸ºäº†ç”¨Caffeineè€Œå¼ºè¡Œç”¨çš„å‘³é“ã€‚ä¾‹å¦‚ https://www.vincentli.top/2020/09/01/jvm-local-cache-case-caffeine/ï¼Œè¿™é‡Œæœ¬è´¨ä¸Šè¿˜æ˜¯è·ŸBé¡¹ç›®çš„å®ç°ä¸€æ ·ï¼Œåªä¸è¿‡ç”¨Caffeineæ›¿æ¢äº†Javaçš„HashMapç½¢äº†ã€‚åœ¨è¿™é‡Œè¡¥å……è¯´ä¸‹ï¼ŒCaffeineæ˜¯éå¸¸ä¼˜ç§€çš„ç¼“å­˜å·¥å…·ï¼Œç°åœ¨å¾ˆå¤šä¼˜ç§€çš„å¼€æºç»„ä»¶ä¾‹å¦‚ Pulsar ä¸­ä¹Ÿä¼šç”¨å®ƒæ¥åŠ é€ŸæŸ¥è¯¢ï¼Œä½†ç›²ç›®çš„ä½¿ç”¨æ˜¯ä¸å¯å–çš„ï¼Œå¹¶ä¸”è¿™è‚¯å®šä¹Ÿä¸æ˜¯Caffeineè®¾è®¡è€…æƒ³çœ‹åˆ°çš„ã€‚\næˆ‘çš„å®ç° ä¸Šé¢è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘åˆ†äº«ä¸‹è‡ªå·±çš„å®ç°ä¾›å¤§å®¶å‚è€ƒä»¥åŠæ‰¹åˆ¤ã€‚åœ¨è¿™é‡Œé€šè¿‡ä¸€ä¸ªå®šæ—¶çº¿ç¨‹æ± å®ç°å³å¯ï¼Œåœ¨å¯åŠ¨æ—¶è§¦å‘ä¸€æ¬¡å¹¶åœ¨åç»­å‘¨æœŸæ€§çš„åˆ·æ–°é…ç½®å³å¯ï¼Œæ ¸å¿ƒä»£ç ä¹Ÿå°±ä¸¤ä¸‰è¡Œã€‚å…ˆçœ‹ä¸‹æµç¨‹\nä»£ç å®ç°å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 public class CacheManager implements CommandLineRunner { private static final Long DEFAULT_INTERVAL = 36000L; private final ScheduledExecutorService apiSystemConfigExecutorService = Executors.newSingleThreadScheduledExecutor(); private static Map\u0026lt;String, String\u0026gt; apiSysConfig = new HashMap\u0026lt;\u0026gt;(); @Override public void run(String... args) throws Exception { apiSystemConfigExecutorService.scheduleAtFixedRate(this::loadApiSysConfigDataFromDB, 0, Optional.ofNullable(PropertyConfigurer.getLong(\u0026#34;SYSTEM_CONFIG_UPDATE_PERIOD\u0026#34;)).orElse(DEFAULT_INTERVAL), TimeUnit.SECONDS); } public void loadApiSysConfigDataFromDB(){ ApisDao apisDao = SpringContextHolder.getBean(ApisDao.class); List\u0026lt;ApiSysConfigEntity\u0026gt; sysConfigEntityList = apisDao.selectSystemConfig(); if (null == sysConfigEntityList || sysConfigEntityList.size() == 0){ return; } logger.info(\u0026#34;load ApiSysConfigEntity from api_sys_config in mysql ,the size of api in cache is \u0026#34; + sysConfigEntityList.size()); apiSysConfig = sysConfigEntityList.stream() .collect(Collectors.toMap(ApiSysConfigEntity::getName, ApiSysConfigEntity::getValue)); } } æ€»ç»“ åœ¨å·¥ä½œä¸­åªè¦æˆ‘ä»¬è§‚å¯Ÿå’Œæ€è€ƒï¼Œå°±ä¼šå‘ç°å…¶å®æ˜¯å­˜åœ¨ä¸å°‘å€¼å¾—å®Œå–„çš„åœ°æ–¹ï¼Œæ­¤æ—¶åº”è¯¥è€ƒè™‘å¯¹å®ƒä»¬è¿›è¡Œå®Œå–„ï¼Œå¦åˆ™å¦‚æœé•¿æœŸç»´æŠ¤ä¸€ä¸ªâ€œä¸‘é™‹â€çš„ç³»ç»Ÿï¼Œä½ çš„æ€ç»´ã€ä»¥åŠå®¡ç¾ä¹Ÿä¼šéšä¹‹è·Ÿç€é™ä½ï¼Œä»¥è‡³äºä¹…è€Œä¹…ä¹‹å°±è§‰å¾—è¿™ç§è®¾è®¡ä¹ŸæŒºå¥½çš„ï¼Œç”šè‡³åç»­å†æœ‰ç±»ä¼¼çš„åœºæ™¯æ—¶ä½ è¿˜æ˜¯ä¼šé€‰æ‹©è¿™ç§è®¾è®¡ã€‚å·¥ä½œçš„æœ¬è´¨ä¹Ÿæ˜¯ä¸€åœºä¿®è¡Œï¼Œåœ¨å¯¹ç³»ç»Ÿè¿›è¡Œæ”¹è¿›å®Œå–„çš„è¿‡ç¨‹ä¹Ÿæ˜¯è‡ªæˆ‘å®Œå–„çš„è¿‡ç¨‹ï¼Œç®€ç§°â€œå€Ÿç‰©å¾—é“â€ï¼ŒåŒæ—¶å¦‚æœè¯»è€…é’ˆå¯¹è¿™ä¸ªåœºæ™¯æœ‰æ›´åˆé€‚çš„è®¾è®¡ä¹Ÿæ¬¢è¿åœ¨ä¸‹æ–¹ä¸€èµ·è®¨è®ºã€‚\n","date":"2024-10-12T19:15:11+08:00","image":"https://sherlock-lin.github.io/p/%E5%85%B3%E4%BA%8E%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98%E7%9A%84%E6%80%9D%E8%80%83%E4%BB%A5%E5%8F%8A%E8%AE%BE%E8%AE%A1/image-20240412140549821_hu14806540156354507896.png","permalink":"https://sherlock-lin.github.io/p/%E5%85%B3%E4%BA%8E%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98%E7%9A%84%E6%80%9D%E8%80%83%E4%BB%A5%E5%8F%8A%E8%AE%BE%E8%AE%A1/","title":"å…³äºç³»ç»Ÿæ•°æ®ç¼“å­˜çš„æ€è€ƒä»¥åŠè®¾è®¡"},{"content":"Mavenä¾èµ– 1 2 3 4 5 \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-connector-mysql-cdc\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ç¨‹åº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 public static void main(String[] args) throws Exception { //TODO 1. è·å–æ‰§è¡Œç¯å¢ƒ StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); env.setParallelism(1); //TODO 2. åˆ›å»ºMySqlSourceå¹¶æä¾›è¿æ¥mysqlçš„ä¿¡æ¯ MySqlSource\u0026lt;String\u0026gt; mySqlSource = MySqlSource.\u0026lt;String\u0026gt;builder() .hostname(\u0026#34;localhost\u0026#34;) .port(3306) .username(\u0026#34;root\u0026#34;) .password(\u0026#34;12345678\u0026#34;) .databaseList(\u0026#34;test\u0026#34;) .tableList(\u0026#34;test.t_user\u0026#34;) .startupOptions(StartupOptions.initial()) .deserializer(new JsonDebeziumDeserializationSchema()) .build(); //TODO 3. å°†sourceè£…è½½è¿›ç¯å¢ƒå˜é‡é‡Œ DataStreamSource\u0026lt;String\u0026gt; mysqlSourceDS = env.fromSource(mySqlSource, WatermarkStrategy.noWatermarks(), \u0026#34;MysqlSource\u0026#34;); //TODO 4. æ‰“å°æ•°æ® mysqlSourceDS.print(); //TODO 5. å¯åŠ¨ä»»åŠ¡ env.execute(\u0026#34;Print MySQL Snapshot + Binlog\u0026#34;); } éªŒè¯ æ–°å¢ å¯åŠ¨ç¨‹åºï¼Œç„¶ååœ¨mysql teståº“t_userè¡¨ä¸‹æ’å…¥æ•°æ®\n1 insert into t_user value (124,\u0026#39;test\u0026#39;, 18, 1); é€šè¿‡æ§åˆ¶å°å¯ä»¥çœ‹åˆ°è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸç›‘å¬\n1 {\u0026#34;before\u0026#34;:null,\u0026#34;after\u0026#34;:{\u0026#34;id\u0026#34;:124,\u0026#34;name\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;age\u0026#34;:18,\u0026#34;status\u0026#34;:1},\u0026#34;source\u0026#34;:{\u0026#34;version\u0026#34;:\u0026#34;1.9.8.Final\u0026#34;,\u0026#34;connector\u0026#34;:\u0026#34;mysql\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;mysql_binlog_source\u0026#34;,\u0026#34;ts_ms\u0026#34;:1728610478000,\u0026#34;snapshot\u0026#34;:\u0026#34;false\u0026#34;,\u0026#34;db\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;sequence\u0026#34;:null,\u0026#34;table\u0026#34;:\u0026#34;t_user\u0026#34;,\u0026#34;server_id\u0026#34;:1,\u0026#34;gtid\u0026#34;:null,\u0026#34;file\u0026#34;:\u0026#34;binlog.000007\u0026#34;,\u0026#34;pos\u0026#34;:7510723,\u0026#34;row\u0026#34;:0,\u0026#34;thread\u0026#34;:490,\u0026#34;query\u0026#34;:null},\u0026#34;op\u0026#34;:\u0026#34;c\u0026#34;,\u0026#34;ts_ms\u0026#34;:1728610478607,\u0026#34;transaction\u0026#34;:null} æ›´æ–° é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤æ‰§è¡Œæ›´æ–°æ“ä½œ\n1 update t_user SET status = 0 WHERE ID = 124; é€šè¿‡æ§åˆ¶å°å¯ä»¥çœ‹åˆ°è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼Œè·Ÿæ–°å¢çš„å·®å¼‚æ˜¯ï¼Œopé‚£é‡Œä»cå˜æˆäº†uï¼Œå¹¶ä¸”beforeå†…ä¹Ÿæœ‰æ•°æ®äº†ï¼Œæ˜¯å˜æ›´å‰çš„å†…å®¹\n1 {\u0026#34;before\u0026#34;:{\u0026#34;id\u0026#34;:124,\u0026#34;name\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;age\u0026#34;:18,\u0026#34;status\u0026#34;:1},\u0026#34;after\u0026#34;:{\u0026#34;id\u0026#34;:124,\u0026#34;name\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;age\u0026#34;:18,\u0026#34;status\u0026#34;:0},\u0026#34;source\u0026#34;:{\u0026#34;version\u0026#34;:\u0026#34;1.9.8.Final\u0026#34;,\u0026#34;connector\u0026#34;:\u0026#34;mysql\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;mysql_binlog_source\u0026#34;,\u0026#34;ts_ms\u0026#34;:1728613503000,\u0026#34;snapshot\u0026#34;:\u0026#34;false\u0026#34;,\u0026#34;db\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;sequence\u0026#34;:null,\u0026#34;table\u0026#34;:\u0026#34;t_user\u0026#34;,\u0026#34;server_id\u0026#34;:1,\u0026#34;gtid\u0026#34;:null,\u0026#34;file\u0026#34;:\u0026#34;binlog.000007\u0026#34;,\u0026#34;pos\u0026#34;:7511031,\u0026#34;row\u0026#34;:0,\u0026#34;thread\u0026#34;:491,\u0026#34;query\u0026#34;:null},\u0026#34;op\u0026#34;:\u0026#34;u\u0026#34;,\u0026#34;ts_ms\u0026#34;:1728613503293,\u0026#34;transaction\u0026#34;:null} åˆ é™¤ 1 DELETE FROM t_user WHERE ID = 124; ç›¸æ¯”ä¹‹å‰çš„æ‰“å°ä¿¡æ¯ï¼Œopå˜æˆäº†dï¼Œå¹¶ä¸”beforeæœ‰åˆ é™¤ä¹‹å‰çš„ä¿¡æ¯ï¼Œafterå˜æˆäº†null\n1 {\u0026#34;before\u0026#34;:{\u0026#34;id\u0026#34;:124,\u0026#34;name\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;age\u0026#34;:18,\u0026#34;status\u0026#34;:0},\u0026#34;after\u0026#34;:null,\u0026#34;source\u0026#34;:{\u0026#34;version\u0026#34;:\u0026#34;1.9.8.Final\u0026#34;,\u0026#34;connector\u0026#34;:\u0026#34;mysql\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;mysql_binlog_source\u0026#34;,\u0026#34;ts_ms\u0026#34;:1728613633000,\u0026#34;snapshot\u0026#34;:\u0026#34;false\u0026#34;,\u0026#34;db\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;sequence\u0026#34;:null,\u0026#34;table\u0026#34;:\u0026#34;t_user\u0026#34;,\u0026#34;server_id\u0026#34;:1,\u0026#34;gtid\u0026#34;:null,\u0026#34;file\u0026#34;:\u0026#34;binlog.000007\u0026#34;,\u0026#34;pos\u0026#34;:7511348,\u0026#34;row\u0026#34;:0,\u0026#34;thread\u0026#34;:491,\u0026#34;query\u0026#34;:null},\u0026#34;op\u0026#34;:\u0026#34;d\u0026#34;,\u0026#34;ts_ms\u0026#34;:1728613633915,\u0026#34;transaction\u0026#34;:null} å‚è€ƒ å®˜æ–¹æ–‡æ¡£ ","date":"2024-10-11T10:29:13+08:00","image":"https://sherlock-lin.github.io/p/flinkcdc%E8%AF%BB%E5%8F%96binlog%E6%A0%B7%E4%BE%8B/the-creative-exchange-d2zvqp3fpro-unsplash_hu5876398126655421130.jpg","permalink":"https://sherlock-lin.github.io/p/flinkcdc%E8%AF%BB%E5%8F%96binlog%E6%A0%B7%E4%BE%8B/","title":"FlinkCDCè¯»å–binlogæ ·ä¾‹"},{"content":"ç‰ˆæœ¬ Pulsar: 3.3.0 Flink: 1.18.0 Mavenä¾èµ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;properties\u0026gt; \u0026lt;flink.version\u0026gt;1.18.0\u0026lt;/flink.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!--è¿æ¥å™¨ç®¡ç†--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-connector-base\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${flink.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-connector-pulsar\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.1.0-1.18\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; Flinkè¯»å–Pulsar ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 public class PulsarExample { public static String serverUrl = \u0026#34;http://localhost:8081\u0026#34;; public static void main(String[] args) throws Exception { /*1. åˆ›å»ºç¯å¢ƒå˜é‡*/ StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); //Flinkç›¸å…³é…ç½®(éå¿…è¦) // env.disableOperatorChaining(); // env.enableCheckpointing(60 * 1000 * 5, CheckpointingMode.EXACTLY_ONCE); // env.getCheckpointConfig().setCheckpointTimeout(60000); // env.setStateBackend(new MemoryStateBackend()); // env.setRestartStrategy(RestartStrategies.fixedDelayRestart(0, 3 * 1000)); /*2. ä»Pulsarä¸­è¯»å–æ•°æ®*/ PulsarSource\u0026lt;String\u0026gt; source = PulsarSource.builder() .setServiceUrl(serverUrl) .setStartCursor(StartCursor.earliest()) .setTopics(\u0026#34;public/sherlock-namespace-1/my-topic\u0026#34;) .setDeserializationSchema(new SimpleStringSchema()) .setSubscriptionName(\u0026#34;my-subscription-1\u0026#34;) .build(); DataStreamSource\u0026lt;String\u0026gt; streamSource = env.fromSource(source, WatermarkStrategy.noWatermarks(), \u0026#34;Pulsar \u0026#34; + \u0026#34;Source\u0026#34;); /*3. æ‰“å°æ•°æ®*/ streamSource.print(); /*4. å¯åŠ¨ä»»åŠ¡*/ env.execute(); } } éªŒè¯ å¯åŠ¨è¯»Pulsarç¨‹åº ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œç›´æ¥åœ¨IDEAä¸­å¯åŠ¨å³å¯\nå…ˆå¾€Pulsarä¸­å†™å…¥æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 public static void commonProducer() throws Exception { final String topic = \u0026#34;persistent://public/sherlock-namespace-1/my-topic\u0026#34;; Producer\u0026lt;String\u0026gt; producer = pulsarClient.newProducer(Schema.STRING).topic(topic).create(); for (int i = 0; i \u0026lt; 10000; i++) { producer.send(\u0026#34;hello java API pulsar:\u0026#34; + i + \u0026#34;, å½“å‰æ—¶é—´ä¸ºï¼š\u0026#34; + new Date()); System.out.println(\u0026#34;hello java API pulsar:\u0026#34; + i + \u0026#34;, å½“å‰æ—¶é—´ä¸ºï¼š\u0026#34; + new Date()); } producer.close(); } æŸ¥çœ‹ç®¡ç†å¹³å° åœ¨ç®¡ç†é¡µé¢å¯ä»¥çœ‹åˆ°æœ‰æ•°æ®å†™å…¥ï¼ŒåŒæ—¶ä¹Ÿæœ‰æ•°æ®æµå‡ºï¼Œå¹¶ä¸”èƒ½çœ‹åˆ°åä¸º my-subscription-1çš„è®¢é˜…è€…ï¼Œè¿™ä¹Ÿæ˜¯å’±ä»¬Flinkç¨‹åºä¸­å®šä¹‰çš„è®¢é˜…åç§°ã€‚\næŸ¥çœ‹ç¨‹åºæ§åˆ¶å° Flinkå†™æ•°æ®åˆ°Pulsar ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 public class PulsarSinkExample { public static String serverUrl = \u0026#34;http://localhost:8081\u0026#34;; public static String adminUrl = \u0026#34;pulsar://localhost:6650\u0026#34;; public static void main(String[] args) throws Exception { /*1. åˆ›å»ºç¯å¢ƒå˜é‡*/ StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); //Flinkç›¸å…³é…ç½®(éå¿…è¦) // env.disableOperatorChaining(); // env.enableCheckpointing(60*1000*5, CheckpointingMode.EXACTLY_ONCE); // env.getCheckpointConfig().setCheckpointTimeout(60000); // env.setStateBackend(new MemoryStateBackend()); // env.setRestartStrategy(RestartStrategies.fixedDelayRestart(0, 3 * 1000)); /*2. ä»Pulsarä¸­è¯»å–æ•°æ®*/ PulsarSource\u0026lt;String\u0026gt; source = PulsarSource.builder() .setServiceUrl(serverUrl) .setStartCursor(StartCursor.earliest()) .setTopics(\u0026#34;public/sherlock-namespace-1/my-topic\u0026#34;) .setDeserializationSchema(new SimpleStringSchema()) .setSubscriptionName(\u0026#34;my-subscription-1\u0026#34;) .build(); DataStreamSource\u0026lt;String\u0026gt; streamSource = env.fromSource(source, WatermarkStrategy.noWatermarks(), \u0026#34;Pulsar \u0026#34; + \u0026#34;Source\u0026#34;); //å®šä¹‰è¾“å‡ºçš„topic String topic = \u0026#34;persistent://public/sherlock-namespace-1/my-topic-output\u0026#34;; /*3. å†™åˆ°Pulsarä¸­*/ PulsarSink\u0026lt;String\u0026gt; sink = PulsarSink.builder() .setServiceUrl(serverUrl) .setAdminUrl(adminUrl) .setTopics(topic) .setSerializationSchema(new SimpleStringSchema()) .setDeliveryGuarantee(DeliveryGuarantee.AT_LEAST_ONCE) .build(); streamSource.sinkTo(sink); /*4. å¯åŠ¨ä»»åŠ¡*/ env.execute(); } } éªŒè¯ å¯åŠ¨å†™åˆ°Pulsarç¨‹åº æŸ¥çœ‹ç®¡ç†å¹³å° å¯åŠ¨ç¨‹åºï¼Œè¯»å–Topic my-topicçš„æ•°æ®å¹¶å†™åˆ°my-topic-output ä¸­ï¼ŒæŸ¥çœ‹ç®¡ç†é¡µé¢å¯ä»¥çœ‹åˆ°æ•°æ®å·²å†™åˆ°my-topic-output ä¸­\nå¯åŠ¨æ¶ˆè´¹Topicç¨‹åº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public static void commonConsumer() throws Exception { final String topic = \u0026#34;persistent://public/sherlock-namespace-1/my-topic-output\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); Consumer consumer = pulsarClient.newConsumer(Schema.STRING).topic(topic).subscriptionType(SubscriptionType.Shared).subscriptionName(\u0026#34;sub_07\u0026#34;).subscribe(); while (true) { Message\u0026lt;String\u0026gt; message = consumer.receive(); String msg = message.getValue(); System.out.println(\u0026#34;æ¶ˆæ¯æ•°æ®ä¸ºï¼š\u0026#34; + msg); consumer.acknowledge(message); } } æŸ¥çœ‹ç¨‹åºæ§åˆ¶å° é€šè¿‡ç¨‹åºæ¶ˆè´¹æ­¤Topicæ•°æ®(ç”±äºJavaç¨‹åºæ¶ˆè´¹æŠ¥é”™ï¼Œå› æ­¤è¿™é‡Œæ”¹ç”¨Flinkæ¥æ¶ˆè´¹éªŒè¯)ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®æ˜¯æ­£å¸¸çš„è¢«å†™åˆ°Pulsaräº†\né—®é¢˜ åœ¨å¯åŠ¨Javaå®¢æˆ·ç«¯ä»£ç æ¶ˆè´¹Flinkå†™åˆ°Pulsarçš„æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæŠ¥ä»¥ä¸‹é”™ï¼Œæœ‰è¶£çš„æ˜¯é€šè¿‡Flinkæ˜¯èƒ½å¤Ÿæ­£å¸¸è¯»å–çš„\nåœ¨å®˜æ–¹ä¹Ÿæ‰¾åˆ°ç›¸åŒçš„ case\n1 2 3 4 5 Exception in thread \u0026#34;main\u0026#34; org.apache.pulsar.client.api.PulsarClientException$IncompatibleSchemaException: {\u0026#34;errorMsg\u0026#34;:\u0026#34;Topic does not have schema to check\u0026#34;,\u0026#34;reqId\u0026#34;:503535884505001157, \u0026#34;remote\u0026#34;:\u0026#34;localhost/127.0.0.1:6650\u0026#34;, \u0026#34;local\u0026#34;:\u0026#34;/127.0.0.1:61406\u0026#34;} at org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:1069) at org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribe(ConsumerBuilderImpl.java:103) at com.sherlock.admin.ManagerConsumer.commonConsumer(ManagerConsumer.java:59) at com.sherlock.admin.ManagerConsumer.main(ManagerConsumer.java:39) å‚è€ƒ å®˜æ–¹æ–‡æ¡£\nå…¶ä»–ç‰ˆæœ¬çš„å®˜æ–¹æ–‡æ¡£\n","date":"2024-10-10T21:24:43+08:00","image":"https://sherlock-lin.github.io/p/flink%E9%9B%86%E6%88%90pulsar%E8%BF%9B%E8%A1%8C%E8%AF%BB%E5%86%99/image-20241010212758255_hu1641948039960571053.png","permalink":"https://sherlock-lin.github.io/p/flink%E9%9B%86%E6%88%90pulsar%E8%BF%9B%E8%A1%8C%E8%AF%BB%E5%86%99/","title":"Flinké›†æˆPulsarè¿›è¡Œè¯»å†™"},{"content":"ç¯å¢ƒå‡†å¤‡ ç»„ä»¶ç‰ˆæœ¬ Pulsar(3.3.0)\nMysql(8.0.39 Homebrewæ–¹å¼å®‰è£…)\nPulsarè¿æ¥æ’ä»¶ pulsar-io-debezium-mysql-3.3.0.nar\næ’ä»¶ä¸‹è½½åœ°å€ï¼Œé€‰æ‹©è‡ªå·±Pulsarå¯¹åº”çš„ç‰ˆæœ¬ä¸‹è½½ä½¿ç”¨å³å¯\nMySQLå¼€å¯binlog å¦‚æœæ˜¯mysql5çš„éœ€è¦å¼€å¯ï¼Œmysql8çš„è¯é»˜è®¤å¼€å¯ï¼Œç”±äºæœ¬æ¬¡ä½¿ç”¨çš„æ˜¯mysql8ï¼Œå› æ­¤mysqlæ— é¡»åšä»»ä½•æ“ä½œ\né…ç½®debezium-mysql-source-config.yamlï¼ˆæ–‡ä»¶åå¯è‡ªå®šä¹‰ï¼‰ åœ¨connectorsç›®å½•ä¸‹åˆ›å»ºdebezium-mysql-source-config.yamlæ–‡ä»¶ï¼Œç”¨äºsourceçš„å¯åŠ¨ï¼Œé…ç½®è¯¦æƒ…å¦‚ä¸‹(å¯ç›´æ¥ä½¿ç”¨)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 tenant: \u0026#34;sherlock-warehouse\u0026#34; # pulsarç§Ÿæˆ·ï¼Œå¯è‡ªå®šä¹‰ namespace: \u0026#34;sherlock-namespace-1\u0026#34; # pulsarå‘½åç©ºé—´ï¼Œå¯è‡ªå®šä¹‰ name: \u0026#34;debezium-mysql-source\u0026#34; # sourceåï¼Œå¯è‡ªå®šä¹‰ topicName: \u0026#34;debezium-mysql-topic\u0026#34; # topicåï¼Œå¯è‡ªå®šä¹‰ archive: \u0026#34;connectors/pulsar-io-debezium-mysql-3.3.0.nar\u0026#34; # naræ–‡ä»¶çš„å­˜æ”¾ä½ç½®ï¼Œä¸€èˆ¬æ”¾åœ¨Pulsarå®‰è£…ç›®å½•ä¸‹çš„connectors parallelism: 1 #å¹¶è¡Œåº¦ configs: ## config for mysql, docker image: debezium/example-mysql:0.8 database.hostname: \u0026#34;localhost\u0026#34; # æ•°æ®åº“ip database.port: \u0026#34;3306\u0026#34;\t# æ•°æ®åº“port database.user: \u0026#34;root\u0026#34;\t# æ•°æ®åº“ç”¨æˆ·å database.password: \u0026#34;12345678\u0026#34; # æ•°æ®åº“å¯†ç  database.server.id: \u0026#34;1\u0026#34;\t# mysqlå®ä¾‹çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯¹åº”my.iniä¸‹çš„server-idå€¼ï¼Œmysql8çš„è¯ç›´æ¥å¡«1å³å¯ database.server.name: \u0026#34;dbserver1\u0026#34; # æœåŠ¡åï¼ŒPulsarä¼šæ ¹æ®å®ƒæ‹¼æ¥Topic database.whitelist: \u0026#34;flink\u0026#34;\t# éœ€è¦è®¿é—®çš„æ•°æ®åº“ ## database.exclude.list: \u0026#34;demo_dap\u0026#34; # ä¸éœ€è¦è®¿é—®çš„æ•°æ®åº“ï¼Œå¯ä»¥æ²¡æœ‰è¿™ä¸€æ¡ ## table.include.list:\u0026#34;demo_esb.ack_sample,demo_esb.aac_sample\u0026#34; #éœ€è¦è®¿é—®çš„è¡¨ï¼Œä¸å¡«é»˜è®¤æ‰€æœ‰è¡¨ ## table.exclude.list:\u0026#34;demo_esb.ack sample_test\u0026#34; # ä¸éœ€è¦è®¿é—®çš„æ•°æ®è¡¨ï¼Œé€‰å¡« ## column.include.list:\u0026#34;demo_esb.ack_sample.s_ID,demo_esb.ack_sample.s_coDE\u0026#34; # éœ€è¦è®¿é—®çš„åˆ—ï¼Œä¸å¡«é»˜è®¤æ‰€æœ‰åˆ— ##column.exclude.list:\u0026#34;demo_esb.ack_sample.s TEsri # ä¸éœ€è¦è®¿é—®çš„åˆ—ï¼Œé€‰å¡« ## include.schema.changes:true\u0026#34; # åŒ…å«schemaçš„æ”¹å˜ï¼Œå¯ä»¥æ²¡æœ‰è¿™ä¸€æ¡ snapshot.mode: \u0026#34;schema_only_recovery\u0026#34; database.history: \u0026#34;org.apache.pulsar.io.debezium.PulsarDatabaseHistory\u0026#34; database.history.pulsar.topic: \u0026#34;history-topic\u0026#34; database.history.pulsar.service.url: \u0026#34;pulsar://127.0.0.1:6650\u0026#34;\t# pulsaré›†ç¾¤æœåŠ¡åœ°å€ ## KEY_CONVERTER_CLASS_CONFIG, VALUE_CONVERTER_CLASS_CONFIG key.converter: \u0026#34;org.apache.kafka.connect.json.JsonConverter\u0026#34; value.converter: \u0026#34;org.apache.kafka.connect.json.JsonConverter\u0026#34; ## OFFSET_STORAGE_TOPIC_CONFIG offset.storage.topic: \u0026#34;offset-topic\u0026#34; å¯åŠ¨ MySQLå¯åŠ¨ 1 sudo mysql.server start pulsarå¯åŠ¨ 1 2 3 bin/pulsar-daemon start zookeeper bin/pulsar-daemon start bookie bin/pulsar-daemon start broker ä¹Ÿå¯ä»¥ä»¥å•èŠ‚ç‚¹æ–¹å¼å¯åŠ¨Broker pulsar standalone\npulsar-source(mysql)å¯åŠ¨ 1 bin/pulsar-admin source localrun --source-config-file connectors/debezium-mysql-source-config.yaml æŸ¥çœ‹pulsarå¯¹åº”çš„namespaceä¸‹å·²åˆ›å»ºå¯¹åº”çš„Topicï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ä¸‰å±‚ç®¡ç†å¦‚ dbserver1.flink.user\ndbserver1æ˜¯ç”¨æ¥æ ‡è®°è¿™ä¸ªflink sourceå®ä¾‹ï¼Œflinkæ˜¯ç›‘å¬çš„æ•°æ®åº“ï¼Œuseræ˜¯ç›‘å¬çš„è¡¨ã€‚ä¹Ÿå°±æ˜¯æ¯å¼ è¢«ç›‘å¬çš„mysqlè¡¨åœ¨pulsaréƒ½æœ‰å”¯ä¸€å¯¹åº”çš„Topic\néªŒè¯ å¯åŠ¨Pulsar æ¶ˆè´¹è€… 1 bin/pulsar-client consume -s \u0026#34;first-subscription\u0026#34; persistent://sherlock-warehouse/sherlock-namespace-1/dbserver1.flink.user -n 0 æ’å…¥æ•°æ® 1 insert into `user`(`name`,`age`,`status`) values (\u0026#39;hadoop123\u0026#39;,17,0); æŸ¥çœ‹æ¶ˆè´¹æƒ…å†µ æŸ¥çœ‹æ¶ˆè´¹æƒ…å†µ(æ‰¹é‡æ’å…¥) é€šè¿‡fakerç”Ÿæˆå¤šæ¡ä¿¡æ¯æ’å…¥åˆ°mysqlï¼Œå¯ä»¥å®æ—¶çœ‹åˆ°pulsarä¹Ÿç›‘å¬åˆ°æœ€æ–°çš„æ•°æ®å˜åŠ¨\né—®é¢˜åˆ†æ å¯åŠ¨sourceæŠ¥é”™ åˆ†æåå‘ç°å¯èƒ½æ˜¯åœ¨ç›‘å¬mysqlå†å²å˜æ›´binlogæ—¶å‡ºç°å¼‚å¸¸å¯¼è‡´çš„ï¼Œç”±äºæœ¬æ¬¡åªæ˜¯æµ‹è¯•éªŒè¯ï¼Œå› æ­¤æ–°å»ºä¸€ä¸ªmysql æ•°æ®åº“ä»¥åŠè¡¨æ¥è¿›è¡ŒéªŒè¯ï¼Œé€šè¿‡æ–°åº“è¡¨éªŒè¯ä¸ä¼šæŠ¥æ­¤é—®é¢˜\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 2024-09-29T17:55:42,424+0800 [blc-localhost:3306] ERROR io.debezium.connector.mysql.MySqlStreamingChangeEventSource - Error during binlog processing. Last offset stored = {transaction_id=null, file=binlog.000004, pos=4905, server_id=1, event=1}, binlog reader near position = binlog.000004/4980 2024-09-29T17:55:42,424+0800 [blc-localhost:3306] ERROR io.debezium.pipeline.ErrorHandler - Producer failure io.debezium.DebeziumException: Error processing binlog event at io.debezium.connector.mysql.MySqlStreamingChangeEventSource.handleEvent(MySqlStreamingChangeEventSource.java:374) ~[debezium-connector-mysql-1.9.7.Final.jar:1.9.7.Final] at io.debezium.connector.mysql.MySqlStreamingChangeEventSource.lambda$execute$25(MySqlStreamingChangeEventSource.java:874) ~[debezium-connector-mysql-1.9.7.Final.jar:1.9.7.Final] at com.github.shyiko.mysql.binlog.BinaryLogClient.notifyEventListeners(BinaryLogClient.java:1246) [mysql-binlog-connector-java-0.27.2.jar:0.27.2] at com.github.shyiko.mysql.binlog.BinaryLogClient.listenForEventPackets(BinaryLogClient.java:1072) [mysql-binlog-connector-java-0.27.2.jar:0.27.2] at com.github.shyiko.mysql.binlog.BinaryLogClient.connect(BinaryLogClient.java:631) [mysql-binlog-connector-java-0.27.2.jar:0.27.2] at com.github.shyiko.mysql.binlog.BinaryLogClient$7.run(BinaryLogClient.java:932) [mysql-binlog-connector-java-0.27.2.jar:0.27.2] at java.base/java.lang.Thread.run(Thread.java:842) [?:?] Caused by: io.debezium.DebeziumException: Encountered change event for table test.test whose schema isn\u0026#39;t known to this connector at io.debezium.connector.mysql.MySqlStreamingChangeEventSource.informAboutUnknownTableIfRequired(MySqlStreamingChangeEventSource.java:650) ~[debezium-connector-mysql-1.9.7.Final.jar:1.9.7.Final] at io.debezium.connector.mysql.MySqlStreamingChangeEventSource.informAboutUnknownTableIfRequired(MySqlStreamingChangeEventSource.java:691) ~[debezium-connector-mysql-1.9.7.Final.jar:1.9.7.Final] at io.debezium.connector.mysql.MySqlStreamingChangeEventSource.handleUpdateTableMetadata(MySqlStreamingChangeEventSource.java:628) ~[debezium-connector-mysql-1.9.7.Final.jar:1.9.7.Final] at io.debezium.connector.mysql.MySqlStreamingChangeEventSource.lambda$execute$13(MySqlStreamingChangeEventSource.java:845) ~[debezium-connector-mysql-1.9.7.Final.jar:1.9.7.Final] at io.debezium.connector.mysql.MySqlStreamingChangeEventSource.handleEvent(MySqlStreamingChangeEventSource.java:354) ~[debezium-connector-mysql-1.9.7.Final.jar:1.9.7.Final] ... 6 more å¯åŠ¨æ¶ˆè´¹æŠ¥é”™ ç”¨javaå®¢æˆ·ç«¯æ¶ˆè´¹æŠ¥çš„é”™ï¼Œ\n1 2 3 4 5 Exception in thread \u0026#34;main\u0026#34; org.apache.pulsar.client.api.PulsarClientException$IncompatibleSchemaException: {\u0026#34;errorMsg\u0026#34;:\u0026#34;Key schemas or Value schemas are different schema type, from key schema type is JSON and to key schema is BYTES, from value schema is JSON and to value schema is BYTES\u0026#34;,\u0026#34;reqId\u0026#34;:2131068157376809305, \u0026#34;remote\u0026#34;:\u0026#34;localhost/127.0.0.1:6650\u0026#34;, \u0026#34;local\u0026#34;:\u0026#34;/127.0.0.1:50274\u0026#34;} at org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:1069) at org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribe(ConsumerBuilderImpl.java:103) at com.sherlock.admin.ManagerConsumer.binLogConsumer(ManagerConsumer.java:130) at com.sherlock.admin.ManagerConsumer.main(ManagerConsumer.java:42) æ€»ç»“ å¯ä»¥çœ‹åˆ°é›†æˆè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™ä¸ªå·¥ä½œæ€è·¯æœ¬è´¨ä¸Šè·ŸFlink CDCçš„æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å¯¹å¼€æºçš„debeziumè¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œdebeziumæ˜¯ä¸€ä¸ªjavaå¼€å‘çš„ä¸“é—¨ç”¨äºç›‘å¬æ•°æ®åº“å˜åŒ–çš„é¡¹ç›®ï¼Œå› æ­¤å¦‚æœæƒ³æ·±å…¥äº†è§£æ•°æ®åº“æ•°æ®å˜åŒ–æ„ŸçŸ¥ç»†èŠ‚çš„è¯å¯ä»¥å¯¹å®ƒè¿›è¡Œç ”ç©¶ã€‚å¦‚æœå½“å‰å…¬å¸ç”Ÿæ€æ˜¯é‡‡ç”¨çš„Pulsarï¼Œä¾‹å¦‚IoTè¡Œä¸šçš„å…¬å¸ï¼Œæœ‰åŒæ­¥æ•°æ®åº“çš„åœºæ™¯ä½†æ˜¯ä¸æƒ³ä¾èµ–å…¶ä»–å¤§æ•°æ®ç›¸å…³çš„ç»„ä»¶å¦‚Flinkç­‰ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ç›´æ¥ä½¿ç”¨Pulsar IOè¿›è¡Œæ•°æ®é›†æˆã€‚\nå‚è€ƒæ–‡çŒ® Pulsar IOä¹‹CDC Debezium Connector Pulsaré›†æˆDebeziumç›‘å¬MySQLæ—¥å¿— å®˜æ–¹é…ç½®ä»‹ç» ","date":"2024-10-08T17:29:07+08:00","image":"https://sherlock-lin.github.io/p/pulsario%E9%9B%86%E6%88%90mysql/image-20241008163436302_hu2242598783164892916.png","permalink":"https://sherlock-lin.github.io/p/pulsario%E9%9B%86%E6%88%90mysql/","title":"PulsarIOé›†æˆmysql"},{"content":"ç®€æ è·ç¦»åˆæ¬¡å†™ç¬”è®°/åšå®¢å·²ç»å·®ä¸å¤šåå¹´äº†ï¼Œè¿™å…¶ä¸­æ¢äº†ä¸å°‘å¹³å°ï¼Œæ¯æ¬¡æ¢å¹³å°éƒ½å°‘ä¸äº†ä¸€é¡¿æŠ˜è…¾ï¼Œå¯¼è‡´æœ‰æ®µæ—¶é—´éƒ½ä¸æ€ä¹ˆå–œæ¬¢å†™åšå®¢äº†ï¼Œæ›´å–œæ¬¢ä»¥ç¬”è®°çš„æ–¹å¼è®°å½•ä¸‹ï¼Œç°åœ¨åœ¨åŸºäºgithubæ­å»ºå®Œåšå®¢åï¼Œç»ˆäºæœ‰ç§å®‰å¿ƒçš„æ„Ÿè§‰äº†ï¼Œä¸ç¦æ€è€ƒèµ·ï¼Œæ‰¿è½½åšå®¢çš„æœ€ç»ˆå½¢å¼åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œé¦–å…ˆå…ˆç®€å•å›é¡¾è¿™äº›å¹´ç”¨è¿‡çš„åšå®¢ç½‘ç«™å§ã€‚\nV1(CSDN) æ—¶é—´ï¼š15ï½18å¹´\n15å¹´æ—¶å€™å¼€å§‹æƒ³è¾“å‡ºæŠ€æœ¯æ–‡ç« ï¼Œåœ¨å¹³æ—¶æŸ¥é˜…èµ„æ–™ä»¥åŠå‘¨å›´åŒå­¦äº¤æµæ—¶ï¼Œè§‰å¾—CSDNå¾ˆç«ï¼Œäºæ˜¯å°±åœ¨CSDNä¸Šæ³¨å†Œäº†å·å¹¶ä¸”æŒç»­è¾“å‡ºæ–‡ç« ï¼Œå½“æ—¶æ¥è§¦äº†å¾ˆå¤šæ–°æŠ€æœ¯ï¼Œä½†æ˜¯å†™çš„å¤§éƒ¨åˆ†å†…å®¹å®é™…ä¸Šéƒ½æ˜¯ä¸€äº›å¸¸è¯†ç±»çš„ä¸œè¥¿ï¼Œå¾ˆå°‘æœ‰è‡ªå·±æ·±å…¥æŒ–æ˜ã€‚å½“æ—¶é€‰æ‹©CSDNè¿˜æœ‰ä¸€äº›å…¶ä»–å› ç´ ï¼Œæ€»ç»“æ¥è¯´å°±æ˜¯å…¥é—¨é—¨æ§›ä½ã€å¼•æµå¥½ï¼Œå¯¹ä¸­æ–‡å‹å¥½ï¼Œç›¸æ¯”ä¹‹ä¸‹Githubã€è‡ªå»ºç½‘ç«™ç­‰æ¥è¯´å¯¹å°ç™½æ¥è¯´ä¸æ˜¯å¾ˆå‹å¥½ï¼Œå› æ­¤å°±è¿™æ ·ç”¨äº†å‡ å¹´çš„CSDNã€‚\nV2(segmentfault/ç®€ä¹¦/github) æ—¶é—´ï¼š18ï½19\nåœ¨æŸ¥çœ‹æŠ€æœ¯æ—¶ï¼Œè¢«ç®€ä¹¦çš„ç®€çº¦ã€æ¼‚äº®çš„ç•Œé¢å¸å¼•ä½äº†ï¼Œç›¸æ¯”CSDNå¤©èŠ±ä¹±å çš„å¹¿å‘Šä»¥åŠå……æ–¥ç€ä¸å°‘é‡å¤å†…å®¹çš„æƒ…å†µï¼Œç®€ä¹¦çš„å¸å¼•åŠ›ç®€ç›´å¤ªå¤§äº†ï¼Œäºæ˜¯å¼€å§‹åœ¨ä¸Šé¢è¿›è¡Œå†…å®¹çš„è¾“å‡ºï¼Œä½†æ˜¯æ²¡æœ‰æŒç»­å¤šä¹…ï¼Œå‘ç°è¿™ä¸Šé¢çš„å¼•æµåšå¾—ä¸æ˜¯å¾ˆå¥½ï¼Œè®¤çœŸå†™äº†ä¸å°‘æ–‡ç« åŸºæœ¬æ²¡å•¥æµé‡ï¼›åæ¥è½¬æˆ˜segmentfaultï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„ç†ç”±ã€‚ä¹‹åä¹Ÿåœ¨githubå†™è¿‡ä¸€æ®µæ—¶é—´ï¼Œgithubå¥½åœ¨å¯ä»¥æ°¸ä¹…çš„ç»™ä½ ä¿è¯æ•°æ®ä¸ä¼šä¸¢è€Œä¸”è¿™ä¸ªå¹³å°åŸºæœ¬ä¸ä¼šå€’ï¼Œä½†æ˜¯å› ä¸ºUIä»¥åŠæ²¡æœ‰ä»€ä¹ˆå¥½çš„åé¦ˆé€æ¸æ”¾å¼ƒã€‚\nV3(åšå®¢å›­/çŸ¥ä¹) æ—¶é—´ï¼š19ï½21\nåœ¨ç»å†è¿‡segmentfault/ç®€ä¹¦åï¼Œæ„ˆå‘è§‰å¾—ä¸åº”è¯¥è¿‡åº¦åœ¨ä¹ç•Œé¢ï¼Œæ›´åº”è¯¥æ³¨é‡å†…å®¹çš„è´¨é‡ï¼ŒåŒæ—¶ä¸ºäº†ä¸å†æŠ˜è…¾ï¼Œæƒ³é€‰ä¸€ä¸ªè€ç‰Œç¨³é‡ç‚¹ç½‘ç«™ï¼Œäºæ˜¯æŠŠç›®å…‰ç„å‡†äº†åšå®¢å›­ï¼Œæ•´ä½“æ¥è¯´åšå®¢å›­åº”è¯¥æ˜¯åšå¾—å¯¹å¼€å‘è€…å¾ˆå‹å¥½çš„å¹³å°ï¼Œè™½ç„¶UIæ¯”è¾ƒç®€é™‹ï¼Œä½†æ˜¯æ”¯æŒä½œè€…è‡ªå®šä¹‰UIå‘€ï¼Œé€šè¿‡csså’Œjsä¸€æ ·èƒ½è‡ªå®šä¹‰å‡ºä¼˜ç¾ã€é…·ç‚«çš„ç•Œé¢ï¼ŒåŒæ—¶å®ƒçš„åå°ç®¡ç†åŠŸèƒ½ä¹Ÿæ˜¯åšå¾—æ¯”è¾ƒå¥½çš„ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜åœ¨çŸ¥ä¹å¹¶è¡Œçš„å†™æ–‡ç« ï¼Œä½†ä¸å¾—ä¸è¯´ï¼ŒçŸ¥ä¹çš„markdownæ”¯æŒçœŸçš„ä¸è¡Œï¼Œæ›´é€‚åˆå†™ä¸€äº›å¯¹æ ¼å¼è¦æ±‚æ²¡é‚£ä¹ˆå¼ºçš„å†…å®¹ã€‚\nV4(hexoè‡ªå»ºç½‘ç«™) æ—¶é—´ï¼š21ï½22\nè™½ç„¶å¾ˆå–œæ¬¢åšå®¢å›­ï¼Œä½†æ˜¯æœ‰ä¸å°‘éœ€è¦è‡ªå·±åŠ¨æ‰‹åšçš„åœ°æ–¹äº†ï¼Œä½œä¸ºä¸€ä¸ªéå‰ç«¯è¦èŠ±ä¸å°‘æ—¶é—´å»è°ƒcsså’Œjså…¶å®æŒºæ¼ç«çš„ï¼Œåæ¥æƒ³äº†æƒ³æ—¢ç„¶åæ­£éƒ½èŠ±äº†è¿™ä¹ˆå¤šæ—¶é—´ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è‡ªå·±æ­å»ºä¸ªç½‘ç«™å‘¢ï¼Œäºæ˜¯åŸºäº hexo+github æ­å»ºäº†ä¸€ä¸ªï¼Œè™½ç„¶ä¹ŸæŠ˜è…¾äº†ä¸å°‘ï¼Œä½†å¥½æ­¹ä¸èŠ±é’±å¼„äº†ä¸€ä¸ªç¨³å®šçš„ã€å±äºè‡ªå·±çš„åšå®¢ç½‘ç«™ï¼Œä½†åæ¥æœ‰å‡ æ¬¡hexoæŠ¥é”™å¹¶ä¸”å·¥ä½œ å¿™äº†èµ·æ¥ï¼Œå°±æ‰”åœ¨é‚£é‡Œäº†ï¼›å†åæ¥ç”µè„‘é‡è£…ç³»ç»Ÿå¯¼è‡´æœ¬åœ°æ–‡ä»¶ä¸¢å¤±ï¼Œç”±äºå½“æ—¶åªæ˜¯å°†ç¼–è¯‘å¥½çš„åšå®¢æ•°æ®éƒ¨ç½²åˆ°githubï¼Œå› æ­¤githubä¹Ÿæ²¡æœ‰ä¿æŒåŸæ¥çš„æ•°æ®ï¼ŒåŸºäºè¿™ä¸ªåŸå› å°±ä¸æƒ³å†ç»§ç»­å¼„äº†\nV5(CSDN/å…¬ä¼—å·) æ—¶é—´ï¼š23ï½24\næ€è€ƒä¹‹åï¼Œè§‰å¾—ä½œä¸ºå·²ç»å·¥ä½œå¤šå¹´çš„äººå¹¶ä¸”å¯¹æŠ€æœ¯è¿˜æœ‰çƒ­æƒ…çš„äººï¼Œé¦–å…ˆå½“ä¸‹é‡ä¸­ä¹‹é‡æ˜¯ä¿æŒè¾“å‡ºæŠ€æœ¯æ–‡ç« ï¼Œå¹³å°æ˜¯å…¶æ¬¡ï¼Œåªè¦èƒ½å¤Ÿä¿æŒé«˜è´¨é‡è¾“å‡ºæ–‡ç« å†…å®¹ï¼Œè‡ªå·±çš„æ°´å¹³ä¹Ÿä¼šä¸æ–­è¿›æ­¥ï¼Œå¹³å°åªæ˜¯ä¸ªå·¥å…·è€Œå·²ï¼Œå¹¶ä¸”éšç€åœ¨CSDNè¾“å‡ºæ–‡ç« å¢å¤šä»¥åŠç²‰ä¸å¢å¤šï¼ŒCSDNä¹Ÿé€æ¸ç»™æˆ‘å¼€æ”¾äº†ä¸å°‘é…·ç‚«çš„ä¸»é¢˜ï¼Œè€Œä¸”ç”¨CSDNçš„è¯ä¹Ÿèƒ½é™ä½å†™åšå®¢çš„æˆæœ¬ï¼Œäºæ˜¯è¿™ä¸€å¹´åœ¨CSDNè´¡çŒ®äº†ä¸å°‘çš„åšå®¢ï¼ŒåŒæ—¶è§‰å¾—å…¬ä¼—å·å¯ä»¥æ‰“é€ è‡ªå·±çš„IPå¹¶ä¸”ä¹ŸæŒºé…·ç‚«çš„ï¼Œå› æ­¤æœ‰äº›è§‰å¾—è´¨é‡ä¸é”™çš„æ–‡ç« ä¹Ÿä¼šåœ¨å…¬ä¼—å·å†å‘ä¸€æ¬¡ã€‚ä½†æ˜¯éšç€åšå®¢æ•°é‡çš„å¢åŠ ï¼Œå†™åšå®¢çš„é™„åŠ æˆæœ¬åœ¨é€æ¸ä¸Šå‡ï¼Œé¦–å…ˆæ˜¯CSDNä¸æ”¯æŒå¯¼å…¥markdownæ–‡ä»¶çš„åŒæ—¶å¯¼å…¥å›¾ç‰‡ï¼Œå› æ­¤æ¯æ¬¡è¦åœ¨CSDNä¸Šå‘å¸ƒæ–‡ç« ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨çš„åœ¨ç¼–è¾‘é¡µé¢ä¸Šä¸€å¼ ä¸€å¼  çš„ä¸Šä¼ å›¾ç‰‡ï¼Œè¿™ä¸ªæ–¹å¼ç°åœ¨å›æƒ³éƒ½è§‰å¾—æŒ«ï¼›åŒç†ï¼Œå…¬ä¼—å·ä¹Ÿæ˜¯ä¸€æ ·ï¼Œç›¸å½“äºæ¯å‘ä¸€æ¬¡æ–‡ç« åŒæ ·çš„äº‹æƒ…éœ€è¦åšä¸¤éï¼Œæˆ‘é™·å…¥äº†æ²‰æ€ï½\nåœ¨é€šè¿‡æ‘¸ç´¢åï¼Œå‘ç°å…¶å®å¯ä»¥é€šè¿‡å›¾åºŠçš„æ–¹å¼ä¾‹å¦‚PicGoæ¥è§£å†³ï¼Œå°±æ˜¯åœ¨typeraå†™æ–‡ç« æ—¶ï¼Œå›¾ç‰‡ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°ç½‘ä¸Šä¾‹å¦‚giteeã€githubä¸Šï¼Œç„¶åæœ¬åœ°ç›´æ¥å¼•ç”¨ç½‘ç»œè¿æ¥ï¼Œè¿™æ ·å°±å®Œç¾è§£å†³ä¸Šè¯‰é—®é¢˜ï¼Œè¿™æ ·æœ¬åœ°ã€CSDNã€å…¬ä¼—å·çš„éƒ½é€šè¿‡ç½‘ç»œè¿æ¥è®¿é—®giteeä¸Šçš„å›¾ç‰‡èµ„æºï¼Œä»è€Œé¿å…äº†æ¯æ¬¡å‘å¸ƒç¼–è¾‘å›¾ç‰‡ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™CSDNç½‘ç«™å˜å¾—å¾ˆå¡ï¼Œ æƒ³ç¿»é˜…å†å²çš„åšå®¢èƒ½åŠ è½½å‡ ä¸ªå°æ—¶ï¼Œä»¥åŠç¼–è¾‘ä¸€äº›å†å²æ–‡ç« å†ä¿å­˜æ—¶ä¹Ÿä¼šå¡å¾ˆä¹…æˆ–è€…ç›´æ¥å¤±è´¥ï½\nè‡³äºå…¬ä¼—å·ï¼Œæ›´é€‚åˆå‘ä¸€äº›æƒå¨æˆ–è€…è¯´æ”¹åŠ¨ä¸å¤§çš„å†…å®¹ï¼Œå¦‚æœæœ‰ç¼–è¾‘è¿‡è‡ªå·±å…¬ä¼—å·æ–‡ç« çš„æœ‹å‹åº”è¯¥ä¹Ÿæ¯”è¾ƒæ¸…æ¥šï¼ŒåŸºäºè¿™ä¸ªåŸå› æˆ‘ä¹Ÿæ”¾å¼ƒäº†å…¬ä¼—å·ã€‚\nV6(hugoè‡ªå»ºç½‘ç«™) æ—¶é—´ï¼šç°åœ¨\nå›é¡¾è¿‡å»è¿™äº›å¹´çš„ç»å†ï¼Œå†ç»“åˆè‡ªå·±çš„æƒ…å†µï¼Œéœ€æ±‚é€æ¸æ¸…æ™°äº†èµ·æ¥ã€‚\nèƒŒæ™¯ï¼šæˆ‘æ˜¯è¦ç”¨ä¸€è¾ˆå­å»å‚ä¸ç¼–ç¨‹çš„ï¼Œå› æ­¤è¾“å‡ºåšå®¢æ˜¯é•¿æœŸå­˜åœ¨çš„éœ€æ±‚(å› ä¸ºç¼–ç¨‹æ˜¯è„‘åŠ›æ´»åŠ¨ï¼Œéœ€è¦æ·±åº¦æ€è€ƒï¼Œè¾“å‡ºé«˜è´¨é‡æŠ€æœ¯åšå®¢å¯ä»¥pushè‡ªå·±æŒç»­å¸æ”¶é«˜è´¨é‡æŠ€æœ¯)\nä»¥ä¸‹éœ€æ±‚æŒ‰ä¼˜å…ˆçº§æ’åºï¼š\nç¨³å®šçš„å¹³å°\næ¯æ¬¡è¿ç§»å¹³å°éƒ½æ„å‘³ç€æœ‰ä¸€å †é€‚é…çš„æ‚æ´»è¦åšï¼Œè¿™äº›äº‹æƒ…æœ¬è´¨ä¸Šå°±æ˜¯æ²¡æœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œå¯¹ä¸ªäººæ²¡æœ‰ä»»ä½•çš„æˆé•¿è€Œè¨€ï¼›ä¸éœ€è¦è¿‡å¤šå‚ä¸åˆ°å¹³å°çš„ç»´æŠ¤å·¥ä½œä¸­ï¼Œä¾‹å¦‚è‡ªå·±è´­ä¹°æœåŠ¡å™¨éƒ¨ç½²ä¹‹ç±»çš„ï¼Œä¾‹å¦‚æœ‰äº›æ—¶é—´æ¯”è¾ƒå¿™æœåŠ¡å´©äº†éƒ½ä¸çŸ¥é“ï¼Œæˆ‘æœŸæœ›çš„æ˜¯è¿™äº›æ–‡ç« æˆ‘ä¸€æ—¦å‘å¸ƒåï¼Œå³ä¾¿æˆ‘å¾ˆå¤šå¹´ä¸å»ç»´æŠ¤å®ƒï¼Œå®ƒä¹Ÿèƒ½æŒç»­å¾ˆå¥½çš„å·¥ä½œï½\nå…è´¹\nä¸€æ–¹é¢ä¸å¸Œæœ›èŠ±é’±ï¼Œå› ä¸ºä¹Ÿæ²¡æ‰“ç®—é å†™åšå®¢èµšé’±ï¼Œå¦ä¸€æ–¹é¢ï¼Œä¹Ÿå¸Œæœ›æˆ‘è®¤çœŸå†™çš„æ–‡ç« ä¸è¦ä¾èµ–æŸä¸€ä¸ªä¸ªä½“ï¼Œä¾‹å¦‚æˆ‘å¾ˆå–œæ¬¢çš„å·¦è€³æœµè€—å­ï¼Œä»–çš„æ–‡ç« æ˜¯è´­ä¹°æµ·å¤–æœåŠ¡å™¨éƒ¨ç½²çš„ï¼Œè€Œåœ¨ä»–é€å»åï¼Œå¦‚æœæœåŠ¡å™¨è¢«å›æ”¶äº†ï¼Œé‚£çœŸçš„æ˜¯ä¸€å¤§æŸå¤±ã€‚è™½ç„¶æˆ‘çš„æ–‡ç« è´¨é‡å¹¶ä¸èƒ½ç›¸æå¹¶è®ºï¼Œä½†æ˜¯ä¹Ÿæ˜¯è®¤çœŸæ€è€ƒè¿‡çš„ä¸œè¥¿ï¼Œå¦‚æœå¯ä»¥æˆ‘ä¹Ÿå¸Œæœ›å³ä½¿æˆ‘ç¦»å¼€è¿™ä¸ªä¸–ç•Œï¼Œå®ƒä¹Ÿèƒ½å¸®åˆ°åæ¥æœ‰éœ€è¦çš„å­¦å¾’ï¼Œå°±åƒç°åœ¨çš„æˆ‘ä¾ç„¶åœ¨çœ‹å·¦è€³æœµè€—å­çš„æ–‡ç« ä¸€æ ·ï¼Œå³ä¾¿ä½œè€…å·²ä¸åœ¨è¿™ä¸ªä¸–ç•Œï¼Œä½†æœ‰æ—¶å€™ä»¿ä½›åœ¨è·Ÿä½œè€…æ²Ÿé€šã€è¾©è®ºä¸€æ ·ï¼Œæ€æƒ³çš„ä¸œè¥¿å°±æ˜¯è¿™æ ·ï¼Œå› æ­¤æœ‰ä¸€ä¸ªèƒ½å¤Ÿå…è´¹å¹¶ä¸”é•¿æœŸæ‰¿è½½è¿™äº›æ€æƒ³çš„ä¸œè¥¿æ˜¯éå¸¸é‡è¦çš„\næ”¯æŒè‡ªå®šä¹‰\næ­£å¦‚æ•™å‘˜æ‰€è¯´çš„â€œæªæ å­é‡Œå‡ºæ”¿æƒâ€ï¼Œä¸€äº›å…³é”®çš„ä¸œè¥¿ä¸€å®šè¦æŠŠæ§åœ¨æ‰‹ä¸Šã€‚ä¾‹å¦‚ä¸»é¢˜çš„é€‰æ‹©ã€äº¤äº’çš„æ§åˆ¶ã€å“åº”æ€§èƒ½çš„ä¼˜åŒ–ç­‰ç­‰ï¼Œè¿™æ ·åœ¨æœªæ¥æœ‰ä»»ä½•å˜åŠ¨ï¼Œæˆ‘éƒ½èƒ½é€šè¿‡è‡ªå·±è‡ªå®šä¹‰å»è¿›è¡Œå¤„ç†\nç»´æŠ¤äººå·¥æˆæœ¬ä½/å†™æ–‡ç« æˆæœ¬ä½\nä»é•¿æœŸçš„è§’åº¦æ¥çœ‹ï¼Œä¸éœ€è¦äººç»´æŠ¤ï¼Œå¹¶ä¸”å‘å¸ƒæ–°æ–‡ç« çš„æˆæœ¬è¦å¾ˆä½ï¼Œåƒæ‰‹åŠ¨ä¸€å¼ å¼ ä¸Šä¼ å›¾ç‰‡çš„æ“ä½œç»ä¸å¯å–ï¼Œå…¶ä»–é€‚é…çš„å·¥ä½œä¹Ÿæ˜¯èƒ½å°‘å°±å°‘\nåŸºäºä»¥ä¸Šéœ€æ±‚ï¼Œæˆ‘æœ€ç»ˆçš„æ–¹æ¡ˆä¹Ÿæœ‰é›å‹äº†ï¼Œéšç€ä¸æ–­çš„å®Œå–„ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„æœ€ç»ˆå½¢æ€\né€šè¿‡æœ¬åœ°ç”µè„‘çš„typoraç¼–å†™Blogå†…å®¹ï¼Œè¿™äº›Blogéƒ½æ˜¯é€šè¿‡hugoåˆ›å»ºå¹¶ä¸”ç®¡ç†çš„ï¼ŒåŒæ—¶è¿™ä¸ªç›®å½•ä¹Ÿæ˜¯ç”±gitç®¡ç†çš„ï¼Œè¿™ä¸ªæ—¶å€™å†™å®Œæ–‡ç« ä¹Ÿå¯ä»¥é€šè¿‡hugoå¯åŠ¨æœ¬åœ°åšå®¢ç½‘ç«™è¿›è¡Œå±•ç¤ºä»¥åŠè°ƒæ•´ é€šè¿‡gitå‘½ä»¤å°†æ•°æ®pushåˆ°githubæœåŠ¡ç«¯æŒä¹…åŒ–èµ·æ¥ï¼Œæ­¤æ—¶ç›¸å½“äºæ•°æ®å·²ç»æŒä¹…åŒ–å¤‡ä»½èµ·æ¥äº†ï¼Œä¹‹åå³ä¾¿æœ¬åœ°ç”µè„‘åäº†å¯¹åšå®¢å†…å®¹éƒ½ä¸ä¼šæœ‰ä¸æ¯«çš„å½±å“ é€šè¿‡é…ç½®workflowsæ–‡ä»¶ï¼Œåœ¨ä»“åº“1æ„Ÿåº”åˆ°æœ‰æ–°çš„èµ„æºè¢«pushæ¥æ—¶ï¼Œä¼šå‡ºå‘actionï¼Œå°†ä»“åº“1æœ€æ–°çš„æ•°æ®é€šè¿‡hugoç¼–è¯‘éƒ¨ç½²åœ¨ä»“åº“2ä¸Šï¼Œç”±ä»“åº“2å¯¹å¤–æä¾›webæœåŠ¡ã€‚ åœ¨æœ‰ç”¨æˆ·åœ¨åšå®¢è¯„è®ºæ—¶ï¼Œè¯„è®ºä¿¡æ¯ä¼šè‡ªåŠ¨æŒä¹…åŒ–åˆ°ä»“åº“3ï¼Œä»¥issueçš„å½¢å¼æŒä¹…åŒ–å¹¶ä¸”æ­£å¸¸å±•ç¤ºåˆ°åšå®¢ç½‘ç«™ä¸Šï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯utteranceså·¥å…·æ¥åšçš„æŒä¹…åŒ–æ“ä½œ åœ¨åšå®¢æ­å»ºå¥½ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åšçš„åªæœ‰1ã€2ä¸¤æ­¥ï¼Œç¬¬3å’Œç¬¬4æ­¥å’±ä»¬å¯ä»¥æ°¸è¿œä¸ç”¨å»ç®¡å®ƒï¼Œå¦‚æœæœ‰äººåƒæˆ‘ä¸€æ ·è§‰å¾—ç¬¬äºŒæ­¥æ“ä½œè¾“å…¥å‡ æ¡æŒ‡ä»¤å¤ªéº»çƒ¦ï¼Œå¯ä»¥å°†èµ·å°è£…æˆä¸€ä»¶æ‰§è¡Œçš„shellè„šæœ¬ï¼Œè¿™æ ·å°±ä¹‹éœ€è¦ä¸“æ³¨Blogå†…å®¹çš„ç¼–å†™ï¼Œç¼–å†™å®Œåç‚¹ä¸€ä¸ªæŒ‰é’®ï¼Œæ•°æ®ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°ä»“åº“1ï¼Œä¹‹åå°±å¯ä»¥é€šè¿‡è®¿é—®åšå®¢ç½‘ç«™æ­£å¸¸ä½¿ç”¨äº†ã€‚\næ€»ç»“ å¦‚æœå°†è¿™ä¸ªæ•´ä¸ªåšå®¢ç³»ç»Ÿçœ‹ä½œä¸€ä¸ªè½¯ä»¶çš„è¯ï¼Œé‚£ä¹ˆåˆ†å±‚å¦‚ä¸‹\nå†èŠå›å’±ä»¬çš„æ ‡é¢˜ï¼Œä½ è§‰å¾—ç†æƒ³æƒ…å†µä¸‹ï¼Œblogçš„å½’å¤„æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿæˆ–è€…è¯´åšå®¢æ–‡ç« åº”è¯¥æ”¾åœ¨å“ªé‡Œæ˜¯æœ€å¥½çš„ï¼Ÿ\næœ‰äººä¼šè§‰å¾—ï¼Œæœ‰å¿…è¦è¿™ä¹ˆå¤§è´¹å‘¨å¼ çš„æ€è€ƒè¿™ä¸ªå—ï¼Œä½†æˆ‘è§‰å¾—è¿™æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œä»»ä½•äº‹æƒ…ä½ å¦‚æœæƒ³æŠŠå®ƒåšå¥½ï¼Œå°±ä¸€å®šè¦æœ‰é—­ç¯çš„æ€ç»´ï¼Œå¦‚æœä½ è®¤çœŸå†™äº†å‡ ç¯‡é«˜è´¨é‡çš„æ–‡ç« ï¼Œç”±äºåƒæˆ‘ä¸Šé¢ä¸€æ ·ï¼Œé€šè¿‡å¤šæ¬¡å¹³å°çš„è¿ç§»å¯¼è‡´ä¸¢å¤±äº†ä¸å°‘ï¼Œè¿™éš¾é“ä¸æ˜¯ä¸€ç§æŸå¤±å—ã€‚è¿™å°±åƒæ˜¯å·¥ä½œä¸Šçš„å¤±è¯¯å¯¼è‡´å…¬å¸çš„ä¸šåŠ¡é€ æˆæŸå¤±ï¼Œè¿™ä¸ªæŸå¤±ä¹Ÿè®¸æ˜¯å¯ä»¥æ¥å—çš„(ä¾‹å¦‚åšå®¢æ–‡ç« å†…å®¹è´¨é‡ä¸é«˜)ï¼Œä½†ä¸‡ä¸€å“ªä¸€å¤©å…¬å¸ä¸šåŠ¡èµ·æ¥äº†å‘¢ï¼Œä¹Ÿå°±æ˜¯ä½ æ–‡ç« è´¨é‡é€æ¸ä¸Šæ¥æˆ–è€…æ˜¯ä½ å¼€å§‹æŠŠå†™åšå®¢ä¹Ÿå½“ä½œäº‹ä¸šä¸€æ ·æ¥å¯¹å¾…æ—¶ï¼Œå¦‚ä½•ç»™è‡ªå·±çš„åšå®¢æ–‡ç« æä¾›ç¨³å®šæ€§ä¿éšœï¼Œè¿™å°±éœ€è¦å¥½å¥½æ€è€ƒäº†ä¹Ÿå°±æ˜¯æ ‡é¢˜çš„é—®é¢˜ã€‚\nå¦‚æœæœ‰å…¶ä»–æ›´å¥½çš„è®¾è®¡ï¼Œæ¬¢è¿åœ¨åº•ä¸‹è¯„è®ºã€‚è¡¥å……è¯´æ˜ä¸‹ï¼Œä¸Šé¢æåˆ°çš„æ‰€æœ‰å¹³å°ä¸æ’é™¤ä½œè€…æ‰“å¼€æ–¹å¼ä¸å¯¹ï¼Œä»…ä¾›è¯»è€…å‚è€ƒï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆä¹Ÿæ˜¯ï¼Œä»…ä¾›å‚è€ƒï¼Œå¸Œæœ›èƒ½è®©æœ‰åŒæ ·éœ€æ±‚çš„åŒå­¦å°‘èµ°ä¸€ç‚¹å¼¯è·¯ï¼Œè¿™å°±æ˜¯æˆ‘å†™æœ¬ç¯‡æ–‡ç« çš„åˆè¡·\n","date":"2024-09-21T10:53:25+08:00","image":"https://sherlock-lin.github.io/p/blog%E5%BD%92%E5%A4%84/image-20240921101717625_hu1519644137074903956.png","permalink":"https://sherlock-lin.github.io/p/blog%E5%BD%92%E5%A4%84/","title":"Blogå½’å¤„"},{"content":"ç®€æ Brokerçš„å¯åŠ¨æµç¨‹æ¡†æ¶åŸºæœ¬å¦‚ä¸‹\nè§¦å‘å¯åŠ¨ åˆå§‹åŒ– è¯»å–é…ç½®ã€æ£€æµ‹ã€èµ‹å€¼ å¯åŠ¨ Bookieå¯åŠ¨ Brokerå¯åŠ¨ å¯åŠ¨Netty å¯åŠ¨åå°ç›‘æ§ä»»åŠ¡ ä½•æ—¶ã€å¦‚ä½•è§¦å‘å¯åŠ¨ Brokerçš„å¯åŠ¨åŸºæœ¬éƒ½æ˜¯é ç»´æŠ¤äººå‘˜ä¸»åŠ¨è§¦å‘çš„ï¼Œå…¥å£æ˜¯Brokeræä¾›çš„è„šæœ¬ bin/pulsarã€bin/pulsar-daemonã€‚å¸¸è§çš„å¯åŠ¨æŒ‡ä»¤æœ‰ bin/pulsar standaloneã€ bin/pulsar brokerã€bin/pulsar-daemon start brokerç­‰ï¼Œä»Šå¤©å°±ä»bin/pulsar brokeræµç¨‹è¿›è¡Œæ¢è®¨ã€‚å…ˆæ¥çœ‹çœ‹bin/pulsarçš„è„šæœ¬é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 pulsar_help() { cat \u0026lt;\u0026lt;EOF //åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°pulsaræ”¯æŒçš„æ“ä½œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡bin/pulsar help æŒ‡ä»¤è¿›è¡ŒæŸ¥çœ‹ Usage: pulsar \u0026lt;command\u0026gt; where command is one of: //å¯åŠ¨BrokeræœåŠ¡ broker Run a broker server //å¯åŠ¨bookieæœåŠ¡ bookie Run a bookie server zookeeper Run a zookeeper server configuration-store Run a configuration-store server discovery Run a discovery server proxy Run a pulsar proxy websocket Run a web socket proxy server functions-worker Run a functions worker server sql-worker Run a sql worker server sql Run sql CLI standalone Run a broker server with local bookies and local zookeeper autorecovery Run an autorecovery service .... } //å¦‚æœæ‰§è¡Œçš„æ˜¯bin/pulsar brokeråˆ™ä¼šèµ°åˆ°è¿™é‡Œï¼Œå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°æœ€ç»ˆä¼šè°ƒç”¨PulsarBrokerStarterç±»è¿›è¡Œå¯åŠ¨ if [ $COMMAND == \u0026#34;broker\u0026#34; ]; then PULSAR_LOG_FILE=${PULSAR_LOG_FILE:-\u0026#34;pulsar-broker.log\u0026#34;} exec $JAVA $LOG4J2_SHUTDOWN_HOOK_DISABLED $OPTS -Dpulsar.log.file=$PULSAR_LOG_FILE org.apache.pulsar.PulsarBrokerStarter --broker-conf $PULSAR_BROKER_CONF $@ elif [ $COMMAND == \u0026#34;bookie\u0026#34; ]; then PULSAR_LOG_FILE=${PULSAR_LOG_FILE:-\u0026#34;bookkeeper.log\u0026#34;} exec $JAVA $OPTS -Dpulsar.log.file=$PULSAR_LOG_FILE org.apache.bookkeeper.server.Main --conf $PULSAR_BOOKKEEPER_CONF $@ Brokerå¯åŠ¨æµç¨‹ é€šè¿‡è„šæœ¬èƒ½å¤Ÿçœ‹åˆ°æ˜¯é€šè¿‡PulsarBrokerStarterè¿›è¡Œå¯åŠ¨ï¼Œå› æ­¤ç°åœ¨å°±ç›´æ¥ä»å®ƒçš„mainæ–¹æ³•è¿›è¡Œè·Ÿè¸ªå§\nè¿™é‡Œçš„åˆå§‹åŒ–å’Œå¯åŠ¨ä¸¤æ¡é“¾è·¯éƒ½å€¼å¾—çœ‹ï¼Œé¦–å…ˆè·Ÿè¸ªä¸‹åˆå§‹åŒ–Brokerçš„é“¾è·¯\nå¯ä»¥çœ‹åˆ°åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­åˆ†åˆ«åšäº† é…ç½®åŠ è½½ã€åˆå§‹åŒ–Brokerã€åˆå§‹åŒ–Bookkeeperä»¥åŠAutoRecoveryMainæœåŠ¡ç­‰ã€‚æ¥ä¸‹æ¥å°±å°±çœ‹æœåŠ¡å¯åŠ¨é“¾è·¯ã€‚\nå¯ä»¥çœ‹åˆ°å¯åŠ¨å…¥å£å¾ˆç®€æ´ï¼Œå°±æ˜¯å¯åŠ¨ä¸Šé¢åˆå§‹åŒ–å¥½çš„Brokerã€Bookkeeperã€AutoRecoveryMainï¼Œè¿™é‡Œå…ˆçœ‹Brokerçš„å¯åŠ¨æµç¨‹ä¹Ÿå°±æ˜¯276è¡Œ\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•éå¸¸å¤§ï¼Œé‡Œé¢å†…å®¹éå¸¸ä¸°å¯Œï¼Œä¸€èµ·æ¥è¯¦ç»†çœ‹çœ‹\nç®€å•æ€»ç»“ä¸‹è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒä¸»è¦åˆ›å»ºäº†ä»¥ä¸‹å‡ ä¸ªå¯¹è±¡\nCoordinationServiceImplå¯¹è±¡ï¼Œç”¨äºåè°ƒBrokeré€‰ä¸»\nBrokerServiceå¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯å¯åŠ¨Brokerå¯¹è±¡çš„æ ¸å¿ƒ\nLoadManagerå¯¹è±¡ï¼Œç”¨äºç®¡ç†Brokerå¯¹è±¡çš„è´Ÿè½½å‡è¡¡\nSchemaStorageå¯¹è±¡ï¼Œè´Ÿè´£å¤„ç†è¯»å†™schemaçš„è¯·æ±‚\nOffloadPoliciesImplï¼Œè´Ÿè´£åˆ†å±‚å­˜å‚¨æ“ä½œ\nå¹¶å¯åŠ¨WebServiceæœåŠ¡ï¼Œè´Ÿè´£å¯¹å¤–æä¾›httpæœåŠ¡\nWorkerServiceæœåŠ¡ï¼Œè´Ÿè´£å¤„ç†functionè®¡ç®—æ“ä½œ\nè¿™é‡Œé¢çš„BrokerServiceæ˜¯æœ€æ ¸å¿ƒçš„ï¼Œåœ¨è¿™é‡Œè¿›å»çœ‹ä¸‹å®ƒåˆ›å»ºçš„é€»è¾‘\næ­¤æ–¹æ³•ä¸»è¦åšäº†ä¸‹é¢å‡ ä»¶äº‹\nåˆ›å»ºNettyæœåŠ¡ç«¯ï¼Œç”¨äºå¤„ç†ç”Ÿäº§è€…/æ¶ˆè´¹è€…/ä»£ç†çš„TCPè¯·æ±‚ åˆ›å»ºå®šæœŸæ£€æµ‹æœåŠ¡ ä¸æ´»è·ƒçš„æ£€æµ‹ æ¶ˆæ¯è¿‡æœŸæ£€æµ‹ å‹ç¼©æ£€æµ‹ æ¶ˆè´¹è€…æ£€æµ‹ åˆå§‹åŒ–äº”ä¸ªMapå®¹å™¨ ç»´æŠ¤Topicå¯¹è±¡ ç»´æŠ¤é›†ç¾¤å‰¯æœ¬å¤åˆ¶çš„å®¢æˆ·ç«¯ ç»´æŠ¤è¿æ¥å½“å‰Brokerçš„ç®¡ç†æµ ç»´æŠ¤Topicå½’å±ä¿¡æ¯ ç»´æŠ¤å¤šå±‚çº§çš„Topicä¿¡æ¯ï¼Ÿ å¯åŠ¨DelayedDeliveryTrackerLoaderè·Ÿè¸ªå»¶è¿Ÿæ¶ˆæ¯ å¯åŠ¨Brokeræ‹¦æˆªå™¨BrokerEntryMetadataInterceptors å¯åŠ¨é™é¢ç®¡ç†å¯¹è±¡BundlesQuotas å¯åŠ¨NettyæœåŠ¡ç«¯(æ­¤æ—¶PulsaræœåŠ¡å…·å¤‡å¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚èƒ½åŠ›) å¯åŠ¨å®šæœŸæ£€æµ‹æœåŠ¡ ä¸æ´»è·ƒçš„æ£€æµ‹ æ¶ˆæ¯è¿‡æœŸæ£€æµ‹ å‹ç¼©æ£€æµ‹ æ¶ˆè´¹è€…æ£€æµ‹ æ¶ˆæ¯ç§¯å‹æ£€æµ‹ æ€»ç»“ PulsarServiceæ˜¯PulsaræœåŠ¡å¯åŠ¨çš„æ ¸å¿ƒç±»ï¼Œå…¶å†…ç½®äº†ä¸ƒå¤§é‡è¦çš„å¯¹è±¡å¦‚ä¸‹å›¾\nBrokerService: æ ¸å¿ƒæ˜¯å¯åŠ¨Nettyï¼Œå¤„ç†å®¢æˆ·ç«¯çš„TCPè¿æ¥ï¼ŒåŒæ—¶é€šè¿‡å¤šä¸ªMapå®¹å™¨ç»´æŠ¤ä¾‹å¦‚Topicä¿¡æ¯ã€Topicå½’å±ä¿¡æ¯ç­‰ç­‰ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯åŠ¨ä¸€æ‰¹å®šæ—¶çº¿ç¨‹å®šæœŸæ£€æµ‹(æ¶ˆæ¯è¿‡æœŸã€å‹ç¼©ã€å®¢æˆ·ç«¯æ´»è·ƒç­‰) LoadManager: è´Ÿè´£å¤„ç†BrokeræœåŠ¡çš„è´Ÿè½½å‡è¡¡ WebService: å¯¹å¤–æä¾›HTTPæœåŠ¡ï¼Œä¾‹å¦‚ç®¡ç†æµçš„æ“ä½œ(å…ƒæ•°æ®)ç­‰ CoordinationService: ç»™Brokeræä¾›åè°ƒæœåŠ¡ï¼Œä¾‹å¦‚Brokeré€‰ä¸»æ“ä½œ SchemaStorage: æä¾›schemaç›¸å…³çš„ä¸€åˆ‡æœåŠ¡ï¼Œå¸¸è§çš„å°±æ˜¯schemaçš„è¯»å†™ OffloadPolicies: æä¾›åˆ†å±‚å­˜å‚¨ï¼Œå†·æ•°æ®è‡ªåŠ¨è¿ç§»åˆ°å¤–éƒ¨æœåŠ¡ä¸­ WorkerService: ç®¡ç†Workerå®ä¾‹ï¼Œç”¨æ¥æ‰§è¡ŒFunctionè®¡ç®—ä»»åŠ¡ ä»¥ä¸Šå°±æ˜¯Pulsarå¯åŠ¨æµç¨‹æ‰€åšçš„äº‹æƒ…ï¼Œå…¶ä¸­Bookkeeperçš„å¯åŠ¨ä»¥åŠå…¶ä½™çš„åŠŸèƒ½ä¾‹å¦‚CoordinationServiceã€SchemaStorageç­‰ç­‰éƒ½å€¼å¾—å•ç‹¬æ–°å¼€ä¸€ç¯‡æ–‡ç« è¿›è¡Œè®²è§£ï¼Œè¿™é‡Œå°±ä¸æ··åœ¨ä¸€èµ·è®²äº†ã€‚\n","date":"2024-09-18T10:05:57+08:00","image":"https://sherlock-lin.github.io/p/%E5%90%AF%E7%A8%8Bpulsar%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E9%AB%98%E9%80%9F%E5%90%AF%E5%8A%A8%E5%BC%95%E6%93%8E%E6%8F%AD%E7%A7%98%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%B7%A8%E5%85%BD%E7%9A%84%E8%AF%9E%E7%94%9F/image-20240913141630196_hu5121917752973153749.png","permalink":"https://sherlock-lin.github.io/p/%E5%90%AF%E7%A8%8Bpulsar%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E9%AB%98%E9%80%9F%E5%90%AF%E5%8A%A8%E5%BC%95%E6%93%8E%E6%8F%AD%E7%A7%98%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%B7%A8%E5%85%BD%E7%9A%84%E8%AF%9E%E7%94%9F/","title":"å¯ç¨‹Pulsarï¼šæ·±å…¥å‰–æé«˜é€Ÿå¯åŠ¨å¼•æ“ï¼Œæ­ç§˜æ¶ˆæ¯ä¸­é—´ä»¶å·¨å…½çš„è¯ç”Ÿ"},{"content":"å¼•è¨€ å…³äºPulsar Schemaï¼Œå’±ä»¬è¦æƒ³æƒ³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜\nPulsar ä¸­çš„ Schema æ˜¯ä»€ä¹ˆï¼Ÿ Pulsar Schema Registryçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ æ€ä¹ˆä½¿ç”¨ï¼Ÿ åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ Schema æ˜¯ä»€ä¹ˆ Schemaæ˜¯å®šä¹‰ç»“æ„åŒ–æ•°æ®å’ŒäºŒè¿›åˆ¶å­—èŠ‚æ•°ç»„ä¹‹é—´è½¬æ¢çš„é€»è¾‘ï¼ŒPulsarçš„æ¶ˆæ¯æ˜¯ä»¥éç»“æ„åŒ–çš„äºŒè¿›åˆ¶æ•°ç»„è¿›è¡Œå­˜å‚¨çš„ï¼ŒSchemaåªæœ‰åœ¨è¯»å†™æ—¶æ‰ä¼šè¢«åº”ç”¨äºæ•°æ®ä¸Šï¼Œå› æ­¤ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éœ€è¦å¯¹Schemaè¾¾æˆä¸€è‡´ã€‚Pulsaré€šè¿‡Schema Registryä½œä¸ºä¸€ä¸ªä¸­å¤®ä»“åº“å­˜å‚¨Schemaä¿¡æ¯ï¼Œå®ƒå¯ä»¥åè°ƒç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¿è¯ç›¸åŒçš„Schemaï¼Œå®ƒå¯ä»¥å­˜å‚¨å¤šä¸ªç‰ˆæœ¬çš„Schemaï¼Œæ”¯æŒä¸åŒçš„å…¼å®¹æ€§é…ç½®ä»¥åŠæ ¹æ®å…¼å®¹æ€§çš„è¦æ±‚è¿›è¡ŒSchemaçš„æ¼”è¿›ã€‚Pulsarå°†Schemaå­˜å‚¨åœ¨Bookieä¸Šï¼ŒSchemaçš„å†™å…¥ã€è¯»å–éƒ½é€šè¿‡Brokerå’ŒBookieäº¤äº’ï¼Œè¿™ä¸ªé€»è¾‘è·Ÿæ¶ˆæ¯çš„è¯»å†™æ“ä½œæ˜¯ä¸€åªçš„ï¼Œå› æ­¤ä¸éœ€è¦é¢å¤–è€ƒè™‘Schemaçš„å¯ç”¨æ€§å’Œå¯é æ€§é—®é¢˜ï¼Œå› æ­¤æ•´ä½“çœ‹Pulsarå®ç°Schema Registryçš„æ–¹å¼éå¸¸ä¼˜é›…\nç±»å‹å®‰å…¨åœ¨æ‰€æœ‰æ•°æ®åº”ç”¨ä¸­éƒ½éå¸¸é‡è¦ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éœ€è¦æŸç§æœºåˆ¶åè°ƒæ•°æ®ç±»å‹æ¥é¿å…å„ç§æ½œåœ¨çš„é—®é¢˜ï¼Œæ¯”å¦‚åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹å¼ä¸ä¸€è‡´ã€‚æ•°æ®å®‰å…¨é€šå¸¸æœ‰ä¸¤ç§å¤„ç†æ–¹å¼client-sideå’Œservice-sideï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å®¢æˆ·ç«¯ç”¨æ—¶å†³å®šå’ŒæœåŠ¡ç«¯æå‰ä¿è¯\nclient-sideï¼šå°†ä¸€åˆ‡äº¤ç»™ç”¨æˆ·ï¼Œå®¢æˆ·ç«¯è‡ªè¡Œè´Ÿè´£æ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¹¶ä¸”ä¿è¯ç”Ÿäº§æ¶ˆè´¹æ—¶æ¶ˆæ¯çš„ç±»å‹å®‰å…¨ï¼Œè¿™ç§æ–¹å¼çš„æœ€å¤§é—®é¢˜å°±æ˜¯ç±»å‹æ˜¯é€šè¿‡çº¦å®šçš„ï¼Œä¸€æ—¦ç”Ÿäº§è€…å†™å…¥éçº¦å®šçš„æ•°æ®ï¼Œä¸‹æ¸¸çš„æ¶ˆè´¹è€…å°†æ²¡æœ‰åŠæ³•è§£ææ•°æ®\nserver-sideï¼šæ•°æ®å®‰å…¨ç”±æœåŠ¡ç«¯ä¿è¯ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½éœ€è¦è·ŸæœåŠ¡ç«¯æå‰ç¡®å®šæ•°æ®ç±»å‹ã€‚è¿™ç§æ–¹å¼çœŸæ­£æ„ä¹‰ä¸Šä¿è¯äº†æ•°æ®çš„ç±»å‹å®‰å…¨ï¼Œé¿å…äº†ç”Ÿäº§è€…å†™å…¥éæ³•æ•°æ®çš„é—®é¢˜\nä¸¤ç§å·®å¼‚å¦‚ä¸‹å›¾\næ€ä¹ˆä½¿ç”¨ client-side ç”Ÿäº§è€…ä»£ç é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 //schemaåœ¨ç¬¬ä¸€æ¬¡å†™å…¥çš„æ—¶å€™å°±å·²ç»å†³å®šå¥½äº†ï¼Œåç»­ç”¨å…¶ä»–çš„schemaæ¶ˆæ¯ç±»å‹ä¼šå†™å…¥å¤±è´¥ public static void customSchemaProducer() { try { String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); Producer\u0026lt;byte[]\u0026gt; producer = pulsarClient.newProducer() .topic(\u0026#34;persistent://sherlock-api-tenant-1/sherlock-namespace-1/topic_8\u0026#34;) .create(); User user = new User(); user.setName(\u0026#34;è€å…­\u0026#34;); user.setAge(21); user.setAddress(\u0026#34;æµ·å—\u0026#34;); //ç”±ç”¨æˆ·è‡ªè¡Œåšåºåˆ—åŒ–é€»è¾‘ producer.send(JSON.toJSONString(user).getBytes()); producer.close(); pulsarClient.close(); } catch (Exception e) { } } æ¶ˆè´¹è€…é€»è¾‘ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public static void customSchemaConsumer() { try { String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); Consumer\u0026lt;byte[]\u0026gt; consumer = pulsarClient.newConsumer() .topic(\u0026#34;persistent://sherlock-api-tenant-1/sherlock-namespace-1/topic_8\u0026#34;) .subscriptionName(\u0026#34;sub_03\u0026#34;) .subscribe(); while(true) { Message\u0026lt;byte[]\u0026gt; message = consumer.receive(); //ç”±ç”¨æˆ·è‡ªè¡Œåšåºåˆ—åŒ–é€»è¾‘ byte[] user = message.getValue(); System.out.println(\u0026#34;æ¶ˆæ¯æ•°æ®ä¸ºï¼š\u0026#34;+JSON.parseObject(user, User.class).toString()); consumer.acknowledge(message); //consumer.negativeAcknowledge(message); } } catch (Exception e) { } } æ‰§è¡Œæ•ˆæœå¦‚ä¸‹\n1 æ¶ˆæ¯æ•°æ®ä¸ºï¼šUser{name=\u0026#39;è€å…­\u0026#39;, age=21, address=\u0026#39;æµ·å—\u0026#39;} server-side ç”Ÿäº§è€…ä»£ç é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 //schemaåœ¨ç¬¬ä¸€æ¬¡å†™å…¥çš„æ—¶å€™å°±å·²ç»å†³å®šå¥½äº†ï¼Œåç»­ç”¨å…¶ä»–çš„schemaæ¶ˆæ¯ç±»å‹ä¼šå†™å…¥å¤±è´¥ public static void customSchemaProducer() { try { String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); //ç”±Pulsaråšåºåˆ—åŒ–é€»è¾‘ Producer\u0026lt;User\u0026gt; producer = pulsarClient.newProducer(AvroSchema.of(User.class)) .topic(\u0026#34;persistent://sherlock-api-tenant-1/sherlock-namespace-1/topic_7\u0026#34;) .create(); User user = new User(); user.setName(\u0026#34;ç‹æ­¦\u0026#34;); user.setAge(36); user.setAddress(\u0026#34;æµ·å—\u0026#34;); producer.send(user); producer.close(); pulsarClient.close(); } catch (Exception e) { } } æ¶ˆè´¹è€…é€»è¾‘ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public static void customSchemaConsumer() { try { String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); //ç”±Pulsaråšåºåˆ—åŒ–é€»è¾‘ Consumer\u0026lt;User\u0026gt; consumer = pulsarClient.newConsumer(AvroSchema.of(User.class)) .topic(\u0026#34;persistent://sherlock-api-tenant-1/sherlock-namespace-1/topic_7\u0026#34;) .subscriptionName(\u0026#34;sub_03\u0026#34;) .subscribe(); while(true) { Message\u0026lt;User\u0026gt; message = consumer.receive(); User user = message.getValue(); System.out.println(\u0026#34;æ¶ˆæ¯æ•°æ®ä¸ºï¼š\u0026#34;+user); consumer.acknowledge(message); //consumer.negativeAcknowledge(message); } } catch (Exception e) { } } æ‰§è¡Œæ•ˆæœå¦‚ä¸‹\n1 æ¶ˆæ¯æ•°æ®ä¸ºï¼šUser{name=\u0026#39;ç‹æ­¦\u0026#39;, age=36, address=\u0026#39;æµ·å—\u0026#39;} å°ç»“ åˆ†åˆ«æŸ¥çœ‹ä¸¤ä¸ªTopicçš„Schemaä¿¡æ¯å¦‚ä¸‹å›¾\né€šè¿‡æŸ¥è¯¢client-sideçš„Schemaä¿¡æ¯ï¼Œä¼šå‘ç°PulsaræœåŠ¡ç«¯å…¶å®å¹¶æ²¡æœ‰è¿›è¡Œå­˜å‚¨ï¼Œç›¸å½“äºä¸æŒ‡å®šSchemaçš„è¯Pulsaré»˜è®¤éƒ½ç”¨byteæ•°ç»„\nå†æ¥çœ‹çœ‹server-sideçš„Schemaä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°å¦‚ä¸‹ï¼Œnamespaceæ˜¯pojoç±»çš„åŒ…è·¯å¾„ï¼Œnameæ˜¯pojoç±»åï¼Œç„¶åfieldså°±æ˜¯pojoç±»çš„å„ä¸ªå­—æ®µçš„å±æ€§(åƒä¸åƒmysqlé‡Œé¢çš„è¡¨ç»“æ„ï¼Œä¸å°‘åœºæ™¯Topicå°±æ˜¯å½“ä½œè¡¨æ¥ç”¨çš„)ï¼Œç„¶åtypeæ˜¯AVROæ˜¯ç”±äºå’±ä»¬æ˜¯ç”¨çš„avroè¿›è¡Œåºåˆ—åŒ–çš„ã€‚\né™¤äº†åœ¨è¯»å†™æ•°æ®æ—¶æŒ‡å®šSchemaï¼ŒPulsarè¿˜æ”¯æŒé€šè¿‡adminç®¡ç†æµæå‰æŒ‡å®šå¥½ï¼Œå…·ä½“æŒ‡ä»¤åœ¨è¿™é‡Œã€‚å¦‚æœæ˜¯ç”¨Pulsaræ¥ä½œä¸ºå®æ—¶æ•°ä»“åœºæ™¯ï¼Œå¼ºçƒˆå»ºè®®æå‰é€šè¿‡adminç®¡ç†æµè¿›è¡ŒæŒ‡å®šå¥½ï¼Œé…ç½®isSchemaValidationEnforcedå¯ä»¥è€ƒè™‘å¼€å¯ã€‚å¦‚æœæ¡ä»¶å…è®¸å¯ä»¥è€ƒè™‘åšæˆæœåŠ¡åŒ–ï¼Œä¾‹å¦‚é€šè¿‡Webé¡µé¢æä¾›æ–°å»ºSchemaã€ä¿®æ”¹Schemaæ“ä½œå¹¶æ¥å…¥å…¬å¸å†…éƒ¨çš„å®¡æ‰¹æµç­‰\n1 2 3 pulsar-admin schemas upload --filename POST /admin/v2/schemas/:tenant/:namespace/:topic/schema pulsar-admin schemas get sherlock-api-tenant-1/sherlock-namespace-1/partition_partition_topic_3 åŸç†è§£æ Schemaç›¸å…³çš„æµç¨‹å’±ä»¬éœ€è¦å…³æ³¨ä»¥ä¸‹å‡ ä¸ª\næ³¨å†ŒSchemaæµç¨‹ ç”Ÿäº§è€…ç«¯ä¾§ æ¶ˆè´¹è€…ç«¯ä¾§ æŒ‡å®šæœåŠ¡å™¨ Schemaç”Ÿæ•ˆæµç¨‹ æ›´æ–°Schemaæµç¨‹ æ³¨å†ŒSchemaæµç¨‹ ç”Ÿäº§è€…ç«¯ä¾§\nç”Ÿäº§è€…å®ä¾‹ä¼šåœ¨å†…éƒ¨æ„é€ schemaå®ä¾‹ï¼Œç”Ÿäº§è€…ä¼šé€šè¿‡å®ƒå¯¹æ•°æ®è¿›è¡Œè½¬æ¢ ç”Ÿäº§è€…ä¼šè¯·æ±‚è¿æ¥Brokerï¼Œå¹¶ä¼ é€’schemaä¿¡æ¯ SchemaInfo Brokerä¼šåœ¨schema registryä¸­æŸ¥æ‰¾è¿™ä¸ªschemaæ˜¯å¦è¢«æ³¨å†Œï¼Œå¦‚æœå·²ç»æ³¨å†Œäº†å°±å°†æ³¨å†Œçš„schemaç‰ˆæœ¬è¿”å›ç»™ç”Ÿäº§è€… Brokeræ£€æŸ¥æ˜¯å¦æ”¯æŒè‡ªåŠ¨æ›´æ–°schemaï¼Œå¦‚æœé…ç½®ä¸å…è®¸è‡ªåŠ¨æ›´æ–°ï¼Œåˆ™è¿™ä¸ªschemaä¸èƒ½è¢«æ³¨å†Œå¹¶ä¸”æ‹’ç»ç”Ÿäº§è€… Brokerè¿›è¡Œschemaå…¼å®¹æ€§æ£€æŸ¥ï¼Œå¦‚æœé€šè¿‡æ£€æŸ¥åˆ™å°†æ­¤schemaå­˜å‚¨åœ¨schema registryå¹¶è¿”å›ç‰ˆæœ¬ç»™ç”Ÿäº§è€…ï¼Œç”Ÿäº§è€…æ‰€æœ‰æ¶ˆæ¯ä»¥è¿™ä¸ªschemaæ ¼å¼è¿›è¡Œå‘é€ï¼›è‹¥æ˜¯æ£€æŸ¥æ²¡é€šè¿‡åˆ™æ‹’ç»ç”Ÿäº§è€… æ¶ˆè´¹è€…ç«¯\næ¶ˆè´¹è€…å®ä¾‹ä¼šåœ¨å†…éƒ¨æ„é€ schemaå®ä¾‹ æ¶ˆè´¹è€…è¯·æ±‚è¿æ¥Brokerï¼Œå¹¶ä¼ é€’schemaä¿¡æ¯ SchemaInfo Brokeræ£€æŸ¥è¿™ä¸ªTopicæ˜¯å¦å·²ç»åœ¨ä½¿ç”¨ï¼Œæœ‰çš„è¯è·³åˆ°ç¬¬äº”æ­¥ï¼Œå¦åˆ™è·³åˆ°ç¬¬å››æ­¥ Brokeræ£€æŸ¥æ˜¯å¦æ”¯æŒè‡ªåŠ¨æ›´æ–°schemaï¼Œå¦‚æœæ”¯æŒåˆ™æ³¨å†Œè¿™ä¸ªschemaï¼Œå¦åˆ™æ‹’ç»å®¢æˆ·ç«¯ Brokerè¿›è¡Œschemaå…¼å®¹æ€§æ£€æŸ¥ï¼Œé€šè¿‡åˆ™è¿æ¥å¦åˆ™æ‹’ç»å®¢æˆ·ç«¯ æºç è§£æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 public static void customSchemaProducer() { try { String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); Producer\u0026lt;User\u0026gt; producer = pulsarClient.newProducer(AvroSchema.of(User.class)) .topic(\u0026#34;persistent://sherlock-api-tenant-1/sherlock-namespace-1/topic_7\u0026#34;) .create(); User user = new User(); user.setName(\u0026#34;ç‹æ­¦\u0026#34;); user.setAge(36); user.setAddress(\u0026#34;æµ·å—\u0026#34;); producer.send(user); producer.close(); pulsarClient.close(); } catch (Exception e) { } } æ–‡çŒ® Pulsarï¼šSchema Registryä»‹ç» å®˜æ–¹æ–‡æ¡£ æ·±åº¦è§£è¯» Pulsar Schema ","date":"2024-09-13T10:34:56+08:00","image":"https://sherlock-lin.github.io/p/schema%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/image-20240308104136110_hu13493609005795593452.png","permalink":"https://sherlock-lin.github.io/p/schema%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/","title":"Schemaæ·±åº¦è§£æ"},{"content":"ç®€æ schemaæ˜¯pulsaré‡è¦çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œç°åœ¨å°±ä¸€èµ·ä»æºç çš„è§†è§’çœ‹ä¸‹ç®¡ç†æµåˆ›å»ºschemaæ—¶å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¡¨ç°\nå®¢æˆ·ç«¯ å®¢æˆ·ç«¯ä¸»è¦ç»å†ä»¥ä¸‹å››ä¸ªæ­¥éª¤\nåˆ›å»ºSchemaå®ä¾‹\næ ¹æ®æ•°æ®ç±»å‹åˆ›å»ºç›¸å¯¹åº”çš„å®ä¾‹ï¼Œä¾‹å¦‚Avroåˆ›å»ºAvroSchemaã€JSONåˆ›å»ºJSONSchemaç­‰\nè·å–å¤„ç†Schemaçš„å¯¹è±¡\nç®¡ç†æµPulsarAdminå¯¹è±¡è·å–SchemasImplå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸“é—¨å¤„ç†æ‰€æœ‰schemaç›¸å…³çš„æ“ä½œã€‚é™¤æ­¤ä¹‹å¤–PulsarAdminå¯¹è±¡è¿˜ç»´æŠ¤ç€Clustersã€Brokersã€Tenantsç­‰ç­‰ç®¡ç†ç»´æŠ¤é›†ç¾¤çš„é‡è¦å¯¹è±¡ï¼Œé€šè¿‡è¿™äº›å¯¹è±¡å¯ä»¥å¾ˆå¥½çš„ç®¡ç†ç»´æŠ¤Pulsaré›†ç¾¤\næ„é€ SchemaInfo\né€šè¿‡Schemaå®ä¾‹åˆ›å»ºå…¶å¯¹åº”çš„SchemaInfoä¿¡æ¯ï¼Œé‡Œé¢å°±åŒ…æ‹¬è¿™ä¸ªschemaçš„åå­—ã€schemaçš„ç»“æ„åŒ–ä¿¡æ¯ã€schemaç±»å‹ç­‰ç­‰ï¼Œæœ€åSchemaInfoè¿™ä¸ªå¯¹è±¡ä¼šè½¬æˆå­—ç¬¦ä¸²å‘åˆ°æœåŠ¡ç«¯\nå‘é€HTTPè¯·æ±‚\né€šè¿‡postè¯·æ±‚å°†æ•°æ®å‘åˆ°æœåŠ¡ç«¯ï¼Œè¿™é‡Œæ˜¯é€šè¿‡Java Reståº“javax.ws.rs-apiè¿›è¡Œå¤„ç†çš„\næœåŠ¡ç«¯ æœåŠ¡ç«¯ä¸»è¦ç»å†ä»¥ä¸‹å››ä¸ªæ­¥éª¤\nå‚æ•°æ ¼å¼æ ¡éªŒ\næ ¡éªŒç§Ÿæˆ·ã€å‘½åç©ºé—´çš„æ˜¯å¦æœ‰æ•ˆ(åˆ¤ç©ºã€æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦) ä»ç¼“å­˜ä¸­æ ¹æ®Topicè·å–å…¶å¯¹åº”çš„TopicNameå¯¹è±¡ æƒé™æ ¡éªŒ\nåˆ¤æ–­æ˜¯å¦æ˜¯Topicçš„owner åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æ“ä½œå½“å‰Topicçš„æƒé™ SchemaRegistryæ³¨å†Œschema\nSchemaRegistryServiceæ˜¯æœåŠ¡ç«¯å¤„ç†æ‰€æœ‰schemaç›¸å…³çš„å¯¹è±¡ï¼Œè€Œschemaç›¸å…³çš„è¯»å†™æ“ä½œæ˜¯ä¾èµ–å®ƒçš„æˆå‘˜SchemaStorageè¿›è¡Œå¤„ç†çš„ï¼ŒSchemaStorageçš„æœ€ç»ˆæ˜¯é€šè¿‡Bookkeeperå®¢æˆ·ç«¯å¯¹è±¡å‘é€å†™è¯·æ±‚\nå†™Bookkeeper\né€šè¿‡LedgerHandleå¯¹è±¡å‘BookkeeperæœåŠ¡ç«¯å‘é€å†™è¯·æ±‚\nå°ç»“ schameæ–°å»ºæµç¨‹æ¦‚æ‹¬èµ·æ¥å°±æ˜¯ï¼Œå®¢æˆ·ç«¯æ„é€ schemaä¿¡æ¯ï¼ŒæœåŠ¡ç«¯è´Ÿè´£schemaæ ¡éªŒï¼Œbookkeeperè´Ÿè´£schemaçš„å­˜å‚¨\nå®¢æˆ·ç«¯æºç è§£æ æºç è·Ÿè¸ª ä¸‹é¢æ˜¯é€šè¿‡ç®¡ç†æµåˆ›å»ºschemaçš„æ ·ä¾‹ä»£ç ï¼Œæ ¸å¿ƒå°±æ˜¯é€šè¿‡PulsarAdmin.schemasè·å–schemaå¯¹è±¡ï¼Œè¿™ä¸ªschemaå¯¹è±¡è´Ÿè´£æ‰€æœ‰å®¢æˆ·ç«¯è·Ÿschemaç›¸å…³çš„æ“ä½œï¼ŒåŒ…æ‹¬schemaçš„å¢åˆ æ”¹æŸ¥ç­‰ã€‚é€šè¿‡æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡Schemaæ¥å£æä¾›çš„é™æ€æ–¹æ³•AVROæ¥æ„é€ Avroæ ¼å¼çš„schemaå¯¹è±¡ï¼Œé™¤æ­¤ä¹‹å¤–Schemaæ¥å£è¿˜æä¾›äº†è¯¸å¦‚JSONã€KeyValueã€PROTOBUFç­‰é™æ€æ–¹æ³•æä¾›å¯¹åº”æ•°æ®æ ¼å¼çš„schemaå¯¹è±¡ï¼Œè¿™é‡Œå¦‚æœå°†è¿™å—æ„é€ schemaå¯¹è±¡é€»è¾‘æŠ½æˆç®€å•å·¥å‚æ¨¡å¼å¯èƒ½ä¼šæ›´åˆé€‚äº›\næ¥ä¸‹æ¥å°±è¿›å…¥createSchemaæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰å¯ä»¥çŸ¥é“è¿™ä¸ªæ–¹æ³•å°±æ˜¯ç”¨äºåˆ›å»ºschemaçš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯topicï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯SchemaInfoå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†æ‰€æœ‰è¦æ–°å»ºçš„schemaä¿¡æ¯ï¼Œè¿™é‡Œä¼šå°†å®ƒè½¬æ¢ä¸ºPostSchemaPayloadå¯¹è±¡ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ–¹æ³•ã€‚PostSchemaPayloadæ˜¯ç”¨æ¥è¯·æ±‚åˆ°æœåŠ¡ç«¯çš„å‚æ•°\nè¿™ä¸ªæ–¹æ³•å¹¶ä¸ä¼šæœ‰è¿”å›å€¼ï¼Œsyncæ–¹æ³•æ˜¯å¤„ç†å¼‚æ­¥ç»“æœå¯¹è±¡ï¼Œå®ƒåœ¨æ­£å¸¸å†™æˆåŠŸæƒ…å†µä¸‹ä¸ä¼šåšä»»ä½•æ“ä½œï¼Œä½†å¦‚æœæœ‰ä»€ä¹ˆé”™è¯¯ä¼šå¾€å¤–æŠ›å‡ºå¼‚å¸¸ã€‚è¿™é‡Œæ ¸å¿ƒé€»è¾‘æ˜¯åœ¨createSchemaAsyncæ–¹æ³•\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸ªå¼‚æ­¥å¯¹è±¡ï¼Œ146è¡Œè¿™é‡Œä¼šè·å–å½“å‰topicå¯¹åº”çš„TopicNameå¯¹è±¡ï¼Œå¹¶é€šè¿‡schemaPathæ–¹æ³•æ„é€ WebTargetå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­å°±åŒ…å«ç€è¦è¯·æ±‚çš„HTTPåœ°å€ï¼Œä¸»è¦æ˜¯æ ¹æ®å½“å‰Topicçš„ç‰ˆæœ¬æ¥å†³å®šè¯·æ±‚æœåŠ¡ç«¯å“ªä¸ªç‰ˆæœ¬çš„å¤„ç†æ–¹æ³•ã€‚é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥çœ‹åˆ°æœ‰é€šè¿‡Entity.jsonæ–¹æ³•å°†PostSchemaPayloadå¯¹è±¡è½¬æ¢ä¸ºHTTPè¯·æ±‚çš„å‚æ•°å¯¹è±¡ï¼Œè½¬æ¢é€»è¾‘æ˜¯javax.ws.rs-apiè¿™ä¸ªç½‘ç»œåº“å°è£…çš„ï¼Œå°±ä¸è¿›è¡Œè·Ÿè¸ªäº†\nè¿™é‡Œå°±æ˜¯å®¢æˆ·ç«¯æœ€åå‘é€çš„åœ°æ–¹ï¼Œrequestæ–¹æ³•ä¸­è¿˜ä¼šå‘é€å‰çš„å®‰å…¨ç›¸å…³æ£€æŸ¥ï¼Œasyncæ–¹æ³•åŸºæœ¬ä¸Šå°±è¯´æ˜æœ¬æ¬¡HTTPè¯·æ±‚æ˜¯å¼‚æ­¥çš„ï¼Œè€Œpostæ–¹æ³•ä¹Ÿèƒ½çœ‹å¾—å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªPOSTç±»å‹çš„HTTPè¯·æ±‚ï¼Œå†å¾€åå°±æ˜¯å°†è¯·æ±‚å‘é€å‡ºå»äº†\nä¸çŸ¥æ˜¯å¦æœ‰äººå¥½å¥‡å‚æ•°WebTargeté•¿ä»€ä¹ˆæ ·å­ï¼Œé€šè¿‡é€šè¿‡è°ƒè¯•å¯ä»¥çœ‹åˆ°å€¼ä¸º\n/admin/v2/schemas/public/test-namespace-jytixthzgatgirem/test-multi-version-schema-one/schema\næ­¤å€¼ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œå…·ä½“è¿™ä¸ªå€¼çš„æ„é€ é€»è¾‘å¦‚ä¸‹\nå°ç»“ ç®€å•å½’çº³å¦‚ä¸‹\né€šè¿‡Schemaæ¥å£æ„é€ å¯¹åº”æ•°æ®æ ¼å¼çš„schemaå¯¹è±¡ï¼Œç”±æ­¤å¯¹è±¡å¯å¾—åˆ°schemaç›¸å…³çš„å…ƒä¿¡æ¯SchemaInfo æ„é€ è¯·æ±‚ç›®æ ‡çš„HTTPåœ°å€ é€šè¿‡javax.ws.rs-apiæä¾›çš„åº“å‘é€å¼‚æ­¥HTTPè¯·æ±‚åˆ°æœåŠ¡ç«¯ æœåŠ¡ç«¯æºç è§£æ æºç è·Ÿè¸ª æœåŠ¡ç«¯çš„æ¥æ”¶é€»è¾‘åœ¨SchemasResourceç±»ï¼Œè¿™ä¸ªç±»åœ¨org.apache.pulsar.broker.adminåŒ…ä¸‹ï¼Œè¿™ä¸ªåŒ…ä¸‹å…¨æ˜¯å¤„ç†ç®¡ç†æµç›¸å…³çš„æ“ä½œï¼Œå¦‚æœæœ‰åšpulsarå¹³å°åŒ–éœ€æ±‚çš„ï¼Œè¿™ä¸ªåŒ…ä¸‹çš„ç›¸å…³é€»è¾‘å€¼å¾—ä¸€è¯»ã€‚\nå†æ¥çœ‹çœ‹postSchemaæ–¹æ³•ï¼Œé¦–å…ˆæ˜¯validateTopicNameæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯å¯¹å…¥å‚è¿›è¡Œåˆ¤ç©ºã€æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦åšæ£€æŸ¥ï¼›æ¥ä¸‹æ¥å°±æ˜¯æ ¸å¿ƒæ–¹æ³•postSchemaAsyncï¼Œé€šè¿‡æ–¹æ³•åå¯ä»¥æ¨æ–­å‡ºè¿™æ˜¯ä¸ªå¼‚æ­¥å¤„ç†schemaå†™è¯·æ±‚çš„æ–¹æ³•\npostSchemaAsyncæ–¹æ³•çœ‹ä¼¼å¤æ‚ï¼Œå®é™…ä¸Šæ ¸å¿ƒçš„å°±æ˜¯133è¡Œï¼Œå…¶ä½™çš„æ–¹æ³•å¤§æ¦‚è¯´ä¸€ä¸‹ï¼ŒvalidateOwnershipAndOperationAsyncæ–¹æ³•ä¸»è¦æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æ–°å»ºschemaçš„æ“ä½œæƒé™ï¼ŒgetSchemaCompatibilityStrategyAsyncWithoutAuthæ–¹æ³•ç›¸å¯¹å¤æ‚ä¸€äº›ï¼Œæ”¾åˆ°åé¢è¯¦ç»†è®²è§£ã€‚é‚£ä¹ˆå†çœ‹å›133è¡Œï¼Œå…¶ä¸­getSchemaRegistryServiceæ–¹æ³•è·å–çš„æ˜¯SchemaRegistryServiceImplå¯¹è±¡ï¼Œé¡¾åæ€ä¹‰å¯ä»¥çŸ¥é“Pulsarçš„SchemaResistryç›¸å…³çš„åŠŸèƒ½éƒ½æ˜¯ç”±å®ƒè¿›è¡Œå¤„ç†ï¼Œç°åœ¨å…ˆçœ‹å®ƒçš„putSchemaIfAbsentæ–¹æ³•\nSchemaStorageå¯¹è±¡æ˜¯SchemaRegistryServiceImplçš„æ ¸å¿ƒæˆå‘˜ï¼Œè´Ÿè´£schemaå­˜å‚¨ç›¸å…³çš„æ“ä½œã€‚åœ¨æ–°å»ºschemaæ—¶ä¼šè°ƒç”¨å®ƒçš„putæ–¹æ³•è¿›è¡Œåˆ›å»ºï¼›è¿™é‡Œæœ‰ä¸ªtrimDeletedSchemaAndGetListæ–¹æ³•ï¼Œå¦‚æœputæ–¹æ³•åœ¨åˆ›å»ºschemaæ—¶æœ‰ä»»ä½•å¼‚å¸¸ï¼Œåˆ™æ­¤æ–¹æ³•ä¼šå»åˆ é™¤è¯¥æ–°å»ºçš„schemaï¼Œé¿å…å†™\u0026quot;ä¸€åŠ\u0026quot;çš„æƒ…å†µå‘ç”Ÿï¼ŒæŸç§æ„ä¹‰ä¸Šè¿™ä¹Ÿæ˜¯ä¸€ç§å›æ»šçš„è®¾è®¡ã€‚\nè¿™é‡Œçš„getAllæ–¹æ³•å¾ˆé‡è¦ï¼Œä¼šæ ¹æ®schemaçš„idæ¥æŸ¥è¯¢æ˜¯å¦å·²ç»å­˜åœ¨å½“å‰schemaï¼Œæœ‰çš„è¯åˆ™å°†ç‰ˆæœ¬å·åŠ 1ã€‚å¤„ç†å®Œä¹‹åå°±è°ƒç”¨putæ–¹æ³•\nè¿™é‡Œæ²¡ä»€ä¹ˆé€»è¾‘ï¼Œç»§ç»­å¾€ä¸‹è·Ÿè¸ª\ngetSchemaLocatoræ–¹æ³•ä¼šæ„é€ LocatorEntryå¯¹è±¡ï¼Œè°ƒç”¨putSchema\nç”±äºæ˜¯åˆæ¬¡åˆ›å»ºschemaï¼Œå› æ­¤ç›´æ¥èµ°åˆ°337è¡Œï¼›å¦‚æœè¿™ä¸ªtopicå·²ç»åˆ›å»ºè¿‡schemaåˆ™ä¼šè¯»å–ä¹‹å‰çš„schemaä¿¡æ¯å†æ–°å¢ï¼ŒåŒæ—¶æŠŠç‰ˆæœ¬å·è‡ªå¢\nåœ¨è¿™é‡Œå¯ä»¥çœ‹å¾—åˆ°æ„é€ IndexEntryå¯¹è±¡ï¼Œè¿™æ˜¯æ¶ˆæ¯çš„ç´¢å¼•å¯¹è±¡ï¼Œåç»­ç”¨æ¥åŠ é€ŸæŸ¥è¯¢schema\nè¿™ä¸ªæ–¹æ³•çš„å†…å®¹å°±å¾ˆçœ¼ç†Ÿäº†(bookkeeperç›¸å…³å†…å®¹)ï¼ŒcreateLedgeræ–¹æ³•ä¼šå…ˆåˆ›å»ºè¿™ä¸ªLedger\nåœ¨576è¡Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆè°ƒç”¨bookkeeperåˆ›å»ºè¿™ä¸ªLedger\nå†æ¥çœ‹çœ‹addEntryæ–¹æ³•ï¼Œè¿™é‡Œæ ¸å¿ƒä¹Ÿæ˜¯è°ƒç”¨bookkeeperçš„ledgerHandleè¿›è¡Œæ•°æ®å†™å…¥\nè¿™ä¸ªæ–¹æ³•æ˜¯å±äºBookkeeperå®¢æˆ·ç«¯çš„é€»è¾‘äº†ï¼Œé€šè¿‡æ–¹æ³•æ³¨é‡Šå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£å°†æ•°æ®å¼‚æ­¥å†™å…¥åˆ°ä¸€ä¸ªæ‰“å¼€çš„Ledgerã€‚Bookkeeperç›¸å…³çš„é€»è¾‘åç»­åœ¨å•ç‹¬å†™postè¿›è¡Œè®²è§£\nå°ç»“ ç®€å•å½’çº³å¦‚ä¸‹\nå‚æ•°æ ¼å¼æ ¡éªŒã€æ“ä½œæƒé™æ ¡éªŒ æŸ¥è¯¢å½“å‰Topicæ˜¯å¦å·²ç»åˆ›å»ºè¿‡schemaï¼Œæœ‰åˆ™ä»¥æ’å…¥æ—¶ç‰ˆæœ¬å·è‡ªå¢ å¦‚æœæ˜¯åˆæ¬¡åˆ›å»ºSchemaï¼Œåˆ™è°ƒç”¨bookkeeperåˆ›å»ºLedger å¾€è¿™ä¸ªSchemaå¯¹åº”çš„Ledgerå†…æ’å…¥schemaå…ƒæ•°æ®ä¿¡æ¯ å…¶ä»– åºåˆ—åŒ–å¯¹è±¡åˆ›å»ºæµç¨‹ ç°åœ¨å†ä¸“é—¨æ¥çœ‹çœ‹åºåˆ—åŒ–å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå›åˆ°å¼€å¤´ç®¡ç†æµåˆ›å»ºschemaçš„åœ°æ–¹ï¼ŒSchema.AVROæ–¹æ³•æ˜¯å’±ä»¬æœ¬æ¬¡è¦çœ‹çš„\né€šè¿‡æ³¨é‡Šå¯ä»¥çœ‹åˆ°ï¼Œæ­¤é™æ€æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªAvroç±»å‹çš„schemaå¯¹è±¡ï¼ŒgetDefaultImplementationæ–¹æ³•æ˜¯è·å–å®ç°ç±»(é¥¿æ±‰å•ä¾‹è®¾è®¡æ¨¡å¼)ï¼Œè€ŒnewAvroSchemaæ–¹æ³•æ‰æ˜¯æœ¬æ¬¡è¦çœ‹çš„\nç»§ç»­å¾€ä¸‹è·Ÿè¸ª\nè·å–å¯¹åº”å¤„ç†çš„ç±»åŠ è½½å™¨ï¼Œå¹¶é€šè¿‡å¯¹åº”çš„ç±»åŠ è½½å™¨åˆ›å»ºAvroSchemaå®ä¾‹\n54è¡Œæ˜¯æ ¸å¿ƒï¼Œå…¶ä»–çš„éƒ½æ˜¯èµ‹å€¼æ“ä½œ\nsuperè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°åšèµ‹å€¼æ“ä½œï¼Œè¿˜æ˜¯ç»§ç»­çœ‹\nç»§ç»­è·Ÿè¸ªparseé€»è¾‘\nFACTORY.createParseræ–¹æ³•æ˜¯jacksonçš„æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºJsonParserå¯¹è±¡çš„ï¼›å› æ­¤ç»§ç»­è·Ÿè¸ªparseæ–¹æ³•\n1471è¡Œå¯ä»¥çœ‹åˆ°è¿”å›äº†æˆ‘ä»¬æƒ³è¦çš„Schemaå¯¹è±¡ï¼Œé‚£ä¹ˆSchema.parseæ–¹æ³•å°±æ˜¯é‡ä¸­ä¹‹é‡\nè¿™ä¸ªæ–¹æ³•æ˜¯æ ¸å¿ƒï¼Œæœ¬èº«ä¼šé€’å½’çš„è¿›è¡Œè§£æèµ‹å€¼ç»™schemaå¯¹è±¡\nç›¸ä¿¡è¯»è€…è¯»åˆ°è¿™é‡Œä¹Ÿå¥½å¥‡schemaé•¿ä»€ä¹ˆæ ·ï¼Œå› æ­¤æä¾›ä¸‹å›¾è®©è¯»è€…æ„Ÿå—ä¸‹ï¼Œèƒ½å¤§æ¦‚æ¨æµ‹å¾—å‡ºæ¥è¿™é‡Œå·²ç»æ¶µç›–äº†schemaçš„ç»“æ„ä¿¡æ¯äº†\ngetSchemaCompatibilityStrategyAsyncWithoutAuthæ–¹æ³• AdminResource#getSchemaCompatibilityStrategyAsyncWithoutAuthæ–¹æ³•æ˜¯åœ¨æœåŠ¡ç«¯å¤„ç†schemaåˆ›å»ºè¯·æ±‚é˜¶æ®µä¼šè°ƒç”¨çš„æ–¹æ³•ï¼Œç°åœ¨å°±ä¸€èµ·è·Ÿè¸ªçœ‹çœ‹\n731è¡Œå’Œ739è¡Œåˆ†åˆ«æ˜¯è·å–Topicçº§åˆ«å’ŒNamespaceçº§åˆ«çš„schemaå…¼å®¹ç­–ç•¥ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰åˆ™é»˜è®¤è‡ªåŠ¨æ›´æ–°ã€‚ä¾‹å¦‚Topic Aä¹‹å‰å·²ç»åˆ›å»ºè¿‡schema1ï¼Œé‚£ä¹ˆå¦‚æœæ­¤æ—¶å†å‘èµ·schema2åˆ›å»ºè¯·æ±‚ï¼Œåˆ™æœåŠ¡ç«¯ä¼šç»§ç»­ä¿å­˜å¹¶ä¸”ç”Ÿæ•ˆschema2ï¼Œåªä¸è¿‡å®ƒçš„ç‰ˆæœ¬å·ä¼šè¿›è¡Œç´¯åŠ ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é…ç½®ä¸ºä¸æ”¯æŒschemaç­–ç•¥ä¸æ”¯æŒæ›´æ–°ï¼Œä¸€æ—¦ç¡®å®šäº†åå°±ä¸å…è®¸å†å˜æ›´\næ€»ç»“ ç›¸ä¿¡å¤§å®¶å¯¹schemaåˆ›å»ºçš„æµç¨‹å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œå†æ¬¡ç®€å•å½’çº³ä¸‹\nå®¢æˆ·ç«¯æ ¹æ®ç”¨æˆ·å®šä¹‰çš„ç»“æ„ä¿¡æ¯åˆ›å»ºå¯¹åº”çš„Schemaå¯¹è±¡ï¼Œå¹¶å°†ç»“æ„ä¿¡æ¯ä»¥HTTPè¯·æ±‚å‘ç»™æœåŠ¡ç«¯ æœåŠ¡ç«¯æ£€æµ‹å¹¶æ ¹æ®Schemaå…¼å®¹ç­–ç•¥åšç›¸å¯¹åº”çš„å¤„ç†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šè°ƒç”¨Bookkeeperåˆ›å»ºLedgerä»¥åŠEntry Bookkeeperå°†æ­¤Schemaæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œç›¸å½“äºSchemaä¿¡æ¯ä¼šè¢«Bookkeeperå½“ä½œä¸€æ¡æ¶ˆæ¯è¿›è¡Œå­˜å‚¨ è¿™åŸºæœ¬ä¸Šå°±æ˜¯å…¨éƒ¨å†…å®¹ï¼Œå½“ç„¶ç»†èŠ‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œè·Ÿè¸ªä»£ç ï¼Œç›¸ä¿¡ä½ ä¼šæœ‰æ›´å¤šæ”¶è·ï½\n","date":"2024-08-01T10:02:55+08:00","image":"https://sherlock-lin.github.io/p/%E7%AE%A1%E7%90%86%E6%B5%81%E5%88%9B%E5%BB%BAschema%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/image-20240801111546500_hu11517481045871944850.png","permalink":"https://sherlock-lin.github.io/p/%E7%AE%A1%E7%90%86%E6%B5%81%E5%88%9B%E5%BB%BAschema%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/","title":"ç®¡ç†æµåˆ›å»ºschemaæµç¨‹æºç è§£æ"},{"content":"Pulsarå®¢æˆ·ç«¯ç®€æ pulsaræœåŠ¡æ˜¯ç»å…¸çš„C/Sæ¶æ„ï¼Œç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ„æˆã€‚æœåŠ¡ç«¯æä¾›å¤„ç†è¯»å†™è¯·æ±‚æœåŠ¡ï¼Œå®¢æˆ·ç«¯è´Ÿè´£å‘èµ·è¯»å†™è¯·æ±‚ã€‚pulsarå°†å®¢æˆ·ç«¯æŒ‰ç…§è¯»å†™åˆ†æˆäº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œä½†æ˜¯æ— è®ºæ€ä¹ˆåˆ†ï¼Œå®ƒä»¬æœ¬è´¨ä¸Šéƒ½æ˜¯Pulsarå®¢æˆ·ç«¯å¹¶æœ‰å¾ˆå¤šç›¸åŒçš„åœ°æ–¹ï¼Œæœ¬ç¯‡å°±é’ˆå¯¹å®¢æˆ·ç«¯è¿›è¡Œåˆ†æã€‚\nä¸‹å›¾æ˜¯å®¢æˆ·ç«¯çš„ç»„æˆéƒ¨åˆ†\nConnectionPoolè¿æ¥æ± (å€¼å¾—æ·±æŒ–)\nè¿æ¥æ± æ˜¯å®¢æˆ·ç«¯çš„æ ¸å¿ƒï¼Œç»´æŠ¤ç€è·ŸæœåŠ¡ç«¯çš„TCPè¿æ¥ï¼Œå®¢æˆ·ç«¯çš„è¯»å†™(ç”Ÿäº§è€…/æ¶ˆè´¹è€…)éƒ½å¼ºä¾èµ–ç½‘ç»œè¿æ¥ï¼Œå› ä¸ºæœ€åæ•°æ®è¿˜æ˜¯è¦é€šè¿‡åº•å±‚çš„ç½‘ç»œè¿›è¡Œé€šä¿¡\nLookupService\nå…·æœ‰è·¯æœ‰å±æ€§çš„å®¢æˆ·ç«¯è§’è‰²ï¼Œè´Ÿè´£æŸ¥æ‰¾Topicå½’å±çš„BrokerèŠ‚ç‚¹\nçº¿ç¨‹æ± \näº‹ä»¶çº¿ç¨‹æ± \nå¤–éƒ¨çº¿ç¨‹æ± \nå†…éƒ¨çº¿ç¨‹æ± \nåˆ›å»ºå®¢æˆ·ç«¯å¯¹è±¡ åˆ›å»ºæµç¨‹ å…ˆçœ‹çœ‹ä¸‹é¢ä¸€æ®µä»£ç \nè¿™æ˜¯é€šè¿‡ç”Ÿäº§è€…å†™æ•°æ®åˆ°PulsaræœåŠ¡ç«¯çš„caseï¼Œç›¸ä¿¡å¤§å®¶ä¸ä¼šæ„Ÿåˆ°é™Œç”Ÿï¼Œå…¶ä¸­34è¡Œå°±æ˜¯åˆ›å»ºå®¢æˆ·ç«¯çš„é€»è¾‘ï¼Œå› æ­¤å°±ä»è¿™é‡Œè¿›è¡Œè·Ÿè¸ª\né€šè¿‡è·Ÿè¸ªPulsarClient.builderæ–¹æ³•å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›å€¼æ˜¯ClientBuilderå¯¹è±¡ï¼Œå…·ä½“å®ç°é€»è¾‘å’±ä»¬å…ˆä¸å…³å¿ƒï¼Œå’±ä»¬åªéœ€è¦çŸ¥é“è¿™ä¸ªæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªClientBuilderå°±å¤Ÿäº†ï¼Œç»“åˆä¹‹å‰çš„åˆ›å»ºçš„é€»è¾‘å¯ä»¥çŸ¥é“æœ€ç»ˆä¼šèµ°åˆ°ClientBuilder#buildæ–¹æ³•\nbuildæ–¹æ³•ä¸­æ ¸å¿ƒå°±æ˜¯50è¡Œçš„é€šè¿‡PulsarClientImplæ„é€ å‡½æ•°åˆ›å»ºå®¢æˆ·ç«¯å¯¹è±¡ï¼Œå…¶ä»–çš„éƒ½æ˜¯ä¸€äº›é…ç½®æ ¡éªŒå·¥ä½œã€‚ä¸‹é¢å°±ç›´æ¥è¿›å…¥PulsarClientImplçš„æ„é€ å‡½æ•°è¿›è¡Œåˆ†æ\nè¿™ä¸ªæ„é€ æ–¹æ³•è™½ç„¶é€»è¾‘ä¸å°‘ï¼Œä½†å®é™…ä¸Šé‡è¦çš„å°±æ˜¯201è¡Œçš„åˆå§‹åŒ–\nåˆ›å»ºç½‘ç»œè¿æ¥æ±  åˆå§‹åŒ– è¿™é‡Œçš„ClientCnxå¯¹è±¡éå¸¸é‡è¦ï¼Œåé¢å†ç»†è®²ã€‚ç°åœ¨å…ˆç»§ç»­è·Ÿè¸ªæ„é€ å‡½æ•°çš„é€»è¾‘\nè¿™é‡Œåˆå§‹åŒ–äº†Nettyå®¢æˆ·ç«¯ï¼Œåœ¨è·Ÿå¤–éƒ¨åˆ›å»ºç½‘ç»œè¿æ¥æ—¶ç›´æ¥é€šè¿‡Nettyå®¢æˆ·ç«¯è¿›è¡Œå³å¯ã€‚å®¢æˆ·ç«¯åˆå§‹åŒ–é˜¶æ®µï¼Œç½‘ç»œè¿æ¥æ± åŸºæœ¬ä¸Šå°±åšäº†è¿™äº›äº‹ï¼Œé‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Œè®©æˆ‘ä»¬æ¥å¾€ä¸‹çœ‹\nå·¥ä½œæµç¨‹ åœ¨åˆ›å»ºç”Ÿäº§è€…å¯¹è±¡æ—¶ï¼Œä¼šèµ°åˆ°PulsarClientImpl#getConnectionè¿™ä¸ªæ–¹æ³•ï¼Œä»è¿™é‡Œå¼€å§‹è¿›è¡Œåˆ†æ\næ­¤æ–¹æ³•ç¬¬ä¸€è¡Œæ˜¯é€šè¿‡LookupæœåŠ¡æŸ¥æ‰¾Topicå½’å±çš„BrokerèŠ‚ç‚¹ä¿¡æ¯ï¼ŒLookupç›¸å…³çš„æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ Apache Pulsaræºç è§£æä¹‹Lookupæœºåˆ¶ è¿™ç¯‡æ–‡ç« ï¼Œåœ¨969è¡Œä¼šå°†LookupæŸ¥åˆ°çš„Brokeråœ°å€è¿›è¡Œåˆ›å»ºç½‘ç»œè¿æ¥\nå¯ä»¥çœ‹åˆ°è·å–ç½‘ç»œè¿æ¥æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨ConnectionPoolç±»çš„æ–¹æ³•è¿›è¡Œè·å–\nè¿™é‡Œä¼šæ ¹æ®å‚æ•°randomKey(Broker IPåœ°å€)è¿›è¡Œç½‘ç»œè¿æ¥çš„å¤ç”¨ï¼Œå¦‚æœè¿˜æ²¡åˆ›å»ºçš„è¯åˆ™è¿›è¡Œåˆ›å»ºï¼ŒåŒæ—¶æ£€æŸ¥æ¸…ç†ä¸å¯ç”¨çš„ç½‘ç»œè¿æ¥è¿›è¡Œé‡Šæ”¾\nè°ƒç”¨createConnectionæ–¹æ³•è¿›è¡Œè¿æ¥åˆ›å»ºï¼ŒåŒæ—¶ä¹Ÿåœ¨é€šé“åˆ›å»ºé€šé“æˆåŠŸåç»‘å®šç›‘å¬å™¨ï¼Œåœ¨é€šé“è¢«å…³é—­æ—¶ä¸€èµ·å…³é—­å½“å‰çš„ç½‘ç»œè¿æ¥ã€‚\nå°†unresolvedPhysicalAddressè§£æå‡ºæ­£ç¡®çš„åœ°å€ï¼Œç°åœ¨è¿˜ä¸å¤ªæ¸…æ¥šå·²ç»æœ‰äº†logicalAddress(ç›®æ ‡Brokeråœ°å€)ï¼Œè¿˜è§£æè¿™ä¸ªçš„ç”¨é€”æ˜¯ä»€ä¹ˆ\nè°ƒç”¨connectToAddressæ–¹æ³•åˆ›å»ºç½‘ç»œè¿æ¥ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸æ—¶ï¼Œå¦‚æœæœåŠ¡ç«¯åœ¨Lookupé˜¶æ®µè¿”å›ä¸æ­¢ä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆå°±å°è¯•è·Ÿä¸‹ä¸€ä¸ªåœ°å€åˆ›å»ºç½‘ç»œè¿æ¥\nè¿™é‡Œåº”è¯¥å°±å¾ˆç†Ÿæ‚‰äº†ï¼Œå°±æ˜¯é€šè¿‡Nettyå®¢æˆ·ç«¯åˆ›å»ºè·Ÿç›®æ ‡BrokerèŠ‚ç‚¹çš„TCPè¿æ¥ã€‚\nå°ç»“ è¿æ¥æ± æ˜¯ä¸€ä¸ªConcurrentHashMapï¼Œkeyæ˜¯IP+ç«¯å£ï¼Œvalueæ˜¯ClientCnxæ¥ç¼“å­˜è¿™äº›è¿æ¥ã€‚ClientCnxé™¤äº†ç®¡ç†è¿æ¥è¿˜ç®¡ç†æ‰€æœ‰çš„ä¸šåŠ¡å‘½ä»¤ï¼Œä¾‹å¦‚å‘é€æ¶ˆæ¯æ˜¯Sendå‘½ä»¤ï¼ŒæœåŠ¡ç«¯ä¼šå¯¹åº”ä¸€ä¸ªhandleSendæ–¹æ³•æ¥å¤„ç†è¿™ä¸ªå‘½ä»¤ã€‚\nè¿æ¥æ± æ˜¯å®¢æˆ·ç«¯æœ€é‡è¦çš„å†…å®¹ï¼Œæ— è®ºæ˜¯ç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œéƒ½ä¼šå»è¿æ¥æ± è·å–/åˆ›å»ºè·ŸBrokerçš„ç½‘ç»œè¿æ¥ï¼Œåç»­çš„æ•°æ®è¯»å†™æœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡Nettyçš„channelè¿›è¡Œçš„ï¼Œå› æ­¤å¯è§å®ƒæ˜¯ç›¸å½“é‡è¦çš„ã€‚è¿æ¥æ± çš„è®¾è®¡å°†ç½‘ç»œè¿æ¥è·Ÿå…¶ä»–è¯»å†™åŠŸèƒ½å‰¥ç¦»å¼€æ¥è¾¾åˆ°èŒè´£åˆ†ç¦»çš„æ•ˆæœï¼ŒåŒæ—¶é€šè¿‡æ± åŒ–æ¦‚å¿µï¼Œåœ¨å¤šä¸ªç”Ÿäº§è€…/æ¶ˆè´¹è€…æƒ…å†µä¸‹ä¸ä»…èŠ‚çº¦äº†ç½‘ç»œè¿æ¥çš„åˆ›å»ºï¼ŒåŒæ—¶è¿˜æå‡ç½‘ç»œè¿æ¥åˆ›å»ºçš„æ€§èƒ½(å¤ç”¨æ€è·¯)ã€‚\nå…¶ä»–åŠŸèƒ½ LookupService Lookupæœºåˆ¶å·¥ä½œé€»è¾‘åœ¨ Apache Pulsaræºç è§£æä¹‹Lookupæœºåˆ¶ è¿™ç¯‡æ–‡ç« å·²ç»è¯´æ˜äº†ï¼Œè¿™é‡Œä¸»è¦ä¸€èµ·çœ‹çœ‹å®ƒçš„åˆ›å»ºé€»è¾‘ã€‚åœ¨PulsarClientImplæ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ä»¥ä¸‹ä»£ç \nPulsaræ”¯æŒä¸¤ç§Lookupå®ç°ï¼Œä¸€ç§æ˜¯é€šè¿‡httpåè®®å»è·ŸæœåŠ¡ç«¯é€šä¿¡ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡äºŒè¿›åˆ¶æ–¹å¼æŸ¥è¯¢(æ€§èƒ½æ›´å¥½)ã€‚æœ¬æ¬¡å°±è·Ÿç€æ¯”è¾ƒå¸¸è§çš„httpæ–¹å¼è¿›è¡Œåˆ†æ\né€šè¿‡æ„é€ å‡½æ•°å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡åˆ›å»ºHttpClientå¯¹è±¡è¿›è¡Œçš„ï¼Œè¿™é‡Œæˆ‘ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ç”¨çš„å¼€æºçš„HttpClientå°±æ²¡ç»§ç»­è·Ÿï¼Œåæ¥åœ¨è°ƒè¯•çš„æ—¶å€™è·Ÿè¿›å»æ‰å‘ç°ï¼Œè¿™æ˜¯Pulsar è‡ªå®šä¹‰å¯¹è±¡\nè·Ÿè¸ªè¿›å»çœ‹ï¼Œå…¶ä»–éƒ½æ˜¯èµ‹å€¼ã€å®‰å…¨æ£€æŸ¥çš„å·¥ä½œï¼Œæ ¸å¿ƒåœ¨161è¡Œçš„httpClientåˆ›å»ºã€‚ è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯åˆ›å»ºçš„AsyncHttpClientå¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå°è£…Nettyçš„async-http-client-2.12.1.jarçš„å¤–éƒ¨åŒ…ï¼Œè¿™æ˜¯æ”¯æŒå¼‚æ­¥å¤„ç†çš„é«˜æ€§èƒ½HTTPå·¥å…·åŒ…\nMemoryLimitController ç”±äºMemoryLimitControllerçš„å†…å®¹ä¸å¤šï¼Œå°±çœ‹çœ‹å®ƒçš„åˆ›å»ºä»¥åŠå·¥ä½œæµç¨‹\nåœ¨PulsarClientImplçš„æ„é€ å‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°ä¼šè°ƒç”¨MemoryLimitControlleræ„é€ å‡½æ•°è¿›è¡Œåˆ›é€ ï¼Œä»è¿™é‡Œè¿›å»åˆ†æ\næ„é€ é€»è¾‘å¾ˆç®€å•ï¼Œå°±åªæœ‰èµ‹å€¼æ“ä½œï¼Œåˆ°è¿™é‡Œå°±æˆåŠŸåˆ›å»ºMemoryLimitControllerå¯¹è±¡äº†ï¼Œé‚£å°±å†çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„å§ã€‚MemoryLimitControllerçš„æ ¸å¿ƒå·¥ä½œé€»è¾‘æ˜¯checkTriggeræ–¹æ³•\nè¿™é‡Œä¼šè°ƒç”¨triggerçš„runæ–¹æ³•ï¼Œè¿™ä¸ªtriggerçš„é€»è¾‘å…¶å®å°±æ˜¯åˆ›å»ºMemoryLimitControllerçš„æ„é€ æ–¹æ³•ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„reduceConsumerReceiverQueueSizeæ–¹æ³•ï¼Œé‚£ä¹ˆç»§ç»­è·Ÿè¸ª\nå¾ªç¯è°ƒç”¨æ‰€æœ‰çš„æ¶ˆè´¹è€…çš„reduceCurrentReceiverQueueSizeæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´MemoryLimitControllerç›®å‰åªèƒ½é™åˆ¶æ¶ˆè´¹è€…çš„å†…å­˜ã€‚\nè¿™é‡Œçš„é™åˆ¶é€»è¾‘ç›¸å½“äºå°†æ‰€æœ‰æ¶ˆè´¹è€…çš„æ¥æ”¶é˜Ÿåˆ—çš„å®¹é‡å‡åŠï¼Œé¿å…é˜Ÿåˆ—ä¸­çš„æ•°æ®å ç”¨è¿‡å¤šå†…å­˜ã€‚ç”±æ­¤å¯è§MemoryLimitControllerç›®å‰åšçš„è¿˜æ˜¯æ¯”è¾ƒå°èŒƒå›´çš„å†…å­˜æ§åˆ¶ï¼Œå¹¶ä¸”æ•´ä½“é€»è¾‘å¹¶ä¸å¤æ‚ã€‚\nçº¿ç¨‹æ±  å®¢æˆ·ç«¯å¯¹è±¡åˆå§‹åŒ–æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸‰ä¸ªçº¿ç¨‹æ± ï¼Œç°åœ¨å°±æ¥åˆ†æä¸‹å®ƒä»¬çš„ç”¨é€”\né¦–å…ˆæ˜¯externalExecutorProviderçº¿ç¨‹æ± é€šè¿‡æŸ¥çœ‹è°ƒç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è¢«æ¶ˆè´¹è€…ä½¿ç”¨ï¼Œé‡Œé¢çš„å·¥ä½œçº¿ç¨‹ä¸»è¦æ˜¯ç”¨äºæ¶ˆè´¹æœåŠ¡ç«¯çš„æ¶ˆæ¯\nå†æ¥çœ‹çœ‹internalExecutorProviderçº¿ç¨‹æ± ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ç”¨æ¥æ˜¯ä¸€äº›è·Ÿåå‘Pulsarç³»ç»Ÿå±‚é¢çš„å·¥ä½œ\nè‡³äºscheduledExecutorProviderç›¸ä¿¡å°±æ›´ç®€å•äº†ï¼Œé¡¾åæ€ä¹‰éƒ½æ˜¯å¤„ç†ä¸€äº›å‘¨æœŸæ€§çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ä¸‹é¢çš„å‘¨æœŸæ€§çš„åŒæ­¥Topicåˆ†åŒºä¿¡æ¯åˆ°å®¢æˆ·ç«¯\næ€»ç»“ PulsarClientä¸­çš„EventLoopGroupè´Ÿè´£åˆ›å»ºTCPè¿æ¥ï¼ŒConnectionPoolå¯¹è±¡è´Ÿè´£ç®¡ç†è¿æ¥ï¼Œåœ¨åˆ›å»ºConnectionPoolå¯¹è±¡æ—¶ä¼šé€šè¿‡EventLoopGroupåˆ›å»ºè¿æ¥ã€‚ PulsarClientä½¿ç”¨Nettyæ¥åˆ›å»ºTCPè¿æ¥ï¼Œå¹¶ç®¡ç†ä¸€ä¸ªè¿æ¥æ± å’Œä¸¤ä¸ªçº¿ç¨‹æ± ï¼Œæ‰€æœ‰Producerå’ŒConsumeréƒ½ä¼šå¤ç”¨PulsarClientçš„è¿æ¥æ± å’Œçº¿ç¨‹æ± ï¼Œè¿™æ ·å¯ä»¥é¿å…å®¢æˆ·ç«¯åˆ›å»ºè¿‡å¤šçš„è¿æ¥å’Œçº¿ç¨‹ã€‚å› æ­¤é€šå¸¸ä¸€ä¸ªè¿›ç¨‹ä¸­åªåˆ›å»ºä¸€ä¸ªPulsarClientï¼Œæ¯ä¸ªTopicå¯ä»¥è‡ªå·±å•ç‹¬åˆ›å»ºProducerå’ŒConsumerã€‚ ç”±äºBrokerä½¿ç”¨äº†Reactoræ¨¡å‹ï¼Œå•çº¿ç¨‹åªè´Ÿè´£è½¬å‘äº‹ä»¶ï¼Œè€Œæ•°æ®çš„è¯»å–ã€è§£ç ã€å¤„ç†ç­‰éƒ½æ˜¯åœ¨å·¥ä½œçº¿ç¨‹ä¸­å®Œæˆçš„ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯æ‰€æœ‰è¯·æ±‚éƒ½æ˜¯å¼‚æ­¥å®Œæˆçš„ï¼›å®¢æˆ·ç«¯Producer/Consumeréƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤ä¸å­˜åœ¨å•è¿æ¥çš„æ€§èƒ½é—®é¢˜ã€‚ PulsarClienté»˜è®¤åªä¼šä¸æ¯ä¸ªBrokerå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œå¦‚æœè§‰å¾—ä¸å¤Ÿå¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒå¤§ã€‚ ClientCnxéå¸¸é‡è¦ï¼Œè¿™æ˜¯nettyçš„å…¥é˜Ÿå¤„ç†é€»è¾‘ç±»ã€‚åç»­ä¼šä¸“é—¨é’ˆå¯¹è¿™ä¸ªç±»è¿›è¡Œè§£æ ","date":"2024-07-17T10:34:21+08:00","image":"https://sherlock-lin.github.io/p/pulsarclient%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/image-20240715212010651_hu12175125588812162081.png","permalink":"https://sherlock-lin.github.io/p/pulsarclient%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/","title":"PulsarClientæºç è§£æ"},{"content":"å¼•è¨€ çŸ¥ä¹ä¸Šæœ‰ä¸€ä¸ªçƒ­é—¨çš„é—®é¢˜ï¼Œä»€ä¹ˆæ˜¯äººç”Ÿçš„é¡¶çº§äº«å—ï¼Ÿ çœ‹åˆ°è¿™ä¸ªé—®é¢˜æˆ‘å›æƒ³åˆ°äº†å¤šå¹´å‰ï¼Œé‚£ä¸ªç‚çƒ­çš„åˆåï¼Œæˆ‘åœ¨å­¦æ ¡çš„å›¾ä¹¦é¦†é‡Œï¼Œä¸€è¾¹å‚ç…§ä¹¦ç±ï¼Œä¸€è¾¹ç”¨ç€ä¸€éƒ¨ç ´æ—§çš„thinkpadæ•²ç€ä¸€è¡Œè¡ŒJavaä»£ç ï¼Œå†™ä¸€ä¼šæ‰§è¡Œè°ƒè¯•ä¸€ä¸‹ï¼Œæˆ–çš±çœ‰ï¼Œæˆ–å–œç¬‘é¢œå¼€ï¼Œè¿™æ˜¯åœ¨å¤–äººçš„è§†è§’ï¼›è€Œå†…å¿ƒä¸–ç•Œé‡Œï¼Œæˆ‘ä»¿ä½›å°±æ˜¯ä¸€ä¸ªæ— æ‰€ä¸èƒ½çš„é­”æ³•å¸ˆğŸ§™â€â™€ï¸ï¼Œä¸€æŒ¥åŠ¨é­”æ³•æ£’ğŸª„ï¼Œé«˜æ¥¼å¤§å¦æ‹”åœ°è€Œèµ·ï¼Œå†å¿µä¸€æ®µå’’è¯­ï¼Œå±±å·æ²³æµã€å„ä¸ªå½¢æ€çš„åŠ¨ç‰©éƒ½éšæˆ‘æ‰€æƒ³çš„æ¨¡æ ·å‡ºç°ï¼Œæœ€åå¤§å–ä¸€å£°ï¼Œâ€œå¯åŠ¨ï½â€ï¼Œè¿™ä¸ªâ€œä¸–ç•Œâ€å°±ä»¿ä½›è¢«èµ‹äºˆäº†ç”Ÿå‘½åŠ›ä¸€æ ·æ´»äº†è¿‡æ¥ï¼Œæ²³æµå”±ç€æ­Œä»é«˜å±±æµä¸‹æ¥ï¼Œç»è¿‡å¬‰é—¹çš„ä¸›æ—ï¼Œä¸›æ—é‡Œå°é¹¿åœ¨è·Ÿè´è¶ğŸ¦‹å¬‰é—¹ï¼Œæ­¤æ—¶æ± è¾¹è›°ä¼å·²ä¹…çš„é³„é±¼ğŸŠæ­£å‡†å¤‡æ‰‘å‘å°é¹¿ï¼Œåªå¬æˆ‘å¤§å–ä¸€å£°ï¼Œâ€œåœï½â€ï¼Œæ•´ä¸ªä¸–ç•Œå°±åƒæŒ‰ä¸‹äº†æš‚åœé”®ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½åœæ­¢åœ¨é‚£ä¸€åˆ»ï¼Œäºæ˜¯ä¹æˆ‘æ•²ç€é”®ç›˜é‡æ–°ç¼–ç é³„é±¼çš„è¡Œä¸ºï¼Œé³„é±¼ä¸éœ€è¦æ•é£Ÿå…¶ä»–åŠ¨ç‰©ä¹Ÿèƒ½å­˜æ´»ï¼Œåªéœ€è¦é€šè¿‡å‘¼å¸å’Œå–æ°´ä¹Ÿèƒ½è·å¾—è¶³å¤Ÿèƒ½é‡ã€‚æœ‰äººè¯´ï¼Œä½ è¿™ä¸èƒ¡æ‰¯å—ï¼Œè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿä½†è¿™å°±æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºè¿™æ˜¯å±äºæˆ‘çš„ä¸–ç•Œï¼Œè¿™å°±æ˜¯ç¼–ç¨‹çš„ä¸–ç•Œã€‚\nç¼–ç¨‹çš„æœ¬è´¨ ç¼–ç¨‹çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Œè¿‡å»æˆ‘ç»éªŒå°šæµ…ä¸æ•¢å†™è¿™ç§å†…å®¹ï¼Œç°å¦‚ä»Šå·¥ä½œä¹…äº†è„¸çš®åšäº†ï¼Œå°è¯•å†™ä¸€ä¸‹å§ã€‚ç¼–ç¨‹è·Ÿå…¶ä»–æ‰€æœ‰è„‘åŠ›å¯†é›†å‹è¡Œä¸šä¸€æ ·ï¼Œæœ¬è´¨å·¥ä½œéƒ½æ˜¯è®¾è®¡ã€‚æ”¿æ²»å®¶çš„è®¾è®¡ï¼Œæ˜¯è§£å†³å¦‚ä½•è®©ä¸€ä¸ªå›½å®¶å˜å¾—æ›´åŠ å¯Œå¼ºï¼›å»ºç­‘å¸ˆçš„è®¾è®¡ï¼Œæ˜¯è§£å†³å¦‚ä½•è®©å¤§æ¥¼å¯ä»¥åŒæ—¶å…¼é¡¾ç¨³å®šã€ä¼˜é›…ç¾è§‚ï¼›é£æœºå»ºé€ è€…çš„è®¾è®¡ï¼Œæ˜¯è§£å†³å¦‚ä½•ä½æˆæœ¬å»ºé€ å‡ºæ€§èƒ½ä¼˜è¶Šçš„é£æœºç­‰ç­‰ï¼Œè€Œç¼–ç¨‹ä¹Ÿæ˜¯ä¸€æ ·ï¼Œç¨‹åºå‘˜ä¹Ÿå°±æ˜¯coderè§£å†³çš„æ˜¯ï¼Œå¦‚ä½•ç”¨è½¯ä»¶è§£å†³çœŸå®ä¸–ç•Œçš„å„ä¸ªä¸šåŠ¡åœºæ™¯çš„é—®é¢˜ï¼ŒåŒæ—¶åœ¨æ€§èƒ½å’Œæˆæœ¬æ–¹é¢éƒ½è¦æœ‰ä¸€å®šçš„è¦æ±‚ã€‚ä½†æœ‰åˆ«äºå…¶ä»–è¡Œä¸šï¼Œç¼–ç¨‹å¯ä»¥è®©è®¾è®¡è€…å¿«é€Ÿã€ä½æˆæœ¬çš„éªŒè¯è‡ªå·±çš„æƒ³æ³•ï¼Œè®¾è®¡é£æœºçš„äººï¼Œè¦æ˜¯ä¸‹ä¸€ç§’å°±èƒ½çœ‹åˆ°è‡ªå·±äº²æ‰‹è®¾è®¡çš„é£æœºç¿±ç¿”åœ¨å¤©ç©ºä¸­çš„å§¿æ€ï¼Œè®¾è®¡ç¤¾ä¼šæ¡†æ¶ä¾‹å¦‚ç†æƒ³å›½çš„äººï¼Œè¦æ˜¯ä¸‹ä¸€ç§’å°±èƒ½çœ‹åˆ°è‡ªå·±è®¾è®¡çš„å›½åº¦ç­‰ç­‰ï¼Œé‚£ä¼šæ˜¯å¤šä¹ˆå¹¸ç¦çš„ä¸€ä»¶äº‹æƒ…ï¼Œè€Œç¼–ç¨‹æ°æ°å°±å¯ä»¥ï¼åœ¨å¤§éƒ¨åˆ†åœºæ™¯ï¼Œåªéœ€è¦åœ¨ç¼–è¯‘å™¨ä¸­æ‰§è¡Œä¸€ä¸‹ï¼Œè‡ªå·±çš„æƒ³æ³•ç«‹é©¬å°±èƒ½å¾—åˆ°éªŒè¯ã€‚å› æ­¤ï¼Œè™½ç„¶ç¼–ç¨‹å‘å±•äº†å‡ åå¹´ï¼Œç›¸å…³çš„ç¼–ç¨‹è¯­è¨€æ•°ä¸èƒœæ•°ï¼Œæ¶‰åŠçš„é¢†åŸŸä»æœ€å¼€å§‹çš„ç ´è¯‘å†›äº‹æœºå¯†ã€åˆ°åŸå­å¼¹ç ”ç©¶é€æ­¥åˆ°ç°åœ¨çš„äº’è”ç½‘å•†ä¸šï¼Œå†åˆ°å…ƒå®‡å®™ã€GPTç­‰ç­‰ï¼Œä½†ä¸‡ç‰©ä¸ç¦»å…¶å®—ï¼Œæœ¬è´¨éƒ½æ˜¯é€šè¿‡è®¾è®¡æ¥è§£å†³ç‰¹å®šåœºæ™¯çš„é—®é¢˜ã€‚å› æ­¤ï¼Œç¨‹åºå‘˜çš„æ ¸å¿ƒç«äº‰åŠ›åº”è¯¥æ˜¯æ€ç»´æˆ–è€…æ˜¯è®¾è®¡èƒ½åŠ›ï¼Œè€Œè¿œè¿œä¸æ˜¯å…·ä½“çš„æŸä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼ŒæŸä¸€é¡¹æŠ€æœ¯ï¼Œæ›´ä¸åº”è¯¥æ˜¯æŸä¸ªèŒç§°ã€‚å› æ­¤ç¬”è€…è®¤ä¸ºï¼Œå¦‚æœçƒ­çˆ±ç¼–ç¨‹ï¼Œåº”è¯¥æ›´çœ‹é‡å¦‚ä½•æå‡è‡ªå·±è®¾è®¡èƒ½åŠ›ä»¥åŠè§£å†³é—®é¢˜èƒ½åŠ›ï¼Œåˆ‡å‹¿å› ä¸ºä¸€äº›éé‡è¦çš„äº‹æƒ…ä¹±äº†é“å¿ƒã€‚\nå·¥ä½œä¸ç¼–ç¨‹ å¤§æ¦‚æ˜¯ä»12å¹´å·¦å³å¼€å§‹ï¼Œå›½å†…äº’è”ç½‘è¡Œä¸šè¿æ¥äº†å¤§çˆ†å‘ï¼Œç”±äºè¡Œä¸šçº¢åˆ©ï¼Œå¤§æ‰¹äººè½¬åˆ°äº’è”ç½‘è¡Œä¸šæ¥ï¼Œç›¸å…³çš„åŸ¹è®­æœºæ„ä¹Ÿå¦‚é›¨åæ˜¥ç¬‹å¢é•¿äº†èµ·æ¥ï¼Œå¤§å¹…é™ä½äº†ç¨‹åºå‘˜çš„é—¨æ§›ã€‚å› æ­¤äº’è”ç½‘è¡Œä¸šé±¼é¾™æ··æ‚ï¼Œæœ‰ç‰¹åˆ«ç‰¹åˆ«ç‰›çš„å¤§ä½¬ï¼ŒåŒæ—¶ä¹Ÿæœ‰å¾ˆå¤šä¸å…·å¤‡æ‰€è°“ç¼–ç¨‹æ€ç»´çš„ç¨‹åºå‘˜ï¼Œè€Œç›®å‰äº’è”ç½‘è¡Œä¸šçš„å…¬å¸ï¼Œå¤§éƒ¨åˆ†çš„å·¥ä½œå†…å®¹åŸºæœ¬éƒ½æ˜¯CURDï¼Œæ›´æœ‰ç”šè€…åŸºæœ¬éƒ½ä¸ç¼–ç¨‹ï¼Œæ¯å¤©å¼€ä¸å®Œçš„ä¼šä»¥åŠæ‹‰é€šå¯¹é½ã€‚åœ¨è¿™é‡Œå¹¶ä¸æ˜¯è¦æ‰¹åˆ¤ä»€ä¹ˆï¼Œè€Œæ˜¯æƒ³è·Ÿçƒ­çˆ±ç¼–ç¨‹çš„ä¼™ä¼´è¯´ï¼Œå³ä¾¿å·¥ä½œå¾ˆå¿™ä»¥åŠå·¥ä½œä¸Šå¾ˆå°‘ç”¨åˆ°ç¼–ç¨‹ï¼Œä½†ä¹Ÿè¯·åˆ«æ”¾å¼ƒå¯¹ç¼–ç¨‹çš„çƒ­çˆ±ã€‚è¿‡å»æˆ‘è®¤ä¸ºå¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œå·¥ä½œç­‰åŒäºç¼–ç¨‹ï¼Œå·¥ä½œéœ€è¦ä»€ä¹ˆå°±å»å­¦ä»€ä¹ˆä»¥åŠä½¿ç”¨ä»€ä¹ˆï¼Œè€Œå› ä¸ºç§ç§å› ç´ ï¼Œæœ€ç»ˆé€æ¸ä¸§å¤±å¯¹ç¼–ç¨‹çš„çƒ­çˆ±ã€‚è€Œç°åœ¨ï¼Œæˆ‘è·Ÿå–œæ¬¢å°†å·¥ä½œä¸ç¼–ç¨‹åˆ†å¼€ï¼Œå°±åƒä¸¤ä¸ªè¿›ç¨‹ä¸€æ ·äº’ç›¸èµ„æºéš”ç¦»ï¼Œä½†åˆå¶å°”ä¿æŒè”ç³»ã€‚ä¸€æ–¹é¢åœ¨å°†å·¥ä½œåšå¥½çš„åŒæ—¶ä¹Ÿæå‡è‡ªå·±çš„æ²Ÿé€šè¡¨è¾¾ã€æ‹†è§£æŠ½è±¡é—®é¢˜çš„èƒ½åŠ›ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å­¦åˆ°çš„ä¸œè¥¿æ˜¯æœ‰åŠ©äºå’±ä»¬å»å­¦ç¼–ç¨‹ï¼›å¦ä¸€æ–¹é¢ï¼Œåœ¨å­¦ä¹ ç¼–ç¨‹æ—¶ï¼Œæå‡å¯¹æŠ€æœ¯çš„æ·±å¹¿åº¦ç†è§£ï¼Œåˆèƒ½æ›´å¥½çš„ä½œç”¨äºæ—¥å¸¸çš„å·¥ä½œï¼Œè€Œè„±ç¦»äº†å·¥ä½œçš„é™åˆ¶ï¼Œå’±ä»¬å¯ä»¥å¤§å¹…å‘æŒ¥è‡ªå·±çš„çƒ­çˆ±ï¼Œå†…å¿ƒçœŸå¿ƒæƒ³å­¦ä»€ä¹ˆå°±å¤§èƒ†å»å­¦ï¼Œä¸ç”¨è€ƒè™‘å…·ä½“çš„æŠ€æœ¯æ˜¯å¦èƒ½åº”ç”¨åˆ°å½“å‰çš„å·¥ä½œï¼Œå°½å¯èƒ½çš„æ·±æŒ–ï¼Œå› ä¸ºæŠ€æœ¯éƒ½æ˜¯è‡ªç›¸ä¼¼çš„ï¼Œä»»ä½•ä¸œè¥¿å­¦åˆ°ä¸€å®šçš„æ·±åº¦è¦è€ƒè™‘çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹å¼éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œä½†åŒºåˆ«å°±åœ¨äºéœ€è¦ä½ é™ä¸‹å¿ƒæ¥å»æ€è€ƒæ²‰æ·€ã€‚åƒä¸‡ä¸è¦å› ä¸ºç¤¾ä¼šä¸Šçš„ä¸€äº›ç„¦è™‘è¨€è®ºæ­¢æ­¥æ¢ç´¢çš„é‚£é¢—å¿ƒï¼Œç¼–ç¨‹è·Ÿå…¶ä»–æŠ€èƒ½çˆ±å¥½ä¸€æ ·ï¼Œéœ€è¦å¤§é‡çš„æ—¶é—´æ²‰æ·€ç£¨ç»ƒï¼Œç›¸å¯¹åº”çš„ï¼Œå®ƒä¹Ÿä¼šç»™ä½ å¾ˆä¸°åšçš„åé¦ˆï¼›å› æ­¤ï¼Œå¥½å¥½äº«å—ç¼–ç¨‹å§ï½\nç¼–ç¨‹çš„æœªæ¥ ç°å¦‚ä»Šï¼Œéšç€GPTã€äººå·¥æ™ºèƒ½çš„çˆ†ç«ï¼Œä¹Ÿé€æ­¥å‡ºç°è‡ªåŠ¨å†™ä»£ç çš„ç¨‹åºï¼Œä¹Ÿè®¸æœªæ¥çœŸçš„å¯ä»¥å–ä»£äººç±»è¿›è¡Œç¼–ç¨‹ã€‚é’ˆå¯¹è¿™ä¸ªæƒ…å†µï¼Œæˆ‘ä¹Ÿåˆ†äº«ä¸‹æˆ‘çš„çœ‹æ³•\næ€ç»´ å¦‚æœç¼–ç¨‹æ°´å¹³ä¸€ç›´åœç•™åœ¨å…¥é—¨çº§åˆ«ï¼Œé‚£ç¡®å®å¾ˆå®¹æ˜“è¢«å–ä»£ï¼Œå³ä¾¿ä¸æ˜¯äººå·¥æ™ºèƒ½ï¼Œä¹ŸåŒæ ·ä¼šæœ‰å¾ˆå¤šå…¶ä»–æ¯”ä½ å‰å®³çš„äººå–ä»£ä½ ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸æ–­æå‡è‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›ä»¥åŠä¸šåŠ¡èƒ½åŠ›ï¼Œå¦‚æœä½ èƒ½å¯¹ä¸šåŠ¡å¾ˆäº†è§£å¹¶ä¸”èƒ½ç”¨å¯¹åº”çš„æŠ€æœ¯å®ç°ä¸šåŠ¡å¹¶è§£å†³ä¸šåŠ¡çš„ç—›ç‚¹ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼ŒåŸºæœ¬ä¸Šä¸ç”¨æ‹…å¿ƒè¢«äººå·¥æ™ºèƒ½å–ä»£ï¼Œè€Œæ˜¯åº”è¯¥æŠ±ç€ç§¯æçš„å¿ƒæ€ï¼Œå› ä¸ºäººå·¥æ™ºèƒ½è¯´ç™½äº†ä¹Ÿæ˜¯å·¥å…·ï¼Œéœ€è¦äººå»é©¾é©­ï¼Œè€Œä½ é€šè¿‡é©¾é©­å®ƒå¯ä»¥æ¯”åˆ«äººæ›´å¥½çš„å®Œæˆä¸šåŠ¡ï¼Œè¿™æ˜¯ä¸€ä»¶å€¼å¾—å…´å¥‹çš„äº‹æƒ… è‡ªæˆ‘ä¿®è¡Œ é€€ä¸€æ­¥æ¥è¯´ï¼Œå³ä½¿åœ¨æœªæ¥äººå·¥æ™ºèƒ½å·²å½»åº•å–ä»£äººç±»ç¼–ç¨‹çš„å·¥ä½œï¼Œæˆ‘ä»¬çœŸçš„å°±è¦æ”¾å¼ƒç¼–ç¨‹å—ï¼ŸåŒç†æ”¾åœ¨å…¶ä»–åœºæ™¯ï¼Œç°åœ¨äººå·¥æ™ºèƒ½å‡»è´¥äº†æŸ¯æ´ï¼Œé‚£ä¹ˆäººç±»å°±ä¸ç”¨å›´æ£‹äº†å—ï¼Ÿå¦‚æœæœ‰ä¸€å¤©äººå·¥æ™ºèƒ½ä¹Ÿèƒ½æ‹‰å‡ºå¾ˆå¥½å¬çš„å°æç´æ›²å­ï¼Œäººç±»å°±å½»åº•æ”¾å¼ƒå°æç´äº†å—ï¼Ÿ å› æ­¤è¿™ä¸ªé—®é¢˜å…¶å®æ˜¯æœ‰ç‚¹è’è°¬çš„ï¼Œè¯´åˆ°åº•ï¼Œå…¶å®åƒè¿™äº›æŠ€èƒ½æœ¬è´¨ä¸Šæ˜¯ é“-æœ¯-å™¨ä¸­çš„å™¨ï¼Œæ˜¯è¦é€šè¿‡å™¨æ¥ä¹ å¾—æœ¯å’Œé“ï¼Œè¿™ä¸ªè¿‡ç¨‹åªèƒ½è‡ªå·±æ¥ï¼Œæ²¡æœ‰äººèƒ½æ›¿æˆ‘ä»¬èµ°ï¼Œäººå·¥æ™ºèƒ½æ›´ä¸è¡Œã€‚å› æ­¤ç°åœ¨èƒ½çœ‹åˆ°ï¼Œå³ä¾¿æœºå™¨è‡‚å·²ç»èƒ½å‘æŒ¥æ¯”äººç±»å¾ˆå¤§çš„åŠ›é‡ï¼Œä¾ç„¶æœ‰å¾ˆå¤šäººåœ¨é”»ç‚¼è‡ªå·±çš„èº«ä½“è‚Œè‚‰ï¼Œå³ä¾¿äººå·¥æ™ºèƒ½ä¸åœçš„åœ¨å„ä¸ªé¢†åŸŸæ‰“ç ´ä¸€äº›äººçš„è®°å½•ï¼Œä½†ä¸€æ ·æœ‰æ— æ•°çš„åœ¨åœ¨è¿™ä¸ªé¢†åŸŸç»§ç»­è‡ªæˆ‘çªç ´ã€‚è¯´ç™½äº†ï¼Œè¿™ä¸æ˜¯äººè·Ÿäººå·¥æ™ºèƒ½çš„è¾ƒé‡ï¼Œè€Œæ˜¯ä¸€åœºäººè·Ÿè‡ªå·±çš„è¾ƒé‡ï¼Œå› æ­¤æ— è®ºäººå·¥æ™ºèƒ½å‘å±•åˆ°ä½•ç§ç¨‹åº¦ï¼Œäººç±»ä¾ç„¶ä¸ä¼šåœæ­¢ä¿®è¡Œçªç ´ï¼Œé‚£ä¹ˆå¤šè¡Œä¸šéƒ½å¦‚æ­¤ï¼Œç¼–ç¨‹æ€ä¼šä¾‹å¤– æœ€åï¼Œæˆ‘éå¸¸åº†å¹¸èƒ½æˆä¸ºä¸€åcoderï¼Œæˆ‘å‘¨å›´æ‰€çœ‹åˆ°çš„ç¨‹åºå‘˜ä¼™ä¼´éƒ½æ˜¯æ¯”è¾ƒå•çº¯ã€æœ´ç´ ã€å’Œå¯¹ç”Ÿæ´»å……æ»¡çƒ­çˆ±çš„ä¸€ç¾¤äººï¼Œè·Ÿå¤§å®¶ä¼™ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨ç”¨è‡ªå·±çš„æ–¹å¼ç»™è¿™ä¸ªä¸–ç•Œæ·»ç –åŠ ç“¦ï¼Œå‘å…‰å‘çƒ­ï½\n","date":"2024-04-28T15:09:13+08:00","image":"https://sherlock-lin.github.io/p/%E7%BC%96%E7%A8%8B%E6%9C%AC%E6%BA%90/image-20240920151110972_hu12095366861263762317.png","permalink":"https://sherlock-lin.github.io/p/%E7%BC%96%E7%A8%8B%E6%9C%AC%E6%BA%90/","title":"ç¼–ç¨‹æœ¬æº"},{"content":"å¼•è¨€ ä½ æ˜¯å¦é‡åˆ°ä»¥ä¸‹é—®é¢˜\næ—¶é—´è¿‡å¾—å¾ˆå¿«ï¼Œä¸çŸ¥é“è¿‡å»åœ¨å¿™ä»€ä¹ˆ äº‹æƒ…å¾ˆå¤šå¾ˆæ‚ï¼Œæ„Ÿè§‰ä¸€ç›´éƒ½å¾ˆå¿™ä½†æ˜¯å¥½åƒä¹Ÿæ²¡å•¥æ”¶è· ç”Ÿæ´»ã€å·¥ä½œä¸­ä¸é¡ºå¿ƒçš„äº‹æƒ…å¾ˆå¤šï¼Œå¿ƒé‡Œæ¯”è¾ƒçƒ¦èºå‹æŠ‘ é‚£ä¹ˆå¯ä»¥å°è¯•å‚è€ƒã€Šå¥‡ç‰¹çš„ä¸€ç”Ÿã€‹ä¸­çš„ç”·ä¸»ä¸€æ ·ï¼Œå°è¯•å°†æ¯å¤©é‡è¦çš„äº‹æƒ…ã€æ€è€ƒè®°å½•ä¸‹æ¥ï¼Œé€šè¿‡æ¯å¤©è¾“å‡ºè®°å½•æ¥ä¿ƒè¿›è‡ªå·±åæ€ï¼ŒåŒæ—¶æ–‡å­—è¿˜æœ‰ç–—ä¼¤çš„åŠŸæ•ˆï¼Œå¾ˆå¤šæ°”æ„¤æ¼æ€’çš„é—®é¢˜ï¼Œåœ¨ä½ ç”¨æ–‡å­—è¾“å‡ºåæƒ…ç»ªèƒ½èƒ½å¾—åˆ°ä¸å°‘çš„ç¼“è§£ã€‚æœ‰äººå¯èƒ½ä¼šè§‰å¾—æ¯å¤©éƒ½å¾ˆå¿™äº†å“ªæœ‰æ—¶é—´æ¥è¿›è¡Œè®°å½•ï¼Œå…¶å®ä¸ç„¶ï¼Œæ¯å¤©åªéœ€è¦èŠ±ä¸åˆ°ååˆ†é’Ÿçš„æ—¶é—´è®°å½•æ ¸å¿ƒçš„ä¸€ä»¶äº‹æƒ…ã€åˆ†æåŸå› ä»¥åŠæ”¹è¿›æªæ–½å°±å¤Ÿäº†ï¼Œæ‰€å¸¦æ¥çš„å¥½å¤„æˆ‘æ€»ç»“äº†ä¸‹å¤§æ¦‚æœ‰ä»¥ä¸‹ä¸‰ç‚¹\nèŠ‚çœç”Ÿå‘½ æå‡æ„ŸçŸ¥ç»†èŠ‚çš„èƒ½åŠ› æ­£è§†ç—›è‹¦ èŠ‚çœç”Ÿå‘½ æˆ‘ä»¬å¹³æ—¶ä¼šæ˜¯ä¸æ˜¯å†’å‡ºä¸€äº›æƒ³æ³•ğŸ’¡ã€çµæ„Ÿï¼Œå¦‚æœä¸è®°å½•ä¸‹æ¥å¾ˆå¿«å°±ä¼šé—å¿˜ä»è€Œå¯¼è‡´æµªè´¹ç”Ÿå‘½ï¼Œä¾‹å¦‚æœ¬äººä¹‹å‰åœ¨å¤„ç†ä¸€ä¸ªé—®é¢˜æ—¶æœ€åæ‰€æ¢ç´¢å‡ºæ¥çš„è§£å†³æ–¹å¼ä¹‹å‰å°±æœ‰æ€è€ƒğŸ¤”è¿‡ï¼Œä½†æ˜¯ç”±äºæ²¡è®°å½•ä¸‹æ¥åˆç™½ç™½æµªè´¹è¿™æ¬¡çš„æ—¶é—´ã€‚å› ä¸ºçµæ„Ÿè™½ç„¶æ˜¯ä¸€ç¬é—´å†’å‡ºæ¥çš„ï¼Œä½†æ˜¯èƒŒåå´æ˜¯ä¸€æ®µç”Ÿæ´»ç»å†çš„ç§¯ç´¯ã€‚å¦‚æœä¸è®°å½•ä¸‹æ¥åé¢å¯èƒ½è¿˜æ˜¯ä¼šä¸æ–­çš„å‡ºç°å¯¼è‡´ç”Ÿå‘½å˜å¾—ä½æ•ˆã€‚ å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬æ¯å¤©è¦é¢å¯¹çš„äº‹æƒ…éå¸¸çš„å¤šï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºé‡è¦ç´§æ€¥ã€é‡è¦ä¸ç´§æ€¥ã€ä¸é‡è¦ç´§æ€¥ï¼Œä¸é‡è¦ä¸ç´§æ€¥ã€‚æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šé™·å…¥é‡Œé¢ä¸é‚£ä¹ˆé‡è¦çš„äº‹æƒ…ï¼Œå¯¼è‡´å½±å“äº†é‡è¦ç´§æ€¥çš„äº‹æƒ…ï¼Œè¿™æ˜¯ç”±äºå½“å±€è€…è¿·ï¼Œè€Œè®°å½•çš„æ–¹å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»¥ç¬¬ä¸‰äººç§°çš„è§†è§’çš„å®¡è§†ï¼Œè¿›è€Œè°ƒæ•´è‡ªå·±çš„å·¥ä½œå®‰æ’ï¼Œæ›´åŠ æœ‰çš„æ”¾çŸ¢ã€‚\næ„ŸçŸ¥ç»†èŠ‚çš„èƒ½åŠ› åœ¨ä¸åæ€çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç”Ÿæ´»ä¼šå˜å¾—å¾ˆâ€œç²—ç³™â€ä»è€Œå¯¼è‡´è™½ç„¶åšäº†å¾ˆå¤šäº‹ä½†æ˜¯ä¹Ÿæ²¡æœ‰æ„Ÿè§‰ï¼Œè€Œé€šè¿‡è®°å½•å°±å¯ä»¥ä»å¾ˆå¤šå¾®å°çš„æ—¶é—´ä»æ•æ‰æ„Ÿè§¦åˆé¦†æ¥å‘¢ï¼Œä¸€ä¸ªåŠ¨ä½œã€ä¸€å¥è¯ã€ä¸€ä¸ªåœºæ™¯ã€ä¸€ä¸ªé€‰æ‹©ã€ä¸€ç§æƒ…ç»ªç­‰éƒ½ä¼šè®©äººäº§ç”Ÿæ„Ÿæ‚Ÿï¼Œç”šè‡³æ¯å¤©å¿ƒä¸­éƒ½ä¼šå»åæ€è¿™ä»¶äº‹ï¼Œè¿™å›è®©æˆ‘ä»¬å¯¹ç”Ÿæ´»çš„è§‰çŸ¥æœ‰å¾ˆå¤§çš„æå‡ã€‚é€šè¿‡æ¯å¤©å®šæœŸè®°å½•ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿä¼šä¸‹æ„è¯†çš„å»æ€è€ƒï¼Œç°åœ¨åœ¨åšçš„è¿™ä»¶äº‹æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦å»åšï¼Ÿæ€ä¹ˆæ ·å¯ä»¥åšå¾—æ›´å¥½ç­‰ç­‰ï¼Œä»è€Œåå‘äºåšæ›´é‡è¦çš„äº‹æƒ…å¹¶ä¸”æ”¾æ›´å¤šçš„ç²¾åŠ›åœ¨è¿™ä»¶äº‹æƒ…ä¸Šï¼Œç”±äºæ€è€ƒæŠ•å…¥æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å¯¹è¿™ä»¶äº‹çš„ç»†èŠ‚æµç¨‹ä¹Ÿä¼šæ ¼å¤–çš„å°è±¡æ·±åˆ»ã€‚\næ­£è§†ç—›è‹¦ äººç”Ÿåœ¨ä¸–ï¼Œéš¾å…ä¼šé‡åˆ°å¾ˆå¤šè€¿è€¿äºæ€€ã€æ°”æ„¤ã€æ‚²ä¼¤çš„äº‹æƒ…ï¼Œæ­¤æ—¶å¤§å¤šæ•°äººä¼šé€‰æ‹©é€ƒé¿ï¼Œæ²‰æµ¸åœ¨è´Ÿé¢æƒ…ç»ªä¸­ã€‚è€Œåæ€å¤©ç„¶å°±æœ‰æ­£è§†ç—›è‹¦çš„åŠ›é‡ï¼Œé€šè¿‡åæ€ï¼Œé€šè¿‡è®°å½•ï¼Œä½ å°±ä¼šä»¥ç¬¬ä¸‰äººç§°çš„è§†è§’ï¼Œåƒæ˜¯çœ‹åˆ«äººçš„æ•…äº‹ä¸€èˆ¬å®¢è§‚çš„å»åˆ†ææ€è€ƒè¿™ä»¶äº‹æƒ…ï¼Œé€šè¿‡å®¢è§‚çš„æ€è€ƒåˆ†æå°±èƒ½å°†æƒ…ç»ªå’Œäº‹ä»¶æŠ½ç¦»å¼€æ¥ï¼Œé’ˆå¯¹äº‹ä»¶ä¸­è‡ªå·±éœ€è¦æ”¹è¿›çš„ç‚¹è®°å½•ä¸‹æ¥é¿å…ä¸‹æ¬¡å†çŠ¯ï¼Œè¿›è€Œå¾—åˆ°æå‡ä»¥åŠæˆé•¿ã€‚è¿™æ‰æ˜¯ç—›è‹¦ä¿ƒè¿›äººè¿›æ­¥çš„æ ¸å¿ƒï¼Œå› æ­¤å³ä¾¿é‡åˆ°å†éš¾è¿‡çš„äº‹æƒ…éƒ½å¯ä»¥å°è¯•è®°å½•ä¸‹æ¥åˆ†æï¼Œä¹…è€Œä¹…ä¹‹å†é‡åˆ°ç—›è‹¦æ‚²ä¼¤çš„äº‹æƒ… æˆ‘ä»¬ä¹Ÿä¸ä¼šé‚£ä¹ˆå®³æ€•ï¼Œå› ä¸ºæ¢ä¸ªè§†è§’è¿™åˆæ˜¯ä¸€æ¬¡æå‡è‡ªæˆ‘çš„æœºä¼šã€‚\næ€»ç»“ æœ€åï¼Œæˆ‘ç¥æ„¿å¤§å®¶èº«ä½“å¥åº·ã€ä¸‡äº‹é¡ºå¿ƒï¼Œå¦‚æœä¸è¡Œçš„è¯é‚£å°±ç¥æ„¿å¤§å®¶éƒ½æœ‰é¢å¯¹ã€è§£å†³ç—›è‹¦çš„èƒ½åŠ›ï¼Œä»¥åŠè¿‡ä¸Šé«˜æ•ˆã€å¿«æ„çš„äººç”Ÿï½\n","date":"2024-04-19T15:09:14+08:00","image":"https://sherlock-lin.github.io/p/%E8%AE%B0%E5%BD%95%E6%96%B9%E5%BC%8F%E9%87%8D%E6%96%B0%E6%89%93%E5%BC%80%E4%BA%BA%E7%94%9F/f6bca0216ea5e504d6fd85e06d61631d_hu17895883417847532878.png","permalink":"https://sherlock-lin.github.io/p/%E8%AE%B0%E5%BD%95%E6%96%B9%E5%BC%8F%E9%87%8D%E6%96%B0%E6%89%93%E5%BC%80%E4%BA%BA%E7%94%9F/","title":"è®°å½•æ–¹å¼é‡æ–°æ‰“å¼€äººç”Ÿ"},{"content":"ä»‹ç» åœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿èƒ½å¤Ÿåº”å¯¹ä¸åŒçš„åœºæ™¯ï¼Œä¸€èˆ¬åœ¨ä¸€äº›å®¹æ˜“æœ‰å·®å¼‚çš„ç¯èŠ‚ä¼šè€ƒè™‘å…è®¸ç”¨æˆ·è‡ªå®šä¹‰é€»è¾‘ï¼Œæ‹¦æˆªå™¨å°±æ˜¯å…¶ä¸­çš„ä¸€ç§å®ç°æ–¹å¼ï¼ŒåƒSpringã€Kafkaã€Pulsarç­‰éƒ½æ”¯æŒè¿™ç§æ–¹å¼ã€‚æµç¨‹ç®€åŒ–èµ·æ¥å°±å¦‚ä¸‹å›¾ï¼Œå®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯çš„å†™æ¶ˆæ¯è¯·æ±‚å’Œæ¥æ”¶è¯·æ±‚éƒ½è¦å…ˆé€šè¿‡ä¸€éæ‹¦æˆªå™¨ï¼Œå› æ­¤ç”¨æˆ·éƒ½è¿‡è‡ªå®šä¹‰æ‹¦æˆªå™¨é€»è¾‘å°±èƒ½ä»¥ä¸€ç§æ— ä¾µå…¥ã€è§„èŒƒåŒ–çš„æ–¹å¼æ¥æ”¹åŠ¨æ¶ˆæ¯å‘é€ä»¥åŠå¤„ç†å“åº”çš„è¡Œä¸ºã€‚\nä½¿ç”¨ ProducerInterceptoræ¥å£ ProducerInterceptoræ˜¯Pulsaræä¾›çš„æ¥å£ï¼Œé€šè¿‡å®ç°è¯¥æ¥å£ç”¨æˆ·å¯ä»¥åœ¨æ¶ˆæ¯å‘é€å’Œå‘é€æˆåŠŸé˜¶æ®µæ³¨å…¥è‡ªå®šä¹‰çš„é€»è¾‘æ¥æ‰©å±•Pulsarå®¢æˆ·ç«¯çš„èƒ½åŠ›ï¼Œè¿›è€Œä¼˜é›…çš„è§£å†³æŸäº›åœºæ™¯çš„é—®é¢˜ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @InterfaceAudience.Public @InterfaceStability.Stable public interface ProducerInterceptor extends AutoCloseable { void close(); boolean eligible(Message message); Message beforeSend(Producer producer, Message message); void onSendAcknowledgement( Producer producer, Message message, MessageId msgId, Throwable exception); default void onPartitionsChange(String topicName, int partitions) { } } è¿™é‡Œé’ˆå¯¹è¿™äº”ä¸ªæ–¹æ³•å¤§æ¦‚ä»‹ç»ä¸‹\ncloseï¼šç”±äºè¯¥æ¥å£å®ç°äº†AutoCloseableï¼Œå› æ­¤ä¹Ÿè¦å®šä¹‰ç”Ÿäº§è€…å…³é—­æ—¶è¦é‡Šæ”¾çš„èµ„æºï¼Œå¦‚æœæ²¡æœ‰å°±ç©ºç€ eligibleï¼šåˆ¤æ–­æ‹¦æˆªå™¨é’ˆå¯¹é‚£äº›æ¶ˆæ¯ç”Ÿæ•ˆï¼Œé»˜è®¤falseä¸ç”Ÿæ•ˆã€‚è¿™ä¸ªç›¸å½“äºJava8 Streamé‡Œçš„filterï¼Œå±äºèŒè´£åˆ†ç¦»çš„è®¾è®¡ beforeSendï¼šåœ¨æ¯æ¡æ¶ˆæ¯è¦å‘é€æ—¶ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå› æ­¤å¦‚æœåœ¨å‘é€å‰æƒ³åšç‚¹ä»€ä¹ˆå¯ä»¥è€ƒè™‘åœ¨è¿™é‡Œå®ç° onSendAcknowledgementï¼šåœ¨æ¯æ¡æ¶ˆæ¯æ¶ˆæ¯å‘é€æœåŠ¡ç«¯å“åº”å(æ— è®ºæˆåŠŸå¤±è´¥)ä¼šè°ƒç”¨æ­¤æ–¹æ³• onPartitionsChangeï¼šåœ¨åˆ†åŒºæ•°æœ‰å˜åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨è¿™é‡Œçš„é€»è¾‘ã€‚è¿™æ˜¯3.2ç‰ˆæœ¬æ–°åŠ çš„é€»è¾‘ï¼Œ2.8ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬æ²¡æœ‰æ­¤æ¥å£ å®ç°ä¹‹ç»Ÿè®¡ è¿™é‡Œå¯¹ç”Ÿäº§è€…ç´¯è®¡å‘é€çš„æ¶ˆæ¯æ¡æ•°è¿›è¡Œç»Ÿè®¡ï¼Œå®ç°é€»è¾‘å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 public class SherlockCountProducerInterceptor implements ProducerInterceptor { private AtomicLong count = new AtomicLong(1); @Override public void close() { } @Override public boolean eligible(Message message) { return true; } @Override public Message beforeSend(Producer producer, Message message) { System.out.println(\u0026#34;ç´¯è®¡å‘é€æ¶ˆæ¯æ¡æ•°ï¼š\u0026#34;+count.getAndIncrement()); return message; } @Override public void onSendAcknowledgement(Producer producer, Message message, MessageId msgId, Throwable exception) { } } é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨åœ¨æ¯æ¬¡å‘é€æ—¶è¿›è¡ŒåŠ 1å³å¯ï¼Œå¹¶ä¸”åœ¨eligibleä¸­è¿”å›trueä¹Ÿå°±æ˜¯å¯¹æ‰€æœ‰å‘é€çš„æ¶ˆæ¯éƒ½ç”Ÿæ•ˆï¼Œæ¯æ¡æ¶ˆæ¯åœ¨å‘é€å‰éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡beforeSendæ–¹æ³•è¿›è¡Œè‡ªå¢æ“ä½œå¹¶æ‰“å°å‡ºæ¥ã€‚\nç°åœ¨æ‹¦æˆªå™¨çš„é€»è¾‘å·²ç»å®šä¹‰å¥½äº†ï¼Œæ¥ä¸‹æ¥æ€ä¹ˆä½¿ç”¨å‘¢ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public static void customInterceptorProducer() throws Exception { String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); Producer\u0026lt;String\u0026gt; producer = pulsarClient.newProducer(Schema.STRING) .topic(\u0026#34;sherlock-api-tenant-1/sherlock-namespace-1/partition_partition_topic_3\u0026#34;) .intercept(new SherlockCountProducerInterceptor())\t//æ‹¦æˆªå™¨ç”Ÿæ•ˆé€»è¾‘ .create(); for (int i = 0; i \u0026lt; 200; i++) { producer.send(\u0026#34;hello java API pulsar:\u0026#34;+i+\u0026#34;, å½“å‰æ—¶é—´ä¸ºï¼š\u0026#34;+new Date()); } producer.close(); pulsarClient.close(); } ä¸Šè¿°å°±æ˜¯ä½¿ç”¨æ‹¦æˆªå™¨çš„caseï¼Œé€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½è½»æ¾çš„å®šä¹‰æ‰€éœ€è¦æ³¨å…¥çš„é€»è¾‘ã€‚ä¸Šè¿°ä»£ç æ‰§è¡Œåè¾“å‡ºå¦‚ä¸‹\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡æ‹¦æˆªå™¨å®Œæˆäº†æ¶ˆæ¯å‘é€çš„ç»Ÿè®¡åŠŸèƒ½ï¼Œå¯ä»¥å‘æ•£è®¾æƒ³ä¸€æƒ³ï¼Œåƒæ ¹æ®ä¸åŒkeyè¿›è¡Œåˆ†ç»„ç»Ÿè®¡ã€ç»Ÿè®¡æŸä¸ªæ—¶é—´æ®µæ¶ˆæ¯å‘é€å¤±è´¥çš„æ¡æ•°ç­‰åŠŸèƒ½ä¹ŸåŒæ ·å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨å®ç°ã€‚\nå®ç°ä¹‹äºŒæ¬¡å¤„ç† å®ç°ç»Ÿè®¡æ„Ÿè§‰è¿˜ä¸å¾—åŠ²ï¼Œå†æŠ˜è…¾ä¸€ä¸ªã€‚å‡è®¾å’±ä»¬çš„ç”Ÿäº§è€…ä¸­ä¼šå‘é€å¾ˆå¤šåœ°åŒºçš„æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯æœ‰äº›æ˜¯ä¸­å›½çš„ï¼Œæœ‰äº›æ˜¯æ–°åŠ å¡çš„ï¼Œæœ‰äº›æ˜¯å·´è¥¿çš„ï¼Œè¿™ä¸ªæ—¶å€™å®ƒä»¬çš„æ—¶é—´å°±æœ‰æ­§ä¹‰äº†ï¼Œå› ä¸ºä¸åŒæ—¶åŒºçš„æ—¶é—´æ˜¯æœ‰å·®å¼‚çš„ï¼Œé‚£å’±ä»¬å°è¯•ç”¨æ‹¦æˆªå™¨æ¥å®ç°ä¸€ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 public class SherlockAdapterTimeProducerInterceptor implements ProducerInterceptor { @Override public void close() { } @Override public boolean eligible(Message message) { // if (\u0026#34;V3\u0026#34;.equals(String.valueOf(message.getSchemaVersion()))) { // return true; // } if (\u0026#34;Singapore\u0026#34;.equals(message.getKey())) { System.out.println(\u0026#34;è¿™æ¡æ¶ˆæ¯æ˜¯æ–°åŠ å¡åœ°åŒºçš„ï¼Œè¿›è¡Œå¤„ç†ï¼\u0026#34;); return true; } System.out.println(\u0026#34;è¿™æ¡æ¶ˆæ¯æ˜¯ä¸­å›½åœ°åŒºçš„ï¼Œä¸è¿›è¡Œå¤„ç†ï¼\u0026#34;); return false; } @Override public Message beforeSend(Producer producer, Message message) { System.out.println(\u0026#34;æ‹¦æˆªåˆ°ä¸€æ¡æ–°åŠ å¡åœ°åŒºçš„æ¶ˆæ¯ï¼Œç°åœ¨è¿›è¡Œå¤„ç†ï¼Œæ¶ˆæ¯å†…å®¹ä¸ºï¼š\u0026#34;+message.getValue()); return message; } @Override public void onSendAcknowledgement(Producer producer, Message message, MessageId msgId, Throwable exception) { } } ä¸Šé¢å°±æ˜¯demoï¼Œç»§ç»­å°†è¿™ä¸ªæ‹¦æˆªå™¨åº”ç”¨äºç”Ÿäº§è€…\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public static void customInterceptorProducer() throws Exception { String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); Producer\u0026lt;String\u0026gt; producer = pulsarClient.newProducer(Schema.STRING) .topic(\u0026#34;sherlock-api-tenant-1/sherlock-namespace-1/partition_partition_topic_3\u0026#34;) .intercept(new SherlockAdapterTimeProducerInterceptor()) .create(); producer.newMessage().key(\u0026#34;China\u0026#34;).value(\u0026#34;ä¸‹å•åŠ¨ä½œ\u0026#34;).send(); producer.newMessage().key(\u0026#34;Singapore\u0026#34;).value(\u0026#34;æ”¶è—åŠ¨ä½œ\u0026#34;).send(); producer.newMessage().key(\u0026#34;China\u0026#34;).value(\u0026#34;å–æ¶ˆåŠ¨ä½œ\u0026#34;).send(); producer.newMessage().key(\u0026#34;Singapore\u0026#34;).value(\u0026#34;è®¢é˜…åŠ¨ä½œ\u0026#34;).send(); producer.close(); pulsarClient.close(); } æ‰§è¡Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„è¾“å‡º\né€šè¿‡è¾“å‡ºçš„ç»“æœå¯ä»¥åˆ†æå‡ºæ¥eligibleçš„é€»è¾‘æ˜¯ç”Ÿæ•ˆçš„ï¼Œé’ˆå¯¹æ–°åŠ å¡åœ°åŒºçš„æ¶ˆæ¯ä¼šè¿›è¡Œå¤„ç†ï¼Œè€Œä¸­å›½çš„æ¶ˆæ¯ä¿æŒä¸å˜ï¼Œæ‰€æœ‰åœ°åŒºçš„æ—¶é—´é€šè¿‡æ­¤æ‹¦æˆªå™¨æ¥ç»Ÿä¸€æˆä¸œå…«åŒºçš„æ—¶é—´ã€‚\nå°ç»“ é€šè¿‡ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨å®ç°ä»»æ„çš„é€»è¾‘ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‹¦æˆªå™¨é‡Œé¢å°½é‡ä¸è¦æ”¾è¿‡å¤šçš„é€»è¾‘ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå½±å“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå¹¶ä¸”ä¹Ÿå®¹æ˜“é€ æˆå¤„ç†é€»è¾‘çš„åˆ†æ•£ã€‚æ‹¦æˆªå™¨æœ€å¥½æ˜¯åšä¸€äº›æ ¡éªŒã€é€‚é…ã€çŠ¶æ€è®°å½•ç­‰ä¸€äº›éœ€è¦å‰ç½®å®Œæˆå¹¶ä¸”è½»é‡çº§çš„æ“ä½œã€‚\nå®ç°åŸç† åˆå§‹åŒ–æµç¨‹ é€šè¿‡ä½¿ç”¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨åˆ›å»ºç”Ÿäº§è€…å¯¹è±¡æ˜¯åªè¦é€šè¿‡.interceptæ–¹æ³•ä¼ å…¥æ‹¦æˆªå™¨å¯¹è±¡å³å¯ç”Ÿæ•ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å…ˆé€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥çœ‹çœ‹å®ç°é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 ProducerBuilder\u0026lt;T\u0026gt; intercept(org.apache.pulsar.client.api.interceptor.ProducerInterceptor... interceptors); public ProducerBuilder\u0026lt;T\u0026gt; intercept(ProducerInterceptor... interceptors) { if (this.interceptorList == null) { this.interceptorList = new ArrayList(); } this.interceptorList.addAll(Arrays.asList(interceptors)); return this; } é€šè¿‡ä»£ç è·Ÿè¸ªå¯ä»¥çœ‹åˆ°ProducerBuilderImplæ–¹æ³•ä¸­ä¼šå…ˆå°†æ‹¦æˆªå™¨å¯¹è±¡é›†åˆèµ‹å€¼ç»™è‡ªå·±çš„æˆå‘˜å˜é‡ï¼Œä¹Ÿå°±æ˜¯å®ƒå…ˆä¿å­˜ä¸€ä»½åœ¨åé¢ä½¿ç”¨ã€‚åœ¨æœ€ç»ˆè°ƒç”¨createæ–¹æ³•æ¥åˆ›å»ºProduceræ—¶ï¼Œæœ€ç»ˆä¼šèµ°åˆ°è¯¥ç±»çš„createAsyncæ–¹æ³•ï¼Œæ ¸å¿ƒé€»è¾‘å¦‚ä¸‹\n1 2 3 4 5 public CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; createAsync() { .... return this.interceptorList != null \u0026amp;\u0026amp; this.interceptorList.size() != 0 ? this.client.createProducerAsync(this.conf, this.schema, new ProducerInterceptors(this.interceptorList)) : this.client.createProducerAsync(this.conf, this.schema, (ProducerInterceptors)null); } } å¦‚æœç”¨æˆ·é€šè¿‡.interceptæ–¹æ³•ä¼ å…¥äº†è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ï¼Œåˆ™ä¼šè°ƒç”¨PulsarClientImplå¸¦æœ‰æ‹¦æˆªå™¨å¯¹è±¡çš„æ„é€ æ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 public \u0026lt;T\u0026gt; CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; createProducerAsync(ProducerConfigurationData conf, Schema\u0026lt;T\u0026gt; schema, ProducerInterceptors interceptors) { .... //è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘å°±è¿™ä¸€è¡Œï¼Œç»§ç»­å¾€ä¸‹è·Ÿè¸ª return this.createProducerAsync(topic, conf, schema, interceptors); } private \u0026lt;T\u0026gt; CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; createProducerAsync(String topic, ProducerConfigurationData conf, Schema\u0026lt;T\u0026gt; schema, ProducerInterceptors interceptors) { .... //åŒç†ï¼Œæ ¸å¿ƒé€»è¾‘å°±è¿™ä¸€è¡Œ producer = this.newProducerImpl(topic, -1, conf, schema, interceptors, producerCreatedFuture); } protected \u0026lt;T\u0026gt; ProducerImpl\u0026lt;T\u0026gt; newProducerImpl(....) { return new ProducerImpl(this, topic, conf, producerCreatedFuture, partitionIndex, schema, interceptors); } public ProducerImpl(PulsarClientImpl client, String topic, ProducerConfigurationData conf, CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; producerCreatedFuture, int partitionIndex, Schema\u0026lt;T\u0026gt; schema, ProducerInterceptors interceptors) { //åªæœ‰è¿™é‡Œæœ‰ç”¨åˆ°ï¼Œç»§ç»­è·Ÿè¸ª super(client, topic, conf, producerCreatedFuture, schema, interceptors); .... } protected ProducerBase(PulsarClientImpl client, String topic, ProducerConfigurationData conf, CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; producerCreatedFuture, Schema\u0026lt;T\u0026gt; schema, ProducerInterceptors interceptors) { .... //å¯¹çˆ¶ç±»çš„æˆå‘˜å˜é‡è¿›è¡Œèµ‹å€¼ this.interceptors = interceptors; } é€šè¿‡ä¸Šé¢çš„ä»£ç è·Ÿè¸ªæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå½“æˆ‘ä»¬é€šè¿‡æ‹¦æˆªå™¨åˆ›å»ºçš„Producerå¯¹è±¡ï¼Œå®ƒæ˜¯æœ‰åœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªProducerInterceptorså¯¹è±¡æ¥å­˜å‚¨æˆ‘ä»¬æ‰€æŒ‡å®šçš„æ‹¦æˆªå™¨é›†åˆçš„é€»è¾‘\né‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹ProducerInterceptorsçš„å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 public class ProducerInterceptors implements Closeable { .... private final List\u0026lt;ProducerInterceptor\u0026gt; interceptors;\t//å­˜å‚¨æ‹¦æˆªå™¨é›†åˆé€»è¾‘ .... //åœ¨æ¶ˆæ¯å‘é€å‰è¿›è¡Œè§¦å‘ public Message beforeSend(Producer producer, Message message) { Message interceptorMessage = message; for (ProducerInterceptor interceptor : interceptors) { //è°ƒç”¨æ‹¦æˆªå™¨çš„eligibleæ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦è¦å¯¹å½“å‰è¿™æ¡æ¶ˆæ¯è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œè¿™ä¸ªå°±æ˜¯å’±ä»¬ä¸Šé¢å®ç°çš„eligibleæ¥å£ if (!interceptor.eligible(message)) { continue; } try { //å¾ªç¯è°ƒç”¨æ‹¦æˆªå™¨é›†åˆé‡Œçš„æ¯ä¸ªæ‹¦æˆªå™¨å¯¹è¿™æ¡æ¶ˆæ¯è¿›è¡Œå¤„ç† interceptorMessage = interceptor.beforeSend(producer, interceptorMessage); } catch (Throwable e) { .... } } return interceptorMessage; } //é€»è¾‘è·ŸbeforeSendåŸºæœ¬ä¸€è‡´ public void onSendAcknowledgement(Producer producer, Message message, MessageId msgId, Throwable exception) { for (ProducerInterceptor interceptor : interceptors) { if (!interceptor.eligible(message)) { continue; } try { interceptor.onSendAcknowledgement(producer, message, msgId, exception); } catch (Throwable e) { log.warn(\u0026#34;Error executing interceptor onSendAcknowledgement callback \u0026#34;, e); } } } public void onPartitionsChange(String topicName, int partitions) { for (ProducerInterceptor interceptor : interceptors) { try { interceptor.onPartitionsChange(topicName, partitions); } catch (Throwable e) { log.warn(\u0026#34;Error executing interceptor onPartitionsChange callback \u0026#34;, e); } } } @Override public void close() throws IOException { for (ProducerInterceptor interceptor : interceptors) { try { interceptor.close(); } catch (Throwable e) { log.error(\u0026#34;Fail to close producer interceptor \u0026#34;, e); } } } } é€šè¿‡ä¸Šè¿°é€»è¾‘å¯ä»¥çœ‹åˆ°ProducerInterceptorsæœ¬è´¨ä¸Šå°±æ˜¯ä¸ªæ‰¹é‡ç®¡ç†å¯¹è±¡ï¼Œç¬¦åˆé«˜å†…èšä½è€¦åˆçš„è®¾è®¡ï¼Œè§£è€¦äº†ä¸šåŠ¡é€»è¾‘å¾ªç¯å¤„ç†çš„é€»è¾‘ï¼Œå°†è¿™äº›å¾ªç¯å¤„ç†çš„é€»è¾‘éƒ½å°è£…åœ¨ProducerInterceptorsç±»é‡Œé¢ï¼Œç„¶åProducerInterceptorsä»…å¯¹å¤–æä¾›è§¦å‘æŸå‡ ä¸ªåŠ¨ä½œçš„apiï¼Œä¸šåŠ¡åªéœ€è¦åœ¨å“ªä¸ªé˜¶æ®µè°ƒç”¨è¿™äº›apiå³å¯ã€‚\nç”Ÿæ•ˆæµç¨‹ åœ¨ç”Ÿäº§è€…æ¶ˆæ¯å‘é€é˜¶æ®µï¼Œæœ€ç»ˆéƒ½ä¼šèµ°åˆ°ProducerImplç±»çš„internalSendAsyncæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œä¼šè°ƒç”¨æ‹¦æˆªå™¨è¿›è¡Œå¤„ç†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 CompletableFuture\u0026lt;MessageId\u0026gt; internalSendAsync(Message\u0026lt;?\u0026gt; message) { //æ ¸å¿ƒæ–¹æ³•ï¼Œè·Ÿè¸ªè¿›å» MessageImpl\u0026lt;?\u0026gt; interceptorMessage = (MessageImpl) beforeSend(message); .... } protected Message\u0026lt;?\u0026gt; beforeSend(Message\u0026lt;?\u0026gt; message) { if (interceptors != null) { //å¦‚æœé…ç½®äº†æ‹¦æˆªå™¨åˆ™è°ƒç”¨ProducerInterceptorsç±»çš„beforeSendæ–¹æ³• return interceptors.beforeSend(this, message); } else { //å¦‚æœæ²¡æœ‰é…ç½®æ‹¦æˆªå™¨åˆ™ç›´æ¥è¿”å›åŸæ¶ˆæ¯ return message; } } è¿™æ˜¯æ¶ˆæ¯å‘é€çš„å¤„ç†é€»è¾‘ï¼Œé‚£å¦‚æœæ˜¯å†æ¶ˆæ¯å‘é€ç»“æŸåè§¦å‘å‘¢ï¼Ÿä¸€èµ·æ¥è·Ÿè¸ªçœ‹ä¸‹å§ï¼Œé¦–å…ˆè¿˜æ˜¯ä»ProducerImpç±»çš„internalSendAsyncæ–¹æ³•å¼€å§‹çœ‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 @Override CompletableFuture\u0026lt;MessageId\u0026gt; internalSendAsync(Message\u0026lt;?\u0026gt; message) { sendAsync(interceptorMessage, new SendCallback() { .... @Override public void sendComplete(Exception e) { try { if (e != null) { stats.incrementSendFailed(); //ä»è¿™é‡Œè·Ÿè¸ªè¿›å»çœ‹çœ‹ onSendAcknowledgement(interceptorMessage, null, e); future.completeExceptionally(e); } else { onSendAcknowledgement(interceptorMessage, interceptorMessage.getMessageId(), null); future.complete(interceptorMessage.getMessageId()); stats.incrementNumAcksReceived(System.nanoTime() - createdAt); } } finally { interceptorMessage.getDataBuffer().release(); } } protected void onSendAcknowledgement(Message\u0026lt;?\u0026gt; message, MessageId msgId, Throwable exception) { if (interceptors != null) { //å¯ä»¥çœ‹åˆ°æœ€ç»ˆä¹Ÿæ˜¯è°ƒç”¨çš„ProducerInterceptorsç±»çš„onSendAcknowledgementæ–¹æ³• interceptors.onSendAcknowledgement(this, message, msgId, exception); } } è¿™é‡Œçš„è®¾è®¡æ˜¯å¼‚æ­¥å›è°ƒçš„æ–¹å¼ï¼Œå°†è°ƒç”¨æ‹¦æˆªå™¨å¤„ç†é€»è¾‘å°è£…æˆå‚æ•°ä¼ ç»™ä¸‹ä¸€å±‚ï¼Œåœ¨æ¶ˆæ¯å‘é€å®Œæˆåå†è°ƒç”¨å‚æ•°é‡ŒæŒ‡å®šçš„å›è°ƒé€»è¾‘ã€‚é‚£ä¹ˆä»€ä¹ˆæ—¶å€™è§¦å‘å‘¢ï¼Œç”±äºPulsarå®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯æ˜¯é€šè¿‡Nettyçš„TCPé€šä¿¡çš„ï¼Œå› æ­¤ç›´æ¥çœ‹çœ‹PulsarDecoderçš„channelReadæ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { .... switch (cmd.getType()) { .... case PRODUCER_SUCCESS: //å†™å…¥æ¶ˆæ¯è¢«Brokerå¤„ç†åä¼šå¿˜ç”Ÿäº§è€…å®¢æˆ·ç«¯é€šè¿‡TCPå‘é€ä¸€æ¡PRODUCER_SUCCESSç±»å‹çš„æ¶ˆæ¯ä¹Ÿå°±æ˜¯è¿™é‡Œï¼Œè·Ÿè¸ªè¿›å»çœ‹çœ‹å¤„ç†é€»è¾‘ checkArgument(cmd.hasProducerSuccess()); handleProducerSuccess(cmd.getProducerSuccess()); break; } } protected void handleProducerSuccess(CommandProducerSuccess success) { .... //ç”Ÿäº§è€…ä¼šåœ¨é˜Ÿåˆ—ç»´æŠ¤æ¯æ¡æœªè¢«ackçš„å†™å…¥è¯·æ±‚æ¶ˆæ¯ï¼Œåœ¨Broker ackæ—¶ä¼šä»è¿™ä¸ªé˜Ÿåˆ—ä¸­ç§»é™¤å¹¶è·å–å›è°ƒå¤„ç†é€»è¾‘ CompletableFuture\u0026lt;ProducerResponse\u0026gt; requestFuture = (CompletableFuture\u0026lt;ProducerResponse\u0026gt;) pendingRequests.remove(requestId); if (requestFuture != null) { ProducerResponse pr = new ProducerResponse(success.getProducerName(), success.getLastSequenceId(), success.getSchemaVersion(), success.hasTopicEpoch() ? Optional.of(success.getTopicEpoch()) : Optional.empty()); //è°ƒç”¨å›è°ƒé€»è¾‘ requestFuture.complete(pr); } else { .... } } æ€»ç»“ é€šè¿‡ä½¿ç”¨å’Œè·Ÿè¸ªåŸç†ï¼Œæˆ‘ä»¬å¯¹Pulsarç”Ÿäº§è€…æ‹¦æˆªå™¨æœ‰äº†è¿›ä¸€æ­¥çš„è®¤è¯†ï¼Œé™¤äº†ç”Ÿäº§è€…æ‹¦æˆªå™¨ï¼ŒPulsarè¿˜æ”¯æŒBrokerä¾§ä»¥åŠBookkeeperä¾§çš„æ‹¦æˆªå™¨ï¼Œè¿™äº›æ”¾åˆ°åé¢å†è·Ÿå¤§å®¶ä¸€èµ·å­¦ä¹ ã€‚\n","date":"2024-04-19T11:54:03+08:00","image":"https://sherlock-lin.github.io/p/%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%B4%A2%E7%94%9F%E4%BA%A7%E8%80%85%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E6%BA%90%E7%A0%81%E8%AE%BE%E8%AE%A1/image-20240419110502648_hu11315331606035570821.png","permalink":"https://sherlock-lin.github.io/p/%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%B4%A2%E7%94%9F%E4%BA%A7%E8%80%85%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E6%BA%90%E7%A0%81%E8%AE%BE%E8%AE%A1/","title":"æ·±å…¥æ¢ç´¢ç”Ÿäº§è€…æ‹¦æˆªå™¨çš„ä½¿ç”¨ä»¥åŠæºç è®¾è®¡"},{"content":"æ­£æ–‡ Namespaceä¸‹çš„Topicæ˜¯åˆ†Bundleè¿›è¡Œç®¡ç†çš„ï¼Œæ¯ä¸ªNamespaceéƒ½æ˜¯ä¸€ä¸ªå“ˆå¸Œç¯ï¼Œè€ŒBundleè´Ÿè´£ç®¡ç†ç¯ä¸ŠæŸä¸ªèŒƒå›´ä¸Šçš„Topicã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥æ›´å¥½çš„è¿›è¡ŒTopicçš„ç®¡ç†ã€‚å½“æŸä¸ªBundleä¸Šè´Ÿè´£çš„Topicè¶Šæ¥è¶Šå¤šæ—¶ï¼Œä¼šå¯¼è‡´è´Ÿè´£è¯¥Bundleçš„BrokerèŠ‚ç‚¹å‹åŠ›å˜å¤§ã€‚å› æ­¤Pulsarè¿˜æä¾›äº†Bundleåˆ†è£‚çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶æ”¯æŒè‡ªåŠ¨è§¦å‘ä»¥åŠæ‰‹åŠ¨è§¦å‘ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« å°±ä»æºç çš„è§’åº¦åˆ†ææ‰‹åŠ¨è§¦å‘Bundleåˆ†è£‚æ—¶æœåŠ¡ç«¯ä¼šå‘ç”Ÿä»€ä¹ˆ\nä¸»åŠ¨è§¦å‘Bundleåˆ†è£‚æ“ä½œæ–¹å¼\n1 2 3 4 5 6 7 8 9 10 bin/pulsar-admin namespaces bundles public/default //è¾“å‡ºå¦‚ä¸‹ { \u0026#34;boundaries\u0026#34; : [ \u0026#34;0x00000000\u0026#34;, \u0026#34;0x08000000\u0026#34;, \u0026#34;0x10000000\u0026#34;, \u0026#34;0x20000000\u0026#34;, \u0026#34;0x30000000\u0026#34;, \u0026#34;0x40000000\u0026#34;, \u0026#34;0x50000000\u0026#34;, \u0026#34;0x60000000\u0026#34;, \u0026#34;0x70000000\u0026#34;, \u0026#34;0x80000000\u0026#34;, \u0026#34;0x90000000\u0026#34;, \u0026#34;0xa0000000\u0026#34;, \u0026#34;0xb0000000\u0026#34;, \u0026#34;0xc0000000\u0026#34;, \u0026#34;0xd0000000\u0026#34;, \u0026#34;0xe0000000\u0026#34;, \u0026#34;0xf0000000\u0026#34;, \u0026#34;0xffffffff\u0026#34; ], \u0026#34;numBundles\u0026#34; : 17 } //æŒ‡å®šæŸä¸ªbundleè¿›è¡Œåˆ†è£‚ bin/pulsar-admin namespaces split-bundle --bundle 0x00000000_0x10000000 public/default æºç è§£æ Pulsarç®¡ç†æµç›¸å…³çš„æ“ä½œéƒ½æ˜¯é€šè¿‡HTTPçš„æ–¹å¼ï¼Œå› ä¸ºéœ€è¦æ”¯æŒå¤šç§å®¢æˆ·ç«¯ç±»å‹(httpã€clientã€cli)ã€‚æœåŠ¡ç«¯å¤„ç†è¿™äº›æ“ä½œéƒ½åœ¨adminæ¨¡å—ä¸‹ï¼Œå¦‚ä¸‹å›¾ï¼Œæœ¬æ¬¡è¦èŠçš„bundleåˆ†è£‚å°±åœ¨Namespacesæ–¹æ³•ä¸­\né¦–å…ˆä»Namespacesçš„splitNamespaceBundleè¿›è¡Œè·Ÿè¸ª\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public void splitNamespaceBundle( .... @QueryParam(\u0026#34;splitAlgorithmName\u0026#34;) String splitAlgorithmName, //æŒ‡å®šbundleåˆ†è£‚ç®—æ³• @ApiParam(\u0026#34;splitBoundaries\u0026#34;) List\u0026lt;Long\u0026gt; splitBoundaries) { //æ ¡éªŒå‚æ•°æ ¼å¼ä»¥åŠæ˜¯å¦å­˜åœ¨å¯¹åº”çš„namespace validateNamespaceName(tenant, namespace); //å¼‚æ­¥è¿›è¡Œåˆ†è£‚æ“ä½œ internalSplitNamespaceBundleAsync(bundleRange, authoritative, unload, splitAlgorithmName, splitBoundaries) .thenAccept(__ -\u0026gt; { .... }) .exceptionally(ex -\u0026gt; { .... }); } å¯ä»¥çœ‹åˆ°æœ€å¤–å±‚åªæ˜¯åšäº›å‚æ•°æ ¡éªŒï¼Œé‚£ä¹ˆå°±ç»§ç»­è·Ÿè¸ªinternalSplitNamespaceBundleAsyncæ–¹æ³•ï¼Œå¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 protected CompletableFuture\u0026lt;Void\u0026gt; internalSplitNamespaceBundleAsync(String bundleName, boolean authoritative, boolean unload, String splitAlgorithmName, List\u0026lt;Long\u0026gt; splitBoundaries) { return validateSuperUserAccessAsync() //æƒé™æ ¡éªŒ .thenAccept(__ -\u0026gt; { checkNotNull(bundleName, \u0026#34;BundleRange should not be null\u0026#34;); log.info(\u0026#34;[{}] Split namespace bundle {}/{}\u0026#34;, clientAppId(), namespaceName, bundleName); //è·å–å½“å‰é›†ç¾¤æ‰€æ”¯æŒçš„bundleåˆ†è£‚ç®—æ³•ï¼Œè¿™é‡Œæ˜¯ç¡¬ç¼–ç çš„å›ºå®šå››ç§ List\u0026lt;String\u0026gt; supportedNamespaceBundleSplitAlgorithms = pulsar().getConfig().getSupportedNamespaceBundleSplitAlgorithms(); //æ­¤å¤„çœå»å‚æ•°æ£€æŸ¥é€»è¾‘ .... } }) .thenCompose(__ -\u0026gt; { //æ­¤å¤„çœå»å‚æ•°æ£€æŸ¥é€»è¾‘ .... }) .thenCompose(__ -\u0026gt; validatePoliciesReadOnlyAccessAsync()) //æƒé™æ ¡éªŒ .thenCompose(__ -\u0026gt; getBundleRangeAsync(bundleName)) //è·å–è¦åˆ†è£‚çš„bundleçš„èŒƒå›´ .thenCompose(bundleRange -\u0026gt; { return getNamespacePoliciesAsync(namespaceName) .thenCompose(policies -\u0026gt; //1. æ ¡éªŒBundleçš„èŒƒå›´æ˜¯å¦æœ‰æ•ˆ //2.åˆ¤æ–­å½“å‰BrokerèŠ‚ç‚¹æ˜¯å¦è´Ÿè´£è¿™ä¸ªbundleçš„ç®¡ç†ï¼Œå¦‚æœä¸æ˜¯åˆ™é‡å®šå‘ validateNamespaceBundleOwnershipAsync(namespaceName, policies.bundles, bundleRange,authoritative, false)) //æ ¸å¿ƒæ–¹æ³•å°±æ˜¯è¿™é‡Œçš„ NamespaceService.splitAndOwnBundle .thenCompose(nsBundle -\u0026gt; pulsar().getNamespaceService().splitAndOwnBundle(nsBundle, unload, pulsar().getNamespaceService() .getNamespaceBundleSplitAlgorithmByName(splitAlgorithmName), splitBoundaries)); }); } æ¥ä¸‹æ¥å°±æ˜¯è¿›å…¥NamespaceServiceç±»çš„splitAndOwnBundleæ–¹æ³•ï¼ŒNamespaceServiceä¹Ÿæ˜¯Pulsaræ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªç±»ï¼Œè¿™é‡Œå…ˆç»§ç»­è·Ÿè¸ªåˆ†å‰²bundleçš„é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 public CompletableFuture\u0026lt;Void\u0026gt; splitAndOwnBundle(NamespaceBundle bundle, boolean unload, NamespaceBundleSplitAlgorithm splitAlgorithm, List\u0026lt;Long\u0026gt; boundaries) { //å¦‚æœå®ç°äº†è‡ªå®šä¹‰çš„åˆ†å‰²é€»è¾‘åˆ™ä½¿ç”¨è‡ªå®šä¹‰çš„ if (ExtensibleLoadManagerImpl.isLoadManagerExtensionEnabled(config)) { return ExtensibleLoadManagerImpl.get(loadManager.get()) .splitNamespaceBundleAsync(bundle, splitAlgorithm, boundaries); } final CompletableFuture\u0026lt;Void\u0026gt; unloadFuture = new CompletableFuture\u0026lt;\u0026gt;(); final AtomicInteger counter = new AtomicInteger(BUNDLE_SPLIT_RETRY_LIMIT); //æ ¸å¿ƒæµç¨‹æµç¨‹ splitAndOwnBundleOnceAndRetry(bundle, unload, counter, unloadFuture, splitAlgorithm, boundaries); return unloadFuture; } void splitAndOwnBundleOnceAndRetry(NamespaceBundle bundle, boolean unload, AtomicInteger counter, CompletableFuture\u0026lt;Void\u0026gt; completionFuture, NamespaceBundleSplitAlgorithm splitAlgorithm, List\u0026lt;Long\u0026gt; boundaries) { //è·å–bundleåˆ†å‰²é…ç½® BundleSplitOption bundleSplitOption = getBundleSplitOption(bundle, boundaries, config); //æ ¹æ®é…ç½®æ¥é€‰æ‹©å¯¹åº”çš„åˆ†å‰²ç®—æ³•è¿›è¡Œåˆ†å‰² splitAlgorithm.getSplitBoundary(bundleSplitOption).whenComplete((splitBoundaries, ex) -\u0026gt; { CompletableFuture\u0026lt;List\u0026lt;NamespaceBundle\u0026gt;\u0026gt; updateFuture = new CompletableFuture\u0026lt;\u0026gt;(); if (ex == null) { .... try { //è¿›è¡Œbundleåˆ†å‰²æ“ä½œ bundleFactory.splitBundles(bundle, splitBoundaries.size() + 1, splitBoundaries) .thenAccept(splitBundles -\u0026gt; { .... Objects.requireNonNull(splitBundles.getLeft()); Objects.requireNonNull(splitBundles.getRight()); checkArgument(splitBundles.getRight().size() == splitBoundaries.size() + 1, \u0026#34;bundle has to be split in \u0026#34; + (splitBoundaries.size() + 1) + \u0026#34; bundles\u0026#34;); NamespaceName nsname = bundle.getNamespaceObject(); .... try { // æ£€æŸ¥ç¡®ä¿æ¯ä¸ªBundleéƒ½æœ‰å¯¹åº”çš„Brokerè´Ÿè´£ for (NamespaceBundle sBundle : splitBundles.getRight()) { Objects.requireNonNull(ownershipCache.tryAcquiringOwnership(sBundle)); } //æ›´æ–°Bundleä¿¡æ¯ï¼Œæ¯•ç«ŸBundleå·²ç»åˆ†è£‚å¥½äº†ï¼Œç›¸å…³çš„ä¸€äº›å…ƒæ•°æ®è¦åŒæ­¥æ›´æ–° updateNamespaceBundles(nsname, splitBundles.getLeft()).thenCompose(__ -\u0026gt; updateNamespaceBundlesForPolicies(nsname, splitBundles.getLeft())) .thenRun(() -\u0026gt; { bundleFactory.invalidateBundleCache(bundle.getNamespaceObject()); updateFuture.complete(splitBundles.getRight()); }).exceptionally(ex1 -\u0026gt; { .... }); } catch (Exception e) { .... } }); } catch (Exception e) { .... } } else { updateFuture.completeExceptionally(ex); } updateFuture.whenCompleteAsync((r, t)-\u0026gt; { if (t != null) { // å¤±è´¥åˆ™é‡è¯•å‡ æ¬¡ if ((t.getCause() instanceof MetadataStoreException.BadVersionException) \u0026amp;\u0026amp; (counter.decrementAndGet() \u0026gt;= 0)) { pulsar.getExecutor().schedule(() -\u0026gt; pulsar.getOrderedExecutor() .execute(() -\u0026gt; splitAndOwnBundleOnceAndRetry( bundle, unload, counter, completionFuture, splitAlgorithm, boundaries)), 100, MILLISECONDS); } else if (t instanceof IllegalArgumentException) { completionFuture.completeExceptionally(t); } else { // Retry enough, or meet other exception String msg2 = format(\u0026#34; %s not success update nsBundles, counter %d, reason %s\u0026#34;, bundle.toString(), counter.get(), t.getMessage()); LOG.warn(msg2); completionFuture.completeExceptionally(new ServiceUnitNotReadyException(msg2)); } return; } //æ›´æ–°bundleçš„çŠ¶æ€ getOwnershipCache().updateBundleState(bundle, false) .thenRun(() -\u0026gt; { // update bundled_topic cache for load-report-generation pulsar.getBrokerService().refreshTopicToStatsMaps(bundle); loadManager.get().setLoadReportForceUpdateFlag(); // release old bundle from ownership cache pulsar.getNamespaceService().getOwnershipCache().removeOwnership(bundle); completionFuture.complete(null); if (unload) { // Unload new split bundles, in background. This will not // affect the split operation which is already safely completed r.forEach(this::unloadNamespaceBundle); } onNamespaceBundleSplit(bundle); }) .exceptionally(e -\u0026gt; { .... }); }, pulsar.getOrderedExecutor()); }); } ä¸Šé¢è¿™ä¸ªæ–¹æ³•çš„é€»è¾‘æ¯”è¾ƒä¸°å¯Œï¼Œä½†æ ¸å¿ƒçš„åˆ†å‰²æµç¨‹å®é™…ä¸Šæ˜¯è°ƒç”¨çš„NamespaceBundleFactoryçš„splitBundlesè¿›è¡Œçš„ï¼Œè¿™é‡Œå°±ç»§ç»­è·Ÿè¸ªNamespaceBundleFactoryçš„é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 public CompletableFuture\u0026lt;Pair\u0026lt;NamespaceBundles, List\u0026lt;NamespaceBundle\u0026gt;\u0026gt;\u0026gt; splitBundles( NamespaceBundle targetBundle, int argNumBundles, List\u0026lt;Long\u0026gt; splitBoundaries) { //åˆ¤æ–­å½“å‰bundleæ˜¯å¦æ”¯æŒåˆ†è£‚ checkArgument(canSplitBundle(targetBundle), \u0026#34;%s bundle can\u0026#39;t be split further since range not larger than 1\u0026#34;, targetBundle); .... NamespaceName nsname = targetBundle.getNamespaceObject(); final int numBundles = argNumBundles; return bundlesCache.get(nsname).thenApply(sourceBundle -\u0026gt; { final int lastIndex = sourceBundle.partitions.length - 1; //é‡æ–°åˆ›å»ºæ•°ç»„ä¿å­˜å“ˆå¸Œç¯çš„èŠ‚ç‚¹ï¼Œå› ä¸ºbundleåˆ†è£‚åç¯ä¸Šçš„èŠ‚ç‚¹ä¼šå¢å¤š final long[] partitions = new long[sourceBundle.partitions.length + (numBundles - 1)]; int pos = 0; int splitPartition = -1; final Range\u0026lt;Long\u0026gt; range = targetBundle.getKeyRange(); for (int i = 0; i \u0026lt; lastIndex; i++) { //éå†å½“å‰Namespaceçš„æ‰€æœ‰Bundleæ¥æ‰¾åˆ°éœ€è¦è¿›è¡Œåˆ†è£‚çš„ç›®æ ‡Bundle if (sourceBundle.partitions[i] == range.lowerEndpoint() \u0026amp;\u0026amp; (range.upperEndpoint() == sourceBundle.partitions[i + 1])) { splitPartition = i; long minVal = sourceBundle.partitions[i]; partitions[pos++] = minVal; if (splitBoundaries == null || splitBoundaries.size() == 0) { long maxVal = sourceBundle.partitions[i + 1]; //numBundleså°±æ˜¯è¦åˆ†å‰²æˆçš„ä»½æ•°ï¼Œè¿™é‡Œç›¸å½“äºå°†åŸå…ˆBundleè´Ÿè´£çš„èŒƒå›´å¹³å‡åˆ†ç»™å¤šä¸ªæ–°çš„Bundle long segSize = (maxVal - minVal) / numBundles; long curPartition = minVal + segSize; for (int j = 0; j \u0026lt; numBundles - 1; j++) { partitions[pos++] = curPartition; curPartition += segSize; } } else { for (long splitBoundary : splitBoundaries) { partitions[pos++] = splitBoundary; } } } else { partitions[pos++] = sourceBundle.partitions[i]; } } partitions[pos] = sourceBundle.partitions[lastIndex]; if (splitPartition != -1) { // keep version of sourceBundle //æ ¹æ®ä¸Šé¢æ—§çš„BundleèŒƒå›´åˆ’åˆ†æ¥åˆ†è£‚å‡ºå¤šä¸ªæ–°çš„bundle NamespaceBundles splitNsBundles = new NamespaceBundles(nsname, this, sourceBundle.getLocalPolicies(), partitions); List\u0026lt;NamespaceBundle\u0026gt; splitBundles = splitNsBundles.getBundles().subList(splitPartition, (splitPartition + numBundles)); return new ImmutablePair\u0026lt;\u0026gt;(splitNsBundles, splitBundles); } return null; }); } åˆ°è¿™é‡ŒåŸºæœ¬å°±ç»“æŸï¼Œè¿™æ¡é“¾è·¯ä¸»è¦æ˜¯Brokerå°†åŸå…ˆçš„å“ˆå¸Œç¯ä¸­çš„æŸä¸€ä¸ªèŒƒå›´æ‹†åˆ†æˆå¤šä¸ªèŒƒå›´çš„é€»è¾‘ï¼Œè¿™é‡Œä¿ç•™å‡ ä¸ªé—®é¢˜ç»™è¯»è€…æ€è€ƒ\nBundleåˆ†è£‚åæ˜¯å¦ä¼šæ¶‰åŠåˆ°æ•°æ®çš„è¿ç§»ï¼Ÿ Bundleåˆ†è£‚ç®—æ³•æœ‰å››ç§ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ å‚è€ƒæ–‡çŒ® å®˜æ–¹æ–‡æ¡£ ","date":"2024-04-16T10:34:57+08:00","image":"https://sherlock-lin.github.io/p/%E4%B8%BB%E5%8A%A8%E8%A7%A6%E5%8F%91bundle%E5%88%86%E8%A3%82%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/image-20240416181912380_hu8808141309202124509.png","permalink":"https://sherlock-lin.github.io/p/%E4%B8%BB%E5%8A%A8%E8%A7%A6%E5%8F%91bundle%E5%88%86%E8%A3%82%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/","title":"ä¸»åŠ¨è§¦å‘Bundleåˆ†è£‚æœåŠ¡ç«¯æµç¨‹æºç è§£æ"},{"content":"å¼•è¨€ æ‰¿æ¥ æ‰‹å†™åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿv0.2ç‰ˆæœ¬ ï¼Œä»Šå¤©å¼€å§‹æ–°çš„è¿­ä»£å¼€å‘ã€‚ä¸»è¦å®ç° æœåŠ¡å‘ç° åŠŸèƒ½\nä»€ä¹ˆæ˜¯æœåŠ¡å‘ç° ç”±äºå’±ä»¬çš„æœåŠ¡æ˜¯åˆ†å¸ƒå¼çš„ï¼Œé‚£ä»æœåŠ¡ç®¡ç†çš„è§’åº¦æ¥çœ‹è‚¯å®šæ˜¯è¦æœ‰ä¸€ä¸ªæœºåˆ¶æ¥çŸ¥é“å…·ä½“éƒ½æœ‰å“ªäº›å®ä¾‹å¯ä»¥æä¾›æœåŠ¡ã€‚ä¸¾ä¸ªä¾‹å­å°±æ˜¯ï¼Œå¼ ä¸‰å®¶é‡Œåœ¨å…¨å›½å„åœ°æœ‰ä¸å°‘ç«é”…åŠ ç›Ÿåº—ï¼Œé‚£å¼ ä¸‰è‚¯å®šè¦æœ‰ä¸€ä¸ªæ–¹å¼çŸ¥é“è¿™äº›ç«é”…åº—åŠ ç›Ÿåº—çš„æƒ…å†µã€‚ä¾‹å¦‚ä¸Šæµ·åˆæ–°å¼€äº†ä¸€å®¶åŠ ç›Ÿåº—ï¼Œé‚£ä¹ˆè¿™å®¶åŠ ç›Ÿåº—è‚¯å®šè¦å…ˆé€šè¿‡æŸç§æ–¹å¼è”ç³»å¼ ä¸‰ï¼Œè¿™æ ·å¼ ä¸‰æ‰èƒ½å°†é…æ–¹ä»¥åŠé£Ÿæä¾›åº”ç»™è¿™å®¶æ–°çš„åŠ ç›Ÿåº—ç­‰ç­‰ã€‚\nç–‘é—®\nä¸ºä»€ä¹ˆä¸èƒ½é€šè¿‡åŸŸåæ˜ å°„çš„æ–¹å¼æ¥åšæ˜ å°„ï¼Œå®¢æˆ·ç«¯é€šè¿‡åŸŸåè°ƒç”¨æœåŠ¡å°±å¥½äº†ä¸ºå•¥è¦ä¸“é—¨åšæœåŠ¡å‘ç°\nç­”ï¼šåŸŸåæ˜ å°„æ˜¯å¯¹å¤–æä¾›æœåŠ¡æ—¶ä½¿ç”¨çš„ï¼Œè€Œæˆ‘ä»¬çš„ç³»ç»Ÿè¿˜æœ‰å¾ˆå¤šåœºæ™¯è¦åšå†…éƒ¨çš„æœåŠ¡ç®¡ç†ï¼Œä¾‹å¦‚æŸä¸ªèŠ‚ç‚¹æ•…éšœäº†ï¼Œä¸ºäº†æœåŠ¡èƒ½å¤Ÿç»§ç»­ä¿è¯é«˜å¯ç”¨ï¼Œå’±ä»¬çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿå°±è¦å°†è¿™ä¸ªèŠ‚ç‚¹ä¸Šæ‰€ç®¡ç†çš„æ•°æ®åˆ†ç»™å…¶ä½™çš„èŠ‚ç‚¹è¿›è¡Œç®¡ç†ç­‰ï¼Œè¿™ä¸ªæ—¶å€™ç³»ç»Ÿå†…éƒ¨å°±éœ€è¦æ˜ç¡®çŸ¥é“å„ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚\næœåŠ¡å‘ç°è®¾è®¡ ç›®å‰æœåŠ¡å‘ç°è®¾è®¡ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§\né…ç½®åŒ–ï¼šå°†æ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯å†™åœ¨æœåŠ¡é…ç½®é‡Œï¼ŒåƒESç­‰ ä½¿ç”¨èƒ½ä¿è¯ä¸€è‡´æ€§çš„å¤–éƒ¨æœåŠ¡ï¼šå¦‚kafkaã€bookkeeperç­‰ï¼Œå¤–éƒ¨æœåŠ¡æœ‰zookeeperã€etcdã€consulç­‰ ä¸»ä»æ¶æ„é‡Œï¼Œæ‰€æœ‰ä»èŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨å‘ä¸»æœåŠ¡æ³¨å†Œè‡ªå·±çš„èŠ‚ç‚¹ä¿¡æ¯ï¼šå¦‚hdfsã€yarnç­‰ ä¸ºäº†æ–¹ä¾¿æ‰©å±•ï¼ŒåŒæ—¶å’±ä»¬çš„å­˜å‚¨æœåŠ¡èƒ½å¤Ÿè®¾è®¡æˆæ— ä¸»æ¶æ„ï¼Œå› æ­¤é‡‡ç”¨ç¬¬äºŒç§é‡‡ç”¨å¤–éƒ¨æœåŠ¡zookeeperæ¥è¿›è¡Œå®ç°ã€‚å®ç°çš„å¤§è‡´æµç¨‹å¦‚ä¸‹å›¾\næ‰€æœ‰èŠ‚ç‚¹å®ä¾‹åœ¨å¯åŠ¨æ—¶ï¼Œéƒ½å»zookeeperä¸Šåˆ›å»ºå±äºè‡ªå·±çš„ç›®å½•ï¼Œåœ¨èŠ‚ç‚¹ä¸‹çº¿æ—¶å°±å°†è‡ªå·±å¯¹åº”çš„ç›®å½•è¿›è¡Œåˆ é™¤ã€‚è¿™æ ·åªéœ€è¦ç›‘å¬â€œæœåŠ¡å‘ç°ç›®å½•â€å°±èƒ½çŸ¥é“æ˜¯å¦æœ‰èŠ‚ç‚¹ä¸Šä¸‹çº¿ã€‚åŒæ—¶ä¸ºäº†é¿å…æœåŠ¡æ•…éšœæ—¶æ²¡èƒ½æ­£ç¡®åˆ é™¤è‡ªå·±çš„ç›®å½•ï¼Œå› æ­¤å’±ä»¬é‡‡ç”¨zookeeperä¸´æ—¶ç›®å½•çš„åŠŸèƒ½ï¼Œä¾‹å¦‚èŠ‚ç‚¹1å¯åŠ¨å¹¶åœ¨zookeeperåˆ›å»ºå¯¹åº”ä¸´æ—¶ç›®å½•åï¼Œä¼šæ¯éš”ä¸€å°æ®µæ—¶é—´å‘zookeeperå‘é€è¯·æ±‚ä¹Ÿå°±æ˜¯å¿ƒè·³ï¼Œè¯æ˜è‡ªå·±çš„æœåŠ¡è¿˜æ­£å¸¸ï¼›å¦‚æœzookeeperåœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œæ²¡æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼Œå°±ä¼šé»˜è®¤è¿™ä¸ªæœåŠ¡å·²ç»æŒ‚äº†å¹¶å°†å…¶å¯¹åº”çš„ä¸´æ—¶ç›®å½•è¿›è¡Œåˆ é™¤ã€‚\nä»£ç å®ç° ç”±äºæŠŠå…¨éƒ¨ä»£ç è´´ä¸Šæ¥ä¸å¤ªç°å®ä¸”ä¸æ˜“äºé˜…è¯»ï¼Œå°±å°†å¼€å‘æ—¶æµ‹è¯•æ ·ä¾‹è´´ä¸Šæ¥ä¾›å¤§å®¶ä¼™å‚è€ƒ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 package com.sherlock; import org.apache.zookeeper.*; import org.apache.zookeeper.data.ACL; import org.apache.zookeeper.data.Stat; import java.io.File; import java.util.List; import java.util.concurrent.CountDownLatch; /** * author: shalock.lin * date: 2024/2/4 * describe: */ public class BaseZookeeper implements Watcher { private static ZooKeeper zookeeper; public static void main(String[] args) throws Exception { BaseZookeeper baseZookeeper = new BaseZookeeper(); baseZookeeper.connectZookeeper(\u0026#34;127.0.0.1:2181\u0026#34;); List\u0026lt;String\u0026gt; children = baseZookeeper.getChildren(\u0026#34;/\u0026#34;); System.out.println(children); AsyncCallback.StringCallback scb = new AsyncCallback.StringCallback() { @Override public void processResult(int rc, String path, Object ctx, String name) { System.out.println(rc); } }; asyncCreateFullPathOptimistic(zookeeper, \u0026#34;/distributed-storage-system/available/shalocklindeMacBook-Pro.local\u0026#34;, \u0026#34;testData\u0026#34;.getBytes() ,ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT,scb, null); Thread.sleep(5000); List\u0026lt;String\u0026gt; afterChildren = baseZookeeper.getChildren(\u0026#34;/\u0026#34;); System.out.println(afterChildren); } /** * è¶…æ—¶æ—¶é—´ */ private static final int SESSION_TIME_OUT = 2000; private CountDownLatch countDownLatch = new CountDownLatch(1); @Override public void process(WatchedEvent event) { if (event.getState() == Event.KeeperState.SyncConnected) { System.out.println(\u0026#34;Watch received event\u0026#34;); countDownLatch.countDown(); } } /**è¿æ¥zookeeper * @param host * @throws Exception */ public void connectZookeeper(String host) throws Exception{ zookeeper = new ZooKeeper(host, SESSION_TIME_OUT, this); countDownLatch.await(); System.out.println(\u0026#34;zookeeper connection success\u0026#34;); } /** * è·å–è·¯å¾„ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹ * @param path * @return * @throws KeeperException * @throws InterruptedException */ public List\u0026lt;String\u0026gt; getChildren(String path) throws KeeperException, InterruptedException{ List\u0026lt;String\u0026gt; children = zookeeper.getChildren(path, false); return children; } /** * è·å–èŠ‚ç‚¹ä¸Šé¢çš„æ•°æ® * @param path è·¯å¾„ * @return * @throws KeeperException * @throws InterruptedException */ public String getData(String path) throws KeeperException, InterruptedException{ byte[] data = zookeeper.getData(path, false, null); if (data == null) { return \u0026#34;\u0026#34;; } return new String(data); } /** * è®¾ç½®èŠ‚ç‚¹ä¿¡æ¯ * @param path è·¯å¾„ * @param data æ•°æ® * @return * @throws KeeperException * @throws InterruptedException */ public Stat setData(String path, String data) throws KeeperException, InterruptedException{ Stat stat = zookeeper.setData(path, data.getBytes(), -1); return stat; } /** * åˆ é™¤èŠ‚ç‚¹ * @param path * @throws InterruptedException * @throws KeeperException */ public void deleteNode(String path) throws InterruptedException, KeeperException{ zookeeper.delete(path, -1); } /** * è·å–æŸä¸ªè·¯å¾„ä¸‹å­©å­çš„æ•°é‡ * @param path * @return * @throws KeeperException * @throws InterruptedException */ public Integer getChildrenNum(String path) throws KeeperException, InterruptedException{ int childenNum = zookeeper.getChildren(path, false).size(); return childenNum; } /** * å…³é—­è¿æ¥ * @throws InterruptedException */ public void closeConnection() throws InterruptedException{ if (zookeeper != null) { zookeeper.close(); } } public static void asyncCreateFullPathOptimistic( final ZooKeeper zk, final String originalPath, final byte[] data, final List\u0026lt;ACL\u0026gt; acl, final CreateMode createMode, final AsyncCallback.StringCallback callback, final Object ctx) { zk.create(originalPath, data, acl, createMode, new AsyncCallback.StringCallback() { @Override public void processResult(int rc, String path, Object ctx, String name) { if (rc != KeeperException.Code.NONODE.intValue()) { callback.processResult(rc, path, ctx, name); return; } // Since I got a nonode, it means that my parents don\u0026#39;t exist // create mode is persistent since ephemeral nodes can\u0026#39;t be // parents String parent = new File(originalPath).getParent().replace(\u0026#34;\\\\\u0026#34;, \u0026#34;/\u0026#34;); asyncCreateFullPathOptimistic(zk, parent, new byte[0], acl, CreateMode.PERSISTENT, new StringCallback() { @Override public void processResult(int rc, String path, Object ctx, String name) { if (rc == KeeperException.Code.OK.intValue() || rc == KeeperException.Code.NODEEXISTS.intValue()) { // succeeded in creating the parent, now // create the original path asyncCreateFullPathOptimistic(zk, originalPath, data, acl, createMode, callback, ctx); } else { callback.processResult(rc, path, ctx, name); } } }, ctx); } }, ctx); } } åŠŸèƒ½æ¼”ç¤º æ•´ä¸ªåŠŸèƒ½éªŒè¯é€»è¾‘å¦‚ä¸‹\næœåŠ¡å¯åŠ¨å‰è§‚æµ‹zookeeperå¯¹åº”ç›®å½•ä¸‹ä¸å­˜åœ¨æ•°æ®\nå¯åŠ¨æœåŠ¡ï¼Œä»æ§åˆ¶å°èƒ½çœ‹åˆ°æœåŠ¡æ­£å¸¸å¯åŠ¨\nå†è§‚æµ‹zookeeperå¯¹åº”ç›®å½•ä¸‹æ³¨å†Œäº†æœåŠ¡çš„ä¸»æœºå\né€šè¿‡æ‰“å°è¾“å‡ºï¼Œèƒ½çœ‹åˆ°å­˜åœ¨è¯¥ç›®å½•ä¸‹çš„æœåŠ¡ä¿¡æ¯(å½“å‰å­˜çš„æ˜¯æµ‹è¯•æ ·ä¾‹æ•°æ®)\nåœæ­¢æœåŠ¡ï¼Œå¹¶æŒç»­è§‚æµ‹ä¸€æ®µæ—¶é—´ï¼Œå¯ä»¥çœ‹åˆ°ç›®å½•å·²è¢«zookeeperåˆ é™¤\næ€»ç»“ ç»ˆäºå¼€å‘ä¸€ç‚¹è·Ÿâ€œåˆ†å¸ƒå¼â€ç›¸å…³çš„å†…å®¹äº†ï¼Œåœ¨ä½¿ç”¨zookeeperæ—¶è¸©äº†ä¸€ç‚¹å‘ï¼Œ å¯åŠ¨æœåŠ¡æ—¶æŠ¥ä¸‹è¿°å¼‚å¸¸org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired forï¼Œé€šè¿‡è°ƒè¯•å‘ç°zookeeperæœåŠ¡ç«¯è¿”å›çš„ä¿¡æ¯éå¸¸æœ‰é™æ— æ³•å¾—å‡ºæœ‰ç”¨çš„ä¿¡æ¯ã€‚ç»“æœç½‘ä¸Šçš„ç­”æ¡ˆï¼Œæ’é™¤äº†æ˜¯é˜²ç«å¢™ã€è¶…æ—¶é…ç½®ç­‰é—®é¢˜åï¼Œæœ€ç»ˆå‘ç°æ˜¯è‡ªå·±åœ¨è°ƒç”¨zookeeperåˆ›å»ºè·¯å¾„æ˜¯ç›´æ¥ä¼ äº†å®Œæ•´çš„è·¯å¾„ä¹Ÿå°±æ˜¯å¤šçº§ç›®å½• /distributed-storage-system/available/shalocklindeMacBook-Pro.localå¯¼è‡´çš„æŠ¥é”™ï¼ŒåŸå› æ˜¯zookeeperä¸æ”¯æŒé€’å½’åˆ›å»ºå¤šçº§ç›®å½•ï¼Œåªèƒ½å‚è€ƒbookkeeperå¼€å‘å·¥å…·ç±»ä»ä»£ç å±‚é¢é€’å½’å»zookeeperåˆ›å»ºè·¯å¾„ã€‚æƒ­æ„§çš„æ˜¯ï¼Œå·²ç»æ¥è§¦zookeeperå¤šå¹´ï¼Œå¹¶ä¸”ä¹Ÿç¿»è¿‡å®ƒçš„ä»£ç ï¼Œå´è¿è¿™ä¸ªåŸºæœ¬çš„ç‚¹éƒ½ä¸çŸ¥æ™“ã€‚å› æ­¤è¿›ä¸€æ­¥éªŒè¯ä¸Šä¸€ç¯‡çš„æƒ³æ³•ï¼Œå°±æ˜¯å¾ˆå¤šä¸œè¥¿çœŸçš„è¦è‡ªå·±å»å®ç°ä¸€éï¼Œå¦åˆ™åªæ²‰æµ¸ç†è®ºå®¹æ˜“é™·å…¥ä¸€ç§â€œä»€ä¹ˆéƒ½æ‡‚â€ã€â€œä»€ä¹ˆéƒ½æ˜¯ç†æ‰€å½“ç„¶â€çš„å¹»è§‰å¹¶è‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½ï¼Œä½†è¿™å¾ˆæœ‰å¯èƒ½ä¼šä»¤æˆ‘ä»¬çš„æŠ€æœ¯æ­¢æ­¥ä¸å‰\n","date":"2024-04-07T20:51:00+08:00","image":"https://sherlock-lin.github.io/p/%E6%89%8B%E5%86%99%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9Fv0.3%E7%89%88%E6%9C%AC/image-20240923205148052_hu7109961498001971171.png","permalink":"https://sherlock-lin.github.io/p/%E6%89%8B%E5%86%99%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9Fv0.3%E7%89%88%E6%9C%AC/","title":"æ‰‹å†™åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿv0.3ç‰ˆæœ¬"},{"content":"å¼•è¨€ ä¸Šå›è¯´åˆ° æ‰‹å†™åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿv0.1ç‰ˆæœ¬ ï¼Œå·²ç»å®ç°äº†é€šè¿‡ç›‘å¬TCPç«¯å£å¹¶å°†æ•°æ®å†™åˆ°æœ¬åœ°ç£ç›˜çš„åŠŸèƒ½ï¼Œä»Šå¤©å’±ä»¬å°±ç»§ç»­å¾€ä¸Šé¢æ·»ç –åŠ ç“¦\nv0.2ç‰ˆæœ¬å¤§è‡´åšä»¥ä¸‹åŠŸèƒ½\nå®ç°æ»šåŠ¨å†™æ–‡ä»¶\nä»£ç ä¼˜åŒ–\næ»šåŠ¨å†™æ–‡ä»¶å®ç° ç”±äºå’±ä»¬å†™æ–‡ä»¶æ˜¯ç”¨çš„mmapè¿›è¡Œæ–‡ä»¶å†™å…¥ï¼Œè€Œmmapè‡ªèº«åŸå› æœ€å¤šåªèƒ½æ˜ å°„åˆ°ä¸å¤§äº2Gçš„æ–‡ä»¶ã€‚å› æ­¤åœ¨ä¸€ä¸ªç£ç›˜æ–‡ä»¶å†™æ»¡åï¼Œå’±ä»¬éœ€è¦æ»šåŠ¨å†™åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿéƒ½æ˜¯è¿™ä¹ˆå®ç°çš„ï¼Œå¦‚kakfaã€pulsarã€rocketmqç­‰ç­‰ã€‚é‚£å’±ä»¬ä¹Ÿè‡ªå·±å°è¯•å®ç°ä¸‹ï¼Œå¤§è‡´é€»è¾‘å¦‚ä¸‹\nè¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰å‡ ä¸ªç‚¹éœ€è¦è€ƒè™‘\nå¦‚ä½•åˆ¤æ–­æ–‡ä»¶å†™æ»¡äº† æ»šåŠ¨å‰åæ–‡ä»¶åçš„å˜åŒ–è§„åˆ™ ç¬¬ä¸€ç‚¹å¯ä»¥è€ƒè™‘åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªæ•´å‹è®°å½•å½“å‰æ–‡ä»¶çš„å¤§å°ï¼Œå¦åˆ™æ¯æ¬¡å†™æ•°æ®æ—¶åˆ¤æ–­æ˜¯å¦å†™æ»¡éƒ½è¦å»æŸ¥ä¸‹linuxä¼šå½±å“æ€§èƒ½\nç¬¬äºŒç‚¹æ–‡ä»¶åå˜åŒ–è§„åˆ™çš„è®¾è®¡æ–¹å¼æœ‰è¾ƒå¤šä¸­ï¼Œä¾‹å¦‚æ¯æ¬¡å†™æ–°çš„æ–‡ä»¶åéƒ½ç”¨æœ€æ–°çš„ç­‰ã€‚å‚è€ƒå‡ ä¸ªç³»ç»Ÿçš„å®ç°åå†³å®šé‡‡ç”¨å†™æŒ‡å®šåå­—çš„æ–‡ä»¶ä¾‹å¦‚ â€œfileâ€ï¼Œå½“è¿™ä¸ªæ–‡ä»¶å†™æ»¡1ä¸ªGæ—¶ï¼Œå°†â€œfileâ€æ”¹åä¸ºâ€œfileâ€åŠ å½“å‰æ—¶é—´å¦‚â€œfile-20240202â€ï¼Œç„¶åå†æ–°å»ºä¸€ä¸ªåä¸ºâ€œfileâ€çš„æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚è¿™æ ·å°±èƒ½ä¿è¯â€œfileâ€è¿™ä¸ªæ–‡ä»¶æ°¸è¿œéƒ½æ˜¯å½“å‰æ­£åœ¨å†™å…¥çš„æ–‡ä»¶ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 private boolean rollingFile() throws IOException { preFilepath = fileName+\u0026#34;-\u0026#34;+LocalDateTime.now().toString().replace(\u0026#34;:\u0026#34;,\u0026#34;-\u0026#34;).substring(0,19); File preFile = new File(preFilepath); boolean preFileExists = preFile.exists(); if (!preFileExists) { this.fileChannel.force(false); boolean rename = file.renameTo(preFile); if (rename) { this.fileChannel = new RandomAccessFile(new File(fileName), \u0026#34;rw\u0026#34;) .getChannel(); this.mappedByteBuffer = this.fileChannel.map(FileChannel.MapMode.READ_WRITE, 0, fileSize); WROTE_POSITION_UPDATER.set(this, 0); return true; } else { LOG.error(\u0026#34;TieredIndexFile#rollingFile: rename current file failed\u0026#34;); return false; } } return false; } ä»£ç ä¼˜åŒ– ç”±äºv0.1ç‰ˆæœ¬ä¸­å®ç°çš„æ¯”è¾ƒè½ï¼Œå› æ­¤ç°åœ¨éœ€è¦è¿›è¡Œä¸€ä¸ªç®€å•çš„é‡æ„ã€‚é‡æ„åå¤§è‡´é€»è¾‘å¯ä»¥å‚è€ƒä¸‹é¢è¿™å¼ ä¸è§„èŒƒçš„UMLå›¾ï¼Œé¦–å…ˆæ˜¯æŠ½è±¡å‡ºä¸€ä¸ªLifecycleComponentæ¥å£ï¼Œç”±äºé™¤äº†ç½‘ç»œã€æŒä¹…åŒ–æœåŠ¡ä¹‹å¤–ï¼Œæœªæ¥å’±ä»¬å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–çš„æœåŠ¡ä¾‹å¦‚ç›‘æ§ã€æ’ä»¶æœåŠ¡ç­‰ç­‰ï¼Œå› æ­¤å’±ä»¬éœ€è¦å¯¹è¿™äº›æœåŠ¡åšä¸€å±‚ç»Ÿä¸€çš„æŠ½è±¡ï¼Œæ‰€æœ‰è¿™äº›æœåŠ¡éƒ½è¦æä¾›æœåŠ¡å¯åŠ¨å’ŒæœåŠ¡åœæ­¢çš„æ¥å£ï¼Œè¿™æ ·è®¾è®¡ä¹‹åå†æœåŠ¡å¯åŠ¨/åœæ­¢æ—¶åªéœ€è¦å¯¹LifecycleComponenté›†åˆåˆ—è¡¨è¿›è¡Œç»Ÿä¸€çš„å¯åŠ¨/åœæ­¢æ“ä½œå³å¯ï¼Œä»£ç ç»´æŠ¤èµ·æ¥ä¹Ÿå¾ˆèˆ’æœã€‚\nç½‘ç»œæ–¹é¢æ˜¯é€šè¿‡NetServiceImplæ–¹æ³•åˆå§‹åŒ–å¹¶å¯åŠ¨Nettyå¼•å¯¼ç±»ServerBootstrapï¼ŒServerBootstrapå¯åŠ¨åä¼šç›‘å¬Linuxæœºå™¨çš„ç½‘ç»œç«¯å£ï¼Œåœ¨ç›‘å¬åˆ°æœ‰è¯·æ±‚æ—¶ä¼šäº¤ç»™ServerHandler è¿›è¡Œå¤„ç†ï¼Œåœ¨ServerHandlerè¿™é‡Œå¯ä»¥è°ƒç”¨LocalDataStorageImplæ–¹æ³•è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼ŒLocalDataStorageImplæ˜¯æ•°æ®æŒä¹…åŒ–çš„ç»Ÿä¸€å…¥å£ï¼Œå’±ä»¬é’ˆå¯¹mmapå†™å…¥æ–¹å¼æŠ½è±¡å¹¶å®ç°äº†DefaultMappedFileï¼Œæä¾›äº†çœŸæ­£çš„mmapå†™ç£ç›˜æ“ä½œã€‚åŸºæœ¬å¤§è‡´é€»è¾‘å°±æ˜¯å¦‚æ­¤ï¼Œå°½é‡ä¸åšè¿‡åº¦çš„è®¾è®¡ï¼Œå¥½çš„ç³»ç»Ÿæ˜¯æ¼”å˜è¿‡æ¥çš„ï¼Œç­‰æœªæ¥å‘å±•åˆ°ä¸€å®šé˜¶æ®µåå†æ ¹æ®æƒ…å½¢è¿›è¡Œåˆ†æä¼˜åŒ–\nåŠŸèƒ½æ¼”ç¤º å¼€å‘å®Œåï¼Œå’±ä»¬å°±å¯ä»¥å¼€å§‹è¿›è¡Œæ¼”ç¤ºäº†ï¼Œå¯åŠ¨æœåŠ¡åå½“åœ¨æ§åˆ¶å°çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯å°±çŸ¥é“æœåŠ¡å·²ç»æ­£å¸¸å¯åŠ¨ï¼Œæ­¤æ—¶å°±å¯ä»¥å‘æ•°æ®ç»™æœåŠ¡ç«¯äº† é€šè¿‡æŒ‡ä»¤èƒ½çœ‹åˆ°å·²ç»åœ¨ç›®å½•ä¸‹åˆ›å»ºå¥½å¯¹åº”çš„æ–‡ä»¶ï¼Œç”±äºæ˜¯é€šè¿‡mmapæ–¹å¼å†™çš„æ•°æ®ï¼Œå› æ­¤è™½ç„¶å’±ä»¬è¿˜æ²¡å†™æ•°æ®åˆ°æ–‡ä»¶å†…ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤§å°å·²ç»æ˜¯100Byteäº†ï¼Œè¿™ä¹Ÿæ˜¯mmapçš„ç‰¹ç‚¹ é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤å¾€8888ç«¯å£å‘é€æ•°æ® 1 (echo \u0026#39;are you ok?\u0026#39;; sleep 2) | telnet 127.0.0.1 8888 é€šè¿‡æ§åˆ¶å°èƒ½å¤Ÿçœ‹åˆ°æ•°æ®æœ‰å†™åˆ°ç£ç›˜ï¼Œå¹¶ä¸”å†…å­˜ä¸­ç»´æŠ¤çš„æ–‡ä»¶é‡Œå­˜æ”¾æ•°æ®çš„å¤§å°ä¹Ÿåœ¨å¢åŠ  é‡å¤å¤šæ¬¡ç¬¬4æ­¥ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—æ˜¾ç¤ºå·²åˆ°è¾¾æ–‡ä»¶å¤§å°è§¦å‘æ–‡ä»¶æ»šåŠ¨åŠ¨ä½œ å†çœ‹çœ‹linuxæ–‡ä»¶ç³»ç»Ÿå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶ testWrite-2024-02-02T19-35-20 æ‰“å°ä¸€ä¸‹å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°å’±ä»¬åˆšåˆšè¯·æ±‚çš„å†…å®¹éƒ½è¢«æ­£ç¡®çš„æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­äº† æ€»ç»“ ä¸Šé¢åŸºæœ¬ä¸Šå°±æ˜¯ v0.2 ç‰ˆæœ¬çš„å†…å®¹äº†ï¼Œä¸éš¾ä½†æ˜¯ä½ ä¼šå‘ç°ä½¿ç”¨ä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€çœ‹å®ƒçš„æºç çš„ä½“éªŒï¼Œè·Ÿä½ è‡ªå·±å®ç°ä¸€éæ˜¯å®Œå…¨ä¸åŒçš„ï¼Œä¸€ä¸ªç°æˆçš„ç»„ä»¶å°±åƒæ˜¯ä¸€æ¶é£æœºï¼Œä½ çœ‹å¾—åˆ°å®ƒçš„æœºç¿¼ã€å‘åŠ¨æœºç­‰ç­‰ï¼Œä½ çŸ¥é“å®ƒæ˜¯è¿™æ ·è®¾è®¡çš„ï¼›ä½†ï¼Œå®ƒä¸ºä»€ä¹ˆæ˜¯è¿™æ ·è®¾è®¡çš„å‘¢ï¼Ÿé‚£æ ·ä¸å¯ä»¥å—ï¼Œè¿™ç±»é—®é¢˜ææ€•ä¼šæƒ³çš„æ¯”è¾ƒå°‘æˆ–è€…è™½ç„¶æƒ³äº†ä¸€ä¸‹ä½†æ˜¯è½¬å¤´å°±å¿˜äº†ã€‚ä½†æ˜¯å½“ä½ è‡ªå·±è®¾è®¡å»å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šé‡åˆ°ç§ç§é—®é¢˜éœ€è¦ä½ å»åå¤æ€è€ƒä»¥åŠåšå–èˆç­‰ç­‰ï¼Œè¿™äº›éƒ½æ˜¯ä½ çœŸæ­£æ„ä¹‰ä¸Šæˆé•¿çš„è¿‡ç¨‹ï¼Œç”šè‡³æœ‰æ—¶è¿˜ä¼šé¡¿æ‚Ÿä¸ºä»€ä¹ˆé‚£ä¸ªä¸œè¥¿äººå®¶è¦è¿™æ ·è®¾è®¡ï¼Œè¿™äº›éƒ½æ˜¯æ— æ¯”ä»¤äººæŒ¯å¥‹çš„äº‹æƒ…ï¼Œè¿™ä¸å°±æ˜¯ç”Ÿå‘½çš„æ„ä¹‰å—\n","date":"2024-04-07T20:49:15+08:00","image":"https://sherlock-lin.github.io/p/%E6%89%8B%E5%86%99%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9Fv0.2%E7%89%88%E6%9C%AC/image-20240202190044471-6871646_hu533876039371260404.png","permalink":"https://sherlock-lin.github.io/p/%E6%89%8B%E5%86%99%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9Fv0.2%E7%89%88%E6%9C%AC/","title":"æ‰‹å†™åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿv0.2ç‰ˆæœ¬"},{"content":"å¼•è¨€ è¿™æ˜¯æ‰‹å†™åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿv0.1ç‰ˆæœ¬ï¼Œåªæœ‰ä¸€ä¸ªç›®æ ‡å°±æ˜¯æ”¯æŒé€šè¿‡tcpæ¥æ”¶æ•°æ®å¹¶è½åœ°åˆ°ç£ç›˜æ–‡ä»¶(å•æœºæ¨¡å¼)ï¼Œé‚£æ¥ä¸‹æ¥å°±å¼€å§‹å§\nè®¾è®¡ å®ç°ä¸€ä¸ªç³»ç»Ÿï¼Œè®¾è®¡æ˜¯æœ€è¿‡ç˜¾çš„è¿‡ç¨‹æ²¡æœ‰ä¹‹ä¸€ï¼Œç±»ä¼¼ä½ æ­ç§¯æœ¨å‰åœ¨è„‘æµ·è®¾è®¡æ„å»ºä¸€å‰¯å¤§è‡´çš„â€œé›å½¢â€ï¼Œåªæœ‰æœ‰äº†è¿™ä¸ªä¸œè¥¿ä¹‹åæ‰èƒ½å¤ŸæŒ‡å¯¼æœ€ç»ˆå®ç°çš„æ–¹å‘ä»¥åŠç¡®ä¿ä¸ä¼šåç¦»çš„å¤ªå·®ã€‚è¿™é‡Œæˆ‘å¯¹v0.1çš„é¢„æœŸæ˜¯å¦‚ä¸‹çš„ï¼Œåªè¦å®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡tcpå°†æ•°æ®è¯·æ±‚åˆ°Linuxæœºå™¨çš„ç«¯å£ï¼Œå’±ä»¬çš„v0.1ç‰ˆæœ¬å°±èƒ½å¤Ÿç›‘å¬åˆ°å¹¶ä¸”å°†æ•°æ®è½åœ°åˆ°ç£ç›˜ï¼Œåªéœ€è¦å®ç°è¿™ä¸ªåŠŸèƒ½å°±å¯ä»¥äº†ã€‚\nä»£ç å®ç° è¿™ä¸ªåŠŸèƒ½ä¸­ä¼šè·Ÿç½‘ç»œå’Œå†™ç£ç›˜æ‰“äº¤é“ï¼Œé‚£ç›´æ¥ç”¨Nettyç°æˆçš„åŒ…å°±å¥½äº†ï¼Œè‡³äºå†™ç£ç›˜çš„è¯ç”¨JDKåŸç”Ÿè‡ªå¸¦çš„å°±å¤Ÿäº†ã€‚å¤§è‡´æŠ½è±¡å‡ºä¸¤ä¸ªå¯¹åº”çš„æ¥å£ä»¥åŠå®ç°ï¼Œå¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 public interface NetService { void start(); void stop(); } public class NetServiceImpl implements NetService{ private static final Logger LOG = LoggerFactory.getLogger(NetServiceImpl.class); private EventLoopGroup bossGroup = null; private EventLoopGroup workerGroup = null; public void start() { //bossGroupå°±æ˜¯parentGroupï¼Œæ˜¯è´Ÿè´£å¤„ç†TCP/IPè¿æ¥çš„ EventLoopGroup bossGroup = new NioEventLoopGroup(1); //workerGroupå°±æ˜¯childGroup,æ˜¯è´Ÿè´£å¤„ç†Channel(é€šé“) EventLoopGroup workerGroup = new NioEventLoopGroup(30); try { ServerBootstrap bootstrap = new ServerBootstrap() .group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) //åˆå§‹åŒ–æœåŠ¡ç«¯å¯è¿æ¥é˜Ÿåˆ—,æŒ‡å®šäº†é˜Ÿåˆ—çš„å¤§å°128 .option(ChannelOption.SO_BACKLOG, 128) //é€šè¿‡NoDelayç¦ç”¨Nagle,ä½¿æ¶ˆæ¯ç«‹å³å‘å‡ºå»ï¼Œä¸ç”¨ç­‰å¾…åˆ°ä¸€å®šçš„æ•°æ®é‡æ‰å‘å‡ºå» .option(ChannelOption.TCP_NODELAY, true) //ä¿æŒé•¿è¿æ¥ .childOption(ChannelOption.SO_KEEPALIVE, true) .handler(new LoggingHandler(LogLevel.INFO)) .childHandler(new ServerInitializer()); ChannelFuture future = bootstrap.bind(8888).sync(); future.channel().closeFuture().sync(); } catch (Exception e){ }finally { bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); } } public void stop() { bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); } } å†å†™ä¸‹æ•°æ®å­˜å‚¨ç›¸å…³çš„æ¥å£å’Œç±»å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 public interface DataStorage\u0026lt;T\u0026gt; { void save(T t) throws Exception; } public class LocalDataStorageImpl implements DataStorage\u0026lt;String\u0026gt;{ private static MappedByteBuffer mappedByteBuffer; private static Integer _1Gb = 1024*1024*1024; private static Integer _1MB = 1024*1024; public LocalDataStorageImpl() { try { FileChannel fileChannel = new RandomAccessFile(\u0026#34;./testWrite\u0026#34;, \u0026#34;rw\u0026#34;).getChannel(); mappedByteBuffer = fileChannel.map(FileChannel.MapMode.READ_WRITE, 0, _1MB); } catch (Exception e) { e.printStackTrace(); } } @Override public void save(String data) throws Exception{ System.out.println(\u0026#34;start writeDataToFile data is :\u0026#34;+data); mappedByteBuffer.put(data.getBytes()); System.out.println(\u0026#34;writeDataToFile end!\u0026#34;); } } å†å®ç°Nettyç›¸å…³çš„é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 @ChannelHandler.Sharable public class ServerHandler extends SimpleChannelInboundHandler\u0026lt;String\u0026gt; { private static final Logger LOG = LoggerFactory.getLogger(ServerHandler.class); private DataStorage dataStorage = new LocalDataStorageImpl(); @Override public void channelActive(ChannelHandlerContext channelHandlerContext) throws Exception { channelHandlerContext.write(\u0026#34;Welcome to sherlock home!\u0026#34;); channelHandlerContext.write(\u0026#34;It is \u0026#34;+ new Date()+\u0026#34;\\n\u0026#34;); channelHandlerContext.flush(); } @Override public void channelRead0(ChannelHandlerContext ctx, String request) throws Exception { LOG.info(\u0026#34;========readdata, request is {}=========\u0026#34;, request); //å¼‚æ­¥é€šè¿‡ä¸“é—¨çš„EventLoopçº¿ç¨‹æ± è¿›è¡Œå¤„ç† dataStorage.save(request); String response; boolean close = false; if (request.isEmpty()) { response = \u0026#34;Please type something.\\r\\n\u0026#34;; } else if (\u0026#34;bye\u0026#34;.equals(request.toLowerCase())) { response = \u0026#34;Have a good day!\\r\\n\u0026#34;; close = true; } else { response = \u0026#34;Did you say \u0026#39;\u0026#34; + request + \u0026#34;\u0026#39;?\\r\\n\u0026#34;; } ChannelFuture future = ctx.write(response); if (close) { future.addListener(ChannelFutureListener.CLOSE); } } @Override public void channelReadComplete(ChannelHandlerContext ctx) { ctx.flush(); } @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) { cause.printStackTrace(); ctx.close(); } } public class ServerInitializer extends ChannelInitializer\u0026lt;SocketChannel\u0026gt; { private static final Logger LOG = LoggerFactory.getLogger(ServerInitializer.class); private static final StringDecoder DECODER = new StringDecoder(); private static final StringEncoder ENCODER = new StringEncoder(); private static final ServerHandler SERVER_HANDLER = new ServerHandler(); @Override public void initChannel(SocketChannel socketChannel) throws Exception { ChannelPipeline pipeline = socketChannel.pipeline(); pipeline.addLast(new DelimiterBasedFrameDecoder(8192, Delimiters.lineDelimiter())); pipeline.addLast(DECODER); pipeline.addLast(ENCODER); pipeline.addLast(SERVER_HANDLER); } } æœ€åï¼Œå’±ä»¬å†æ¥å®ç°ä¸»å‡½æ•°é€»è¾‘\n1 2 3 4 5 6 public class Main { public static void main(String[] args) { NetService netService = new NetServiceImpl(); netService.start(); } } åŸºæœ¬ä¸Šå°±å·®ä¸å¤šäº†ï¼Œä»£ç ä¼˜åŒ–å¾€åæ”¾æ”¾ï¼Œç°åœ¨å˜›ï¼Œèƒ½è·‘å°±è¡Œâ˜ºï¸\nè¿è¡Œè°ƒè¯• å¯åŠ¨æœåŠ¡åï¼Œå’±ä»¬é€šè¿‡ä¸‹åˆ—æŒ‡ä»¤å¾€æ¥å£æ’å…¥æ•°æ®\n1 2 3 4 (echo \u0026#39;hello\u0026#39;; sleep 2) | telnet 127.0.0.1 8888 (echo \u0026#39;sherlock\u0026#39;; sleep 2) | telnet 127.0.0.1 8888 (echo \u0026#39;thanks\u0026#39;; sleep 2) | telnet 127.0.0.1 8888 (echo \u0026#39;are you ok?\u0026#39;; sleep 2) | telnet 127.0.0.1 8888 é€šè¿‡ä¸‹é¢æ§åˆ¶å°çš„ä¿¡æ¯èƒ½å¤Ÿçœ‹åˆ°æ¥æ”¶åˆ°å®Œæ•´çš„æ•°æ®äº†ï¼Œè¯´æ˜v0.1ç‰ˆæœ¬é€šè¿‡socketç«¯å£è¯»å–æ•°æ®çš„é“¾è·¯æ˜¯æ­£å¸¸çš„\nå†çœ‹çœ‹æœ¬åœ°ç£ç›˜æ–‡ä»¶ï¼Œé€šè¿‡æ‰“å°å‡ºæ¥èƒ½å¤Ÿçœ‹åˆ°æ•°æ®æ˜¯å·²ç»è½åˆ°ç£ç›˜çš„\nå°ç»“ ä»¥ä¸Šå°±æ˜¯å®ç°çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œä»£ç ä¸å¯è°“ä¸ç²—ç³™ï¼Œä¸è¿‡å’±ä»¬è®²ç©¶çš„å°±æ˜¯ä¸€ä¸ªè½ï¼Œå¿«é€Ÿé—­ç¯çœ‹åˆ°æ•ˆæœæ‰æ˜¯æœ€é‡è¦çš„ï¼Œè‡³äºä¼˜åŒ–å˜›ï¼Œæ”¾åˆ°åé¢çš„ç‰ˆæœ¬æ…¢æ…¢ä¼˜åŒ–~\n","date":"2024-04-07T20:46:11+08:00","image":"https://sherlock-lin.github.io/p/%E6%89%8B%E5%86%99%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9Fv0.1%E7%89%88%E6%9C%AC/image-20240131185601251-6698564_hu7506803332195288085.png","permalink":"https://sherlock-lin.github.io/p/%E6%89%8B%E5%86%99%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9Fv0.1%E7%89%88%E6%9C%AC/","title":"æ‰‹å†™åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿv0.1ç‰ˆæœ¬"},{"content":"å¼•è¨€ ä¸€ç›´æƒ³å†™ä¸€ç¯‡æœåŠ¡åŒ–ç›¸å…³çš„æ–‡ç« ï¼Œé‚£å°±åˆ«çŠ¹è±«äº†ç°åœ¨å°±å¼€å§‹å§\næ­£æ–‡ ä½œä¸ºå¤§æ•°æ®åŸºç¡€æ¶æ„å·¥ç¨‹å¸ˆï¼Œä¸šç•Œä¹Ÿç¬‘ç§°â€œè¿ç»´Boyâ€ï¼Œæ—¥å¸¸å·¥ä½œå°±æ˜¯åœ¨å„ä¸ªæœºå™¨ä¸Šéƒ¨ç½²ä»¥åŠç»´æŠ¤æœåŠ¡ï¼Œä¾‹å¦‚éƒ¨ç½²Hadoopã€Kafkaã€Pulsarè¿™äº›ç­‰ç­‰ï¼Œç”¨äºç»™å…¬å¸ä¸šåŠ¡æä¾›æ•°æ®å¯¼å…¥ã€å­˜å‚¨ã€åˆ†ææœåŠ¡ã€‚è¿™äº›äº‹æƒ…åœ¨ç»å†äº†åå¤šå¹´å·²ç»æ¼”å˜å‡ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼Œä»Šå¤©å°±ä»¥å” å—‘çš„å½¢å¼è¿›è¡Œå±•å¼€è¯´è¯´\nå•ä¸€æŒ‡ä»¤é˜¶æ®µ è¿™æ˜¯æœ€åŸå§‹çš„é˜¶æ®µï¼Œåœ¨æœºå™¨/æ“ä½œç³»ç»Ÿä¸Šçš„æ‰€æœ‰äº‹æƒ…éƒ½è¦ç”±å¤§æ•°æ®SREé€šè¿‡ä¸€æ¡æ¡æ‰§è¡Œè¿›è¡Œæ“ä½œï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ã€‚å½“å…¬å¸éœ€è¦ä½ æ–°æ­å»ºæ•°ä»“æ—¶ï¼Œä¹Ÿå°±ç›¸å½“äºè¦æ­å»ºä»¥ä¸‹ä¸‰å±‚\nå­˜å‚¨å±‚ï¼šæ­å»ºHadoopã€Hiveã€HBaseé›†ç¾¤ç­‰ï¼Œè¿™æ˜¯ç”¨äºå°†æ‰€æœ‰å…¬å¸æ•°æ®åŒ…æ‹¬ç”¨æˆ·æ•°æ®çš„å­˜å‚¨ å¯¼å…¥å±‚ï¼šæ­å»ºFlinkCDCã€Flumeã€Kafka/Pulsarç­‰æ•°æ®å¯¼å…¥æœåŠ¡ï¼Œè¿™æ˜¯ç”¨äºå°†æ•°æ®å¯¼å…¥åˆ°å­˜å‚¨å±‚ åˆ†æå±‚ï¼šæ­å»ºDorisã€ClickHouseã€Prestoã€SpringBootç­‰æœåŠ¡ï¼Œè¿™æ˜¯ç”¨äºå°†å­˜å‚¨å±‚çš„æ•°æ®æŒ‰ç…§é¢„æœŸçš„æƒ³æ³•è¿›è¡Œè®¡ç®—å‡ºæœ€ç»ˆå¯ç›´æ¥ç”¨äºåˆ†æçš„ç»“æœï¼Œä¾‹å¦‚åºå¤§çš„å…¬å¸æ˜¨å¤©èµšäº†å¤šå°‘é’±ï¼Ÿåˆ†åˆ«æ˜¯å„ä¸ªåŸå¸‚èµšäº†å¤šå°‘ï¼Ÿç›¸æ¯”ä¸Šä¸ªæœˆå¤šäº†å¤šå°‘ç­‰ç­‰ æ¢ç®—åˆ°çœŸæ­£è¦åšçš„äº‹æƒ…ï¼Œé‚£å¤§è‡´æµç¨‹å°±æ˜¯ï¼Œå…ˆç”³è¯·æœºå™¨(ç‰©ç†æœºæˆ–è€…äº‘æœåŠ¡)ã€åˆå§‹åŒ–ç¯å¢ƒä¾‹å¦‚æ­å»ºSSHç­‰ç­‰ï¼Œç„¶åä¸‹è½½å„ä¸ªç»„ä»¶çš„å®‰è£…åŒ…ä¸Šä¼ åˆ°å¯¹åº”çš„æœºå™¨ï¼Œé’ˆå¯¹å¯¹åº”çš„ç»„ä»¶è¿›è¡Œé…ç½®ä¿®æ”¹ä»¥åŠå„ä¸ªç»„ä»¶å¯åŠ¨çš„å‰ç½®åŠ¨ä½œï¼Œæœ€åå†æ ¹æ®å…·ä½“çš„å¯åŠ¨æŒ‡ä»¤æ¥æŒ¨ä¸ªå¯åŠ¨æœºå™¨ç­‰ç­‰ã€‚å¦‚æœæœºå™¨åªæœ‰å‡ å°ï¼Œä½ ä¸ä¼šè§‰å¾—ä»€ä¹ˆï¼Œä½†æ˜¯å¦‚æœæœ‰ä¸‰å››åå°çš„æ—¶å€™ï¼Œä½ ä¼šè§‰å¾—æ‰‹è½¯ä»¥åŠæŠ±æ€¨ã€‚å¤§è‡´æŠ±æ€¨ä»¥ä¸‹å‡ ç‚¹\nå·¥ä½œé‡å¤§ï¼šè¦é äººå·¥ç™»é™†æ¯å°æœºå™¨é‡å¤æ‰§è¡Œé‚£ä¹ˆå¤šçš„æ­¥éª¤ å®¹æ˜“å‡ºé”™ï¼šè¿™ç±»åŠ¨ä½œé‡å¤å¤šæ¬¡å®¹æ˜“å‡ºç°äººå·¥æ“ä½œå¤±è¯¯å¯¼è‡´å½±å“ ä½“éªŒå·®ï¼šè¿™ç±»äº‹æƒ…åšå¤šäº†å¯¹äºSREæ¥è¯´æ˜¯ç…ç†¬ï¼Œå¹¶ä¸ä¼šæœ‰å¤ªå¤šæŠ€æœ¯ä¸Šçš„æˆé•¿ï¼Œæœ€åæ²¦ä¸ºåªä¼šæ‰§è¡Œè¿™å‡ ä¸ªæŒ‡ä»¤çš„â€œå·¥å…·äººâ€ è„šæœ¬åŒ–é˜¶æ®µ äººç±»å†å²å‘å±•æœ¬è´¨ä¸Šå°±æ˜¯å¯¹èµ„æºçš„åˆ©ç”¨ï¼Œä¸ºäº†æ›´åˆç†çš„åˆ©ç”¨èµ„æºå› æ­¤è¡ç”Ÿå‡ºäº†å„ç§é©å‘½ï¼Œä¾‹å¦‚ç¬¬ä¸€æ¬¡å·¥ä¸šé©å‘½é€šè¿‡è’¸æ±½æ›¿ä»£äººåŠ›ï¼Œç¬¬äºŒæ¬¡å·¥ä¸šé©å‘½é€šè¿‡å„ç§èƒ½æºç‡ƒæ–™æ›´å¤§å¹…ä»£æ›¿äººåŠ›ï¼Œç¬¬ä¸‰æ¬¡ä¹Ÿå°±æ˜¯æœ€è¿‘å‡ åå¹´çš„äº’è”ç½‘é©å‘½ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯çœèµ„æºé¿å…å¤§é‡çš„é‡å¤åŠ³åŠ¨ã€‚\nä¸Šé¢è¿™æ®µè¯æƒ³è¡¨è¾¾çš„æ˜¯ï¼Œ äº’è”ç½‘è¡Œä¸šå¯ä»¥è¯´90%ä»¥ä¸Šçš„é‡å¤åŠ³åŠ¨éƒ½æ˜¯æ²¡å•¥æ„ä¹‰çš„ï¼Œå°±ç›¸å½“äºåœ¨ä¸€è¾†è±ªåçš„æ±½è½¦ğŸš—å†…æ˜¯æœ‰äººåœ¨é‡Œé¢è¹¬ä¸‰è½®ï¼Œè¿™ä¸æ˜¯å¾ˆæ»‘ç¨½å—ã€‚å› æ­¤å¦‚æœä½ å‘ç°è‡ªå·±çš„å·¥ä½œä¸­è¿˜å­˜åœ¨å¤§é‡ å•ä¸€æŒ‡ä»¤é˜¶æ®µçš„äº‹æƒ…ï¼Œé‚£ä¹ˆåŠ¡å¿…è¦æƒ³åŠæ³•è¿›è¡Œè„šæœ¬åŒ–ã€‚è„šæœ¬æœ¬è´¨ä¸Šå°±æ˜¯ä¸€æœ¬æ“ä½œæŒ‡å—ï¼Œç»™â€œæ“ä½œç³»ç»Ÿâ€çœ‹çš„ï¼Œä¸¾ä¸ªä¾‹å­å¦‚æœä½ æ˜¯ä¸€ä¸ªæœå›­å›­ä¸»ï¼Œä½ é›‡äº†30ä¸ªäººè¿›è¡Œæ°´æœé‡‡æ‘˜ï¼Œä½ è‚¯å®šä¸ä¼šå»ç»™æ¯ä¸€ä¸ªäººè®²è§£å¦‚ä½•è¯†åˆ«æ°´æœã€æ°´æœå…·ä½“çš„é‡‡æ‘˜çš„æµç¨‹æ˜¯æ€ä¹ˆæ ·å­çš„ï¼Œè¦ç”¨æ‰‹æ‰˜ä½æœå­åœ¨ç”¨å‰ªåˆ€è½»è½»å‡å“ªä¸ªéƒ¨ä½ä¹‹ç±»çš„è¯ã€‚å› ä¸ºè¿™æ ·ä¸ä»…è€½è¯¯å¤§é‡ä½ çš„æ—¶é—´ï¼Œå¹¶ä¸”æ¯å¹´æ°´æœæˆç†Ÿæ—¶ä½ éƒ½è¦é‡å¤ä¸€éï¼Œå› æ­¤æ›´é«˜æ•ˆçš„æ–¹å¼æ˜¯èŠ±ä¸Šä¸€å¤©æ—¶é—´å†™ä¸€æœ¬â€œæ°´æœé‡‡æ‘˜æŒ‡å—â€ï¼Œåç»­çš„æ¯ä¸€ä¸ªé‡‡æ‘˜çš„äººç›´æ¥çœ‹ä¸‹æŒ‡å—å³å¯çŸ¥é“è¯¥æ€ä¹ˆåšï¼Œè¿™ä¸ªæŒ‡å—å°±æ˜¯è„šæœ¬ã€‚\né‚£ä¹ˆå·¥ä½œä¸­ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå¯ä»¥å°†ä¸‹è½½ç»„ä»¶åŒ…ã€è§£å‹åŒ…ã€æ›´æ”¹é…ç½®ã€æœåŠ¡å¯åŠ¨/é‡å¯ç­‰æ“ä½œç›´æ¥å°è£…æˆè„šæœ¬ï¼Œç„¶åå°†å¯èƒ½ä¼šå˜çš„ä¸œè¥¿ä½œä¸ºå‚æ•°ä¼ è¿›æ¥ï¼Œè¿™æ ·çš„è¯æ— è®ºæ˜¯é’ˆå¯¹å¤šå°‘å°æœºå™¨è¿›è¡Œæ“ä½œï¼Œä½ åªéœ€è¦åœ¨è¿™äº›æœºå™¨ä¸Šæ‰§è¡Œä¸€ä¸‹è„šæœ¬å³å¯ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿˜èƒ½åšäºŒæ¬¡ä¼˜åŒ–ï¼Œå°±æ˜¯åœ¨æ‰€æœ‰æœºå™¨é…ç½®SSHåï¼Œä½ åªéœ€è¦åœ¨æ‰§è¡Œè„šæœ¬æ—¶ä¼ å…¥è¦åšå˜æ›´æœºå™¨çš„æ ‡è¯†ä¾‹å¦‚IPï¼Œæ‰§è¡Œçš„æœºå™¨å°±ä¼šè‡ªåŠ¨å°†è¿™äº›â€œé€»è¾‘â€åˆ†å‘åˆ°å„ä¸ªæœºå™¨ä¸Šè¿›è¡Œæ‰§è¡Œï¼Œè¿™æ ·çš„æ“ä½œæ–¹å¼æ˜¯ä¸æ˜¯æ›´åŠ èˆ’æœï¼Ÿæˆ–è€…è¯´è¿™æ˜¯ä¸æ˜¯æ‰æ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„æµç¨‹ï¼Ÿ\né‚£ä¹ˆæ­¤æ—¶å¤§å®¶è§‰å¾—è¿™ä¸ªæµç¨‹æ˜¯å¦è¿˜å­˜åœ¨é—®é¢˜ï¼Ÿå¯ä»¥æ€è€ƒğŸ¤”ä¸€ä¼šå†ç»§ç»­å¾€ä¸‹çœ‹ã€‚å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å¯¹å¼€å‘äººå‘˜çš„ä¸“ä¸šèƒ½åŠ›æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œæ¢æˆæ˜¯ä¸Šé¢çš„ä¾‹å­æ¥è§£é‡Šå°±æ˜¯ï¼Œæœå›­å›­ä¸»ä¸æƒ³èŠ±æ—¶é—´å»å­¦ä¹ å†™â€œæ°´æœé‡‡æ‘˜æŒ‡å—â€ï¼Œæˆ–è€…è¯´æ‰€æœ‰æœå›­å›­ä¸»å•ç‹¬å†™æŒ‡å—ä»ä¸Šå¸è§†è§’çœ‹æœ¬è´¨ä¸Šå°±æ˜¯èµ„æºçš„æµªè´¹ï¼Œè¦æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ã€‚ä¹Ÿä¸å¤æ‚ï¼Œç›´æ¥è®©ä¸Šå¸æä¾›å‡ ä»½â€œæ°´æœé‡‡æ‘˜æŒ‡å—â€ï¼Œå„ä¸ªæœå›­å›­ä¸»åªéœ€è¦é€‰æ‹©é€‚åˆè‡ªå·±çš„ç›´æ¥ç”¨å²‚ä¸ç¾å“‰ï¼Ÿé‚£ä¹ˆå°±å¼•å‡ºäº†ç”¨æˆ·ç•Œé¢æ“ä½œé˜¶æ®µã€‚\nç”¨æˆ·ç•Œé¢æ“ä½œé˜¶æ®µ åœ¨è¯»è¿™ç¯‡æ–‡ç« çš„ä½ ç›¸ä¿¡å¯¹ç½‘ç«™æ“ä½œä¹Ÿä¸é™Œç”Ÿäº†ï¼Œä¾‹å¦‚å’±ä»¬ä¸éœ€è¦çŸ¥é“ç½‘ç»œåº•å±‚æ˜¯æ€ä¹ˆæ“ä½œï¼Œä»£ç æ˜¯æ€ä¹ˆç¼–å†™çš„ï¼Œå°±èƒ½å®Œæˆå¤šäººè·¨ç½‘ç»œã€è·¨æ—¶ç©ºçš„æ²Ÿé€šï¼Œè¿™äº›æœ¬è´¨ä¸Šè¦å½’åŠŸäºç”¨æˆ·ç•Œé¢æ“ä½œé˜¶æ®µ, å› ä¸ºè¿™äº›ä¸œè¥¿å·²ç»åŒ…è£…æˆäº†å‡ ä¸ªæŒ‰é’®ã€‚å¤§æ•°æ®SREçš„å·¥ä½œå†…å®¹å…¶å®ä¹Ÿæ˜¯å¯ä»¥ä½œæˆå‡ ä¸ªæŒ‰é’®æ¥å¤§å¹…æå‡æ•ˆç‡çš„ï¼Œä¾‹å¦‚è¦åœ¨æŸäº›æœåŠ¡ä¸Šæ­å»ºæ•°ä»“ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨Webé¡µé¢ä¸Šå‹¾é€‰è¦éƒ¨ç½²æœåŠ¡çš„æœºå™¨æ ‡è¯†ä¾‹å¦‚IPï¼Œç„¶åé€‰æ‹©æƒ³è¦å®‰è£…çš„æœåŠ¡ï¼Œç„¶åç‚¹å‡»ç¡®å®šå³å¯å®Œæˆå®‰è£…ï¼Œç„¶åå®‰è£…å®Œååœ¨Webé¡µé¢å°±æœ‰è¿™ä¸ªæœåŠ¡çš„ä¸“é—¨ç®¡ç†é¡µé¢ï¼Œä¾‹å¦‚æœåŠ¡å¯åŠ¨ã€é…ç½®æ›´æ”¹ã€ä½¿ç”¨æƒ…å†µç›‘æ§ç­‰ç­‰ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸‹å­è§‰å¾—é«˜çº§äº†èµ·æ¥ï¼Ÿæ›´é‡è¦çš„æ˜¯ï¼Œä½ å‘ç°ç”šè‡³ä½ éƒ½ä¸ç”¨æŒæ¡è¿‡å¤šçš„SREçš„çŸ¥è¯†ä¹Ÿèƒ½å®Œæˆè¿™ä»½å·¥ä½œï¼Ÿå¹¶ä¸”å³ä¾¿åç»­åœ¨æ›´å¤§çš„åœºæ™¯ä¾‹å¦‚è¦åœ¨å‡ ç™¾å°ã€å‡ åƒå°æœºå™¨è¿›è¡Œéƒ¨ç½²ç»´æŠ¤ä½ ä¹Ÿä¸æ€•äº†ï¼Ÿè¿™å°±æ˜¯äº’è”ç½‘çš„é­…åŠ›ï¼Œæ‰€ä»¥è¯´äº’è”ç½‘é©å‘½ä¹Ÿæ˜¯äººç±»å†å²ä¸Šå¯¹èµ„æºåˆ©ç”¨çš„ä¸€å¤§è¿›æ­¥ï¼Œå¦‚æœå’±ä»¬æ·±å¤„äº’è”ç½‘æ—¶ä»£ï¼Œç”šè‡³ä»äº‹äº’è”ç½‘å·¥ä½œï¼Œè€Œä¸å…·å¤‡äº’è”ç½‘æ€ç»´ï¼Œé‚£å²‚ä¸æ˜¯ä¸€ç§å€’é€€å—æˆ–è€…å½¢è±¡ç‚¹å°±æ˜¯ä¸€ä¸ªè¿œå¤äººç”Ÿæ´»åœ¨21ä¸–çºªè¿˜åœ¨é’»æœ¨å–ç«ï¼Œè¿™å°±æŒºå¥‡æ€ªçš„ã€‚\nåœ¨è¿™ä¸ªé˜¶æ®µæ˜¯å¦è¿˜æœ‰èƒ½æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¥ä¸‹æ¥æ˜¯æˆ‘çš„è®¾æƒ³æˆ–è€…æ˜¯YYæ—¶é—´ä¹Ÿå°±æ˜¯ å¤§æ¨¡å‹+AIOPSé˜¶æ®µ\nå¤§æ¨¡å‹+AIOPSé˜¶æ®µ æœ€è¿‘å‡ å¹´éšç€å¤§æ¨¡å‹çš„çˆ†å‘ï¼Œæœ‰ä¸å°‘ä¼ä¸šä»¥åŠä¸ªäººå·²ç»ç”¨å®ƒæ¥æå‡å’Œæ”¹è¿›è‡ªå·±çš„å·¥ä½œæ•ˆç‡ã€‚é‚£ä¹ˆä»¥åæ˜¯å¦è¿˜æœ‰è¿™æ ·çš„ä¸€ç§æ¨¡å¼ï¼Œå°±æ˜¯æˆ‘ä»¬åªè¦è·Ÿæœºå™¨äººï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä½â€œè™šæ‹ŸåŒäº‹â€å‘é€ ç»™æˆ‘æ­å»ºä¸€å¥—æ•°ä»“æŒ‡ä»¤æ˜¯å¦å°±å¯ä»¥äº†ï¼Ÿå®ƒä¼šè‡ªåŠ¨æ¥ç»­è¿™æ¡è‡ªç„¶è¯­è¨€çš„è¯­æ„ï¼Œå’±ä»¬è¿›è¡Œå„ä¸ªæµç¨‹çš„æ“ä½œï¼Œåœ¨ä¸€äº›å…³é”®æµç¨‹æˆ‘ä»¬äººç±»åªéœ€è¦è¿›è¡Œå®¡æ‰¹ç¡®è®¤æ²¡é—®é¢˜å³å¯ï¼Œå‰©ä¸‹çš„äº‹æƒ…äº¤ç»™æœºå™¨å»åšå°±å¤Ÿäº†ã€‚\nåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œè¿ç»´äººå‘˜ä¹Ÿä¸ç”¨å¤©å¤©ç›¯ç€ç›‘æ§å‘Šè­¦äº†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å†å²å‘ç”Ÿè¿‡çš„äº‹æ•…æ•°æ®ä»¥åŠä¸“ä¸šçŸ¥è¯†å–‚äººå·¥æ™ºèƒ½ï¼Œå¹¶è®­ç»ƒå®ƒé’ˆå¯¹å…·ä½“äº‹æƒ…è¯¥åšå‡ºæ€æ ·çš„å†³ç­–ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¯”å¦‚æŸå°æœºå™¨çš„CPUè¿‡é«˜ï¼Œé‚£ä¹ˆè‡ªåŠ¨æ’æŸ¥é—®é¢˜å¹¶è¿›è¡Œä¿®å¤ï¼Œæœ€åå†å°†æ’æŸ¥çš„ç»“æœä»¥åŠä¿®å¤çš„æµç¨‹å‘ç»™äººç±»å³å¯ï¼Œè¿™å²‚ä¸ç¾å“‰ï¼Ÿè€Œäººç±»è¿‡å¤šçš„åšè¿™äº›äº‹æƒ…æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç§èµ„æºçš„æµªè´¹ï¼Œå› ä¸ºå­˜åœ¨è¿‡å¤šè¿‡å¤šé‡å¤åŠ³åŠ¨ã€è¿‡å¤šæ²¡æœ‰å¤ªå¤šä»·å€¼çš„äº‹æƒ…ï¼Œå¦‚æœä¸€ä¸ªäººçš„ä¸€è¾ˆå­éƒ½åœ¨åšè¿™ç§äº‹æƒ…ï¼Œé‚£æœ¬è´¨ä¸Šæˆ‘ä»¬è¿˜æ˜¯å‡ ä¸‡å¹´å‰é‚£ä¸ªå­å“§å­å“§é’»æœ¨å¤´ğŸªµçš„åŸå§‹äººï¼Œä¸€åˆ‡çš„ä¸€åˆ‡éƒ½ä»æ¥æ²¡æœ‰å˜è¿‡ã€‚\næ€»ç»“ ä»¥ä¸Šæ˜¯æˆ‘å¯¹å¤§æ•°æ®æœåŠ¡åŒ–ç²—ç³™çš„è®¤çŸ¥ï¼Œè¾“å‡ºå‡ºæ¥æ˜¯å¸Œæœ›èƒ½å¼•å‘ä¸€äº›æ€è€ƒğŸ¤”ï¼Œå½“ç„¶å†™çš„è¿‡ç¨‹ä¸­ä¹Ÿå¼•å‘äº†æˆ‘è‡ªå·±çš„ä¸å°‘æ€è€ƒã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­è™½ç„¶å­˜åœ¨ä¸€ç‚¹æ‰¹åˆ¤ï¼Œä½†ç»ä¸æ˜¯é’ˆå¯¹å…·ä½“çš„ä¸ªäººï¼Œè€Œæ˜¯é’ˆå¯¹ç›®å‰å¸¸è§çš„ä¸€äº›æµç¨‹è®¾è®¡ï¼Œå•çº¯è§‰å¾—æœ‰äº›è®¾è®¡å¯ä»¥å˜å¾—æ›´â€œç¾â€ä¸€äº›ã€‚å¦‚æœå¯¹æœåŠ¡åŒ–æ„Ÿå…´è¶£çš„ä¼™ä¼´å¯ä»¥å»é’ˆå¯¹æ€§çš„å­¦ä¹ ä¸“ä¸šçš„çŸ¥è¯†æ¥æ”¹å–„å·¥ä½œå†…å®¹ï¼Œæœ¬ç¯‡æ–‡ç« ä»…ä»…æ˜¯å” å—‘ï¼Œå­˜åœ¨å¾ˆå¤šç‘•ç–µï¼Œä½†æˆ‘å§‹ç»ˆç›¸ä¿¡ï¼Œå¤šäººæ²Ÿé€šè®¨è®ºå¯ä»¥æ„å»ºè®¾è®¡ä¸€ä¸ªæ›´åŠ å®Œç¾çš„è®¾è®¡ï¼Œå› æ­¤å¦‚æœèƒ½å¼•å‘å…¶ä»–äººçš„å…±é¸£æˆ–è€…ä¸åŒæƒ³æ³•ğŸ’¡å…¶å®éƒ½æ˜¯å¥½äº‹ã€‚\n","date":"2024-04-04T20:41:34+08:00","image":"https://sherlock-lin.github.io/p/%E8%AE%BA%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E5%8F%91%E5%B1%95%E5%8F%B2/image-20240404185440981_hu17668148412322371707.png","permalink":"https://sherlock-lin.github.io/p/%E8%AE%BA%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%9C%8D%E5%8A%A1%E5%8C%96%E5%8F%91%E5%B1%95%E5%8F%B2/","title":"è®ºå¤§æ•°æ®æœåŠ¡åŒ–å‘å±•å²"},{"content":"å¼•è¨€ è·ç¦» è½ï¼Œå°±å®Œäº‹å•¦ï¼å·²ç»è¿‡å»äº†ä¸¤ä¸ªæœˆï¼Œè¿™ä¸¤ä¸ªæœˆä¹Ÿäº¤å‡ºäº†è‡ªå·±çš„ç­”å·ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿæœ‰äº›è‡ªå·±çš„å¿ƒå¾—ä½“ä¼šï¼Œè¿™ç¯‡å°±ä½œä¸ºcall backå§\né«˜æ•ˆæ‰§è¡ŒåŠ› è¿™ä¸¤ä¸ªæœˆç´¯è®¡è¾“å‡º22ç¯‡æ–‡ç« ï¼Œç®—ä¸‹æ¥å·®ä¸å¤šæ˜¯ä¸‰å¤©ä¸€ç¯‡ï¼Œè¿™åœ¨è¿‡å»æ˜¯å®Œå…¨ä¸æ•¢æƒ³è±¡çš„ï¼Œåœ¨èˆå¼ƒâ€œå®Œç¾â€åï¼Œå¾ˆå¤šè‡ªå·±çš„æƒ³æ³•ã€å¯¹æŠ€æœ¯çš„è§è§£éƒ½å¯ä»¥å‘å‡ºæ¥ï¼Œè™½ç„¶ä¹Ÿæœ‰å†™å¾—å¥½çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸å°‘è‡ªå·±è§‰å¾—ä¸æ»¡æ„çš„ï¼Œè¿™åœ¨ä»¥å‰æˆ‘è‚¯å®šå¸Œæœ›èƒ½å¤Ÿåœ¨æœªæ¥æ‰“é€ åˆ°å®Œç¾å†å‘å‡ºæ¥ï¼Œä½†å¦‚æœçœŸçš„æ˜¯é‚£æ ·å¯èƒ½æˆ‘çš„äº§é‡ä¼šä¸¥é‡ä¸‹æ»‘ç”šè‡³å¯èƒ½ä¼šåœæ­¢è¾“å‡ºåšå®¢ï¼Œå¹¶ä¸”å¦‚æœä¸å‘å‡ºæ¥æˆ‘è‡ªå·±çš„ä¸€äº›é—®é¢˜ä¹Ÿæ— æ³•æš´éœ²å‡ºæ¥å¹¶æ— æ³•è¿›è¡Œæ”¹è¿›ã€‚å› æ­¤è¯·è¯»è€…å¸¦ç€åŒ…å®¹çš„å¿ƒæ€æ¥è¿›è¡Œé˜…è¯»ï¼ŒåŒæ—¶æˆ‘ä¹Ÿç›¸ä¿¡æœç´¢å¼•æ“ä¼šè‡ªåŠ¨è¿‡æ»¤æ‰æˆ‘çš„é‚£äº›å†™å¾—ç³Ÿç³•çš„æ–‡ç« ï¼ŒåŒæ—¶ä¼šå°†æˆ‘å†™çš„è¿˜è¡Œçš„æ–‡ç« é€åˆ°æ‚¨çš„é¢å‰ï¼Œå¦‚æœèƒ½æ°å¥½å¸®åŠ©æ‚¨è§£å†³æŸäº›é—®é¢˜æˆ–è€…è§£å¼€æŸä¸ªç–‘æƒ‘ï¼Œé‚£æ˜¯æˆ‘çš„è£å¹¸ã€‚\nä»æˆ‘è¿™ä¸¤ä¸ªæœˆçš„è¾“å‡ºä¹Ÿèƒ½ä»æŸç§ç¨‹åº¦è¯´æ˜å®Œç¾å’Œæ‰§è¡ŒåŠ›æ˜¯äº’æ–¥çš„ï¼Œæˆ–è€…è¯´æœ‰æ—¶å€™ä¸è¦æƒ³ç€ä¸€æ­¥åˆ°ä½ï¼Œè€Œæ˜¯æƒ³åšå‡ºæ¥ï¼Œç„¶åå†ä¸æ–­è¿›è¡Œå®Œå–„ã€‚å°±åƒPulsarç³»åˆ—çš„æ–‡ç« ï¼Œæœ‰äº›å†™å¾—æ¯”è¾ƒè‰ç‡ï¼Œä½†æ˜¯å³ä¾¿å¦‚æ­¤åœ¨è¾“å‡ºåˆ°ç°å¦‚ä»Šæˆ‘å¯¹Pulsarçš„æ•´ä½“æµç¨‹æœ‰ä¸ªæ›´åŠ æ·±å…¥çš„ç†è§£ï¼Œåœ¨è„‘æµ·é‡Œé€æ¸æœ‰äº†ä¸€ä¸ªâ€œæ™ºæ…§æ¨¡å‹â€ï¼Œè¿™æ˜¯éå¸¸é‡è¦çš„ï¼Œåœ¨æœ‰ä¸ªè¿™ä¸ªæ¨¡å‹æˆ–è€…è¯´æ•´ä½“æ¡†æ¶åï¼Œæˆ‘å†å»é’ˆå¯¹æŸä¸ªç‚¹è¿›è¡Œå•ƒé€å°±ç›¸å¯¹è½»æ¾å¾ˆå¤šï¼Œå¹¶ä¸”ä¹Ÿæœ‰çš„æ”¾çŸ¢ï¼Œè‡ªå·±è‡ªå·±å½“å‰çš„è¿›åº¦åœ¨é‚£é‡Œ\nè´¨é‡ å¦‚ä½•å°†äº‹æƒ…åšå¾—åˆå¿«åˆå¥½åº”è¯¥æ˜¯å¤§éƒ¨åˆ†äººéƒ½åœ¨æ€è€ƒçš„é—®é¢˜ï¼Œå¦‚ä»Šçš„æˆ‘è§‰å¾—ä¸¤è€…å°±åƒæ˜¯é“å®¶çš„é˜´é˜³é±¼æ­¤æ¶ˆå½¼é•¿ï¼Œæˆ‘ä»¬è¦å°½é‡åšå¥½å¹³è¡¡ï¼Œæœ‰æ—¶å€™è¦ä¾§é‡äºæ‰§è¡Œï¼Œä½†æ˜¯å½“å‘ç°è´¨é‡ä¸‹æ»‘å¾—å‰å®³æ—¶ï¼Œæˆ‘ä»¬åˆè¦é€‚å½“æ”¾æ…¢é€Ÿåº¦æ¥æå‡è´¨é‡ã€‚è¿™ä¼šæ˜¯ä¸€ä¸ªä¸æ–­æŒç»­çš„è¿‡ç¨‹ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ç£¨ç»ƒçš„ä¹Ÿæ˜¯ä¸ªäººçš„å¿ƒæ™ºæˆ–è€…èƒ½åŠ›ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ä¸æ–­æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿè¦ä¸æ–­è¿›è¡Œæç‚¼ï¼Œä¾‹å¦‚ä¸€ç¯‡å¥½çš„æ–‡ç« æ¡†æ¶åº”è¯¥æ˜¯å¦‚ä½•çš„ï¼Œæç‚¼å‡ºä¸€å¥—é€šç”¨çš„æ¡†æ¶åå°±æŒ‰ç…§è¿™å¥—æ¡†æ¶è¿›è¡Œæ–‡ç« è¾“å‡ºï¼Œå¹¶ä¸”åœ¨è¾“å‡ºçš„è¿‡ç¨‹ä¸­ç»§ç»­å®Œå–„æ¡†æ¶ï¼Œæ¯”å¦‚å¾ˆç»å…¸çš„5W2Hæ¨¡å‹ï¼Œè¿™ä¸ªä¸œè¥¿æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¼šéœ€è¦è¿™ä¸ªä¸œè¥¿ï¼Ÿè¿™ä¸ªä¸œè¥¿æ€ä¹ˆç”¨ï¼Ÿæ€ä¹ˆå®ç°ï¼Ÿç­‰ç­‰ã€‚åŸºæœ¬æŠŠè¿™äº›é—®é¢˜å›ç­”äº†ï¼Œé‚£ä¹ˆä½ è¦è®²çš„ä¸œè¥¿ä¹Ÿè®²æ¸…æ¥šäº†\nå¾…å®Œå–„ åœ¨ä¸æ–­è¾“å‡ºæŠ€æœ¯çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå‘ç°è‡ªå·±ç›®å‰è¿˜å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œåœ¨æ­¤ä¸€èµ·è®°å½•ä¸‹æ¥æ–¹ä¾¿è‡ªæˆ‘å®Œå–„ä¹Ÿä¾›å¤§å®¶å‚è€ƒ\nè¡¨è¾¾ä¹Ÿæ˜¯æœ‰æ¡†æ¶çš„ï¼Œæˆ‘åœ¨è®²è§£æŸäº›ä¸œè¥¿çš„æ—¶å€™é€»è¾‘ä¸å¤Ÿæ¸…æ™°ï¼Œåå¤è®²æ¥è®²å»å…¶å®å°±æ˜¯æƒ³è¡¨è¾¾ä¸€ä¸ªæ„æ€ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰å¾ˆå¥½çš„æç‚¼å¯¼è‡´æœ‰ç‚¹å˜´ç¢çš„æ„Ÿè§‰ ç»˜å›¾èƒ½åŠ›å¾…æå‡ï¼Œåº”è¯¥çœ‹æ›´å¤šä¼˜ç§€çš„ä½œå“ï¼ŒåŒæ—¶å°†æŸäº›æŠ€æœ¯çš„å…³é”®ç‚¹é€šè¿‡å›¾ç»™å…³è”èµ·æ¥ï¼Œå¹¶ä¸”ç›®å‰ç»˜åˆ¶çš„å›¾æŒºä¸è§„èŒƒï¼Œä¾‹å¦‚ç±»å’ŒåŠŸèƒ½æ··åˆåœ¨ä¸€èµ·ç­‰ç­‰ï¼Œè¿™äº›éƒ½å¾…å®Œå–„ è¡¨è¾¾åº”è¯¥ä¹Ÿè¦æœ‰å±‚æ¬¡æ„Ÿï¼Œå°±åƒé‡‘å­—å¡”ä¸€æ ·ï¼Œä¸‹ä¸€å±‚çš„çŸ¥è¯†æ˜¯ä¸ºäº†æ›´å¥½çš„æ”¯æ’‘ä¸Šä¸€å±‚ï¼Œå½¼æ­¤æ˜¯æœ‰è”ç³»å¹¶ä¸”å±‚å±‚é€’è¿›çš„ï¼Œè€Œç›®å‰è¿™å—åšå¾—ä¸å¤Ÿå¥½ï¼Œæ›´åƒæ˜¯é¡ºç€æŸæ¡è·¯ä¸€æ¡è·¯èµ°å®Œä½†æ˜¯è¯»è€…ä¼šå¾ˆæ‡µ æ€»ç»“ è¿™æ˜¯æˆ‘æœ€è¿‘ä¸¤ä¸ªæœˆå…³äºâ€œè½â€æ¯”è¾ƒå¤§çš„æ„Ÿæ‚Ÿï¼Œè™½ç„¶æ–‡ç« è´¨é‡æœ‰ä¸‹æ»‘ï¼Œä½†æˆ‘è§‰å¾—æœ‰æ—¶å€™è¯¥æŠ“ä¸€æ”¾ä¸€ï¼Œå¯¹äºæ­¤æ—¶çš„æˆ‘æ¥è¯´åšæŒè¾“å‡ºè¿œèƒœäºç”¨å¾ˆå¤šæ—¶é—´æ‰“ç£¨ä¸€ä¸¤ç‰‡æ–‡ç« ã€‚å› æ­¤æˆ‘ä¼šåœ¨â€œè½â€çš„è¿‡ç¨‹ä¸­å°½é‡æå‡è´¨é‡ï¼Œè¯»è€…å¦‚æœæœ‰å…¶ä»–çš„å»ºè®®ä¹Ÿå¸Œæœ›åœ¨è¯„è®ºä¸­ä¸€èµ·è¿›è¡Œè®¨è®º\n","date":"2024-04-04T15:09:14+08:00","image":"https://sherlock-lin.github.io/p/%E8%8E%BD%E5%B0%B1%E5%AE%8C%E4%BA%8B%E4%BA%86%E7%AC%AC%E4%BA%8C%E5%BC%B9/pawel-czerwinski-8uZPynIu-rQ-unsplash_hu6307248181568134095.jpg","permalink":"https://sherlock-lin.github.io/p/%E8%8E%BD%E5%B0%B1%E5%AE%8C%E4%BA%8B%E4%BA%86%E7%AC%AC%E4%BA%8C%E5%BC%B9/","title":"è½å°±å®Œäº‹äº†ç¬¬äºŒå¼¹"},{"content":"å¼•è¨€ ã€Šè®¤çŸ¥è§‰é†’ã€‹è¿™æœ¬ä¹¦å¤ªç»å…¸äº†ï¼Œåå¤è¯»äº†å¤šæ¬¡è¿˜æ˜¯çˆ±ä¸é‡Šæ‰‹ï¼Œå› æ­¤å†³å®šé’ˆå¯¹å®ƒå†™å†™è¯»ä¹¦ç¬”è®°ã€‚ä»Šå¤©ä¸»è¦é’ˆå¯¹è¿™æœ¬ä¹¦çš„ä¸‰é‡å¤§è„‘ç†è®ºè¿›è¡Œè®²è§£\nä¸‰é‡å¤§è„‘ ä½œè€…è®¤ä¸ºäººç±»çš„å¤§è„‘åˆ†ä¸ºä¸‰é‡åˆ†åˆ«æ˜¯æœ¬èƒ½è„‘ã€æƒ…ç»ªè„‘ä»¥åŠç†æ™ºè„‘ï¼Œä¸‰è€…çš„åŒºåˆ«å¦‚ä¸‹å›¾(ä»ä¹¦ä¸­æ‹·è´çš„ï¼Œä¾µæƒè¯·è”ç³»åˆ é™¤)\nå¾ˆå¤šç›¸å…³ä¹¦ç±éƒ½ä¼šå°†å¤§è„‘åˆ†ä¸ºè¿™ä¸‰ç§ï¼Œä½†æœ¬äººè§‰å¾—å¯¹äºè¯»è€…æ¥è¯´å…¶å®å¯ä»¥ç®€åŒ–ï¼Œå°†æƒ…ç»ªè„‘å’Œæœ¬èƒ½è„‘è¿›è¡Œåˆå¹¶ç®€ç§°â€œéç†æ™ºè„‘â€ã€‚ç†æ™ºè„‘å’Œéç†æ™ºè„‘å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œç†æ™ºè„‘ç›¸æ¯”ä¹‹ä¸‹æ›´åŠ é«˜çº§ï¼Œä½†æ˜¯å¼±å°ï¼Œè€Œéç†æ™ºè„‘è™½ç„¶ä½çº§ä½†æ˜¯éå¸¸éå¸¸å¼ºå¤§ã€‚å› æ­¤ä»äººç±»è¿œå¤æ—¶æœŸåˆ°å¦‚ä»Šå·²è·¨å…¥äº’è”ç½‘ç¬¬ä¸‰æ¬¡å·¥ä¸šé©å‘½ä¸­ï¼Œå¤§éƒ¨åˆ†äººçš„å†³ç­–è¿˜æ˜¯é€šè¿‡éç†æ™ºè„‘ã€‚è¿™é‡Œåˆ†åˆ«ä¾‹ä¸¾ä¸¤è€…çš„ç‰¹ç‚¹åšä¸‹æ¯”è¾ƒ\nç†æ™ºè„‘ç‰¹ç‚¹\nå¯Œæœ‰è¿œè§ã€å–„äºæƒè¡¡ èƒ½ç«‹è¶³æœªæ¥å»¶è¿Ÿæ»¡è¶³ å¯¹å¤§è„‘æ§åˆ¶åŠ›å¼± éç†æ™ºè„‘ä¼˜ç‚¹\næ‰§è¡ŒåŠ›å¼º é¿éš¾è¶‹æ˜“å’Œæ€¥äºæ±‚æˆ å¯¹å¤§è„‘æ§åˆ¶åŠ›å¼º é€šè¿‡è¿™ä¸ªæ¯”è¾ƒç›¸ä¿¡å¤§å®¶èƒ½å¤Ÿæ˜æ˜¾çš„æ„Ÿè§‰åˆ°ä¸¤è€…çš„å·®å¼‚ï¼Œè¿™é‡Œæ¯”è¾ƒä¸¤è€…å¹¶ä¸æ˜¯æƒ³è¯´ç†æ™ºè„‘æ›´å¥½ï¼Œè€Œæ˜¯å¸Œæœ›æˆ‘ä»¬æ›´åŠ äº†è§£è‡ªå·±å¤§è„‘è¿™ä¸ªâ€œå·¥å…·â€ã€‚å¤§è„‘æ˜¯æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­æœ€å¸¸ç”¨çš„â€œå·¥å…·â€ï¼Œåœ¨æˆ‘ä»¬çš„çµé­‚å‘å¤§è„‘å‘é€æŒ‡ä»¤æ—¶ï¼Œå¤§è„‘ä¼šè¿›è¡Œæ€è€ƒå¹¶åšå‡ºå¯¹åº”å†³ç­–ï¼Œæœ€ç»ˆå°†å†³ç­–çš„ç»“æœå‘é€åˆ°èº«ä½“çš„å„ä¸ªéƒ¨ä½è¿›è¡Œæœ€ç»ˆçš„â€œæ‰§è¡ŒåŠ¨ä½œâ€ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœæ¯ä¸ªäººéƒ½æ˜¯ä¸€ä¸ªç‹å›½ï¼Œé‚£ä¹ˆçµé­‚å°±æ˜¯å›½ç‹ï¼Œè€Œç†æ™ºè„‘æ˜¯å†›å¸ˆï¼Œéç†æ™ºè„‘æ˜¯å°†å†›ï¼Œèº«ä½“çš„å„ä¸ªéƒ¨ä½åˆ†åˆ«æ˜¯è¿™ä¸ªç‹å›½çš„å­æ°‘ã€‚å› æ­¤å›½ç‹è¦åšçš„æ˜¯å°†å›½å®¶å‘å±•æˆ˜ç•¥ç›¸å…³çš„äº‹æƒ…äº¤ç»™å†›å¸ˆï¼Œå°†è¿™ä¸ªæˆ˜ç•¥æ‰€ä¾èµ–çš„å„ä¸ªäº‹æƒ…äº¤ç»™å°†å†›ï¼Œè®©å°†å†›å¸¦é¢†éƒ¨é˜Ÿã€å­æ°‘ä»¬å»æ”»åŸæ‹”å¯¨ä»è€Œå£®å¤§è¿™ä¸ªç‹å›½ã€‚\né€šè¿‡ä¸Šé¢è¿™ä¸ªä¾‹å­å¤§å®¶åº”è¯¥å°±æ¸…æ¥šï¼Œç†æ™ºè„‘å’Œéç†æ™ºè„‘ä»æ¥ä¸æ˜¯å¯¹ç«‹çš„ï¼Œè€Œæ˜¯åä½œï¼Œå¦‚ä½•åè°ƒå¥½ä¸¤è€…æ˜¯æˆ‘ä»¬æ¯ä¸ªäººéœ€è¦åšå¥½çš„äº‹æƒ…ã€‚ç”¨ä¹¦ä¸­çš„åŸè¯æ¥è¯´å°±æ˜¯ ç†æ™ºè„‘ä¸æ˜¯ç›´æ¥å¹²æ´»çš„ï¼Œå¹²æ´»æ˜¯æœ¬èƒ½è„‘å’Œæƒ…ç»ªè„‘çš„äº‹æƒ…ï¼Œå› ä¸ºå®ƒä»¬çš„â€œåŠ›æ°”â€å¤§ï¼›ä¸Šå¤©èµ‹äºˆç†æ™ºè„‘æ™ºæ…§ï¼Œæ˜¯è®©å®ƒé©±åŠ¨æœ¬èƒ½å’Œæƒ…ç»ªï¼Œè€Œä¸æ˜¯ç›´æ¥å–ä»£å®ƒä»¬ã€‚\nç”Ÿæ´»ä¾‹å­ æ¥ä¸‹æ¥ç»“åˆä»¥ä¸‹å‡ ä¸ªä¾‹å­æ¥è®²è®²\nè¥é”€æ‰‹æ³•\nç°å¦‚ä»Šå¾ˆå¤šè¥é”€æ‰‹æ³•æœ¬è´¨ä¸Šå°±æ˜¯æ”»å‡»æ¯ä¸ªäººçš„â€œéç†æ™ºè„‘â€ï¼Œä¾‹å¦‚ä¸å°‘ä¸»æ’­å¸¦è´§ï¼Œé€šè¿‡ä¸åœçš„å–Šå€’è®¡æ—¶æ¥åˆ¶é€ ç¨€ç¼ºä»¥åŠç´§å¼ çš„æ°›å›´ï¼Œæ­¤æ—¶â€œéç†æ™ºè„‘â€å°±ä¼šæœ¬èƒ½çš„ç´§å¼ ä»¥åŠåœ¨æŸå¤±åŒæ¶çš„å¿ƒç†ä¸‹ï¼Œâ€œéç†æ™ºè„‘â€ä¼šä»¥å‹å€’æ€§çš„å½¢å¼è¿œè¿œæˆ˜èƒœâ€œç†æ™ºè„‘â€ï¼Œå³ä¾¿â€œç†æ™ºè„‘â€èƒ½å¯Ÿè§‰åˆ°ä¹°è¿™ç©æ„å¯èƒ½æ²¡å•¥ä½œç”¨ï¼Œä½†æ˜¯æ²¡åŠæ³•å®ƒå¯¹å¤§è„‘çš„æ§åˆ¶è¿œè¿œä¸å¦‚â€œç†æ™ºè„‘â€ã€‚è¿™æ˜¯èªæ˜çš„å•†å®¶å±¡è¯•ä¸çˆ½çš„æ‹›æ•°ï¼Œé™¤æ­¤ä¹‹å¤–çš„åœºæ™¯è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œä¾‹å¦‚å½“æˆ¿ä»·ä¸åœçš„ç–¯ç‹‚ä¸Šæ¶¨æ—¶ï¼Œå¤§éƒ¨åˆ†äººä¹Ÿä¼šä¸§å¤±ç†æ™ºè·Ÿé£ä¸Šè½¦ï¼›å½“è‚¡ä»·é£•é£•ä¸Šæ¶¨æ—¶ï¼Œä¹ŸåŒæ ·å¦‚æ­¤ï¼Œè¿™äº›è¶‹åˆ©é¿å®³ä»¥åŠæ€¥äºæ±‚æˆéƒ½æ˜¯â€œéç†æ™ºè„‘â€çš„ç¼ºç‚¹ï¼Œè‡³å°‘åº”è¯¥æ„è¯†åˆ°è¿™ä¸€ç‚¹ä»¥åŠå°½é‡é¿å…å› æ­¤é­åˆ°æŸå¤±ã€‚\nå­¦ä¹ æŠ€èƒ½\nåœ¨å­¦ä¹ æ–°æŠ€æœ¯/æŠ€èƒ½æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€åšæŒä¸äº†å¤ªä¹…ï¼Œè¿™æ˜¯å› ä¸ºä»å­¦ä¹ æ›²çº¿æ¥è¯´å¤§éƒ¨åˆ†å‰æœŸéƒ½æ˜¯æ¯”è¾ƒå®¹æ˜“ï¼Œä½†æ˜¯ä¸€æ—¦è¿‡äº†å‰æœŸä¹‹åï¼Œå†è¿›è¡ŒåŠªåŠ›éƒ½å¾ˆéš¾çœ‹åˆ°æˆæ•ˆï¼Œæ­¤æ—¶å¾ˆå¤šäººéƒ½ä¼šå»ºè®®ä¸€å®šè¦è‡ªå¾‹ä¹‹ç±»çš„è¯ï¼Œä½†æ˜¯ç›²ç›®çš„è‡ªå¾‹å…¶å®å°±æ˜¯åœ¨è®©å¼±å°çš„â€œç†æ™ºè„‘â€å»å¯¹æŠ—å¼ºå¤§çš„â€œéç†æ™ºè„‘â€ï¼Œç»“æœå¤±è´¥éƒ½æ˜¯éå¸¸æ­£å¸¸çš„äº‹ã€‚å› æ­¤åº”è¯¥ç”¨â€œç†æ™ºè„‘â€å»å¼•å¯¼éç†æ™ºè„‘ï¼Œå°±æ‹¿å­¦å°æç´ä¸ºä¾‹å­ï¼Œæˆ‘ä»¬è¦åšçš„ä¸æ˜¯å¼ºè¿«è‡ªå·±æ¯å¤©æ‹‰å‡ ä¸ªå°æ—¶çš„å°æç´ï¼Œè¿™åªä¼šå˜å¾—ç—›è‹¦ä»¥åŠæ›´æ—©çš„æ”¾å¼ƒã€‚â€œç†æ™ºè„‘â€è¦åšçš„åº”è¯¥æ˜¯ï¼Œè¦æ±‚è‡ªå·±å»å¬å‡ åœºéŸ³ä¹ä¼šï¼Œçœ‹å°æç´å®¶ä»¬åœ¨èˆå°ä¸Šæ‹‰å‡ºæ‚ æ‰¬çš„å£°éŸ³ï¼Œè¿™ä¸ªç”»é¢ä¼šåœ¨æœªæ¥çš„å¾ˆé•¿æ—¶é—´å¼•å¯¼ç€â€œéç†æ™ºè„‘â€å»å……æ»¡çƒ­æƒ…ç»ƒç´ï¼Œå…¶æ¬¡å°±æ˜¯é€‰ä¸€äº›è‡ªå·±å–œæ¬¢å¹¶ä¸”å®¹æ˜“å…¥é—¨çš„æ›²å­ï¼Œåœ¨æ¯å¤©ç»ƒå®ŒåŸºæœ¬åŠŸåâ€œå¥–åŠ±â€è‡ªå·±æ‹‰ä¸€ä¼šè‡ªå·±çš„æ›²å­ï¼Œåœ¨æ›²å­æ‹‰ç†Ÿç»ƒåå¯ä»¥é€‚å½“çš„åœ¨æœ‹å‹ä»¬é¢å‰è¿›è¡Œè¡¨æ¼”ç­‰ã€‚è¿™åªæ˜¯ä»¥å°æç´ä¸ºä¾‹å­ï¼Œå…¶ä»–æŠ€èƒ½éƒ½æ˜¯æƒ³é€šçš„ï¼Œå› æ­¤åº”è¯¥åˆç†çš„åº”ç”¨å¥½æˆ‘ä»¬çš„â€œéç†æ™ºè„‘â€\næ€»ç»“ è¿™ç±»æ–‡ç« å¯èƒ½è¯»èµ·æ¥ä¼šæœ‰ç‚¹è§‰å¾—åƒæ˜¯å‚²æ…¢çš„è¯´æ•™ä¹‹ç±»çš„ï¼Œå¦‚æœæœ‰ç±»ä¼¼çš„æ„Ÿè§‰æˆ‘æ„Ÿåˆ°å¾ˆæŠ±æ­‰ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘çš„æœ¬æ„ï¼Œæˆ‘ä»è¿‡å»åˆ°ç°åœ¨å³ä½¿æ˜¯å°†æ¥åœ¨è¿™æ–¹é¢éƒ½æœ‰è¦ä¸æ–­å®Œå–„çš„åœ°æ–¹ï¼Œå†™å‡ºæ¥ä¸€æ–¹é¢æ˜¯ç»™å¤§å®¶åˆ†äº«æˆ‘çš„è§è§£ï¼Œå¦ä¸€æ–¹é¢è‡ªå·±ä¹Ÿä¼šæ—¶å¸¸å›å¤´çœ‹çœ‹ã€åæ€è¿™å—ç›¸å…³çš„å†…å®¹å¹¶æŒ‡å¯¼æˆ‘è‡ªå·±æ›´å¥½çš„å‰è¡Œã€‚æœ€åè·Ÿå¤§å®¶åˆ†äº«æ–‡ç« ä¸­æˆ‘å¾ˆå–œæ¬¢çš„ä¸€å¥è¯ ä¹ æƒ¯ä¹‹æ‰€ä»¥éš¾ä»¥æ”¹å˜ï¼Œå°±æ˜¯å› ä¸ºå®ƒæ˜¯è‡ªæˆ‘å·©å›ºçš„â€”â€”è¶Šç”¨è¶Šå¼ºï¼Œè¶Šå¼ºè¶Šç”¨ã€‚è¦æƒ³ä»æ—¢æœ‰çš„ä¹ æƒ¯ä¸­è·³å‡ºæ¥ï¼Œæœ€å¥½çš„æ–¹æ³•ä¸æ˜¯ä¾é è‡ªåˆ¶åŠ›ï¼Œè€Œæ˜¯ä¾é çŸ¥è¯†ã€‚\n","date":"2024-04-02T15:09:59+08:00","image":"https://sherlock-lin.github.io/p/%E8%AE%A4%E7%9F%A5%E8%A7%89%E9%86%92%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%A4%A7%E8%84%91%E4%B9%8B%E4%B8%80%E5%88%87%E9%97%AE%E9%A2%98%E7%9A%84%E8%B5%B7%E6%BA%90/image-20240401215532850_hu17024335535230597268.png","permalink":"https://sherlock-lin.github.io/p/%E8%AE%A4%E7%9F%A5%E8%A7%89%E9%86%92%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%A4%A7%E8%84%91%E4%B9%8B%E4%B8%80%E5%88%87%E9%97%AE%E9%A2%98%E7%9A%84%E8%B5%B7%E6%BA%90/","title":"è®¤çŸ¥è§‰é†’è¯»ä¹¦ç¬”è®°ä¹‹å¤§è„‘ä¹‹ä¸€åˆ‡é—®é¢˜çš„èµ·æº"},{"content":"å¼•è¨€ åœ¨çœ‹äº† ä½ çœŸçš„äº†è§£Pulsarçš„æ¶ˆæ¯ä¿ç•™ã€ç§¯å‹ã€TTLç­–ç•¥å— åï¼Œç›¸ä¿¡æœ‰ä¸å°‘å¯¹æŠ€æœ¯å……æ»¡çƒ­æƒ…çš„å°ä¼™ä¼´ä¼šç–‘æƒ‘ï¼ŒPulsarçš„TTLåˆæ˜¯æ€ä¹ˆå»å¤±ä¿¡çš„å‘¢ï¼Ÿä»Šå¤©å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§\nåœ¨çœ‹ä¸‹é¢çš„æ–‡ç« æ—¶æˆ‘ä»¬è¦å¸¦ç€ä»¥ä¸‹å‡ ä¸ªé—®é¢˜\nTTLæ˜¯ä»€ä¹ˆæ—¶å€™è§¦å‘çš„ TTLæœºåˆ¶è¢«è§¦å‘åä¼šå‘ç”Ÿä»€ä¹ˆ è¿‡æœŸçš„æ¶ˆæ¯ä¼šç«‹é©¬è¢«åˆ é™¤å— æ•´ä½“æµç¨‹ åœ¨è·Ÿè¸ªæºç å‰å…ˆçœ‹çœ‹è¿™å¼ å›¾ï¼Œæ¯ä¸ªBrokerå†…éƒ¨éƒ½ä¼šæœ‰ä¸€ä¸ªå‘¨æœŸå®šæ—¶çº¿ç¨‹ä»»åŠ¡ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´éƒ½ä¼šè§¦å‘TTLä»»åŠ¡ã€‚TTLä»»åŠ¡ä¼šè½®è¯¢å½“å‰Brokeræ‰€ç®¡ç†çš„æ‰€æœ‰Topicä¸­çš„æ‰€æœ‰è®¢é˜…è€…ï¼Œå› ä¸ºæ¯ä¸ªè®¢é˜…è€…éƒ½ä¼šåœ¨Brokerç»´æŠ¤ä¸€ä¸ªæ¶ˆè´¹æ¸¸æ ‡ï¼Œå› æ­¤Brokerä¼šæ ¹æ®ç”¨æˆ·é…ç½®çš„è¿‡æœŸæ—¶é—´åˆ°è½®è¯¢æ£€æŸ¥æ¸¸æ ‡ï¼Œçœ‹çœ‹æœ‰å“ªäº›æ¶ˆæ¯æ˜¯æ²¡è¢«æ¶ˆè´¹ä½†æ˜¯å·²ç»è¿‡äº†TTLçš„å¹¶ä¼šå°†æ¸¸æ ‡ç§»åŠ¨åˆ°å…¶çš„å·¦ä¾§(ä»å®ç°çš„å±‚é¢ç›¸å½“äºè¡¨ç¤ºå®ƒå·²ç»è¢«æ¶ˆè´¹äº†)ï¼Œä»è€Œè¾¾åˆ°è¿™äº›è¿‡äº†TTLçš„æ¶ˆæ¯å…è®¸è¢«åˆ é™¤çš„æ•ˆæœï¼Œæœ€ç»ˆå†å°†æ¸¸æ ‡çš„ä¿¡æ¯æŒä¹…åŒ–åˆ°Bookkeeperä¸­è¿›è¡Œä¿å­˜ã€‚\nè§¦å‘TTLæµç¨‹ é‚£ä¹ˆç›´æ¥æ¥è·Ÿè¸ªä¸‹è§¦å‘TTLçš„æµç¨‹å§ï¼Œå…ˆä»Brokerçš„å¯åŠ¨æ–¹æ³•startå¼€å§‹çœ‹ã€‚å¯ä»¥çœ‹åˆ°å¯åŠ¨çš„æ—¶å€™è¿˜ä¼šå¼€å¯ä¸€ç³»åˆ—å®šæ—¶ä»»åŠ¡ï¼Œè¿™é‡Œåªçœ‹TTLç›¸å…³çš„ï¼Œè·Ÿè¸ªè¿›å»startMessageExpiryMonitoræ–¹æ³•å¯ä»¥çœ‹åˆ°messageExpiryMonitorå…¶å®æ˜¯JDKæä¾›çš„çº¿ç¨‹æ± ScheduledExecutorServiceç±»ï¼Œåœ¨è¿™é‡Œé€šè¿‡scheduleAtFixedRateæ–¹æ³•å‘¨æœŸæ€§çš„æ‰§è¡Œè¿‡æœŸä»»åŠ¡æ£€æµ‹ï¼Œé—´éš”ä»Brokeré…ç½®ä¸­è¿›è¡Œè¯»å–çš„ï¼Œé»˜è®¤æ˜¯æ¯éš”5åˆ†é’Ÿä¸€æ¬¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public void start() throws Exception { .... this.startInactivityMonitor(); //å¯åŠ¨å®šæ—¶æ¶ˆæ¯è¿‡æœŸæ£€æµ‹ä»»åŠ¡(TTL) this.startMessageExpiryMonitor(); this.startCompactionMonitor(); this.startConsumedLedgersMonitor(); this.startBacklogQuotaChecker(); this.updateBrokerPublisherThrottlingMaxRate(); this.updateBrokerDispatchThrottlingMaxRate(); this.startCheckReplicationPolicies(); this.startDeduplicationSnapshotMonitor(); } protected void startMessageExpiryMonitor() { int interval = pulsar().getConfiguration().getMessageExpiryCheckIntervalInMinutes(); messageExpiryMonitor.scheduleAtFixedRate(this::checkMessageExpiry, interval, interval, TimeUnit.MINUTES); } TTLå¯åŠ¨æµç¨‹ é€šè¿‡ä¸Šä¸€èŠ‚å¯ä»¥çœ‹åˆ°Pulsarçš„TTLè§¦å‘å°±æ˜¯é€šè¿‡JDKçš„å®šæ—¶çº¿ç¨‹æ± æ¥å®ç°çš„ï¼ŒBrokerä¼šå‘¨æœŸæ€§çš„è°ƒç”¨checkMessageExpiryæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå› æ­¤ç°åœ¨å°±ä»è¿™ä¸ªæ–¹æ³•è¿›è¡Œè·Ÿè¸ªï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆä¼šè°ƒç”¨åˆ°Topicçš„checkMessageExpiryæ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 public void checkMessageExpiry() { //è¿›å»çœ‹çœ‹forEachTopicçš„å®ç° forEachTopic(Topic::checkMessageExpiry); } public void forEachTopic(Consumer\u0026lt;Topic\u0026gt; consumer) { //topicsæ˜¯Brokerç»´æŠ¤çš„ä¸€ä¸ªMapç»“æ„ï¼Œç”¨äºè®°å½•å½“å‰Brokeræ‰€ç»´æŠ¤çš„Topicä¿¡æ¯ //è¿™é‡Œä½¿ç”¨äº†Java8çš„Consumerï¼Œç›¸å½“äºé—­åŒ…çš„è®¾è®¡ï¼Œè®©å†…éƒ¨çš„æ‰€æœ‰Topicéƒ½æ‰§è¡ŒcheckMessageExpiryæ–¹æ³• topics.forEach((n, t) -\u0026gt; { Optional\u0026lt;Topic\u0026gt; topic = extractTopic(t); topic.ifPresent(consumer::accept); }); } ç”±äºTopicåªæ˜¯æ¥å£ï¼Œå› æ­¤æˆ‘ä»¬çœ‹å®ƒæœ€å¸¸ç”¨çš„å®ç°ç±»ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„PersistentTopicç±»çš„å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 public void checkMessageExpiry() { //ä»topicé…ç½®ä¸­è·å–æ¶ˆæ¯çš„TTLé…ç½®ï¼Œè¿™ä¸ªè·Ÿä¸Šé¢çš„é…ç½®æ˜¯æœ‰åŒºåˆ«çš„ï¼Œè¿™é‡Œä»£è¡¨çš„æ˜¯æ¶ˆæ¯çš„æœ‰æ•ˆæœŸ int messageTtlInSeconds = topicPolicies.getMessageTTLInSeconds().get(); //é€šè¿‡è¿™é‡Œçš„é€»è¾‘å¯ä»¥çŸ¥é“å¦‚æœé…ç½®æˆ0å°±ä¸ä¼šè¿‡æœŸ if (messageTtlInSeconds != 0) { //å¾ªç¯è°ƒç”¨å½“å‰Topicè®¢é˜…è€…æ£€æµ‹è¿‡æœŸ subscriptions.forEach((__, sub) -\u0026gt; { if (!isCompactionSubscription(sub.getName())) { //è¿›è¡Œå…·ä½“çš„æ£€æµ‹åŠ¨ä½œï¼Œä»è¿™é‡Œç»§ç»­è·Ÿè¸ª sub.expireMessages(messageTtlInSeconds); } }); } } public boolean expireMessages(int messageTTLInSeconds) { //è·å–å½“å‰ç§¯å‹æ¶ˆæ¯çš„æ¡æ•°(æŒ‡çš„å°±æ˜¯æœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯æ¡æ•°) long backlog = getNumberOfEntriesInBacklog(false); //å¦‚æœæ²¡æœ‰æ¶ˆæ¯ç§¯å‹å°±ä»£è¡¨æ‰€æœ‰æ¶ˆæ¯éƒ½è¢«æˆåŠŸæ¶ˆè´¹å¹¶ä¸”æ¸¸æ ‡æ­¤æ—¶å·²ç»å¤„äºæœ€å·¦ç«¯ï¼Œå› æ­¤æ²¡å¿…è¦å†åšTTLçš„æ£€æµ‹äº† if (backlog == 0 || (dispatcher != null \u0026amp;\u0026amp; dispatcher.isConsumerConnected() \u0026amp;\u0026amp; backlog \u0026lt; MINIMUM_BACKLOG_FOR_EXPIRY_CHECK \u0026amp;\u0026amp; !topic.isOldestMessageExpired(cursor, messageTTLInSeconds))) { // don\u0026#39;t do anything for almost caught-up connected subscriptions return false; } this.lastExpireTimestamp = System.currentTimeMillis(); //æ›´æ–°è¿‡æœŸæ¶ˆæ¯çš„ä¸‹æ ‡ï¼Œä»è¿™é‡Œç»§ç»­è·Ÿè¸ª return expiryMonitor.expireMessages(messageTTLInSeconds); } public boolean expireMessages(int messageTTLInSeconds) { .... // è¿™é‡Œè¿›å»è¿›è¡Œè¿‡æœŸæ£€æŸ¥ checkExpiryByLedgerClosureTime(cursor, messageTTLInSeconds); .... } private void checkExpiryByLedgerClosureTime(ManagedCursor cursor, int messageTTLInSeconds) { //å‚æ•°æ ¡éªŒï¼Œå¯æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆåˆåšäº†å°äº0çš„åˆ¤æ–­ï¼Œè€Œå¤–å±‚åªåˆ¤æ–­äº†ç­‰äº0ï¼Œå¯å¦ç”¨ç»Ÿä¸€çš„å‚æ•°æ ¡éªŒå·¥å…·è¿›è¡Œæ ¡éªŒå‘¢ï¼Ÿ if (messageTTLInSeconds \u0026lt;= 0) { return; } if (cursor instanceof ManagedCursorImpl managedCursor) { ManagedLedgerImpl managedLedger = (ManagedLedgerImpl) managedCursor.getManagedLedger(); //è·å¾—æ¸¸æ ‡å½“å‰æ ‡è®°çš„å¯åˆ é™¤ä½ç½® Position deletedPosition = managedCursor.getMarkDeletedPosition(); //è·å–å½“å‰æœªè¢«æˆåŠŸæ¶ˆè´¹çš„ç§¯å‹æ—¥å¿—ä¿¡æ¯ï¼ŒæŒ‰Ledgerè¿›è¡Œæ’åº SortedMap\u0026lt;Long, MLDataFormats.ManagedLedgerInfo.LedgerInfo\u0026gt; ledgerInfoSortedMap = managedLedger.getLedgersInfo().subMap(deletedPosition.getLedgerId(), true, managedLedger.getLedgersInfo().lastKey(), true); MLDataFormats.ManagedLedgerInfo.LedgerInfo info = null; // æŸ¥è¯¢æœ€æ¥è¿‘ç°åœ¨çš„ç¬¬ä¸€ä¸ªæœªè¿‡æœŸLedgerï¼Œé‚£ä¹ˆå…¶ä¸Šä¸€ä¸ªLedgerä¸€å®šæ˜¯è¿‡æœŸçš„å¹¶ä¸”å…¶ä¹‹å‰çš„éƒ½æ˜¯è¿‡æœŸçš„ for (MLDataFormats.ManagedLedgerInfo.LedgerInfo ledgerInfo : ledgerInfoSortedMap.values()) { if (!ledgerInfo.hasTimestamp() || !MessageImpl.isEntryExpired(messageTTLInSeconds, ledgerInfo.getTimestamp())) { break; } info = ledgerInfo; } //å¦‚æœinfoä¸ä¸ºç©ºè¯´æ˜ä¸€å®šå­˜åœ¨å·²ç»å¤„äºè¿‡æœŸçš„Ledgerä¹Ÿå°±æ˜¯è¿‡æœŸçš„æ¶ˆæ¯é›†åˆä½“ if (info != null \u0026amp;\u0026amp; info.getLedgerId() \u0026gt; -1) { //è·å–å…·ä½“è¿‡æœŸçš„ä½ç½® PositionImpl position = PositionImpl.get(info.getLedgerId(), info.getEntries() - 1); if (((PositionImpl) managedLedger.getLastConfirmedEntry()).compareTo(position) \u0026lt; 0) { findEntryComplete(managedLedger.getLastConfirmedEntry(), null); } else { //è¿™é‡Œè¿›å»æ£€æŸ¥è¿‡æœŸä½ç½® findEntryComplete(position, null); } } } } é€šè¿‡ä¸Šé¢çš„ä»£ç è·Ÿè¸ªå¯ä»¥çœ‹åˆ°åœ¨è·å–åˆ°è¿‡æœŸçš„æ¶ˆæ¯ä½ç½®åï¼Œæœ€ç»ˆè°ƒç”¨äº†PersistentMessageExpiryMonitorç±»çš„findEntryCompleteæ–¹æ³•ï¼Œé‚£ä¹ˆå’±ä»¬æ¥ä¸‹æ¥è·Ÿç€è¿›å»çœ‹çœ‹éƒ½å‘ç”Ÿäº†å“ªäº›æœ‰æ„æ€çš„äº‹æƒ…å§\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 public void findEntryComplete(Position position, Object ctx) { ....\t//é€šè¿‡æ–¹æ³•å‘½åå¯ä»¥æ¨æµ‹æ˜¯é€šè¿‡æ ‡è®°æ¸¸æ ‡çš„åˆ é™¤ä½ç½®åˆ°è¾¾åˆ°TTLçš„æ•ˆæœï¼Œç»§ç»­è·Ÿè¸ªè¿›å»çœ‹çœ‹ cursor.asyncMarkDelete(position, cursor.getProperties(), markDeleteCallback, cursor.getNumberOfEntriesInBacklog(false)); .... } public void asyncMarkDelete(final Position position, Map\u0026lt;String, Long\u0026gt; properties, final MarkDeleteCallback callback, final Object ctx) { .... //å¼‚æ­¥æ ‡è®°åˆ é™¤ä½ç½® internalAsyncMarkDelete(newPosition, properties, callback, ctx); } protected void internalAsyncMarkDelete(final PositionImpl newPosition, Map\u0026lt;String, Long\u0026gt; properties, final MarkDeleteCallback callback, final Object ctx) { .... synchronized (pendingMarkDeleteOps) { switch (STATE_UPDATER.get(this)) { .... case Open: if (PENDING_READ_OPS_UPDATER.get(this) \u0026gt; 0) { pendingMarkDeleteOps.add(mdEntry); } else { //è¿›è¡Œæ ‡è®°åˆ é™¤ internalMarkDelete(mdEntry); } break; .... } } } void internalMarkDelete(final MarkDeleteEntry mdEntry) { .... //æŒä¹…åŒ–æ¸¸æ ‡ä¿¡æ¯åˆ°Bookkeeper persistPositionToLedger(cursorLedger, mdEntry, cb); } void persistPositionToLedger(final LedgerHandle lh, MarkDeleteEntry mdEntry, final VoidCallback callback) { PositionImpl position = mdEntry.newPosition; PositionInfo pi = PositionInfo.newBuilder().setLedgerId(position.getLedgerId()) .setEntryId(position.getEntryId()) .addAllIndividualDeletedMessages(buildIndividualDeletedMessageRanges()) .addAllBatchedEntryDeletionIndexInfo(buildBatchEntryDeletionIndexInfoList()) .addAllProperties(buildPropertiesMap(mdEntry.properties)).build(); .... requireNonNull(lh); byte[] data = pi.toByteArray(); //è°ƒç”¨Bookkeeperå®¢æˆ·ç«¯å°†æ¸¸æ ‡ä¿¡æ¯å†™å…¥ lh.asyncAddEntry(data, (rc, lh1, entryId, ctx) -\u0026gt; { .... }, null); } é€šè¿‡ä¸Šé¢çš„è·Ÿè¸ªå¯ä»¥çœ‹å¾—åˆ°æœ€ç»ˆæ˜¯é€šè¿‡Bookkeeperçš„å®¢æˆ·ç«¯å¯¹è±¡LedgerHandleçš„asyncAddEntryæ–¹æ³•å°†æ¸¸æ ‡ä¿¡æ¯æŒä¹…åŒ–åˆ°äº†Bookkeeperï¼Œè¿™é‡Œå°±ä¸ç»§ç»­è·Ÿè¸ªä¸‹å»äº†ï¼Œå› ä¸ºå·²ç»åˆ°äº†TTLå·¦å³èŒƒå›´çš„å°½å¤´äº†ã€‚\næ€»ç»“ ä»¥ä¸Šå°±æ˜¯Pulsarä¸­TTLçš„å®ç°æºç æµç¨‹ï¼Œæˆ‘åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å°½é‡çœç•¥äº†ä¸€äº›éå¿…è¦çš„é€»è¾‘ï¼Œä¸»è¦æ˜¯è·Ÿè¸ªäº†ä¸»çº¿ï¼Œåƒä¸€äº›åœ°æ–¹ä¹Ÿæ˜¯å€¼å¾—è·Ÿè¸ªçš„ï¼Œæ„Ÿå…´è¶£çš„ä¼™ä¼´å¯ä»¥è‡ªè¡Œè·Ÿè¸ªã€‚åŒæ—¶åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒTTLè¿‡ç¨‹åªç§»åŠ¨äº†æ¸¸æ ‡ä½ç½®å¹¶ä¸æ¶‰åŠåˆ°æ•°æ®çš„åˆ é™¤ï¼Œè¯´æ˜åœ¨Pulsarçš„è®¾è®¡ä¸­å°†ä¸¤è€…è¿›è¡Œäº†åˆ†ç¦»ï¼Œè¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„èŒè´£è®¾è®¡æ€è·¯ï¼Œå„è‡ªè´Ÿè´£è‡ªå·±çš„ä¸€é‚£éƒ¨åˆ†ã€‚ä¸€æ–¹é¢åœ¨ç¨‹åºç»´æŠ¤æ—¶å¯ä»¥é¿å…æ”¹åŠ¨å¼•èµ·ä¸€äº›ç›¸å…³æ€§ä¸é‚£ä¹ˆå¤§çš„å½±å“ï¼Œå¦ä¸€æ–¹é¢å¯¹äºç¨‹åºæ‰§è¡Œçš„æ•´ä½“æ€§èƒ½æ¥è¯´ä¹Ÿæ˜¯æ¯”è¾ƒé«˜æ•ˆçš„ã€‚\n","date":"2024-04-02T10:34:56+08:00","image":"https://sherlock-lin.github.io/p/pulsar%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B9%8Bttl/image-20240331111412370_hu135517140155982200.png","permalink":"https://sherlock-lin.github.io/p/pulsar%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B9%8Bttl/","title":"Pulsaræºç è§£æä¹‹TTL"},{"content":"å¼•è¨€ ä»»ä½•ä¸œè¥¿éƒ½æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œå°±åƒæ²™ä¸é±¼ç½å¤´ğŸ¥«ä¹Ÿä¼šè¿‡æœŸä¸€æ ·ï¼Œå’±ä»¬çš„æ¶ˆæ¯æœ¬èº«ä¹Ÿæ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå› æ­¤åƒPulsarè¿™æ ·çš„æµå¹³å°/æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæä¾›äº†Retentionã€Backlogå’ŒTTLæœºåˆ¶ã€‚\né»˜è®¤æ¸…ç†æœºåˆ¶ ä»»ä½•æœºåˆ¶çš„å‡ºç°éƒ½æ˜¯æœ‰èƒŒæ™¯çš„ï¼Œå› æ­¤æˆ‘ä»¬è¦å…ˆäº†è§£è¿™ä¸‰ä¸ªæœºåˆ¶å‡ºç°ä¹‹å‰çš„æƒ…å†µï¼Œæ‰èƒ½åˆ†æå‡ºå®ƒä»¬å…·ä½“åˆ†åˆ«è§£å†³çš„äº‹ä»€ä¹ˆé—®é¢˜ã€‚é¦–å…ˆçœ‹ä¸‹å›¾ï¼Œç”Ÿäº§è€…å¾€Brokerä¸æ–­å¾€Brokerä¸­å†™å…¥æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯åœ¨Brokerä¸­ä¼šæŒ‰ç…§é¡ºåºä»å·¦åˆ°å³è¿›è¡Œå­˜å‚¨çš„ï¼Œæ–°å†™å…¥çš„æ¶ˆæ¯æ˜¯ä¸æ–­çš„åœ¨å·¦è¾¹è¿›è¡Œæ–°å¢ã€‚æ¶ˆè´¹è€…ä¹Ÿæ˜¯ä»å³å¾€å·¦è¿›è¡Œæ¶ˆè´¹çš„ï¼Œåœ¨Brokerä¸­ä¼šç»´æŒä¸€ä¸ªæ¸¸æ ‡è®°å½•æ¶ˆè´¹çš„æƒ…å†µï¼Œé€šè¿‡æ­¤æ¸¸æ ‡Brokeræ‰å¯ä»¥å¯¹æ¶ˆæ¯è¿›å»åŒºåˆ†ï¼Œå“ªäº›æ¶ˆæ¯æ˜¯å¯æ¸…ç†å›æ”¶çš„ï¼Œå“ªäº›æ¶ˆæ¯æ˜¯ç›®å‰è¿˜ä¸èƒ½æ¸…ç†å›æ”¶çš„ã€‚è¿™ä¸ªé»˜è®¤æ¸…ç†æœºåˆ¶ç¬¦åˆæˆ‘ä»¬ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯\nRetentionæœºåˆ¶ åœ¨å’±ä»¬ç†è§£äº†é»˜è®¤æ¸…ç†æœºåˆ¶æ—¶ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸ªç–‘é—®ğŸ¤”ï¸ï¼Œå¦‚æœæ¶ˆæ¯ä¸€è¢«æˆåŠŸæ¶ˆè´¹å°±è¢«åˆ é™¤ï¼Œé‚£ä¹ˆå¦‚æœBrokerçš„ä¸‹æ¸¸å¤„ç†æœ‰é—®é¢˜éœ€è¦ä»å¤´æ¶ˆè´¹æˆ–è€…ä»æŒ‡å®šçš„æŸä¸ªä½ç½®æ¶ˆè´¹çš„è¯ï¼Œç›®å‰çš„æ¸…ç†æœºåˆ¶æ˜¯å®Œæˆæ²¡åŠæ³•æ”¯æŒçš„ã€‚è€ŒPulsarè®¾è®¡çš„ç›®æ ‡æ˜¯ä¸€ä¸ªå¤§ä¸€ç»Ÿçš„æµå¹³å°/æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè‚¯å®šæ˜¯ä¸å…è®¸è¿™ç§æƒ…å†µçš„å‡ºç°ï¼Œå› æ­¤å¼•å…¥äº†Retentionæœºåˆ¶ã€‚\né€šè¿‡ä¸‹å›¾å¯ä»¥çœ‹åˆ°æ¶ˆæ¯å‘å¸ƒè®¢é˜…è¿‡ç¨‹ï¼Œåœ¨é»˜è®¤çš„æ¸…ç†æœºåˆ¶ä¸­æ¸¸æ ‡å³ä¾§çš„æ¶ˆæ¯æ˜¯å…è®¸è¢«åˆ é™¤çš„ï¼Œä½†æ˜¯é…ç½®Retentionçš„æƒ…å†µåˆ™ä¼šæŒ‰ç…§æœºåˆ¶è¿›è¡Œä¿å­˜ä¸€æ®µæ—¶é—´ã€‚è€ŒCursoræ¸¸æ ‡å·¦è¾¹çš„è¿™äº›æ¶ˆæ¯è¡¨ç¤ºè¿˜æ²¡è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œå› æ­¤å³ä¾¿æ²¡æœ‰é…ç½® Retentionæœºåˆ¶è¿™äº›æ¶ˆæ¯ä¹Ÿä¸ä¼šè¢«åˆ é™¤ã€‚Retention æ”¯æŒæ•°æ®å¤§å°ç»´åº¦ä»¥åŠæ—¶é—´ç»´åº¦ä¸¤ç§æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä¸è¿‡å®ƒç›®å‰ä»…æ”¯æŒé’ˆå¯¹Namespaceçº§åˆ«è¿›è¡Œç”Ÿæ•ˆã€‚\nåœ¨è®¾ç½®Retentioæœºåˆ¶æ—¶å¯ä»¥é€šè¿‡defaultRetentionSizeInMBå’ŒdefaultRetentionTimeInMinutesåŒæ—¶è¿›è¡Œé…ç½®ï¼Œæ­¤æ—¶ä¼šæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µ\næ—¶é—´ç»´åº¦ æ–‡ä»¶å¤§å°ä¸ºåº¦ æ¶ˆæ¯ä¿ç•™æ•ˆæœ -1 -1 æ°¸ä¹…ä¿å­˜ -1 \u0026gt;0 åŸºäºæ•°æ®å¤§å°è¿›è¡Œä¿ç•™ \u0026gt;0 -1 åŸºäºæ—¶é—´è¿›è¡Œä¿ç•™ 0 0 é»˜è®¤é…ç½®ï¼Œå½“æ¶ˆæ¯è¢«æ¶ˆè´¹åä¸ä¼šè¢«ä¿ç•™ 0 \u0026gt;0 æ— æ•ˆé…ç½® \u0026gt;0 0 æ— æ•ˆé…ç½® \u0026gt;0 \u0026gt;0 å½“æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹æˆ–è€…æ²¡æœ‰æ¶ˆè´¹è€…è®¢é˜…æ—¶ï¼Œæ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶çš„åˆ™ä¸è¢«ä¿ç•™ Backlog é™é¢æœºåˆ¶ Retentionæœºåˆ¶è§£å†³äº†æ¶ˆæ¯â€œæå‰â€åˆ é™¤çš„é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥é«˜æ•æ— å¿§äº†å—ï¼Ÿè®©æˆ‘ä»¬æ¥æƒ³æƒ³ä¸‹é¢è¿™ç§åœºæ™¯ï¼Œå°±æ˜¯æœªè¢«æˆåŠŸæ¶ˆè´¹çš„æ¶ˆæ¯æ˜¯ä¼šä¸€ç›´ä¿ç•™åœ¨Pulsarä¸­çš„ï¼Œé‚£ä¹ˆå¦‚æœå†™å…¥é€Ÿåº¦ä¸€ç›´è¿œå¤§äºæ¶ˆè´¹é€Ÿåº¦ï¼Œæ˜¯ä¸æ˜¯å°±ç›¸å½“äºä¸€ä¸ªè“„æ°´æ± å…¥æ°´é€Ÿåº¦è¿œå¤§äºå‡ºæ°´é€Ÿåº¦ï¼Œæœ€ç»ˆè¿™ä¸ªæ± å­ä¼šæ»¡ä¸€æ ·ï¼ŒPulsarçš„ç£ç›˜ä¹Ÿä¼šè¢«æ‰“æ»¡ä»è€Œå½±å“æœåŠ¡çš„ç¨³å®šæ€§ã€‚\nBacklogçš„åŸç†å…¶å®ä¸å¤æ‚ï¼Œç›¸å½“äºåœ¨è“„æ°´æ± ä¸­æ ‡è®°ä¸€ä¸ªæ°´ä½çº¿ï¼Œå½“è“„æ°´æ± çš„é«˜åº¦åˆ°è¾¾è¿™æ¡æ°´ä½çº¿æ—¶åˆ™è§¦å‘æŠ¥è­¦ï¼Œå·¥ä½œäººå‘˜æ ¹æ®è¿™ä¸ªæŠ¥è­¦æ¥åšå‡ºç›¸å¯¹åº”çš„å¤„ç†ã€‚Pulsarå…¶å®ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå‡å¦‚æˆ‘ä»¬é…ç½®Backlogé™é¢çš„å¤§å°æ˜¯ä¸¤æ¡æ¶ˆæ¯çš„å¤§å°ï¼Œé‚£ä¹ˆå¦‚ä¸‹å›¾ï¼Œæ­¤æ—¶å¦‚æœå·²ç»æœ‰ä¸¤æ¡æ¶ˆæ¯æœªè¢«æ¶ˆè´¹ï¼Œå†æœ‰ä¸€æ¡æ–°çš„æ¶ˆæ¯è¿›è¡Œå°è¯•å†™å…¥ï¼Œå°±ä¼šè§¦å‘Pulsarçš„æŠ¥è­¦ç­–ç•¥è¿›è¡Œå¤„ç†ã€‚\nç§¯å‹è­¦æŠ¥ç­–ç•¥æœ‰ä»¥ä¸‹ä¸‰ç§\nproducer_request_holdï¼šç”Ÿäº§è€…ä¼šæš‚æ—¶ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¹¶åœ¨ä¹‹åé‡æ–°è¿›è¡Œæ¶ˆæ¯å‘é€ producer_exceptionï¼šå‘ç”Ÿäº§è€…æŠ›å‡ºå¼‚å¸¸ï¼Œè®©ç”Ÿäº§è€…è¿›è¡Œå¤„ç†å¦‚åœæ­¢æˆ–æš‚åœå¾€Pulsarè¿›è¡Œæ¶ˆæ¯çš„å†™å…¥ consumer_backlog_evictionï¼šBrokerä¼šæ¸…ç†ä¸€äº›ç§¯å‹çš„æ•°æ® Backlog æœºåˆ¶æ˜¯é’ˆå¯¹Namespaceçº§åˆ«é™é¢ï¼ŒåŒæ ·æ˜¯æ”¯æŒé€šè¿‡æ•°æ®å¤§å°ä»¥åŠæ—¶é—´ä¸¤ç§ç»´åº¦é…ç½®ã€‚\nTime to live (TTL) çœ‹èµ·æ¥Retentionå’ŒBacklogæœºåˆ¶å·²ç»åŸºæœ¬æ»¡è¶³æˆ‘ä»¬çš„ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆä¸ºå•¥è¿˜è¦åŠ ä¸€ä¸ªTTLå‘¢ï¼Ÿæ˜¯ç¤¾åŒºé—²ç€æ²¡äº‹å¹²æ•´é‚£ä¹ˆå¤šä¸œè¥¿å—ï¼Œç­”æ¡ˆæ˜¾ç„¶ä¸æ˜¯çš„ã€‚æˆ‘ä»¬å†æ¥æƒ³æƒ³ç”Ÿæ´»ä¸­çš„æŸäº›åœºæ™¯ï¼Œå¦‚æœåœ¨æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸­æ¶ˆæ¯æ˜¯æœ‰æ—¶æ•ˆæ€§çš„ï¼Œä¾‹å¦‚è‚¡ç¥¨æœ€æ–°çš„ä»·æ ¼ï¼Œå¦‚æœè¿™ä¸ªä»·æ ¼ä¿¡æ¯æ˜¯é€šè¿‡Pulsarè¿›è¡Œä¼ é€’çš„ï¼Œé‚£ä¹ˆå¦‚æœè¿™æ¡æ¶ˆæ¯åŠæ—¶æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œåœ¨10åˆ†é’Ÿåå®ƒçš„ä»·å€¼ç†è®ºä¸Šå°±æ²¡æœ‰é‚£ä¹ˆé«˜äº†ï¼Œå› ä¸ºè¿˜ä¼šæœ‰æºæºä¸æ–­çš„æœ€æ–°ä»·æ ¼ä¿¡æ¯å†™å…¥Pulsarï¼Œè€Œç”¨æˆ·æ›´åŠ å…³å¿ƒçš„æ˜¯æœ€æ–°çš„ä»·æ ¼ã€‚å› æ­¤æ ¹æ®ä¸šåŠ¡åœºæ™¯ç»™æ¶ˆæ¯é…ç½®ä¸ŠTTLï¼Œå¯ä»¥æ›´æœ‰åˆ©äºPulsarè¿›è¡Œæ¶ˆæ¯çš„å›æ”¶ä»¥åŠèµ„æºçš„é‡Šæ”¾ã€‚é€šè¿‡ä¸‹å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªâ€œèœ¡çƒ›â€æ ‡è®°å®ƒçš„ç”Ÿå‘½å‘¨æœŸ\nå½“è¿™æ¡æ¶ˆæ¯ä¸Šé¢çš„èœ¡çƒ›ç‡ƒå°½æ—¶ï¼Œå³ä¾¿è¿™æ¡æ¶ˆæ¯è¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œæ¸¸æ ‡ä¾ç„¶ä¼šç§»åŠ¨åˆ°å®ƒå·¦è¾¹å°†å…¶æ ‡è®°ä¸ºå…è®¸è¢«åˆ é™¤ï¼Œå› ä¸ºæ­¤æ—¶å¯¹äºä¸šåŠ¡æ¥è¯´è¿™æ¡æ¶ˆæ¯å·²ç»å±äºæ²¡æœ‰ä»·å€¼ï¼Œæ²¡æœ‰åœ¨Pulsarç»§ç»­ä¿ç•™çš„å¿…è¦ã€‚å¯ä»¥çœ‹åˆ°è¿™ç§æ–¹å¼ç›¸æ¯”Backlogçš„æ–¹å¼æ›´åŠ ç¨³å¦¥ï¼Œå› ä¸ºè¿™ä¸ä¾èµ–äºæ¶ˆè´¹è€…çš„æ¶ˆè´¹æƒ…å†µ\nç»¼åˆ å¯¹äºPulsarå­˜å‚¨è€Œè¨€ï¼ŒBacklogå’ŒTTLæœºåˆ¶å¯ä»¥é˜²æ­¢ç£ç›˜è¢«è€—å°½ï¼›è€ŒRetentionæœºåˆ¶ä¼šå ç”¨ç£ç›˜æ¥ä¿ç•™æœªæ¥å¯èƒ½è¿˜ä¼šç”¨åˆ°çš„æ¶ˆæ¯ã€‚ å¯¹äºå½±å“èŒƒå›´è€Œè¨€ï¼ŒRetentionæœºåˆ¶ä»…é’ˆå¯¹å·²ç»æˆåŠŸæ¶ˆè´¹çš„æ¶ˆæ¯ï¼ŒBacklogå’ŒTTLä»…é’ˆå¯¹æœªè¢«æˆåŠŸæ¶ˆè´¹çš„æ¶ˆæ¯ã€‚ æ•´ä½“æµç¨‹å°±æ˜¯ï¼Œåœ¨è¿‡äº†Retentioné…ç½®çš„æ—¶é—´ï¼Œå·²è¢«æˆåŠŸæ¶ˆè´¹çš„æ¶ˆæ¯å°±ä¼šè¢«åˆ é™¤ï¼›å¦‚æœPulsarçš„æ¶ˆæ¯è¶…è¿‡äº†Backlogé™é¢åˆ™Pulsarä¼šåœæ­¢æ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ç›´åˆ°æœ‰æ›´å¤šå¯ç”¨çš„ç©ºé—´ï¼Œå› æ­¤é’ˆå¯¹æ¶ˆæ¯æ•°æ®é…ç½®TTLæ˜¯å¯ä»¥éå¸¸å¥½çš„ä¿æŠ¤Backlogé™é¢çš„ã€‚ Pulsarç‰©ç†å­˜å‚¨çš„å¤§å°åº”è¯¥æ»¡è¶³Retentionå’ŒBacklogçš„æ€»å’Œï¼Œåœ¨è®¾è®¡é›†ç¾¤æ—¶åº”è¯¥æŠŠæ¶ˆæ¯éœ€è¦ä¿ç•™å¤šä¹…ã€å…è®¸å¤šå°‘ç§¯å‹ç­‰è€ƒè™‘è¿›å»ã€‚ é™¤æ­¤ä¹‹å¤–Pulsaræ”¯æŒåˆ†å±‚å­˜å‚¨ï¼Œä¼šå°†å†·æ•°æ®è¿ç§»åˆ°æ›´åŠ å»‰ä»·çš„å¤–éƒ¨ç³»ç»Ÿä¸­å­˜å‚¨ï¼Œæ­¤æ—¶é…ç½®çš„ç­–ç•¥ä¼šä¾ç„¶æœ‰æ•ˆï¼Œå› æ­¤åº”è¯¥è€ƒè™‘å…¨é¢ã€‚ ä»¥ä¸Šå°±æ˜¯Pulsar Retentionã€Backlogå’ŒTTLæœºåˆ¶çš„æ ¸å¿ƒï¼Œå¯ä»¥æ»¡è¶³æµå¹³å°/æ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯\nå‚è€ƒèµ„æ–™ å®˜æ–¹æ–‡æ¡£\nUnderstanding Pulsar Message TTL, Backlog, and Retention\nApache Pulsar ä¹‹ TTL ä¸ Retention ç­–ç•¥\n","date":"2024-04-01T10:34:57+08:00","image":"https://sherlock-lin.github.io/p/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3pulsar%E7%9A%84%E6%B6%88%E6%81%AF%E4%BF%9D%E7%95%99%E7%A7%AF%E5%8E%8Bttl%E7%AD%96%E7%95%A5%E5%90%97/image-20240331085922332_hu13280254660255972346.png","permalink":"https://sherlock-lin.github.io/p/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3pulsar%E7%9A%84%E6%B6%88%E6%81%AF%E4%BF%9D%E7%95%99%E7%A7%AF%E5%8E%8Bttl%E7%AD%96%E7%95%A5%E5%90%97/","title":"ä½ çœŸçš„äº†è§£Pulsarçš„æ¶ˆæ¯ä¿ç•™ã€ç§¯å‹ã€TTLç­–ç•¥å—"},{"content":"å¼•è¨€ ä»Šå¤©ä¸€èµ·æ¥çœ‹çœ‹PulsaræœåŠ¡ç«¯æ¶ˆæ¯ç›¸å…³æœ€é‡è¦çš„ä¸€ä¸ªç±»PersistentTopicï¼Œçœ‹çœ‹å®ƒéƒ½è´Ÿè´£å“ªäº›äº‹æƒ…ä»¥åŠæ˜¯å¦‚ä½•è®¾è®¡çš„\næ­£æ–‡ åœ¨Topicè¢«åˆ›å»ºæ—¶ï¼ŒPulsaré›†ç¾¤ä¸­ä¼šæœ‰ä¸€å°Brokerç»´æŠ¤è¿™ä¸ªTopicï¼Œåœ¨å®ç°ä¸Šå°±æ˜¯ç»´æŠ¤ä¸€ä¸ªPersistentTopicå¯¹è±¡ï¼Œè¿™ä¸ªPersistentTopicå¯¹è±¡å¤„ç†é’ˆå¯¹è¯¥Topicç›¸å…³çš„ä¸€åˆ‡æ“ä½œï¼Œå…·ä½“è´Ÿè´£çš„ç›¸å…³æ“ä½œå¦‚ä¸‹\nå¤„ç†è®¢é˜…ä»¥åŠä¸‹çº¿è®¢é˜… æ–°å¢ç”Ÿäº§è€…å¯¹è±¡ä»¥åŠä¸‹çº¿ç”Ÿäº§è€…å¯¹è±¡ å¤„ç†æ¶ˆæ¯å†™å…¥ è¿›è¡Œè·¨é›†ç¾¤å¤åˆ¶ è®°å½•Topicåº¦é‡çŠ¶æ€ä»¥åŠåšTopicé™æµ æ£€æŸ¥æ¶ˆæ¯çš„TTLã€ç§¯å‹ã€å‹ç¼©ã€é…ç½®ç­–ç•¥æ›´æ–° ç»˜æˆè¡¨æ ¼çš„å½¢å¼å¦‚ä¸‹å›¾\næœ¬ç¯‡æ–‡ç« ä¸ä¼šæ·±å…¥è®²è§£æ¯ä¸€é¡¹ï¼Œä¸»è¦æ˜¯å¤§æ¦‚è¿‡ä¸‹è¿™ä¸ªç±»éƒ½åšäº†å“ªäº›äº‹æƒ…ä»¥åŠå¤§è‡´é€»è¾‘ï¼Œå› ä¸ºæœåŠ¡ç«¯çš„ä»£ç ä¼šç»å¸¸è·Ÿè¿™ä¸ªç±»æ‰“äº¤é“ï¼Œå› æ­¤ä¸“é—¨å¼„æ¸…æ¥šè¿™ä¸ªç±»çš„ç›¸å…³çŸ¥è¯†è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬å¸¦ç€ä»¥ä¸‹ä¸‰ä¸ªç–‘é—®å»çœ‹ä¸‹é¢çš„å†…å®¹\nPersistentTopicåœ¨ä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ›å»ºï¼Ÿéƒ½æœ‰å“ªäº›é‡è¦çš„æˆå‘˜å˜é‡ï¼Ÿ PersistentTopicçš„åˆ›å»ºæµç¨‹éƒ½ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ä¸Šé¢é‚£äº›ç›¸å…³æ“ä½œå¤§æ¦‚æ˜¯ä»€ä¹ˆå®ç°çš„ï¼Ÿ ä½•æ—¶åˆ›å»º ä»¥ä¸‹åˆ—å‡ºåˆ›å»ºçš„æ—¶æœºï¼ŒåŸºæœ¬ä¸Šæµç¨‹éƒ½æ˜¯å‘èµ·åˆ›å»ºTopicçš„æ—¶å€™ä¼šé€šè¿‡ä¸€è‡´æ€§å“ˆå¸Œè®¡ç®—å‡ºè¿™ä¸ªTopicæ‰€å½’å±çš„Bundleï¼Œç„¶åå»zookeeperè·å–è¿™ä¸ªBundleæ‰€å½’å±çš„Brokeræœºå™¨ï¼Œæœ€åè¯·æ±‚è¿™å°BrokerèŠ‚ç‚¹åˆ›å»ºå¯¹åº”çš„PersistentTopicå¯¹è±¡\nç®¡ç†æµåˆ›å»º cliç®¡ç†å‘½ä»¤è¡Œ å¤šè¯­è¨€Client Httpæ–¹å¼ å†™å…¥æµåˆ›å»º ç”Ÿäº§è€…å†™å…¥æµ æ¶ˆè´¹è€…å†™å…¥æµ æ¥ä¸‹æ¥çœ‹çœ‹è¿™ä¸ªç±»çš„ä¸»è¦æˆå‘˜å˜é‡ï¼Œé‡è¦çš„ä¸€äº›å·²ç»åŠ ä¸Šæ³¨é‡Šè§£é‡Šäº†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 public class PersistentTopic extends AbstractTopic implements Topic, AddEntryCallback { // ç®¡ç†Bookkeeperçš„Ledgerï¼Œåœ¨åšæ¶ˆæ¯è¯»å–æˆ–è€…å†™å…¥æ—¶ä¼šé€šè¿‡è¯¥å¯¹è±¡ protected final ManagedLedger ledger; // å­˜å‚¨è®¢é˜…å½“å‰Topicçš„æ‰€æœ‰è®¢é˜…å¯¹è±¡ï¼Œkeyæ˜¯è®¢é˜…åï¼Œvalueæ˜¯è®¢é˜…å¯¹è±¡ private final ConcurrentOpenHashMap\u0026lt;String, PersistentSubscription\u0026gt; subscriptions; // ç®¡ç†å¯¹ç«¯é›†ç¾¤ï¼Œè´Ÿè´£åšè·¨é›†ç¾¤æ•°æ®å¤åˆ¶ private final ConcurrentOpenHashMap\u0026lt;String/*RemoteCluster*/, Replicator\u0026gt; replicators; //è·Ÿreplicatorsç±»ä¼¼ private final ConcurrentOpenHashMap\u0026lt;String/*ShadowTopic*/, Replicator\u0026gt; shadowReplicators; @Getter private volatile List\u0026lt;String\u0026gt; shadowTopics; private final TopicName shadowSourceTopic; //è°ƒåº¦é™æµå™¨ private Optional\u0026lt;DispatchRateLimiter\u0026gt; dispatchRateLimiter = Optional.empty(); //è°ƒåº¦é™æµé” private final Object dispatchRateLimiterLock = new Object(); //è®¢é˜…é™æµå™¨ private Optional\u0026lt;SubscribeRateLimiter\u0026gt; subscribeRateLimiter = Optional.empty(); //ç§¯å‹æ¸¸æ ‡é˜ˆå€¼æ¡æ•° private final long backloggedCursorThresholdEntries; public static final int MESSAGE_RATE_BACKOFF_MS = 1000; //å¤„ç†æ¶ˆæ¯é‡å¤æƒ…å†µ protected final MessageDeduplication messageDeduplication; //å¤„ç†æ¶ˆæ¯å‹ç¼©æœåŠ¡ private TopicCompactionService topicCompactionService; // åœ¨å¯¹å¤–å¼€æ”¾å‹ç¼©ç­–ç•¥é…ç½®æ—¶ï¼Œæ ¹æ®ç”¨æˆ·é…ç½®åˆ›å»ºå¯¹åº”çš„å‹ç¼©ç­–ç•¥ private static Map\u0026lt;String, TopicCompactionStrategy\u0026gt; strategicCompactionMap = Map.of( ServiceUnitStateChannelImpl.TOPIC, new ServiceUnitStateCompactionStrategy()); //æœªçŸ¥ private CompletableFuture\u0026lt;MessageIdImpl\u0026gt; currentOffload = CompletableFuture.completedFuture( (MessageIdImpl) MessageId.earliest); //è´Ÿè´£è·¨é›†ç¾¤å¤åˆ¶æ—¶è®¢é˜…ç›¸å…³äº‹é¡¹ private volatile Optional\u0026lt;ReplicatedSubscriptionsController\u0026gt; replicatedSubscriptionsController = Optional.empty(); //è®°å½•Topicåº¦é‡ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è¿™ä¸ªTopicçš„å†™å…¥é€Ÿç‡ã€æ¶ˆè´¹é€Ÿç‡ç­‰ private static final FastThreadLocal\u0026lt;TopicStatsHelper\u0026gt; threadLocalTopicStats = new FastThreadLocal\u0026lt;TopicStatsHelper\u0026gt;() { @Override protected TopicStatsHelper initialValue() { return new TopicStatsHelper(); } }; } åˆ›å»ºæµç¨‹ åˆ›å»ºæµç¨‹ä¸»è¦åˆ†ä¸ºæ„å»ºå’Œåˆå§‹åŒ–ä¸¤ä¸ªé˜¶æ®µï¼Œä¸€èˆ¬æ˜¯å…ˆé€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºPersistentTopicï¼Œåˆ›å»ºå¥½ååœ¨è°ƒç”¨å…¶initializeæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–\næ„é€ å‡½æ•° æ„é€ å‡½æ•°ä¸»è¦åšä¸‰ä»¶äº‹ï¼š1. æ›´æ–°Brokerçº§åˆ«ç­–ç•¥ 2. åˆ›å»ºå‘å¸ƒé™æµ 3. åˆå§‹åŒ–å®¹å™¨ã€‚å…·ä½“ä»£ç å®ç°å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 public AbstractTopic(String topic, BrokerService brokerService) { //åŸºæœ¬éƒ½æ˜¯èµ‹å€¼æ“ä½œ this.topic = topic; this.brokerService = brokerService; this.producers = new ConcurrentHashMap\u0026lt;\u0026gt;(); this.isFenced = false; ServiceConfiguration config = brokerService.pulsar().getConfiguration(); this.replicatorPrefix = config.getReplicatorPrefix(); topicPolicies = new HierarchyTopicPolicies(); updateTopicPolicyByBrokerConfig(); this.lastActive = System.nanoTime(); this.preciseTopicPublishRateLimitingEnable = config.isPreciseTopicPublishRateLimiterEnable(); //åˆ›å»ºå‘å¸ƒé™æµ topicPublishRateLimiter = new PublishRateLimiterImpl(brokerService.getPulsar().getMonotonicSnapshotClock()); //æ›´æ–°é™æµç­–ç•¥ updateActiveRateLimiters(); } public PersistentTopic(String topic, ManagedLedger ledger, BrokerService brokerService) { super(topic, brokerService); //èµ‹å€¼æ“ä½œ this.orderedExecutor = brokerService.getTopicOrderedExecutor() != null ? brokerService.getTopicOrderedExecutor().chooseThread(topic) : null; this.ledger = ledger; //åˆå§‹åŒ–å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯ç»´æŠ¤å½“å‰Topicçš„è®¢é˜…æƒ…å†µã€è·¨é›†ç¾¤å‰¯æœ¬æƒ…å†µ this.subscriptions = ConcurrentOpenHashMap.\u0026lt;String, PersistentSubscription\u0026gt;newBuilder() .expectedItems(16) .concurrencyLevel(1) .build(); this.replicators = ConcurrentOpenHashMap.\u0026lt;String, Replicator\u0026gt;newBuilder() .expectedItems(16) .concurrencyLevel(1) .build(); this.shadowReplicators = ConcurrentOpenHashMap.\u0026lt;String, Replicator\u0026gt;newBuilder() .expectedItems(16) .concurrencyLevel(1) .build(); this.backloggedCursorThresholdEntries = brokerService.pulsar().getConfiguration().getManagedLedgerCursorBackloggedThreshold(); .... } initializeæ–¹æ³• åˆå§‹åŒ–æ–¹æ³•çš„é€»è¾‘ç›¸æ¯”ä¸‹è¦ä¸°å¯Œå†™ï¼Œå½’çº³èµ·æ¥æœ‰ä»¥ä¸‹å››ç‚¹\nè·å–å‹ç¼©æœåŠ¡\né€šè¿‡åŒé‡åˆ¤æ–­è·å–å•ä¾‹TwoPhaseCompactorè¿›è¡Œå‹ç¼©ï¼Œæœ‰ä¸“é—¨çš„çº¿ç¨‹æ± è¿›è¡Œå¤„ç†å‹ç¼©åŠ¨ä½œ\néå†æ¸¸æ ‡æ¢å¤è®¢é˜…çš„çŠ¶æ€\nå½“Topicé‡æ–°åˆ†é…åï¼Œåœ¨æ–°çš„Brokerä¸­è¦æ ¹æ®æ¸¸æ ‡æ¢å¤è®¢é˜…ã€è·¨é›†ç¾¤å¤åˆ¶çš„çŠ¶æ€ï¼Œè¿™æ ·æ‰èƒ½è®©å®¢æˆ·ç«¯â€œæ— æ„Ÿâ€\nè·¨é›†ç¾¤å¤åˆ¶\néå†è¿™ä¸ªTopicçš„æ¸¸æ ‡ï¼Œå¦‚æœæ¸¸æ ‡ä¸­å­˜åœ¨è·¨é›†ç¾¤å¤åˆ¶æ¸¸æ ‡åˆ™åˆ›å»ºå¯¹åº”çš„GeoPersistentReplicatorå¯¹è±¡è¿›è¡Œæ¶ˆæ¯çš„å¤åˆ¶\næ›´æ–°é…ç½®\næ›´æ–°Topicå‘½åç©ºé—´çš„é…ç½®ç­–ç•¥ åˆå§‹åŒ–è°ƒåº¦é™æµDispatchRateLimiter æ›´æ–°è®¢é˜…/å‘å¸ƒ/èµ„æºç»„é™æµ æ›´æ–°Topicçº§åˆ«çš„é…ç½® å…·ä½“ä»£ç å®ç°å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 public CompletableFuture\u0026lt;Void\u0026gt; initialize() { List\u0026lt;CompletableFuture\u0026lt;Void\u0026gt;\u0026gt; futures = new ArrayList\u0026lt;\u0026gt;(); //è·å–Brokerå‹ç¼©å¯¹è±¡ futures.add(brokerService.getPulsar().newTopicCompactionService(topic) .thenAccept(service -\u0026gt; { PersistentTopic.this.topicCompactionService = service; //éå†è¿™ä¸ªTopicçš„æ¸¸æ ‡æ¢å¤è®¢é˜…ä¸­çš„å¯¹è±¡ this.createPersistentSubscriptions(); })); //éå†è¿™ä¸ªTopicçš„æ¸¸æ ‡ï¼Œå¦‚æœæ¸¸æ ‡ä¸­å­˜åœ¨è·¨é›†ç¾¤å¤åˆ¶æ¸¸æ ‡åˆ™åˆ›å»ºå¯¹åº”çš„GeoPersistentReplicatorå¯¹è±¡è¿›è¡Œæ¶ˆæ¯çš„å¤åˆ¶ for (ManagedCursor cursor : ledger.getCursors()) { if (cursor.getName().startsWith(replicatorPrefix)) { String localCluster = brokerService.pulsar().getConfiguration().getClusterName(); String remoteCluster = PersistentReplicator.getRemoteCluster(cursor.getName()); futures.add(addReplicationCluster(remoteCluster, cursor, localCluster)); } } return FutureUtil.waitForAll(futures).thenCompose(__ -\u0026gt; brokerService.pulsar().getPulsarResources().getNamespaceResources() .getPoliciesAsync(TopicName.get(topic).getNamespaceObject()) .thenAcceptAsync(optPolicies -\u0026gt; { if (!optPolicies.isPresent()) { isEncryptionRequired = false; updatePublishDispatcher(); //è¿›è¡Œèµ„æºç»„çº§åˆ«çš„éš”ç¦» updateResourceGroupLimiter(new Policies()); initializeDispatchRateLimiterIfNeeded(); updateSubscribeRateLimiter(); return; } Policies policies = optPolicies.get(); //æ›´æ–°å‘½åç©ºé—´çº§åˆ«çš„ç­–ç•¥ this.updateTopicPolicyByNamespacePolicy(policies); //åˆå§‹åŒ–è°ƒåº¦é™æµ initializeDispatchRateLimiterIfNeeded(); //æ›´æ–°è®¢é˜…é™æµ updateSubscribeRateLimiter(); //æ›´æ–°å‘å¸ƒé™æµ updatePublishDispatcher(); //æ›´æ–°èµ„æºç»„é™æµ updateResourceGroupLimiter(policies); this.isEncryptionRequired = policies.encryption_required; isAllowAutoUpdateSchema = policies.is_allow_auto_update_schema; }, getOrderedExecutor()) .thenCompose(ignore -\u0026gt; initTopicPolicy()) .exceptionally(ex -\u0026gt; { .... })); } è´Ÿè´£å†…å®¹ ç”Ÿäº§è€…ç›¸å…³ æ–°å¢ ç”Ÿäº§è€…å®¢æˆ·ç«¯å¯åŠ¨æ—¶ä¼šè·ŸTopicå½’å±çš„Brokerå»ºç«‹TCPè¿æ¥å¹¶è¯·æ±‚Brokerç«¯ServerCnxçš„handleProduceræ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨PersistentTopicçš„addProduceræ–¹æ³•è¿›è¡Œåˆ›å»ºï¼Œå’±ä»¬æ¥çœ‹çœ‹å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 public CompletableFuture\u0026lt;Optional\u0026lt;Long\u0026gt;\u0026gt; addProducer(Producer producer, CompletableFuture\u0026lt;Void\u0026gt; producerQueuedFuture) { //è¿›å»çœ‹çœ‹çˆ¶ç±»çš„å®ç° return super.addProducer(producer, producerQueuedFuture).thenCompose(topicEpoch -\u0026gt; { messageDeduplication.producerAdded(producer.getProducerName()); // Start replication producers if not already return startReplProducers().thenApply(__ -\u0026gt; topicEpoch); }); } public CompletableFuture\u0026lt;Optional\u0026lt;Long\u0026gt;\u0026gt; addProducer(Producer producer, CompletableFuture\u0026lt;Void\u0026gt; producerQueuedFuture) { .... //ç»§ç»­è·Ÿè¸ª return internalAddProducer(producer); .... } protected CompletableFuture\u0026lt;Void\u0026gt; internalAddProducer(Producer producer) { .... //producersæ˜¯ConcurrentHashMapç»“æ„ï¼Œç›¸å½“äºä¼šåœ¨PersistentTopicä¸­ç»´æŠ¤æœåŠ¡ç«¯çš„ç”Ÿäº§è€…å¯¹è±¡ Producer existProducer = producers.putIfAbsent(producer.getProducerName(), producer); .... return CompletableFuture.completedFuture(null); } åˆ é™¤ åˆ é™¤çš„é€»è¾‘å¾ˆç®€å•ï¼Œä¹Ÿæ˜¯é€šè¿‡TCPæ¥æ”¶åˆ°å®¢æˆ·ç«¯æ–­å¼€è¿æ¥çš„è¯·æ±‚åï¼Œä¼šè°ƒç”¨Producerçš„closeæ–¹æ³•è¿›è¡Œèµ„æºé‡Šæ”¾ï¼ŒåŒæ—¶ä»ç»´æŠ¤çš„producersä¸­ç§»é™¤æ­¤å¯¹è±¡\nè®¢é˜…ç›¸å…³ æ¶ˆè´¹è€…å®¢æˆ·ç«¯å¯åŠ¨æ—¶ä¼šè·ŸTopicå½’å±çš„Brokerå»ºç«‹TCPè¿æ¥å¹¶è¯·æ±‚Brokerç«¯ï¼Œè¯·æ±‚ç”±ServerCnxçš„handleSubscribeæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨PersistentTopicçš„internalSubscribeæ–¹æ³•è¿›è¡Œåˆ›å»ºï¼Œå’±ä»¬æ¥çœ‹çœ‹å®ç°\næ–°å¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 private CompletableFuture\u0026lt;Consumer\u0026gt; internalSubscribe(final TransportCnx cnx, String subscriptionName, long consumerId, SubType subType, int priorityLevel, String consumerName, boolean isDurable, MessageId startMessageId, Map\u0026lt;String, String\u0026gt; metadata, boolean readCompacted, InitialPosition initialPosition, long startMessageRollbackDurationSec, boolean replicatedSubscriptionStateArg, KeySharedMeta keySharedMeta, Map\u0026lt;String, String\u0026gt; subscriptionProperties, long consumerEpoch, SchemaType schemaType) { .... //åˆ›å»ºå¯¹åº”çš„å®¢æˆ·ç«¯å¯¹è±¡ Consumer consumer = new Consumer(subscription, subType, topic, consumerId, priorityLevel, consumerName, isDurable, cnx, cnx.getAuthRole(), metadata, readCompacted, keySharedMeta, startMessageId, consumerEpoch, schemaType); .... //å°†æ¶ˆè´¹è€…å¯¹è±¡åŠ åˆ°è®¢é˜…é‡Œ return addConsumerToSubscription(subscription, consumer); } protected CompletableFuture\u0026lt;Void\u0026gt; addConsumerToSubscription(Subscription subscription, Consumer consumer) { .... //æœ€ç»ˆå°†å°†åˆ›å»ºçš„æ¶ˆè´¹è€…æ”¾åˆ°Dispatcherä¸­è¿›è¡Œç®¡ç†ä»¥åŠåŠ åˆ°subscriptionsè¿™ä¸ªMapä¸­è¿›è¡Œç»´æŠ¤ return subscription.addConsumer(consumer); } åˆ é™¤ åˆ é™¤çš„é€»è¾‘ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå°±æ˜¯ä»subscriptionsä¸­è¿›è¡Œç§»é™¤\nå¤„ç†æ¶ˆæ¯å†™å…¥ æ¶ˆæ¯å†™å…¥çš„æµç¨‹ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œåé¢å†å•ç‹¬åˆ†æï¼Œæš‚æ—¶è·³è¿‡\nè·¨é›†ç¾¤å¤åˆ¶ è·¨é›†ç¾¤å¤åˆ¶è¿™é‡Œå®ç°é€»è¾‘å…¶å®ä¸éš¾ï¼Œç›¸å½“äºåœ¨Brokerä¸Šå»è¯»å–Bookkeeperè·å–æ•°æ®å¹¶é€šè¿‡å¯åŠ¨ç”Ÿäº§è€…å¾€å…¶ä»–é›†ç¾¤è¿›è¡Œæ•°æ®å†™å…¥ï¼Œå…·ä½“ç»†èŠ‚åé¢ä¹Ÿå•ç‹¬å†™æ–‡ç« è¿›è¡Œåˆ†æ\næ¶ˆæ¯æ¸…ç† Pulsarçš„æ¶ˆæ¯TTLã€ç§¯å‹ã€å‹ç¼©éƒ½æ˜¯åœ¨Brokerå¯åŠ¨æ—¶å¾€çº¿ç¨‹æ± ä¸­åŠ å…¥å®šæ—¶ä»»åŠ¡è½®è¯¢è§¦å‘çš„\nTTL TTLä¼šå¾ªç¯æ‰«ææ¯ä¸ªTopicè¿‡æœŸçš„æ¶ˆæ¯ä½ç½®ï¼Œå¹¶é€šè¿‡æ”¹å˜æ¸¸æ ‡è¿›è¡Œæ ‡è®°ï¼Œè€Œæ¸…ç†æ˜¯ç”±ä¸“é—¨çš„çº¿ç¨‹æ ¹æ®æ¸¸æ ‡è¿›è¡Œå¤„ç†çš„\nç§¯å‹ æ¶ˆæ¯ç§¯å‹ä¹Ÿæ˜¯ä¼šå®šæœŸæ£€æµ‹ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯æ¶ˆæ¯è¶…è¿‡é™åˆ¶é¢åº¦ï¼Œå¦ä¸€ç§æ˜¯æ¶ˆæ¯æ—¶é—´è¶…è¿‡é¢åº¦ã€‚è¿™ä¸¤ç§æƒ…å†µéƒ½ä¼šè§¦å‘ç§¯å‹ç­–ç•¥çš„å¤„ç†ï¼Œå…·ä½“çš„ç­–ç•¥åœ¨BacklogQuota.RetentionPolicyä¸­å®šä¹‰\nå‹ç¼© è·Ÿä¸Šé¢ä¸€æ ·ï¼Œè½®è¯¢æ£€æµ‹è¿›è¡Œå¤„ç†\né…ç½®æ›´æ–° åœ¨PersistentTopicå¯åŠ¨çš„åˆå§‹åŒ–initializeæ–¹æ³•ä¸­ä¼šè°ƒç”¨onUpdateè¿›è¡Œç­–ç•¥æ›´æ–°ï¼Œé‚£Pulsaråˆæ˜¯å¦‚ä½•åšçš„æ”¯æŒé…ç½®åŠ¨æ€æ›´æ–°çš„å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜ä¿ç•™ç»™å¤§å®¶\næ€»ç»“ æœ¬æ–‡ä¸»è¦å¼ºè°ƒPersistentTopicç±»çš„é‡è¦æ€§ã€èŠèŠå®ƒéƒ½è´Ÿè´£å“ªäº›äº‹æƒ…ä»¥åŠå¤§æ¦‚å®ç°ï¼Œå…·ä½“æ¯ä¸ªç»†èŠ‚å±•å¼€éƒ½èƒ½å•ç‹¬å†™ä¸€ç¯‡æ–‡ç« ï¼Œè¿™ä¸ªæ•¬è¯·æœŸå¾…ï½\n","date":"2024-03-27T10:34:55+08:00","image":"https://sherlock-lin.github.io/p/pulsar%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B9%8Bpersistenttopic%E7%B1%BB/image-20240327210450901-6219390_hu18382412844183478919.png","permalink":"https://sherlock-lin.github.io/p/pulsar%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B9%8Bpersistenttopic%E7%B1%BB/","title":"Pulsaræºç è§£æä¹‹PersistentTopicç±»"},{"content":"å¤±æ•ˆçš„è‡ªå¾‹ åœ¨äººç”Ÿçš„æ¯ä¸ªé˜¶æ®µï¼Œæˆ‘å¥½åƒéƒ½æœ‰é‡åˆ°é‚£ç§å¤©ç„¶å°±çŸ¥é“è‡ªå·±è¯¥åšä»€ä¹ˆäº‹æƒ…å¹¶ä¸”æåº¦â€œè‡ªå¾‹â€çš„äººï¼Œä¸Šå­¦é‚£ä¼šå°±æœ‰åŒå­¦é›·æ‰“ä¸åŠ¨çš„å­¦ä¹ ï¼Œå“ªæ€•æ²¡äººç›‘ç£ä¹Ÿç…§æ ·è®¤çœŸå­¦ä¹ ã€‚ä¸ä¹‹ç›¸æ¯”çš„æˆ‘æ„Ÿè§‰å°±åƒæ˜¯è¿™ä¸ªä¸–ç•Œçš„NPCä¸€æ ·ï¼Œåšäº‹ä¸‰åˆ†çƒ­åº¦ï¼Œæ„Ÿå…´è¶£çš„æ—¶å€™ä¹Ÿèƒ½çƒ­è¡€æ²¸è…¾ç‹ ç‹ å­¦ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æ—¶å€™è¿˜æ˜¯æƒ³å·æ‡’ï¼Œä¸€ç›´ä»¥æ¥è§‰å¾—æ˜¯è‡ªå·±è‡ªæ§åŠ›é—®é¢˜å¯¼è‡´è‡ªå·±ä¸å¤Ÿè‡ªå¾‹ï¼Œä¹Ÿä¼šæ˜¯ä¸æ˜¯ç»™è‡ªå·±å®šåˆ¶è®¡åˆ’å¹¶è®¾ç½®å¥–æƒ©ï¼Œä½†æœ€åéƒ½ä¸äº†äº†ä¹‹ã€‚ä½ æ˜¯å¦ä¹Ÿæœ‰åŒæ ·çš„ç»å†å¹¶ä¸”è‹¦æ¼å‘¢\né«˜çº§çš„æ¬²æœ› ç›¸æ¯”æƒ³æ–¹è®¾æ³•å»è®©è‡ªå·±è‡ªå¾‹ï¼Œæˆ‘ä»¬æ›´åº”è¯¥åšçš„æ˜¯æŒ–æ˜è‡ªå·±å†…å¿ƒæ›´æ·±å±‚æ¬¡çš„é«˜çº§æ¬²æœ›ï¼Œæ‰“æ¸¸æˆç¡®å®å¯ä»¥å¸¦æ¥çŸ­æ—¶é—´çš„å¤šå·´èƒºï¼Œä½†æ˜¯æå‡å­¦ä¹ æŠ€èƒ½æ‰€å¸¦æ¥çš„å†…å•¡è‚½æ¯”å¤šå·´èƒºæ›´åŠ å¸å¼•äººã€‚é«˜çº§æ¬²æœ›ä¸€èˆ¬éš¾åº¦ç›¸æ¯”æ›´å¤§ï¼Œå®ƒå¡«æ»¡æ—¶çš„å–œæ‚¦ä»¥åŠæˆå°±æ„Ÿè¿œè¿œä¸æ˜¯ä½çº§æ¬²æœ›æ‰€èƒ½æ¯”æ‹Ÿçš„ã€‚è€Œä½œä¸ºä¸€ä¸ªéœ€è¦åŠæ—¶åé¦ˆçš„æ™®é€šäººæ¥è¯´ï¼Œå¯ä»¥è®²é«˜çº§æ¬²æœ›çš„ç›®æ ‡è¿›è¡Œåˆ’åˆ†ï¼Œæ¯ä¸ªæ—¶é—´æ®µæ”»å…‹å…¶ä¸­ä¸€å°å—ï¼Œè¿™ä¸ä»…ä¹Ÿèƒ½å¸¦æ¥å–œæ‚¦åŒæ—¶ä¹Ÿèƒ½æœ‰ä¸­å‡çº§æ‰“æ€ªçš„æˆå°±æ„Ÿã€‚åŒæ—¶ä¹Ÿè¦å°½å¯èƒ½æ‰¾åˆ°å¯ä»¥è§‚æµ‹åˆ°çš„è¾“å‡ºæ–¹å¼ï¼Œä¾‹å¦‚è¾“å‡ºæ–‡ç« ï¼Œæˆ–è€…è¯´å­¦ä¹å™¨çš„è¯å°±æ˜¯ç†Ÿç»ƒç»ƒä¼šä¸€é¦–æ›²å­ï¼Œå­¦è‹±è¯­çš„è¯å°±æ˜¯æŒæ¡100ä¸ªå•è¯ç­‰ç­‰ã€‚é™¤äº†è¿™äº›å¤–ï¼Œæœ€å¥½æ˜¯èƒ½å‘ç°æˆ–è€…ç‚¹ç‡ƒå†…å¿ƒå¯¹æŸä¸ªä¸œè¥¿çš„çƒ­çˆ±ï¼Œå½“ä½ åœ¨åšä¸€ä»¶çœŸæ­£çƒ­çˆ±çš„äº‹æƒ…æ—¶ï¼Œåˆ«è¯´è¦ä½ åšæŒï¼Œå³ä¾¿å¾ˆå¤šäººéƒ½ä¸è®©ä½ å»åšï¼Œä½ ä¹Ÿä¼šå‘äº†ç–¯çš„å»æ‹¼å‘½åšã€‚æœ€åä¸€ç‚¹æœ€é‡è¦çš„å°±æ˜¯ï¼Œè¡ŒåŠ¨èµ·æ¥ï¼Œè¯´å†å¤šéƒ½æ¯”ä¸ä¸ŠåŠ¨ä½œåšä¸€æ¬¡ï½\n","date":"2024-03-21T15:09:14+08:00","image":"https://sherlock-lin.github.io/p/%E5%85%8B%E6%9C%8D%E6%AC%B2%E6%9C%9B%E7%9A%84%E6%B0%B8%E8%BF%9C%E4%B8%8D%E6%98%AF%E8%87%AA%E5%BE%8B%E8%80%8C%E6%98%AF%E6%9B%B4%E9%AB%98%E7%BA%A7%E7%9A%84%E6%AC%B2%E6%9C%9B/image-20240321191336836-6816731_hu1393761622652813113.png","permalink":"https://sherlock-lin.github.io/p/%E5%85%8B%E6%9C%8D%E6%AC%B2%E6%9C%9B%E7%9A%84%E6%B0%B8%E8%BF%9C%E4%B8%8D%E6%98%AF%E8%87%AA%E5%BE%8B%E8%80%8C%E6%98%AF%E6%9B%B4%E9%AB%98%E7%BA%A7%E7%9A%84%E6%AC%B2%E6%9C%9B/","title":"å…‹æœæ¬²æœ›çš„æ°¸è¿œä¸æ˜¯è‡ªå¾‹ï¼Œè€Œæ˜¯æ›´é«˜çº§çš„æ¬²æœ›"},{"content":"å¼•è¨€ æ— è®ºä½ æ˜¯åˆšæ¥è§¦Pulsarè¿˜æ˜¯ä½¿ç”¨Pulsarå¤šå¹´ï¼Œç›¸ä¿¡ä½ å¯¹ä¸‹é¢è¿™æ®µä»£ç éƒ½å¾ˆç†Ÿæ‚‰ï¼Œè¿™å°±æ˜¯ç”Ÿäº§è€…ç«¯æœ€å¸¸å†™çš„ä»£ç æ²¡æœ‰ä¹‹ä¸€ï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„å…¶å®å°±ä¸‰è¡Œä»£ç ï¼Œåˆ†åˆ«ç”¨çº¢è‰²æ•°å­—æ ‡è¯†å‡ºæ¥äº†ï¼Œå…¶ä¸­å¯¹åº”çš„å°±æ˜¯1ã€å®¢æˆ·ç«¯å¯¹è±¡åˆ›å»º 2ã€ç”Ÿäº§è€…å¯¹è±¡åˆ›å»º 3ã€æ¶ˆæ¯å‘é€ã€‚ä»Šå¤©å°±åˆ†åˆ«é’ˆå¯¹è¿™ä¸‰ä¸ªæ­¥éª¤è¿›è¡Œæ·±å…¥çš„æ¢ç´¢ã€‚\nåˆ›å»ºå®¢æˆ·ç«¯å¯¹è±¡ æ— è®ºæ˜¯å†™ç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…ç«¯ä»£ç ï¼Œç¬¬ä¸€æ­¥éƒ½æ˜¯è¦åˆ›å»ºå®¢æˆ·ç«¯å¯¹è±¡ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å¯¹è±¡éƒ½åšäº†äº›ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿè¿™é‡Œå°†å®¢æˆ·ç«¯å¯¹è±¡åˆ›å»ºçš„æ­¥éª¤ç»˜åˆ¶æˆä»¥ä¸‹å›¾\nå®¢æˆ·ç«¯å¯¹è±¡çš„åˆ›å»ºä»¥ä¸‹å‡ ä¸ªä¸œè¥¿ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯å‰ä¸¤ä¸ª\nLookupæœåŠ¡ è¿æ¥æ±  çº¿ç¨‹æ±  å†…å­˜æ§åˆ¶å™¨MemoryLimitController åˆ›å»ºå®¢æˆ·ç«¯è®¡æ•°å™¨HashedWheelTimer LookupæœåŠ¡ LookupæœåŠ¡è´Ÿè´£è·å–Topicçš„å½’å±Brokeråœ°å€ä»¥åŠSchemaä¿¡æ¯ç­‰ï¼Œéå¸¸é‡è¦ã€‚é»˜è®¤æœ‰HTTPå’ŒäºŒè¿›åˆ¶ä¼ è¾“ä¸¤ç§å®ç°ï¼Œå¦‚æœåˆ›å»ºå®¢æˆ·ç«¯å¯¹è±¡æ—¶.serviceUrlæ–¹æ³•ä¼ å…¥çš„åœ°å€æ˜¯httpå¼€å¤´åˆ™ä½¿ç”¨HTTPå®ç°ï¼Œå¦åˆ™å°±æ˜¯äºŒè¿›åˆ¶ä¼ è¾“å®ç°ã€‚\nLookupæœåŠ¡çš„åˆ›å»ºå¦‚ä¸‹\n1 2 3 4 5 6 7 //åˆå§‹åŒ–LookupServiceæœåŠ¡ if (conf.getServiceUrl().startsWith(\u0026#34;http\u0026#34;)) { lookup = new HttpLookupService(conf, this.eventLoopGroup); } else { lookup = new BinaryProtoLookupService(this, conf.getServiceUrl(), conf.getListenerName(), conf.isUseTls(), this.scheduledExecutorProvider.getExecutor()); } è¿›å…¥çœ‹çœ‹HttpLookupServiceçš„æ„é€ æ–¹æ³•å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å†…éƒ¨å¥—äº†ä¸€ä¸ªHttpClientå¯¹è±¡æ¥å¯¹å¤–è¿›è¡ŒHTTPé€šä¿¡ï¼Œåœ¨ç»§ç»­çœ‹HttpClientçš„æ„é€ å‡½æ•°å¯ä»¥å®ƒå†…éƒ¨å®é™…ä¸Šæ˜¯è°ƒç”¨çš„DefaultAsyncHttpClientæ„é€ å‡½æ•°æ¥åˆ›å»ºï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯å¤–éƒ¨åŒ… async-http-client-2.12.1.jarçš„å®ç°ï¼Œè·Ÿäº†ä¸€ä¸‹ä»£ç ï¼Œåº•å±‚ä¹Ÿæ˜¯åŸºäºNettyæ¥è¿›è¡Œå®ç°çš„HTTPé•¿è¿æ¥é€šä¿¡\n1 2 3 4 5 6 7 8 9 10 11 public HttpLookupService(ClientConfigurationData conf, EventLoopGroup eventLoopGroup) throws PulsarClientException { this.httpClient = new HttpClient(conf, eventLoopGroup); this.useTls = conf.isUseTls(); this.listenerName = conf.getListenerName(); } protected HttpClient(ClientConfigurationData conf, EventLoopGroup eventLoopGroup) throws PulsarClientException { .... httpClient = new DefaultAsyncHttpClient(config); } è·Ÿåˆ°è¿™é‡Œå°±å·®ä¸å¤šäº†ï¼Œæˆ‘ä»¬çŸ¥é“åˆ›å»ºå®¢æˆ·ç«¯å¯¹è±¡çš„æ—¶å€™ä¼šåˆå§‹åŒ–LookupæœåŠ¡ï¼Œè€ŒLookupæœåŠ¡åˆå§‹åŒ–çš„æ—¶å€™ä¼šåˆ›å»ºè·Ÿå¤–éƒ¨è¿›è¡Œé€šä¿¡çš„å¼‚æ­¥HTTPå®¢æˆ·ç«¯ï¼Œç”¨äºåœ¨åˆ›å»ºç”Ÿäº§è€…æ—¶å»æŸ¥è¯¢Topicçš„å½’å±Brokerçš„IPåœ°å€ï¼Œè¿™æ ·ç”Ÿäº§è€…æ‰çŸ¥é“å…·ä½“å»è·Ÿå“ªå°Brokeråˆ›å»ºTCPè¿æ¥\nè¿æ¥æ± ConnectionPool è¿æ¥æ± æ˜¯æ± åŒ–æŠ€æœ¯åœ¨ç½‘ç»œè¿æ¥è¿™ä¸ªåœºæ™¯çš„ä½¿ç”¨ï¼Œä½¿ç”¨è¿æ¥æ± å¯ä»¥é¿å…é‡å¤åˆ›å»ºå…³é—­TCPè¿æ¥é€ æˆèµ„æºæµªè´¹ä»¥åŠæå‡æ€§èƒ½ã€‚åœ¨åˆ›å»ºå®¢æˆ·ç«¯å¯¹è±¡çš„æ„é€ æ–¹æ³•ä¸­ï¼ŒConnectionPoolçš„åˆ›å»ºå¦‚ä¸‹ï¼Œå¯ä»¥æ˜¯é€šè¿‡newæ–¹å¼è¿›è¡Œåˆ›å»ºï¼Œå› æ­¤æˆ‘ä»¬çœ‹ä¸‹å®ƒçš„æ„é€ æ–¹æ³•\n1 2 connectionPoolReference = connectionPool != null ? connectionPool : new ConnectionPool(conf, this.eventLoopGroup); ConnectionPoolçš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ ¸å¿ƒé€»è¾‘å…¶å®å°±æ˜¯é€šè¿‡Bootstrapåˆ›å»ºNettyå®¢æˆ·ç«¯å¯¹è±¡ï¼Œé€šè¿‡ pool = new ConcurrentHashMap\u0026lt;\u0026gt;(); è¿™è¡Œä»£ç ä¹Ÿå¾ˆé‡è¦ï¼Œè¿™ä¸ªHashMapå°±æ˜¯å­˜å‚¨å’±ä»¬çš„ç½‘ç»œè¿æ¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 public ConnectionPool(ClientConfigurationData conf, EventLoopGroup eventLoopGroup, Supplier\u0026lt;ClientCnx\u0026gt; clientCnxSupplier, Optional\u0026lt;AddressResolver\u0026lt;InetSocketAddress\u0026gt;\u0026gt; addressResolver) throws PulsarClientException { .... //å¯åŠ¨Nettyå®¢æˆ·ç«¯ pool = new ConcurrentHashMap\u0026lt;\u0026gt;(); bootstrap = new Bootstrap(); bootstrap.group(eventLoopGroup); bootstrap.channel(EventLoopUtil.getClientSocketChannelClass(eventLoopGroup)); //Nettyç›¸å…³é…ç½® bootstrap.option(ChannelOption.CONNECT_TIMEOUT_MILLIS, conf.getConnectionTimeoutMs()); bootstrap.option(ChannelOption.TCP_NODELAY, conf.isUseTcpNoDelay()); bootstrap.option(ChannelOption.ALLOCATOR, PulsarByteBufAllocator.DEFAULT); try { channelInitializerHandler = new PulsarChannelInitializer(conf, clientCnxSupplier); bootstrap.handler(channelInitializerHandler); } catch (Exception e) { log.error(\u0026#34;Failed to create channel initializer\u0026#34;); throw new PulsarClientException(e); } .... } ç”Ÿäº§è€…å¯¹è±¡åˆ›å»º çœ‹å®Œäº†å®¢æˆ·ç«¯å¯¹è±¡åˆ›å»ºï¼Œå†æ¥çœ‹çœ‹ç”Ÿäº§è€…å¯¹è±¡çš„åˆ›å»ºï¼Œä»è¿™æ¡è¯­å¥è¿›è¡Œåˆ‡å…¥ Producer\u0026lt;String\u0026gt; producer = pulsarClient.newProducer(...).create(); åœ¨åˆ›å»ºç”Ÿäº§è€…å¯¹è±¡æ—¶ä¼šè¿›è¡Œä¸€ä¸‹å‡ æ­¥\næŒ‡å®šè·¯ç”±ç­–ç•¥ è¿™ä¸ªä¸»è¦å°±æ˜¯æ ¹æ®åˆ›å»ºç”Ÿäº§è€…å¯¹è±¡æ—¶æŒ‡å®šçš„ï¼Œå¦‚æœæ²¡æœ‰é…ç½®çš„è¯é»˜è®¤ä½¿ç”¨çš„è½®è¯¢è·¯ç”±ç­–ç•¥ã€‚setMessageRoutingMode è¿™ä¸ªæ–¹æ³•å°±æ˜¯æŒ‡å®šè·¯ç”±ç­–ç•¥çš„ï¼Œç„¶åæŒ‡å®šå®Œåä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæœ‰é…ç½®æ‹¦æˆªå™¨çš„è¯åœ¨åˆ›å»ºç”Ÿäº§è€…å¯¹è±¡æ—¶ä¹Ÿä¼šæŠŠå®ƒç»™æ‹¦æˆªé€»è¾‘åŠ è½½è¿›å»ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 public CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; createAsync() { .... try { setMessageRoutingMode(); } catch (PulsarClientException pce) { return FutureUtil.failedFuture(pce); } return interceptorList == null || interceptorList.size() == 0 ? client.createProducerAsync(conf, schema, null) : client.createProducerAsync(conf, schema, new ProducerInterceptors(interceptorList)); } setMessageRoutingMode é€»è¾‘å¦‚ä¸‹ï¼Œé»˜è®¤ç”¨è½®è¯¢è·¯ç”±ï¼Œå¦‚æœé…ç½®å…¶ä»–çš„å°±ç”¨å…¶ä»–çš„ï¼Œå…¶æ¬¡å°±æ˜¯åšè·¯ç”±è§„åˆ™çš„æ ¡éªŒï¼Œçœ‹çœ‹ç”¨æˆ·æ˜¯å¦é…ç½®çš„ä¿¡æ¯æœ‰å†²çªçš„æå‰æ„ŸçŸ¥å¹¶æŠ›å‡ºå»ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 private void setMessageRoutingMode() throws PulsarClientException { if (conf.getMessageRoutingMode() == null \u0026amp;\u0026amp; conf.getCustomMessageRouter() == null) { messageRoutingMode(MessageRoutingMode.RoundRobinPartition); } else if (conf.getMessageRoutingMode() == null \u0026amp;\u0026amp; conf.getCustomMessageRouter() != null) { messageRoutingMode(MessageRoutingMode.CustomPartition); } else if (conf.getMessageRoutingMode() == MessageRoutingMode.CustomPartition \u0026amp;\u0026amp; conf.getCustomMessageRouter() == null) { throw new PulsarClientException(\u0026#34;When \u0026#39;messageRoutingMode\u0026#39; is \u0026#34; + MessageRoutingMode.CustomPartition + \u0026#34;, \u0026#39;messageRouter\u0026#39; should be set\u0026#34;); } else if (conf.getMessageRoutingMode() != MessageRoutingMode.CustomPartition \u0026amp;\u0026amp; conf.getCustomMessageRouter() != null) { throw new PulsarClientException(\u0026#34;When \u0026#39;messageRouter\u0026#39; is set, \u0026#39;messageRoutingMode\u0026#39; \u0026#34; + \u0026#34;should be set as \u0026#34; + MessageRoutingMode.CustomPartition); } } è·å–Topicåˆ†åŒºæ•°å’ŒSchema é€šè¿‡Lookupæœºåˆ¶å»Brokerä¸­æŸ¥è¯¢è¿™ä¸ªTopicçš„Schemaä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰é…ç½®Schemaä¿¡æ¯çš„è¯åˆ™é»˜è®¤ç”¨ Schema.BYTES\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 return lookup.getSchema(TopicName.get(conf.getTopicName())) .thenCompose(schemaInfoOptional -\u0026gt; { if (schemaInfoOptional.isPresent()) { SchemaInfo schemaInfo = schemaInfoOptional.get(); if (schemaInfo.getType() == SchemaType.PROTOBUF) { autoProduceBytesSchema.setSchema(new GenericAvroSchema(schemaInfo)); } else { autoProduceBytesSchema.setSchema(Schema.getSchema(schemaInfo)); } } else { autoProduceBytesSchema.setSchema(Schema.BYTES); } return createProducerAsync(topic, conf, schema, interceptors); }); å’±ä»¬è¿›å»çœ‹çœ‹ getSchema çš„å®ç°ï¼Œå¯ä»¥çœ‹åˆ°æ„é€ çš„æ˜¯HTTPåœ°å€å¹¶é€šè¿‡GETæ–¹å¼è¯·æ±‚Brokerè¿›è¡Œè·å–\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 public CompletableFuture\u0026lt;Optional\u0026lt;SchemaInfo\u0026gt;\u0026gt; getSchema(TopicName topicName, byte[] version) { CompletableFuture\u0026lt;Optional\u0026lt;SchemaInfo\u0026gt;\u0026gt; future = new CompletableFuture\u0026lt;\u0026gt;(); String schemaName = topicName.getSchemaName(); String path = String.format(\u0026#34;admin/v2/schemas/%s/schema\u0026#34;, schemaName); if (version != null) { if (version.length == 0) { future.completeExceptionally(new SchemaSerializationException(\u0026#34;Empty schema version\u0026#34;)); return future; } path = String.format(\u0026#34;admin/v2/schemas/%s/schema/%s\u0026#34;, schemaName, ByteBuffer.wrap(version).getLong()); } httpClient.get(path, GetSchemaResponse.class).thenAccept(response -\u0026gt; { if (response.getType() == SchemaType.KEY_VALUE) { SchemaData data = SchemaData .builder() .data(SchemaUtils.convertKeyValueDataStringToSchemaInfoSchema( response.getData().getBytes(StandardCharsets.UTF_8))) .type(response.getType()) .props(response.getProperties()) .build(); future.complete(Optional.of(SchemaInfoUtil.newSchemaInfo(schemaName, data))); } else { future.complete(Optional.of(SchemaInfoUtil.newSchemaInfo(schemaName, response))); } }).exceptionally(ex -\u0026gt; { .... }); return future; } é™¤äº†è¯»å–Schemaï¼Œè¿˜ä¼šè¯»å–Topicçš„åˆ†åŒºä¿¡æ¯ï¼Œä»ä¸‹é¢åˆ›å»ºçš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå­˜åœ¨åˆ†åŒºåˆ™åˆ›å»ºPartitionedProducerImplå¯¹è±¡ï¼Œä¸å­˜åœ¨åˆ†åŒºåˆ™åˆ›å»ºProducerImplå¯¹è±¡ã€‚è·å–åˆ†åŒºçš„æ–¹æ³•æ˜¯ getPartitionedTopicMetadataï¼Œå’±ä»¬è¿›å»çœ‹çœ‹å®ƒçš„å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 private \u0026lt;T\u0026gt; CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; createProducerAsync(String topic, ProducerConfigurationData conf, Schema\u0026lt;T\u0026gt; schema, ProducerInterceptors interceptors) { CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; producerCreatedFuture = new CompletableFuture\u0026lt;\u0026gt;(); getPartitionedTopicMetadata(topic).thenAccept(metadata -\u0026gt; { .... ProducerBase\u0026lt;T\u0026gt; producer; if (metadata.partitions \u0026gt; 0) { producer = newPartitionedProducerImpl(topic, conf, schema, interceptors, producerCreatedFuture, metadata); } else { producer = newProducerImpl(topic, -1, conf, schema, interceptors, producerCreatedFuture, Optional.empty()); } producers.add(producer); }).exceptionally(ex -\u0026gt; { .... }); return producerCreatedFuture; } getPartitionedTopicMetadataæ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼Œé€šè¿‡ä¸€è·¯è·Ÿè¸ªä¸‹å»å‘ç°ä¹Ÿæ˜¯é€šè¿‡LookupæœåŠ¡è¿›è¡ŒHTTPè¿›è¡ŒæŸ¥è¯¢è¯»å–åˆ†åŒºä¿¡æ¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 public CompletableFuture\u0026lt;PartitionedTopicMetadata\u0026gt; getPartitionedTopicMetadata(String topic) { CompletableFuture\u0026lt;PartitionedTopicMetadata\u0026gt; metadataFuture = new CompletableFuture\u0026lt;\u0026gt;(); try { TopicName topicName = TopicName.get(topic); AtomicLong opTimeoutMs = new AtomicLong(conf.getLookupTimeoutMs()); .... getPartitionedTopicMetadata(topicName, backoff, opTimeoutMs, metadataFuture, new ArrayList\u0026lt;\u0026gt;()); } catch (IllegalArgumentException e) { .... } return metadataFuture; } private void getPartitionedTopicMetadata(TopicName topicName, Backoff backoff, AtomicLong remainingTime, CompletableFuture\u0026lt;PartitionedTopicMetadata\u0026gt; future, List\u0026lt;Throwable\u0026gt; previousExceptions) { long startTime = System.nanoTime(); lookup.getPartitionedTopicMetadata(topicName).thenAccept(future::complete).exceptionally(e -\u0026gt; { remainingTime.addAndGet(-1 * TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - startTime)); long nextDelay = Math.min(backoff.next(), remainingTime.get()); // skip retry scheduler when set lookup throttle in client or server side which will lead to // `TooManyRequestsException` boolean isLookupThrottling = !PulsarClientException.isRetriableError(e.getCause()) || e.getCause() instanceof PulsarClientException.AuthenticationException; if (nextDelay \u0026lt;= 0 || isLookupThrottling) { PulsarClientException.setPreviousExceptions(e, previousExceptions); future.completeExceptionally(e); return null; } .... }); } public CompletableFuture\u0026lt;PartitionedTopicMetadata\u0026gt; getPartitionedTopicMetadata(TopicName topicName) { String format = topicName.isV2() ? \u0026#34;admin/v2/%s/partitions\u0026#34; : \u0026#34;admin/%s/partitions\u0026#34;; return httpClient.get(String.format(format, topicName.getLookupName()) + \u0026#34;?checkAllowAutoCreation=true\u0026#34;, PartitionedTopicMetadata.class); } åˆ›å»ºç”Ÿäº§è€…å¯¹è±¡ åœ¨ä¸Šä¸€å°ç»“å¯ä»¥çœ‹åˆ°å·²ç»æŸ¥åˆ°åˆ†åŒºä¿¡æ¯ï¼Œåœ¨æœ‰åˆ†åŒºçš„æƒ…å†µæ˜¯ä¼šè°ƒç”¨ newPartitionedProducerImpl æ–¹æ³•è¿›è¡Œç”Ÿäº§è€…å¯¹è±¡çš„åˆå§‹åŒ–ï¼Œç°åœ¨å°±ä»è¿™é‡Œå¼€å§‹è¿›è¡Œè·Ÿè¸ªï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•åªæ˜¯å°è£…äº†new PartitionedProducerImplå¯¹è±¡çš„æ“ä½œï¼Œäºæ˜¯ç»§ç»­çœ‹PartitionedProducerImplçš„æ„é€ å‡½æ•°çš„é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 protected \u0026lt;T\u0026gt; PartitionedProducerImpl\u0026lt;T\u0026gt; newPartitionedProducerImpl(String topic, ProducerConfigurationData conf, Schema\u0026lt;T\u0026gt; schema, ProducerInterceptors interceptors, CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; producerCreatedFuture, PartitionedTopicMetadata metadata) { return new PartitionedProducerImpl\u0026lt;\u0026gt;(PulsarClientImpl.this, topic, conf, metadata.partitions, producerCreatedFuture, schema, interceptors); } public PartitionedProducerImpl(PulsarClientImpl client, String topic, ProducerConfigurationData conf, int numPartitions, CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; producerCreatedFuture, Schema\u0026lt;T\u0026gt; schema, ProducerInterceptors interceptors) { super(client, topic, conf, producerCreatedFuture, schema, interceptors); this.producers = ConcurrentOpenHashMap.\u0026lt;Integer, ProducerImpl\u0026lt;T\u0026gt;\u0026gt;newBuilder().build(); this.topicMetadata = new TopicMetadataImpl(numPartitions); //é…ç½®è·¯ç”±ç­–ç•¥ this.routerPolicy = getMessageRouter(); stats = client.getConfiguration().getStatsIntervalSeconds() \u0026gt; 0 ? new PartitionedTopicProducerStatsRecorderImpl() : null; //é…ç½®æœ€å¤§åŒæ—¶ç­‰å¾…çš„æ¶ˆæ¯æ•° int maxPendingMessages = Math.min(conf.getMaxPendingMessages(), conf.getMaxPendingMessagesAcrossPartitions() / numPartitions); conf.setMaxPendingMessages(maxPendingMessages); final List\u0026lt;Integer\u0026gt; indexList; if (conf.isLazyStartPartitionedProducers() \u0026amp;\u0026amp; conf.getAccessMode() == ProducerAccessMode.Shared) { // try to create producer at least one partition indexList = Collections.singletonList(routerPolicy .choosePartition(((TypedMessageBuilderImpl\u0026lt;T\u0026gt;) newMessage()).getMessage(), topicMetadata)); } else { // try to create producer for all partitions indexList = IntStream.range(0, topicMetadata.numPartitions()).boxed().collect(Collectors.toList()); } firstPartitionIndex = indexList.get(0); //è¿™é‡Œæ˜¯æ ¸å¿ƒé€»è¾‘ï¼Œä»è¿™é‡Œè¿›å» start(indexList); // start track and auto subscribe partition increasement if (conf.isAutoUpdatePartitions()) { topicsPartitionChangedListener = new TopicsPartitionChangedListener(); partitionsAutoUpdateTimeout = client.timer() .newTimeout(partitionsAutoUpdateTimerTask, conf.getAutoUpdatePartitionsIntervalSeconds(), TimeUnit.SECONDS); } } private void start(List\u0026lt;Integer\u0026gt; indexList) { .... final ProducerImpl\u0026lt;T\u0026gt; firstProducer = createProducer(indexList.get(0)); firstProducer.producerCreatedFuture().handle((prod, createException) -\u0026gt; { .... }).thenApply(name -\u0026gt; { for (int i = 1; i \u0026lt; indexList.size(); i++) { //å¾ªç¯åˆ†åŒºæ•°åˆ›å»ºä¸ä¹‹å¯¹åº”çš„ProducerImplå¯¹è±¡ createProducer(indexList.get(i), name).producerCreatedFuture().handle((prod, createException) -\u0026gt; { afterCreatingProducer.accept(false, createException); return null; }); } return null; }); } ç»§ç»­ä» createProducer æ–¹æ³•è¿›è¡Œè·Ÿè¸ª\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 private ProducerImpl\u0026lt;T\u0026gt; createProducer(final int partitionIndex, final Optional\u0026lt;String\u0026gt; overrideProducerName) { //åˆ›å»ºProducerImplåä¼šç»Ÿä¸€æ”¾åˆ°producersè¿™ä¸ªMapä¸­ï¼Œkeyæ˜¯åˆ†åŒºå·ï¼Œvalueå°±æ˜¯ProducerImplå¯¹è±¡ return producers.computeIfAbsent(partitionIndex, (idx) -\u0026gt; { String partitionName = TopicName.get(topic).getPartition(idx).toString(); //ç»§ç»­è¿›å…¥çœ‹çœ‹ProducerImplåˆ›å»ºçš„é€»è¾‘ return client.newProducerImpl(partitionName, idx, conf, schema, interceptors, new CompletableFuture\u0026lt;\u0026gt;(), overrideProducerName); }); } public ProducerImpl(PulsarClientImpl client, String topic, ProducerConfigurationData conf, CompletableFuture\u0026lt;Producer\u0026lt;T\u0026gt;\u0026gt; producerCreatedFuture, int partitionIndex, Schema\u0026lt;T\u0026gt; schema, ProducerInterceptors interceptors, Optional\u0026lt;String\u0026gt; overrideProducerName) { .... this.compressor = CompressionCodecProvider.getCompressionCodec(conf.getCompressionType()); .... //è¿™é‡Œæ˜¯æ ¸å¿ƒé€»è¾‘ï¼Œç”¨äºåˆ›å»ºProducerImplå¯¹è±¡è·Ÿå¯¹åº”çš„Brokerçš„TCPç½‘ç»œè¿æ¥ grabCnx(); } åˆ›å»ºè¿æ¥ ä»ä¸Šä¸€å°èŠ‚å¯ä»¥çœ‹åˆ°ä»£ç é€»è¾‘è·Ÿåˆ°äº†grabCnx æ–¹æ³•ï¼Œç»§ç»­ä¸€è·¯è·Ÿè¸ªä¸‹å»ï¼Œå¯ä»¥çœ‹åˆ°æœ€åéƒ½ä¼šè°ƒç”¨ state.client.getConnection, ç»§ç»­å¾€é‡Œé¢çœ‹çœ‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 void grabCnx() { this.connectionHandler.grabCnx(); } protected void grabCnx() { grabCnx(Optional.empty()); } protected void grabCnx(Optional\u0026lt;URI\u0026gt; hostURI) { .... cnxFuture = state.client.getConnection(address, address, randomKeyForSelectConnection); .... } public CompletableFuture\u0026lt;ClientCnx\u0026gt; getConnection(final InetSocketAddress logicalAddress, final InetSocketAddress physicalAddress, final int randomKeyForSelectConnection) { //å¯ä»¥çœ‹åˆ°è°ƒç”¨è¿æ¥æ± è¿›è¡Œç½‘ç»œè¿æ¥çš„è·å–ï¼Œç»§ç»­è¿›å»çœ‹çœ‹å®ç°ç»†èŠ‚ return cnxPool.getConnection(logicalAddress, physicalAddress, randomKeyForSelectConnection); } public CompletableFuture\u0026lt;ClientCnx\u0026gt; getConnection(InetSocketAddress logicalAddress, InetSocketAddress physicalAddress, final int randomKey) { if (maxConnectionsPerHosts == 0) { // å¦‚æœé…ç½®æ²¡å¼€å¯è¿æ¥æ± ï¼Œåˆ™æ¯ä¸€æ¬¡éƒ½é‡æ–°æ–°å»ºä¸€ä¸ªTCPè¿æ¥ return createConnection(logicalAddress, physicalAddress, -1); } final ConcurrentMap\u0026lt;Integer, CompletableFuture\u0026lt;ClientCnx\u0026gt;\u0026gt; innerPool = pool.computeIfAbsent(logicalAddress, a -\u0026gt; new ConcurrentHashMap\u0026lt;\u0026gt;()); // æ–°å»ºTCPç½‘ç»œè¿æ¥å¹¶æ”¾åœ¨è¿æ¥æ± ä¸­ä»¥å¤‡ä¹‹åçš„å¤ç”¨,ç»§ç»­è¿›å»çœ‹createConnectionçš„é€»è¾‘ CompletableFuture\u0026lt;ClientCnx\u0026gt; completableFuture = innerPool .computeIfAbsent(randomKey, k -\u0026gt; createConnection(logicalAddress, physicalAddress, randomKey)); .... } private CompletableFuture\u0026lt;ClientCnx\u0026gt; createConnection(InetSocketAddress logicalAddress, InetSocketAddress physicalAddress, int connectionKey) { .... // ç»§ç»­è¿›å»çœ‹createConnectionçš„é€»è¾‘ createConnection(logicalAddress, physicalAddress).thenAccept(channel -\u0026gt; { .... }).exceptionally(exception -\u0026gt; { .... }); return cnxFuture; } private CompletableFuture\u0026lt;Channel\u0026gt; createConnection(InetSocketAddress logicalAddress, InetSocketAddress unresolvedPhysicalAddress) { CompletableFuture\u0026lt;List\u0026lt;InetSocketAddress\u0026gt;\u0026gt; resolvedAddress; try { .... return resolvedAddress.thenCompose( inetAddresses -\u0026gt; connectToResolvedAddresses( logicalAddress, unresolvedPhysicalAddress, inetAddresses.iterator(), isSniProxy ? unresolvedPhysicalAddress : null) ); } catch (URISyntaxException e) { .... } } private CompletableFuture\u0026lt;Channel\u0026gt; connectToResolvedAddresses(...) { CompletableFuture\u0026lt;Channel\u0026gt; future = new CompletableFuture\u0026lt;\u0026gt;(); // ç»§ç»­å¾€ä¸‹è·Ÿè¸ª connectToAddress(logicalAddress, resolvedPhysicalAddress.next(), unresolvedPhysicalAddress, sniHost) .... return null; }); return future; } private CompletableFuture\u0026lt;Channel\u0026gt; connectToAddress(InetSocketAddress logicalAddress, InetSocketAddress physicalAddress, InetSocketAddress unresolvedPhysicalAddress, InetSocketAddress sniHost) { .... //ç»ˆäºè·Ÿè¸ªåˆ°äº†ï¼Œå°±æ˜¯bootstrap.register() è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å°è¯•å¾€é‡Œé¢çœ‹çœ‹å®ç°ï¼Œä»è¿™é‡Œå¼€å§‹å°±æ˜¯Nettyçš„ä»£ç äº† return toCompletableFuture(bootstrap.register()) .thenCompose(channelInitializerHandler::initSocks5IfConfig) .thenCompose(ch -\u0026gt; channelInitializerHandler.initializeClientCnx(ch, logicalAddress, unresolvedPhysicalAddress)) .thenCompose(channel -\u0026gt; toCompletableFuture(channel.connect(physicalAddress))); } public ChannelFuture register() { validate(); //ç»§ç»­å¾€ä¸‹ return initAndRegister(); } final ChannelFuture initAndRegister() { Channel channel = null; try { //æ–°å»ºä¸€æ¡ç½‘ç»œé€šé“åˆ°Broker channel = channelFactory.newChannel(); init(channel); } catch (Throwable t) { .... } .... return regFuture; } ä»ä¸Šé¢çš„ä»£ç è·Ÿè¸ªå¯ä»¥çœ‹åˆ°ï¼Œç”Ÿäº§è€…å¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šé€šè¿‡Nettyå®¢æˆ·ç«¯è·ŸTopicæ‰€åœ¨çš„Brokerå»ºç«‹TCPç½‘ç»œè¿æ¥ï¼Œæ–¹ä¾¿åç»­çš„é€šä¿¡\næ¶ˆæ¯å‘é€ æ¶ˆæ¯å‘é€æµç¨‹å¤§è‡´å¦‚ä¸‹å›¾\nåœ¨é€‰æ‹©æ¶ˆæ¯å‘é€æ˜¯ï¼Œç”Ÿäº§è€…å¯¹è±¡ä¼šæ ¹æ®è·¯ç”±ç­–ç•¥æ¥å†³å®šç”¨ç›®æ ‡åˆ†åŒºæ‰€å¯¹åº”çš„ProducerImplå¯¹è±¡è¿›è¡Œå¤„ç† å‘é€å‰ä¼šæŒ‰ç…§é¡ºåºå¯¹æ•°æ®è¿›è¡Œæ‹¦æˆªå™¨é“¾é€»è¾‘å¤„ç†(å¦‚æœæœ‰é…ç½®çš„è¯)ï¼Œç„¶åè¿›è¡Œå‹ç¼©æœ€åå†è¿›è¡Œåºåˆ—åŒ–æ“ä½œ(æ¶ˆæ¯ä¼ è¾“/å­˜å‚¨å¿…é¡»åºåˆ—åŒ–) æ¶ˆæ¯å‘é€å‰ä¼šæ”¾åˆ°å¾…ç¡®è®¤é˜Ÿåˆ—ä¸­è¿›è¡Œç»´æŠ¤ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç¡®è®¤é˜Ÿåˆ—ï¼Œåœ¨æ¶ˆæ¯å†™å…¥æˆåŠŸåä¼šä»å¯¹åº”çš„ç¡®è®¤é˜Ÿåˆ—ä¸­å°†è‡ªå·±åˆ é™¤ï¼Œå¦åˆ™è¿™æ¡æ¶ˆæ¯ä¸ç®—å†™å…¥æˆåŠŸã€‚ å°†æ¶ˆæ¯å‘é€æ“ä½œå°è£…æˆä¸€ä¸ªä»»åŠ¡äº¤ç»™çº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæœ€åçš„å‘é€æ“ä½œ Brokerå°†æ•°æ®å†™å…¥æˆåŠŸåå‘å®¢æˆ·ç«¯è¿”å›ackï¼Œå®¢æˆ·ç«¯é€šè¿‡ackä¸­æºå¸¦çš„æ¶ˆæ¯ä¿¡æ¯åˆ°å¾…ç¡®è®¤é˜Ÿåˆ—ä¸­è¿›è¡Œæ¶ˆæ¯çš„åˆ é™¤ é‚£ä¹ˆè€è§„çŸ©ï¼Œç»§ç»­ä¸€èµ·çœ‹ä¸‹ä»£ç å®ç°å§\nå‘é€æµç¨‹å‰ç½®æ“ä½œ å°±ä»å¸¸è§çš„è¿™æ¡è¯­å¥è¿›è¡Œåˆ‡å…¥ producer.sendAsync(\u0026quot;hello java API pulsar:\u0026quot;+i+\u0026quot;, å½“å‰æ—¶é—´ä¸ºï¼š\u0026quot;+new Date()); ã€‚é€šè¿‡ä»£ç ä¸­å¯ä»¥çœ‹åˆ°sendAsync æ–¹æ³•æ˜¯ä»å…¶çˆ¶ç±»ProducerBaseä¸­ç»§æ‰¿çš„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public CompletableFuture\u0026lt;MessageId\u0026gt; sendAsync(Message\u0026lt;?\u0026gt; message) { //ç»§ç»­è·Ÿè¸ªè¿›å» return internalSendAsync(message); } //è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæœ‰åˆ†åŒºç”Ÿäº§è€…å’Œéåˆ†åŒºç”Ÿäº§è€…ä¸¤ç§å®ç°ï¼Œè·Ÿè¸ªåˆ†åŒºç”Ÿäº§è€…çš„å®ç°é€»è¾‘ abstract CompletableFuture\u0026lt;MessageId\u0026gt; internalSendAsync(Message\u0026lt;?\u0026gt; message); CompletableFuture\u0026lt;MessageId\u0026gt; internalSendAsync(Message\u0026lt;?\u0026gt; message) { //ç»§ç»­å¾€é‡Œé¢è·Ÿè¸ª return internalSendWithTxnAsync(message, null); } CompletableFuture\u0026lt;MessageId\u0026gt; internalSendWithTxnAsync(Message\u0026lt;?\u0026gt; message, Transaction txn) { .... //è¿˜æœ‰å°è±¡å—ï¼Œåœ¨ç”Ÿäº§è€…åˆ›å»ºæ—¶ä¼šç»´æŠ¤ä¸€ä¸ªä»¥åˆ†åŒºå·ä¸ºkeyï¼ŒProducerImplä¸ºvalueçš„Mapï¼Œç°åœ¨ä»é‡Œé¢è·å–ç›¸å¯¹åº”çš„å¯¹è±¡è¿›è¡Œå¤„ç† return producers.get(partition).internalSendWithTxnAsync(message, txn); } æ¶ˆæ¯å¤„ç†ä»¥åŠåŒ…è£… åˆå›åˆ°ProducerImplå¯¹è±¡çš„é€»è¾‘äº†ï¼Œç›¸å½“äºåˆ†åŒºç”Ÿäº§è€…å¯¹è±¡åªæ˜¯ä¸ªå£³ï¼Œæ— è®ºåˆ†åŒºè¿˜æ˜¯éåˆ†åŒºæœ€ç»ˆéƒ½æ˜¯è°ƒç”¨çš„ProducerImplè¿›è¡Œæ¶ˆæ¯å‘é€çš„çœŸæ­£é€»è¾‘ï¼Œä¸åºŸè¯ç»§ç»­å¾€ä¸‹çœ‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 CompletableFuture\u0026lt;MessageId\u0026gt; internalSendWithTxnAsync(Message\u0026lt;?\u0026gt; message, Transaction txn) { .... return internalSendAsync(message); } CompletableFuture\u0026lt;MessageId\u0026gt; internalSendAsync(Message\u0026lt;?\u0026gt; message) { .... //æ‹¦æˆªå™¨çš„é€»è¾‘å°±æ˜¯åœ¨è¿™é‡Œç”Ÿæ•ˆ MessageImpl\u0026lt;?\u0026gt; interceptorMessage = (MessageImpl) beforeSend(message); .... //æ ¸å¿ƒé€»è¾‘ï¼Œç»§ç»­åˆ‡å…¥ sendAsync(interceptorMessage, new SendCallback() { .... }); return future; } public void sendAsync(Message\u0026lt;?\u0026gt; message, SendCallback callback) { checkArgument(message instanceof MessageImpl); .... //æ ¸å¿ƒé€»è¾‘ï¼Œä»åå­—å¯ä»¥çœ‹åˆ°å°±æ˜¯å¯¹æ¶ˆæ¯è¿›è¡Œåºåˆ—åŒ–å¹¶è¿›è¡Œå‘é€é€»è¾‘ï¼Œç»§ç»­è·Ÿè¿›å» serializeAndSendMessage(msg, payload, sequenceId, uuid, chunkId, totalChunks, readStartIndex, payloadChunkSize, compressedPayload, compressed, compressedPayload.readableBytes(), callback, chunkedMessageCtx, messageId); } catch (PulsarClientException e) { .... } } private void serializeAndSendMessage(....) throws IOException { //æ ¸å¿ƒé€»è¾‘ï¼Œopæ˜¯OpSendMsgå¯¹è±¡ï¼Œå°è£…äº†è¦å‘é€çš„æ¶ˆæ¯å†…å®¹ï¼Œç»§ç»­å¾€ä¸‹è·Ÿ processOpSendMsg(op); } } æ¶ˆæ¯å‘é€ æ•°æ®å·²ç»å¤„ç†åŒ…è£…å¾—å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å‘é€çš„é€»è¾‘ï¼Œå’±ä»¬é¡ºç€ processOpSendMsg æ–¹æ³•ç»§ç»­å¾€ä¸‹çœ‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 protected void processOpSendMsg(OpSendMsg op) { .... //å°†æ¶ˆæ¯åŠ åˆ°OpSendMsgQueueé˜Ÿåˆ—ä¸­ï¼Œè¿™å°±æ˜¯â€œç­‰å¾…ç¡®è®¤é˜Ÿåˆ—â€ pendingMessages.add(op); .... //ClientCnxå¯¹è±¡ç»´æŠ¤ç€Nettyå®ç°è·ŸBrokerçš„TCPè¿æ¥ final ClientCnx cnx = getCnxIfReady(); if (cnx != null) { .... //WriteInEventLoopCallbackæ–¹æ³•çš„runæ–¹æ³•æ‰§è¡Œä¼šå°†æ•°æ®å‘é€å‡ºå»ï¼Œç„¶åé˜Ÿåˆ—ä¸­ç»´æŠ¤æ¶ˆæ¯çš„çŠ¶æ€ cnx.ctx().channel().eventLoop().execute(WriteInEventLoopCallback.create(this, cnx, op)); stats.updateNumMsgsSent(op.numMessagesInBatch, op.batchSizeByte); } else { .... } } catch (Throwable t) { .... } } //WriteInEventLoopCallbackæ˜¯ä¸€ä¸ªçº¿ç¨‹ç±»ï¼Œè¢«æ”¾åˆ°çº¿ç¨‹æ± é‡Œé¢æ‰§è¡Œï¼Œå› æ­¤ç›´æ¥çœ‹å®ƒçš„runæ–¹æ³• private static final class WriteInEventLoopCallback implements Runnable { public void run() { .... try { //ç†Ÿæ‚‰Nettyçš„æœ‹å‹ç›¸ä¿¡å¯¹writeAndFlushæ–¹æ³•ä¸é»˜è®¤ï¼Œå°±æ˜¯é€šè¿‡ä¹‹é—´å»ºç«‹å¥½çš„TCPè¿æ¥å°†æ•°æ®å‘é€åˆ°Brokerå» cnx.ctx().writeAndFlush(cmd, cnx.ctx().voidPromise()); op.updateSentTimestamp(); } finally { recycle(); } } } è·Ÿè¸ªåˆ°è¿™é‡ŒåŸºæœ¬å°±ç»“æŸäº†ï¼Œå¯¹Nettyæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å†ç»§ç»­å¾€ä¸‹è·Ÿï¼Œè¿™é‡Œå¯ä»¥ç®€å•è¯´ä¸€ä¸‹ï¼Œå…¶å®å®ƒå†…éƒ¨æ˜¯å¯¹JDKçš„NIOåšäº†åŒ…è£…å’Œä¼˜åŒ–ï¼Œæœ€åº•å±‚ä¹Ÿæ˜¯é€šè¿‡Javaçš„Socketè¿æ¥ç½‘ç»œç«¯å£è¿›è¡Œçš„æ•°æ®å‘é€ã€‚ä¸çŸ¥é“æœ‰æ²¡æœ‰å°ä¼™ä¼´å‘ç°ï¼Œå’¦ï¼Œæ€ä¹ˆæ²¡æœ‰å¯¹è¿”å›ç»“æœè¿›è¡Œå¤„ç†çš„é€»è¾‘å‘¢ï¼Ÿè¿™å°±æ˜¯æ‰€è°“çš„å¼‚æ­¥è®¾è®¡ï¼ŒNettyä¸å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥é€šä¿¡æ¡†æ¶å—ï¼Œå®¢æˆ·ç«¯å‘é€çš„é€»è¾‘åˆ°è¿™é‡Œå°±æ˜¯å½»åº•ç»“æŸäº†ï¼Œè€Œæ¶ˆæ¯çš„å¤„ç†ç»“æŸå°±æ˜¯è¦ç­‰æœåŠ¡ç«¯Brokerå‘å®¢æˆ·ç«¯å‘èµ·æ¶ˆæ¯ackè¯·æ±‚äº†ï¼Œæƒ³çŸ¥é“Pulsaræ€ä¹ˆå®ç°çš„å—ï¼Ÿé‚£å°±è·Ÿç€æˆ‘ä¸€èµ·ç…ç…å§ï½\næ¶ˆæ¯ç¡®è®¤ æ¶ˆæ¯ç¡®è®¤æµç¨‹æ˜¯ç”±Brokerç«¯å‘èµ·çš„ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å¯¹è±¡è‚¯å®šæ˜¯é€šè¿‡Nettyå®¢æˆ·ç«¯æ¥æ”¶çš„ï¼Œæ‰€ä»¥ç›´æ¥çœ‹Pulsarå®ç°çš„ChannelInboundHandlerAdapterç±»çš„channelReadçš„é€»è¾‘å³å¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public abstract class PulsarDecoder extends ChannelInboundHandlerAdapter { public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { .... switch (cmd.getType()) { .... //å¯ä»¥çœ‹å¾—åˆ°æ¶ˆæ¯æœ‰å†™æˆåŠŸçš„åç»­å¤„ç†åŠ¨ä½œï¼Œé‚£å°±ä»è¿™é‡Œçœ‹çœ‹ case PRODUCER_SUCCESS: checkArgument(cmd.hasProducerSuccess()); handleProducerSuccess(cmd.getProducerSuccess()); break; case UNSUBSCRIBE: checkArgument(cmd.hasUnsubscribe()); safeInterceptCommand(cmd); handleUnsubscribe(cmd.getUnsubscribe()); break; } } } handleProducerSuccessè¿™ä¸ªæ–¹æ³•çš„æ˜¯ç”±ClientCnxå¯¹è±¡è¿›è¡Œå®ç°çš„ï¼Œé‚£å°±è·Ÿè¿›æ¥çœ‹çœ‹å§\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 protected void handleProducerSuccess(CommandProducerSuccess success) { checkArgument(state == State.Ready); if (log.isDebugEnabled()) { log.debug(\u0026#34;{} Received producer success response from server: {} - producer-name: {}\u0026#34;, ctx.channel(), success.getRequestId(), success.getProducerName()); } long requestId = success.getRequestId(); if (!success.isProducerReady()) { //è¿˜è®°å¾—pendingRequests è¿™ä¸ªâ€œå¾…ç¡®è®¤é˜Ÿåˆ—â€å—ï¼Œç°åœ¨ä¼šä»é‡Œé¢æŸ¥è¯¢å¯¹åº”çš„æ¶ˆæ¯ TimedCompletableFuture\u0026lt;?\u0026gt; requestFuture = pendingRequests.get(requestId); if (requestFuture != null) { //æ—¥å¿—è¿›è¡Œæ‰“å° log.info(\u0026#34;{} Producer {} has been queued up at broker. request: {}\u0026#34;, ctx.channel(), success.getProducerName(), requestId); //æ ‡è®°ä¸ºæˆåŠŸ requestFuture.markAsResponded(); } return; } //å®¢æˆ·ç«¯å¤„ç†çš„ä¸»è¦é€»è¾‘å°±æ˜¯ä»é˜Ÿåˆ—ä¸­ç§»é™¤æ­¤æ¶ˆæ¯ CompletableFuture\u0026lt;ProducerResponse\u0026gt; requestFuture = (CompletableFuture\u0026lt;ProducerResponse\u0026gt;) pendingRequests.remove(requestId); .... } æ€»ç»“ ç”Ÿäº§è€…å†™æ•°æ®çš„æµç¨‹åˆ°è¿™é‡ŒåŸºæœ¬å°±ç»“æŸäº†ï¼Œæ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯æ²¡æƒ³è±¡ä¸­é‚£ä¹ˆå¯æ€•ï¼Ÿä¹Ÿè®¸ä½ å¯¹1ã€å®¢æˆ·ç«¯å¯¹è±¡åˆ›å»º 2ã€ç”Ÿäº§è€…å¯¹è±¡åˆ›å»º 3ã€æ¶ˆæ¯å‘é€ è¿™ä¸‰æ­¥ä¹‹é—´çš„å…³ç³»è¿˜æœ‰ç‚¹è¿·è¿·ç³Šç³Šï¼Œé‚£å°±è¯·å…è®¸æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼Œ1ã€å®¢æˆ·ç«¯å¯¹è±¡åˆ›å»ºç›¸å½“äºä¸€åº§æ–°åŸå¸‚çš„åˆ›å»ºï¼Œæ‰“å¥½åŸå¸‚çš„åœ°åŸºï¼Œ2ã€ç”Ÿäº§è€…å¯¹è±¡åˆ›å»º ç›¸å½“äºåœ¨è¿™ä¸ªåœ°åŸºçš„åŸºç¡€ä¸Šå»ºèµ·äº†åŸå¸‚ï¼Œå‘ç”µå‚ç­‰ç­‰ï¼Œæœ€é‡è¦çš„æ˜¯ä¿®å»ºå…¶é€šå¾€å…¶ä»–å„ä¸ªåŸå¸‚çš„äº¤é€šè¦é“ï¼Œæœ€åçš„3ã€æ¶ˆæ¯å‘é€ ç›¸å½“äºè¿™ä¸ªæ–°åŸå¸‚çš„å±…æ°‘ä»¬ä¹˜åé«˜é“å»å…¶ä»–çš„åŸå¸‚ã€‚è¿™ä¹ˆè¯´ç›¸ä¿¡ä½ ä¸€å®šå·²ç»æ˜ç™½äº†ï½å¦‚æœè¿˜æœ‰å…¶ä»–ç–‘é—®æ¬¢è¿åœ¨ä¸‹é¢çš„è¯„è®ºåŒºä¸€èµ·è®¨è®º\n","date":"2024-03-21T10:34:57+08:00","image":"https://sherlock-lin.github.io/p/%E4%B8%80%E6%96%87%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82producer%E7%AB%AF%E6%B5%81%E7%A8%8B%E4%BB%A5%E5%8F%8A%E5%8E%9F%E7%90%86/image-20240321153410330_hu2501804792718174333.png","permalink":"https://sherlock-lin.github.io/p/%E4%B8%80%E6%96%87%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82producer%E7%AB%AF%E6%B5%81%E7%A8%8B%E4%BB%A5%E5%8F%8A%E5%8E%9F%E7%90%86/","title":"ä¸€æ–‡å½»åº•ææ‡‚Producerç«¯æµç¨‹ä»¥åŠåŸç†"},{"content":"æœºä¼šå…¶å®ä¸å¤š æœ€è¿‘ä¸€å£æ°”çœ‹äº†ã€Šé£é©°äººç”Ÿã€‹ä»¥åŠã€Šé£é©°äººç”Ÿ2ã€‹ï¼Œè¿‡å»æ˜¯ä»¥çœ‹å–œå‰§çš„å¿ƒæ€å»çœ‹æ²ˆè…¾çš„ç”µå½±ï¼Œå½“å¦‚ä»ŠäºŒåˆ·æ—¶å‘ç°è¿™ä¸å°±æ˜¯ç”Ÿæ´»å—ï¼Œåªä¸è¿‡ç”¨å–œå‰§çš„å¤–å£³åšäº†å±‚åŒ…è£…ã€‚ä¸¤éƒ¨ç”µå½±ç»™æˆ‘å½±å“æœ€æ·±çš„å°±æ˜¯æœ€åçš„é‚£æ®µå¯¹ç™½ï¼Œâ€œå¼ å¼›ï¼Œè¦ä¸å’±ä»¬æ”¾å¼ƒå§ï¼Œåªè¦ä»¥ååŠªåŠ›è¿˜æœ‰æœºä¼šâ€ï¼Œå¼ å¼›å›ç­”ï¼šâ€œæˆ‘åŠªåŠ›è¿‡æ— æ•°æ¬¡ï¼Œå¯æ˜¯æœºä¼šåªå‡ºç°åœ¨å…¶ä¸­ä¸€ä¸¤æ¬¡â€ã€‚ç›¸ä¿¡è¿™æ®µå¯¹ç™½ä¹Ÿè§¦åŠ¨äº†å¾ˆå¤šäººï¼Œç‰¹åˆ«æ˜¯æ­¥å…¥ç¤¾ä¼šåçš„æœ‹å‹ä»¬ç›¸ä¿¡ä¼šæ›´åŠ æœ‰è‡ªå·±çš„å…±é¸£ã€‚ç¤¾ä¼šä¸åƒå­¦æ ¡å“ªä¼šï¼Œåªè¦ä½ åŠªåŠ›å°±ä¼šåœ¨ä¸‹æ¬¡è€ƒè¯•ä¸­çœ‹åˆ°æ•ˆæœï¼›è€Œå·¥ä½œåï¼Œæœ‰æ—¶å€™ä½ å‘ç°è‡ªå·±å³ä¾¿åšå‡ºåå€ã€ç™¾å€çš„åŠªåŠ›ï¼Œè€Œå·¥ä½œè¿˜æ˜¯ä¸€å›¢é­ï¼Œå¦‚æ­¤å¤šæ¬¡å¯èƒ½ä¹Ÿæƒ³æ‘†çƒ‚ç®—äº†ï¼Œåœ¨ç¤¾ä¼šçš„è¿™å¥—å¤æ‚çš„è¯„å®šä½“ç³»é‡Œï¼Œæœ‰æ—¶å€™ä»¿ä½›ä½ çš„åŠªåŠ›æ˜¯å¤±æ•ˆçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å†çœ‹åˆ°å¼ å¼›ä¸ºäº†æ¯”èµ›èƒœåˆ©ç”šè‡³ä¸æƒœå†’ç€ç”Ÿå‘½å±é™©ï¼Œä»¿ä½›èƒ½å¤Ÿç†è§£äº†ï¼Œå› ä¸ºæœ‰äº›ä¸œè¥¿çœŸçš„ä¸æƒ³ç®—äº†ï¼Œæœ‰äº›ä¸œè¥¿çœŸçš„æ¯”ç”Ÿå‘½æ›´åŠ å¯è´µï¼Œæœ‰äº›ä¸œè¥¿å®ƒé”™è¿‡äº†çœŸçš„å°±é”™è¿‡äº†ï¼Œç”šè‡³è¿™è¾ˆå­éƒ½ä¸ä¼šå†æœ‰äº†ã€‚è¿™å°±æ˜¯æˆ‘å¯¹ã€Šé£é©°äººç”Ÿã€‹ç³»åˆ—çš„è§‚åæ„Ÿã€‚é‚£ä¹ˆï¼Œä½ æ˜¯å¦ä¹Ÿæœ‰é‚£ä¹ˆä¸€ä¸ªæ—¶åˆ»ï¼Œè®©ä½ æ„¿æ„é€‰æ‹©æŠ›å¼ƒå…¨éƒ¨ï¼Œæ¥é€‰æ‹©ç©¿è¶Šå›åˆ°é‚£æ—¶æ‹¼å°½å…¨åŠ›çš„å»åšçš„äº‹æƒ…å—ï¼Ÿ\nåªè¦å‡†å¤‡å¥½ï¼Œæœºä¼šå°±ä¼šå‡ºç° å¦‚æœä½ ä¹Ÿæ›¾å› ä¸ºè¿‡å»çš„æŸä¸ªé‡è¦æ—¶åˆ»æ²¡æœ‰æŠŠæ¡ä½æœºä¼šè€Œæµ‘æµ‘å™©å™©ï¼Œæƒ³æ‘†çƒ‚è¿‡å®Œä½™ç”Ÿï¼Œé‚£ä¹ˆæˆ‘æƒ³è·Ÿä½ åˆ†äº«ä¸€å¥è¯ï¼Œâ€œåªè¦å‡†å¤‡å¥½ï¼Œæœºä¼šå°±ä¼šå‡ºç°â€ã€‚å¦‚ä»Šéšç€äº’è”ç½‘çš„å‘å±•ï¼Œæ¯ä¸ªäººéƒ½å¤šäº†å¾ˆå¤šæ›å…‰è‡ªå·±çš„æœºä¼šä»¥åŠè®¤è¯†æ›´å¤šå¿—åŒé“åˆçš„æœ‹å‹ï¼Œæ‰€ä»¥åªè¦ä½ è¶³å¤Ÿä¼˜ç§€å°±ä¼šé€æ¸è¢«æ¨åˆ°å°å‰ï¼Œæ˜¯é‡‘å­å°±ä¸€å®šä¼šå‘å…‰ï¼Œå‰ææ˜¯ä½ è¿˜è¶³ä¸è¶³å¤Ÿä¼˜ç§€ã€‚å› æ­¤å’±ä»¬éœ€è¦åšçš„å°±æ˜¯ä¸æ–­æ‰“ç£¨è‡ªå·±çš„ä¸“ä¸šæŠ€èƒ½ã€è½¯æŠ€èƒ½ç­‰ç­‰ï¼Œè€Œåœ¨æœºä¼šå‡ºç°æ—¶åŠ¡å¿…è¦ç´§ç´§æŠ“ä½å¹¶æ‹¼å°½å…¨åŠ›ï¼ŒæŠŠæ¡ä½æœºä¼šåå†ç»§ç»­é™ä¸‹å¿ƒæ¥æ²‰æ·€è‡ªå·±å¦‚æ­¤åå¤ï¼Œä»è€Œå°†è‡ªå·±å†…æ ¸ä¿®ç‚¼å¾—è¶Šæ¥å¼ºæ‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å­¦ä¼šäº«å—æ²‰æ·€ã€ä¿®ç‚¼çš„è¿‡ç¨‹ï¼Œå°±åƒæ˜¯åœ¨ç©ä¸€æ¬¾å¾ˆé•¿å¾ˆé•¿çš„å…»æˆç³»æ¸¸æˆä¸€èˆ¬ï¼Œä»¥â€œåå¹´ç£¨ä¸€å‰‘â€çš„åŒ å¿ƒç²¾ç¥æ…¢æ…¢ç§¯ç´¯ï¼Œè€Œåœ¨æœºä¼šå‡ºç°æ—¶æœæ–­çš„ä¸¾èµ·â€œå‰‘â€æŒ¥å‘å®ƒï¼ŒåŒæ—¶é«˜å–Šä¸€å¥ï¼Œâ€œå»ä½ Xçš„â€ã€‚\næ€»ç»“ æˆ‘ä»¬åœ¨æ¯ä¸€åˆ»éƒ½ä¼šé¢ä¸´æ— æ•°ä¸ªé€‰æ‹©ï¼Œæˆ‘ä»¬åœ¨è¿‡å»æ— æ•°ä¸ªé€‰æ‹©ä¸­çš„é€‰å®šç»˜åˆ¶å‡ºäº†å¦‚ä»Šçš„ç”Ÿæ´»ï¼Œè€Œç«™åœ¨æœªæ¥åå¹´ã€äºŒåå¹´çš„è§’åº¦ï¼Œé€‰æ‹©çš„è‡ªå·±ä¹Ÿæ˜¯ä¸€ä¸ªèµ·ç‚¹ï¼Œä»ç°åœ¨å¼€å§‹çš„æ¯ä¸€ä¸ªå†³å®šéƒ½ä¼šä¸æ–­çš„æ”¹å–„æœªæ¥çš„è‡ªå·±ã€‚ç®€å•æ¥è¯´å°±æ˜¯â€œç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨â€ï¼Œå› æ­¤ä»ç°åœ¨è¿™ä¸€åˆ»å¼€å§‹ï¼Œè®©å’±ä»¬ä¸ºäº†è‡ªå·±æ„Ÿå…´è¶£çš„äº‹æƒ…ï¼Œç–¯ç‹‚ä¸€æ¬¡å§\n","date":"2024-03-16T15:09:17+08:00","image":"https://sherlock-lin.github.io/p/%E6%80%BB%E8%A6%81%E6%9C%89%E4%B8%80%E6%AC%A1%E4%B8%BA%E8%87%AA%E5%B7%B1%E7%96%AF%E7%8B%82/image-20240316113459701_hu11518649223452192192.png","permalink":"https://sherlock-lin.github.io/p/%E6%80%BB%E8%A6%81%E6%9C%89%E4%B8%80%E6%AC%A1%E4%B8%BA%E8%87%AA%E5%B7%B1%E7%96%AF%E7%8B%82/","title":"æ€»è¦æœ‰ä¸€æ¬¡ï¼Œä¸ºè‡ªå·±ç–¯ç‹‚"},{"content":"å¼•è¨€ ç³»ç»Ÿå­¦ä¹ Pulsarçš„å¤§çº²\næ­£æ–‡ ä¸‹å›¾æ˜¯æˆ‘ç»˜åˆ¶çš„Pulsarå¤§çº² (ç”±äºæ—¶é—´ç¼˜æ•…èŠ±çš„æ¯”è¾ƒç²—ç³™ï¼Œè¿™å¼ å›¾ä¼šä¸å®šæœŸæ›´æ–°)\nå­¦ä¹ å¤§çº² ä¸€ã€Pulsar Client äºŒã€ç”Ÿäº§è€… Pulsaræ¶ˆæ¯è·¯ç”±æ·±å…¥å‰–æ ä¸‰ã€æ¶ˆè´¹è€… å››ã€Topic pulsaråŸæ¥æ˜¯è¿™æ ·æ“ä½œtopicçš„ äº”ã€Function Pulsar3.2 Functionçš„ä»‹ç»ä¸ä½¿ç”¨ Pulsar IOå®æˆ˜ Workerè°ƒåº¦ç®¡ç†å™¨åŸç†è§£æ å…­ã€Schema Registry Pulsar Schemaä½¿ç”¨åŸç†ä»‹ç» ä¸ƒã€å­˜å‚¨ç®¡ç† è¯¦è§£bookkeeper AutoRecoveryæœºåˆ¶ å…«ã€ç»¼åˆ ä¹ã€é«˜å¯ç”¨ å­¦ä¹ èµ„æ–™ å®˜æ–¹æ–‡æ¡£\nPulsarä¸‰æœ¬ä¹¦ç±\nã€ŠMastering Apache Pulsarã€‹ï¼šä¸ªäººè®¤ä¸ºæ˜¯Pulsarç³»ç»Ÿèµ„æ–™æœ€å¥½çš„ï¼Œå–œæ¬¢Pulsarçš„ä¼™ä¼´åŠ¡å¿…é˜…è¯»æ­¤ç»å…¸\nã€Šæ·±å…¥è§£æApace Pulsarã€‹ï¼šæ—ç³å¤§ä½¬çš„ä½œå“ï¼Œå…¼å¤‡ä½¿ç”¨ã€è°ƒä¼˜ä»¥åŠåŸç†çš„ä»‹ç»\nã€ŠApache Pulsar in Actionã€‹ï¼šç›®å½•å¸ƒå±€ä¸å¤ªå¥½ï¼Œä½†é’ˆå¯¹ä¸ªåˆ«çŸ¥è¯†ç‚¹è®²å¾—æ¯”è¾ƒç²¾ç»†ï¼Œå¯ä½œä¸ºè¡¥å……è¯»ç‰©\nPulsarå®˜æ–¹æ•´ç†èµ„æ–™å¤§å…¨ï¼šæ”¶å½•äº†å¤§é‡Pulsarä½¿ç”¨ã€åŸç†ã€ä¸šåŠ¡åœºæ™¯ç­‰ç²¾å½©çš„æ–‡ç« èµ„æ–™\næƒ³å¯¹æœ¬ç³»åˆ—æ–‡ç« è¯»è€…è¯´çš„è¯ å¦ç™½äº†è¯´ï¼Œç°å¦‚ä»Šçš„ç½‘ç»œç¯å¢ƒä¸åƒè¿‡å»é‚£ä¹ˆå‹å¥½(è¿™ä¸ªè§‚ç‚¹ä¸åšä»»ä½•è®¨è®ºï¼Œå¦‚æœä½ è§‰å¾—ä¸å¯¹ï¼Œé‚£ä¹ˆä½ æ˜¯å¯¹çš„)ï¼Œå¦‚ä»Šè¿˜èƒ½åšæŒåœ¨ç½‘ç»œä¸Šè¾“å‡ºé«˜è´¨é‡çš„ä½œè€…éƒ½æ˜¯å€¼å¾—å°Šæ•¬çš„ã€‚æˆ‘ä¹‹æ‰€ä»¥å†™è¿™ç³»åˆ—æ–‡ç« çš„ç›®çš„æœ‰ä»¥ä¸‹ä¸‰ç‚¹ï¼š1. æ¥è§¦æŠ€æœ¯è¿™äº›å¹´ï¼Œå—åˆ°ä¸å°‘å¤§ä½¬æ–‡ç« çš„ç†é™¶ï¼ŒæŠ€æœ¯å’Œæ€ç»´éƒ½æœ‰äº†ä¸å°‘çš„æå‡ï¼Œå› æ­¤ä¹Ÿæƒ³åšäº›å›é¦ˆäºæŠ€æœ¯ç¤¾åŒºçš„äº‹æƒ… 2. æˆ‘çŸ¥é“ä¸€å®šæœ‰ä¸å°‘å¯¹æŠ€æœ¯å……æ»¡çƒ­æƒ…çš„å°ç™½ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿä»¥Pulsarä¸ºåˆ‡å…¥ç‚¹ç»™ä½ å¸¦æ¥æŠ€æœ¯çš„ä¹è¶£ 3. é€šè¿‡è¾“å‡ºæ–‡ç« æ¥å€’æ¨è‡ªå·±æŒç»­é˜…è¯»ã€æå‡è‡ªå·±æç‚¼æŠ½è±¡èƒ½åŠ›ã€‚\næˆ‘èƒ½ä¿è¯çš„æ˜¯ä»¥ä¸‹å‡ ç‚¹\nè¿™ä¸ªç³»åˆ—çš„æ–‡ç« æ°¸ä¸æ”¶è´¹(é™ä½å¤§å®¶é˜…è¯»æˆæœ¬) è¾“å‡ºçš„å†…å®¹éƒ½æ˜¯ç»è¿‡æ€è€ƒçš„ï¼Œæ‹’ç»å¤åˆ¶å¼ è´´ä»¥åŠä½ä»·å€¼çš„ä¸œè¥¿ å°½å¯èƒ½ä»¥å›¾ã€ç²¾ç®€çš„è¯æ¥ååŠ©å¤§å®¶ä¼™å¯¹æŸä¸ªçŸ¥è¯†ç‚¹çš„ç†è§£ ä¸åšæ¨¡å‡Œä¸¤å¯çš„è§£é‡Šï¼Œå®å¯åæ¿€çš„ç»™ä¸ªé”™è¯¯çš„ç­”æ¡ˆï¼Œæˆ‘ç›¸ä¿¡æœ‰ä¸€å®šä¾æ®æ”¯æ’‘çš„é”™è¯¯ç­”æ¡ˆä»·å€¼å¤§äºæ¨¡ç³Šä¸æ¸…çš„æ¦‚å¿µ é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºæœ¬äººçš„çŸ¥è¯†é‡ä»¥åŠè®¤çŸ¥æœ‰é™ï¼Œå¦‚æœæœ‰æŸä¸ªçŸ¥è¯†è¡¨è¿°ä¸æ¸…æ¥šæˆ–è€…è¡¨è¾¾æœ‰è¯¯çš„åœ°æ–¹ï¼Œæ³è¯·æŒ‡å‡ºï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ å…±åŒè¿›æ­¥ï½\n","date":"2024-03-16T10:34:56+08:00","image":"https://sherlock-lin.github.io/p/pulsar%E4%BB%8E%E5%85%A5%E8%BF%B7%E5%88%B0%E5%85%A5%E9%AD%94%E4%B9%8B%E8%B7%AF/image-20240316103554735_hu8487334652089443369.png","permalink":"https://sherlock-lin.github.io/p/pulsar%E4%BB%8E%E5%85%A5%E8%BF%B7%E5%88%B0%E5%85%A5%E9%AD%94%E4%B9%8B%E8%B7%AF/","title":"Pulsarä»å…¥è¿·åˆ°å…¥é­”ä¹‹è·¯"},{"content":"æ¦‚è¿° å¤§æ•°æ®èƒŒæ™¯ä¸‹ï¼Œåˆ†åŒºåº”è¯¥æ˜¯æ‰€æœ‰ç»„ä»¶å¿…å¤‡çš„åŸºæœ¬æ¡ä»¶ï¼Œå¦åˆ™é¢å¯¹æµ·é‡æ•°æ®æ—¶æ— è®ºæ˜¯è®¡ç®—è¿˜æ˜¯å­˜å‚¨éƒ½å®¹æ˜“é‡åˆ°ç“¶é¢ˆã€‚è·Ÿå…¶ä»–æ¶ˆæ¯ç³»ç»Ÿä¸€æ ·ï¼ŒPulsaré€šè¿‡Topicå°†æ¶ˆæ¯æ•°æ®è¿›è¡Œä¸šåŠ¡å±‚é¢åˆ’åˆ†ç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒTopicåˆ†åŒºï¼Œé€šè¿‡å°†å¤šä¸ªåˆ†åŒºåˆ†å¸ƒåœ¨å¤šå°Broker/æœºå™¨ä¸Šä»è€Œå¸¦æ¥æ€§èƒ½ä¸Šçš„å·¨å¤§æå‡ä»¥åŠæ— é™çš„æ¨ªå‘æ‹“å±•èƒ½åŠ›ã€‚è€Œä¸€æ—¦æœ‰äº†åˆ†åŒºä¹‹åå°±ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼Œä½†ä¸€æ¡æ•°æ®è¯·æ±‚æ—¶åº”è¯¥å°†å…¶å‘å¾€å“ªä¸ªåˆ†åŒºï¼Ÿç›®å‰Pulsarè·Ÿå…¶ä»–æ¶ˆæ¯ç³»ç»Ÿä¸€æ ·æ”¯æŒä»¥ä¸‹ä¸‰ç§è·¯ç”±æ¨¡å¼ã€‚\nè½®è¯¢è·¯ç”± ç”Ÿäº§è€…ä¼šæŒ‰å°†æ¶ˆæ¯æŒ‰æ‰¹ä¸ºå•ä½è½®è¯¢å‘é€åˆ°ä¸åŒçš„åˆ†åŒºï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„è·¯ç”±ç­–ç•¥ï¼Œå…·æœ‰ç®€å•çš„ä¼˜åŠ¿ï¼Œç”±äºå®ƒä¸éœ€è¦è¿‡å¤šçš„é…ç½®ä»¥åŠè€ƒè™‘ä½†å´å¯ä»¥è¡¨ç°ä¸é”™çš„æ€§èƒ½ã€‚å¦‚æœæ¶ˆæ¯å¸¦æœ‰keyçš„è¯ä¼šæ ¹æ®keyè¿›è¡Œå“ˆå¸Œè¿ç®—åå†å¯¹åˆ†åŒºè¿›è¡Œå–æ¨¡æ¥å†³å®šæ¶ˆæ¯æŠ•æ”¾çš„ç›®æ ‡åˆ†åŒºã€‚ å•åˆ†åŒºè·¯ç”± å•åˆ†åŒºè·¯ç”±æä¾›ä¸€ç§æ›´ç®€å•çš„æœºåˆ¶ï¼Œå®ƒä¼šå°†æ‰€æœ‰æ¶ˆæ¯è·¯ç”±åˆ°åŒä¸€ä¸ªåˆ†åŒºã€‚è¿™ç§æ¨¡å¼ç±»ä¼¼éåˆ†åŒºTopicï¼Œå¦‚æœæ¶ˆæ¯æä¾›keyçš„è¯å°†æ¢å¤åˆ°è½®è¯¢å“ˆå¸Œè·¯ç”±æ–¹å¼ è‡ªå®šä¹‰åˆ†åŒºè·¯ç”± è‡ªå®šä¹‰åˆ†åŒºè·¯ç”±æ”¯æŒä½ é€šè¿‡å®ç°MessageRouteræ¥å£æ¥è‡ªå®šä¹‰è·¯ç”±é€»è¾‘ï¼Œä¾‹å¦‚å°†ç‰¹å®škeyçš„æ¶ˆæ¯å‘åˆ°æŒ‡å®šçš„åˆ†åŒºç­‰ å®æˆ˜ æ¶ˆæ¯è·¯ç”±å‘ç”Ÿåœ¨ç”Ÿäº§è€…ç«¯ï¼Œåœ¨åˆ›å»ºç”Ÿäº§è€…æ˜¯é€šè¿‡ .messageRoutingMode() è¿›è¡ŒæŒ‡å®šï¼Œä¸‹é¢å°±åˆ†åˆ«å®æˆ˜å¯¹æ¯”ä¸‹è¿™ä¸‰ç§çš„è·¯ç”±æ•ˆæœ\nè½®è¯¢è·¯ç”± å…ˆè¯•è¯•è½®è¯¢è·¯ç”±çš„ç­–ç•¥ï¼Œè¿™æ˜¯æœ€å¸¸è§ä¹Ÿæ˜¯é»˜è®¤çš„è·¯ç”±ç­–ç•¥ï¼Œé€šè¿‡ .messageRoutingMode(MessageRoutingMode.RoundRobinPartition) è¿›è¡ŒæŒ‡å®šï¼Œç„¶åå¾€é‡Œé¢é€šè¿‡åŒæ­¥æ–¹å¼å¾€åˆ†åŒºTopicé‡Œé¢å†™å…¥æ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 12 String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); Producer\u0026lt;String\u0026gt; producer = pulsarClient.newProducer(Schema.STRING) .topic(\u0026#34;sherlock-api-tenant-1/sherlock-namespace-1/partition_partition_topic_2\u0026#34;) .messageRoutingMode(MessageRoutingMode.RoundRobinPartition) //.messageRoutingMode(MessageRoutingMode.SinglePartition) .create(); for (int i = 0; i \u0026lt; 20000; i++) { producer.send(\u0026#34;hello java API pulsar:\u0026#34;+i+\u0026#34;, å½“å‰æ—¶é—´ä¸ºï¼š\u0026#34;+new Date()); } é€šè¿‡ç®¡ç†é¡µé¢å¯ä»¥çœ‹åˆ°æ•°æ®åŸºæœ¬å‡åŒ€çš„è½åœ¨å„ä¸ªåˆ†åŒºï¼Œä»è¿™ä¸ªç»“æœæ˜¯èƒ½å¤Ÿåå‘éªŒè¯æ•°æ®æ˜¯ç¬¦åˆè½®è¯¢å‘é€åçš„æ•ˆæœ\nå•åˆ†åŒºè·¯ç”± ç°åœ¨è¯•è¯•å•åˆ†åŒºè·¯ç”±çš„ç­–ç•¥ï¼Œé€šè¿‡ .messageRoutingMode(MessageRoutingMode.SinglePartition) è¿›è¡ŒæŒ‡å®šï¼Œå¹¶å¾€åˆ†åŒºTopicé‡Œé¢å†™å…¥ä¸€æ‰¹æ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); Producer\u0026lt;String\u0026gt; producer = pulsarClient.newProducer(Schema.STRING) .topic(\u0026#34;sherlock-api-tenant-1/sherlock-namespace-1/partition_partition_topic_2\u0026#34;) .messageRoutingMode(MessageRoutingMode.SinglePartition) .create(); for (int i = 0; i \u0026lt; 20000; i++) { producer.send(\u0026#34;hello java API pulsar:\u0026#34;+i+\u0026#34;, å½“å‰æ—¶é—´ä¸ºï¼š\u0026#34;+new Date()); } é€šè¿‡ç®¡ç†é¡µé¢å¯ä»¥çœ‹åˆ°æ•°æ®éƒ½è½åœ¨ç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œè¯´æ˜è¿™ä¹Ÿç¬¦åˆå®˜ç½‘ä¸­å¯¹å•åˆ†åŒºè·¯ç”±çš„æè¿°ã€‚åŒæ—¶ç»è¿‡åå¤è¯•éªŒå¤šæ¬¡å‘ç°ï¼Œç”Ÿäº§è€…ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªåˆ†åŒºå¹¶å°†æ‰€æœ‰æ•°æ®å‘é€åˆ°è¿™ä¸ªåˆ†åŒºã€‚\nè‡ªå®šä¹‰è·¯ç”± åœ¨æœ‰äº›ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦å°†è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘â€œèå…¥â€è·¯ç”±ç­–ç•¥ï¼Œå› æ­¤åƒPulsarã€Kafkaç­‰æ¶ˆæ¯ä¸­é—´ä»¶éƒ½æ˜¯æ”¯æŒç”¨æˆ·è¿›è¡Œè·¯ç”±è§„åˆ™çš„è‡ªå®šä¹‰çš„ã€‚è¿™é‡Œä¸ºäº†å¥½ç©ï¼Œå’±ä»¬å°è¯•å°†æ•°æ®æŒ‰ç…§ 1:2:3:4 ç­‰æ¯”ä¾‹åˆ†åˆ«è½åœ¨å››ä¸ªåˆ†åŒºå¦‚ä½•ï¼Ÿè¯´å¹²å°±å¹²ï¼Œè‡ªå®šä¹‰è·¯ç”±ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œåªéœ€è¦å®ç°Pulsar MessageRouteræ¥å£çš„choosePartitionæ–¹æ³•å³å¯ï¼Œå®ç°é€»è¾‘å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 public class SherlockRouter implements MessageRouter { Long count = 0L; public int choosePartition(Message\u0026lt;?\u0026gt; msg, TopicMetadata metadata) { count++; count = count % 10; if (count == 0) return 0; if (count \u0026lt; 3) return 1; if (count \u0026lt; 6) return 2; return 3; } } é€šè¿‡ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå‚æ•°msgå°±æ˜¯ç”Ÿäº§è€…ä¸­å›½å‘¢å‘é€çš„æ¶ˆæ¯å¯¹è±¡ï¼Œmetadataæ˜¯è¿™æ¡æ¶ˆæ¯çš„å…ƒæ•°æ®å¦‚ç§Ÿæˆ·ã€å‘½åç©ºé—´ç­‰ç­‰ï¼Œè€Œè¿”å›å€¼å…¶å®å°±æ˜¯è¿™ä¸ªTopicåˆ†åŒºçš„ä¸‹æ ‡ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸è¦è¶…è¿‡Topicçš„åˆ†åŒºæ•°ï¼ŒåŒæ—¶ä¸€äº›æ¯”è¾ƒå¤æ‚çš„æ•°æ®å¤„ç†é€»è¾‘ä»£ç å°½é‡ä¸è¦å†™åœ¨è¿™é‡Œå½±å“æ¶ˆæ¯å‘é€æ€§èƒ½ä»¥åŠä¸è§„èŒƒã€‚\nå†™å®Œåé€šè¿‡ .messageRouter() æ–¹æ³•è¿›è¡ŒæŒ‡å®šå³å¯ä½¿ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public static void customRoundSchemaProducer() throws Exception { String serverUrl = \u0026#34;http://localhost:8080\u0026#34;; PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(serverUrl).build(); Producer\u0026lt;String\u0026gt; producer = pulsarClient.newProducer(Schema.STRING) .topic(\u0026#34;sherlock-api-tenant-1/sherlock-namespace-1/partition_partition_topic_3\u0026#34;) .messageRouter(new SherlockRouter()) .create(); for (int i = 0; i \u0026lt; 20000; i++) { producer.send(\u0026#34;hello java API pulsar:\u0026#34;+i+\u0026#34;, å½“å‰æ—¶é—´ä¸ºï¼š\u0026#34;+new Date()); } producer.close(); pulsarClient.close(); } åœ¨ç®¡ç†é¡µé¢å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®æ˜¯æŒ‰ç…§å’±ä»¬é¢„æœŸçš„é€»è¾‘ 1:2:3:4ç­‰æ¯”è½åœ¨åˆ†åŒºé‡Œé¢ï¼Œå˜¿å˜¿ï½\næºç åˆ†æ æ¥å£ä»¥åŠçˆ¶ç±» Pulsarä¸­æ‰€æœ‰è·¯ç”±è§„åˆ™éƒ½æ˜¯åŸºäºMessageRouteræ¥å£è¿›è¡Œå®ç°çš„ï¼Œè¿™ä¸ªæ¥å£ä¸»è¦æä¾›äº†choosePartitionæ–¹æ³•ï¼Œåªè¦é‡å†™è¿™ä¸ªæ–¹æ³•å³å¯è‡ªå®šä¹‰ä»»æ„è‡ªå·±é¢„æœŸçš„é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 @InterfaceAudience.Public @InterfaceStability.Stable public interface MessageRouter extends Serializable { /** * * @param msg * Message object * @return The index of the partition to use for the message * @deprecated since 1.22.0. Please use {@link #choosePartition(Message, TopicMetadata)} instead. */ @Deprecated default int choosePartition(Message\u0026lt;?\u0026gt; msg) { throw new UnsupportedOperationException(\u0026#34;Use #choosePartition(Message, TopicMetadata) instead\u0026#34;); } /** * Choose a partition based on msg and the topic metadata. * * @param msg message to route * @param metadata topic metadata * @return the partition to route the message. * @since 1.22.0 */ default int choosePartition(Message\u0026lt;?\u0026gt; msg, TopicMetadata metadata) { return choosePartition(msg); } } MessageRouterBaseæ˜¯è·¯ç”±ç­–ç•¥çš„æŠ½è±¡ç±»ï¼Œä¸»è¦å®šä¹‰äº†æ¶ˆæ¯æœ‰keyæ—¶çš„å“ˆå¸Œç®—æ³•ï¼Œåƒä¸Šé¢æçš„è½®è¯¢è·¯ç”±å’Œå•åˆ†åŒºè·¯ç”±ç»§æ‰¿äº†è¿™ä¸ªæŠ½è±¡ç±»ã€‚JavaStringHashå’ŒMurmur3Hash32ä¸¤ä¸ªéƒ½æ˜¯Pulsaræä¾›çš„å“ˆå¸Œç®—æ³•çš„å®ç°ç±»ï¼Œä¸¤è€…çš„å·®å¼‚åé¢å†å•ç‹¬è¿›è¡Œåˆ†æ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public abstract class MessageRouterBase implements MessageRouter { private static final long serialVersionUID = 1L; protected final Hash hash; MessageRouterBase(HashingScheme hashingScheme) { switch (hashingScheme) { case JavaStringHash: this.hash = JavaStringHash.getInstance(); break; case Murmur3_32Hash: default: this.hash = Murmur3Hash32.getInstance(); } } } è½®è¯¢è·¯ç”±çš„å®ç° ä¸»è¦çœ‹choosePartition æ–¹æ³•çš„é€»è¾‘ï¼Œé¦–å…ˆå¦‚æœæ¶ˆæ¯å¸¦æœ‰keyåˆ™é’ˆå¯¹keyè¿›è¡Œå“ˆå¸Œç„¶åå–æ¨¡ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç›¸åŒkeyçš„æ¶ˆæ¯è½åœ¨åŒä¸€ä¸ªåˆ†åŒºã€‚ç„¶åå°±æ˜¯åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦æŒ‰æ‰¹æ¬¡è¿›è¡Œå‘é€çš„ï¼Œå¦‚æœæ˜¯å•æ¡æ¶ˆæ¯å‘é€çš„è¯åˆ™é€šè¿‡ä¸€ä¸ªç´¯åŠ è®¡æ•°å™¨è¿›è¡Œè½®è¯¢åˆ†åŒºï¼Œå³å¯è¾¾åˆ°æ¶ˆæ¯æŒ‰ç…§åˆ†åŒºé¡ºåºé€ä¸ªå‘é€çš„æ•ˆæœï¼›å¦‚æœæ˜¯æŒ‰æ‰¹æ¬¡å‘é€çš„è¯ï¼Œåˆ™æ˜¯æ ¹æ®æ—¶é—´æˆ³è¿›è¡Œå–æ¨¡ï¼Œè¿™æ ·è¾¾åˆ°çš„æ•ˆæœå°±æ˜¯æ¯æ‰¹æ•°æ®éƒ½ä¼šéšæœºå‘é€åˆ°æŸä¸€ä¸ªåˆ†åŒº\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 public class RoundRobinPartitionMessageRouterImpl extends MessageRouterBase { @SuppressWarnings(\u0026#34;unused\u0026#34;) private volatile int partitionIndex = 0; private final int startPtnIdx; private final boolean isBatchingEnabled; private final long partitionSwitchMs; .... @Override public int choosePartition(Message\u0026lt;?\u0026gt; msg, TopicMetadata topicMetadata) { // If the message has a key, it supersedes the round robin routing policy if (msg.hasKey()) { return signSafeMod(hash.makeHash(msg.getKey()), topicMetadata.numPartitions()); } if (isBatchingEnabled) { // if batching is enabled, choose partition on `partitionSwitchMs` boundary. long currentMs = clock.millis(); return signSafeMod(currentMs / partitionSwitchMs + startPtnIdx, topicMetadata.numPartitions()); } else { return signSafeMod(PARTITION_INDEX_UPDATER.getAndIncrement(this), topicMetadata.numPartitions()); } } } å•åˆ†åŒºè·¯ç”± å¯ä»¥çœ‹åˆ°å•åˆ†åŒºçš„é€»è¾‘æ˜¯æ¯”è¾ƒç®€å•ä¸”æ¸…æ™°çš„ï¼Œå¦‚æœæœ‰keyå°±è¿›è¡Œå“ˆå¸Œå–æ¨¡ï¼Œå¦åˆ™å°±å‘é€åˆ°partitionIndexè¿™ä¸ªæˆå‘˜å˜é‡æŒ‡å®šçš„åˆ†åŒºå»ï¼Œé‚£ä¹ˆè¿™ä¸ªpartitionIndexæŒ‡å®šçš„æ˜¯å“ªä¸ªåˆ†åŒºå‘¢ï¼Ÿé€šè¿‡ä»£ç èƒ½çœ‹åˆ°æ˜¯ä»æ„é€ å‡½æ•°é‡Œé¢ä¼ è¿›æ¥çš„ï¼Œå› æ­¤è·Ÿè¸ªä¸‹ä»£ç çœ‹çœ‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public class SinglePartitionMessageRouterImpl extends MessageRouterBase { private final int partitionIndex; public SinglePartitionMessageRouterImpl(int partitionIndex, HashingScheme hashingScheme) { super(hashingScheme); this.partitionIndex = partitionIndex; } @Override public int choosePartition(Message\u0026lt;?\u0026gt; msg, TopicMetadata metadata) { // If the message has a key, it supersedes the single partition routing policy if (msg.hasKey()) { return signSafeMod(hash.makeHash(msg.getKey()), metadata.numPartitions()); } return partitionIndex; } } é€šè¿‡è·Ÿè¸ªå¯ä»¥çœ‹åˆ°æ˜¯åœ¨PartitionedProducerImplç±»çš„getMessageRouteræ–¹æ³•ä¸­è¿›è¡ŒSinglePartitionMessageRouterImplç±»çš„åˆå§‹åŒ–ï¼ŒåŒæ—¶æ˜¯é€šè¿‡ThreadLocalRandom.current().nextInt(topicMetadata.numPartitions()) æ¥ç”Ÿæˆä¸€ä¸ªå°äºåˆ†åŒºæ•°çš„éšæœºæ•°ï¼Œå› æ­¤å•åˆ†åŒºè·¯ç”±çš„åˆ†åŒºæ˜¯éšæœºæŒ‡å®šçš„ä¸€ä¸ªï¼Œè¿™ä¸ªç»“æœè·Ÿå’±ä»¬å®æˆ˜ä¸­æµ‹è¯•çš„æ•ˆæœæ˜¯å»åˆçš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå’±ä»¬è¿˜çœ‹åˆ° getMessageRouteræ–¹æ³•ä¸­ä¼šæ ¹æ®å’±ä»¬åœ¨åˆ›å»ºç”Ÿäº§è€…æ—¶ .messageRoutingMode æ–¹æ³•æŒ‡å®šçš„è·¯ç”±æ¨¡å¼æ¥åˆ›å»ºå¯¹åº”çš„è·¯ç”±å®ç°ç±»ï¼Œåœ¨è¿™é‡Œå¯ä»¥æ˜ç¡®çš„çœ‹åˆ°æ²¡æœ‰æŒ‡å®šçš„è¯é»˜è®¤å°±æ˜¯é‡‡ç”¨çš„è½®è¯¢è·¯ç”±è§„åˆ™\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 private MessageRouter getMessageRouter() { MessageRouter messageRouter; MessageRoutingMode messageRouteMode = conf.getMessageRoutingMode(); switch (messageRouteMode) { case CustomPartition: messageRouter = Objects.requireNonNull(conf.getCustomMessageRouter()); break; case SinglePartition: messageRouter = new SinglePartitionMessageRouterImpl( ThreadLocalRandom.current().nextInt(topicMetadata.numPartitions()), conf.getHashingScheme()); break; case RoundRobinPartition: default: messageRouter = new RoundRobinPartitionMessageRouterImpl( conf.getHashingScheme(), ThreadLocalRandom.current().nextInt(topicMetadata.numPartitions()), conf.isBatchingEnabled(), TimeUnit.MICROSECONDS.toMillis(conf.batchingPartitionSwitchFrequencyIntervalMicros())); } return messageRouter; } æ€»ç»“ é€šè¿‡ä»¥ä¸Šå†…å®¹ç›¸ä¿¡ä½ å¯¹Pulsarçš„è·¯ç”±è§„åˆ™æœ‰ä¸€å®šçš„äº†è§£äº†ï¼Œå¦‚æœæƒ³è¿›ä¸€æ­¥äº†è§£å¯ä»¥å°è¯•æŒ‰ç…§è‡ªå·±å–œå¥½å®ç°ä¸‹è·¯ç”±è§„åˆ™å¹¶è§‚æµ‹æ˜¯å¦æŒ‰ç…§é¢„æœŸè¿è¡Œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è·Ÿè¸ªPulsarçš„æºç çœ‹çœ‹å®ç°æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å¦‚æœæƒ³å½»åº•æŒæ¡Pulsarï¼Œæœ€å¥½è‡ªå·±è·Ÿè¸ªä¸‹Pulsarçš„ä¸€äº›æ ¸å¿ƒé€»è¾‘ï¼Œè¿™æ ·ä¸ä»…äº†è§£å…¶åº•å±‚æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Œä¹Ÿèƒ½åŠ æ·±ä½ å¯¹ä¸€äº›è®¾è®¡/ç‰¹æ€§çš„å°è±¡ã€‚\n","date":"2024-03-13T10:34:56+08:00","image":"https://sherlock-lin.github.io/p/pulsar%E6%B6%88%E6%81%AF%E8%B7%AF%E7%94%B1%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90/image-20240306152645225_hu5442259153227018439.png","permalink":"https://sherlock-lin.github.io/p/pulsar%E6%B6%88%E6%81%AF%E8%B7%AF%E7%94%B1%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90/","title":"Pulsaræ¶ˆæ¯è·¯ç”±æ·±å…¥å‰–æ"},{"content":"å¼•è¨€ ä»Šå¤©è·Ÿç€ å®˜æ–¹æ–‡æ¡£ åŸºäºdockerç©ä¸€æŠŠPulsar IOå§\næ¦‚è¦ åœ¨ç”¨æˆ·èƒ½å¤Ÿè½»æ¾çš„å°†æ¶ˆæ¯é˜Ÿåˆ—è·Ÿå…¶ä»–ç³»ç»Ÿ(æ•°æ®åº“ã€å…¶ä»–æ¶ˆæ¯ç³»ç»Ÿ)ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨æ‰æ˜¯æœ€å¼ºå¤§çš„ã€‚è€ŒPulsar IO connectorså¯ä»¥è®©ä½ å¾ˆè½»æ¾çš„åˆ›å»ºã€éƒ¨ç½²ä»¥åŠç®¡ç†è¿™äº›è·Ÿå¤–éƒ¨ç³»ç»Ÿçš„è¿æ¥ï¼Œä¾‹å¦‚mysqlã€kafkaã€cassandraç­‰ã€‚\nPulsar connectoråˆ†ä¸ºSourceå’ŒSinkä¸¤ç§ï¼ŒSource connectorä¼šå°†æ•°æ®ä»å¤–éƒ¨ç³»ç»Ÿå–‚ç»™Pulsarï¼Œè€ŒSink connectorè´Ÿè´£å°†æ•°æ®ä»Pulsarå–‚ç»™å¤–éƒ¨ç³»ç»Ÿã€‚\nPulsar connectoræ˜¯ä¸€ç§ç‰¹æ®Šçš„Functionï¼Œåªä¸è¿‡è¿™ä¸ªFunctionæŒæœ‰å…¶ä»–ç³»ç»Ÿçš„å®¢æˆ·ç«¯ä½œä¸ºpulsarä¸å…¶ä»–ç³»ç»Ÿçš„æ¡¥æ¢ï¼Œå®ƒåœ¨å¤„ç†ä¿è¯ä¸Šè·ŸFunctionæ˜¯ä¸€è‡´çš„ï¼Œåˆ†åˆ«æ˜¯æœ€å¤šä¸€æ¬¡ã€è‡³å°‘ä¸€æ¬¡ã€ç²¾å‡†ä¸€æ¬¡ã€‚å¤„ç†ä¿è¯ä¸ä»…ä¾é Pulsarï¼Œè¿˜è·Ÿå¤–éƒ¨ç³»ç»Ÿç›¸å…³ä»¥åŠå®ç°é€»è¾‘ç›¸å…³ã€‚\næœ€å¤šä¸€æ¬¡ï¼šå‘ç»™connectorçš„æ¶ˆæ¯æœ€å¤šå¤„ç†ä¸€æ¬¡æˆ–è€…ä¸åšå¤„ç† è‡³å°‘ä¸€æ¬¡ï¼šå‘ç»™connectorçš„æ¶ˆæ¯å¤„ç†ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ ç²¾å‡†ä¸€æ¬¡ï¼šå‘ç»™connectorçš„æ¶ˆæ¯åªå¤„ç†ä¸€æ¬¡ å®æˆ˜ å®‰è£…connector åœ¨ è¿™é‡Œ ä¸‹è½½å¯¹åº”çš„connectorï¼Œå…ˆé€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼Œåœ¨ç‚¹è¿› connectors ç›®å½•é€‰æ‹©å¯¹åº”çš„sourceæˆ–è€…sink\nå°†ä¸‹è½½çš„naræ–‡ä»¶æ”¾åˆ°pulsarå®‰è£…åœ°å€çš„connectors ç›®å½•ä¸‹(æ²¡æœ‰éœ€è¦åˆ›å»º)\nå¯åŠ¨Pulsar\né€šè¿‡æŒ‡ä»¤æŸ¥çœ‹æœåŠ¡connectorä¿¡æ¯ï¼Œå…ˆè¾“å‡ºä¸‹é¢è¿™æ ·çš„ä¿¡æ¯å°±è¯´æ˜connectorå·²ç»æ³¨å†Œåˆ°Pulsarä¸Šé¢äº†\n1 curl -s http://localhost:8080/admin/v2/functions/connectors å®‰è£…Cassandra åŸºäº brew install --cask --appdir=/Applications docker å®‰è£…docker(ä»…é’ˆå¯¹macç¯å¢ƒ)\nåŸºäºdockerè¿è¡Œ cassandraï¼ŒæˆåŠŸè¿è¡Œåé€šè¿‡ docker pså¯ä»¥çœ‹åˆ°CassandraæœåŠ¡å·²ç»èµ·æ¥äº†\n1 docker run -d --rm --name=cassandra -p 9042:9042 cassandra:3.11 é€šè¿‡ docker exec -ti cassandra cqlsh localhost è¿›å…¥CassandraæœåŠ¡çš„å®¹å™¨ï¼Œå¹¶é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤è¿›è¡Œåº“è¡¨çš„åˆå§‹åŒ–\n1 2 3 4 5 CREATE KEYSPACE pulsar_test_keyspace WITH replication = {\u0026#39;class\u0026#39;:\u0026#39;SimpleStrategy\u0026#39;, \u0026#39;replication_factor\u0026#39;:1}; USE pulsar_test_keyspace; CREATE TABLE pulsar_test_table (key text PRIMARY KEY, col text); å…ˆæŸ¥è¯¢è¯¥è¡¨ç¡®ä¿æ²¡æœ‰æ•°æ® select * from pulsar_test_table;\nåŠŸèƒ½éªŒè¯ å†™é…ç½®æ–‡ä»¶cassandra-sink.yml\n1 2 3 4 5 6 configs: roots: \u0026#34;localhost:9042\u0026#34; keyspace: \u0026#34;pulsar_test_keyspace\u0026#34; columnFamily: \u0026#34;pulsar_test_table\u0026#34; keyname: \u0026#34;key\u0026#34; columnName: \u0026#34;col\u0026#34; å¯åŠ¨å†™Cassandraçš„sinkï¼Œå¯åŠ¨åé€šè¿‡æŒ‡ä»¤æŸ¥çœ‹æ˜¾ç¤ºsinkå·²ç»æ­£å¸¸å¯åŠ¨\n1 2 3 4 5 6 7 pulsar-admin sinks create \\ --tenant public \\ --namespace default \\ --name cassandra-test-sink \\ --sink-type cassandra \\ --sink-config-file examples/cassandra-sink.yml \\ --inputs test_cassandra æ‰§è¡Œå‘½ä»¤æ‰¹é‡å¾€pulsarä¸­å†™å…¥æ•°æ®ï¼Œçœ‹æ˜¯å¦ä¼šæ­£å¸¸è¾“å‡ºåˆ°Cassandraä¸­\n1 for i in {0..9}; do pulsar-client produce -m \u0026#34;key-$i\u0026#34; -n 1 test_cassandra; done ç”±äºä¸Šé¢çš„æ“ä½œæ˜¯æœ‰å»¶è¿Ÿçš„ï¼Œæ‰€ä»¥ä¸æ–­çš„æŸ¥è¯¢Cassandraçš„è¡¨æ˜¯å¯ä»¥çœ‹åˆ°æ•°æ®åœ¨é€æ­¥çš„å¢åŠ ï¼Œå¹¶æœ€ç»ˆå†™æ»¡åæ¡æ•°æ®\næ€»ç»“ çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚ å­¦ä¹ ä¸èƒ½ä»…ä»…åœç•™åœ¨çº¸é¢ä¸Šæˆ–è€…ç†è®ºï¼Œè„±ç¦»ä½¿ç”¨å»æ¢è®¨è®¾è®¡æˆ–è€…æºç éƒ½æ˜¯ä¸åˆ‡å®é™…çš„ã€‚å› æ­¤ä»Šå¤©ä¸€èµ·ä½“éªŒäº†ä¸€æŠŠPulsar IOï¼Œé™¤æ­¤ä¹‹å¤–Pulsarè¿˜æä¾›äº†éå¸¸ä¸°å¯Œçš„è·Ÿå…¶ä»–ç³»ç»Ÿäº¤äº’çš„Connectorï¼Œè¯¦ç»†å¯ä»¥çœ‹ä¸Šé¢å‘çš„ä¸‹è½½åœ°å€å¹¶å°è¯•ä½¿ç”¨è‡ªå·±æ„Ÿå…´è¶£çš„Connectoræ„Ÿå—ä¸‹å®æ“çš„å¿«ä¹ï½\n","date":"2024-03-13T10:34:55+08:00","image":"https://sherlock-lin.github.io/p/pulsario%E5%AE%9E%E6%88%98/image-20240313191618099_hu9489298534787853151.png","permalink":"https://sherlock-lin.github.io/p/pulsario%E5%AE%9E%E6%88%98/","title":"PulsarIOå®æˆ˜"},{"content":"å¼•è¨€ ä¸ºä½•è¦æ¨¡å—åŒ–ï¼Œè¿™é‡Œçš„ä¸»ä½“æ˜¯äººï¼Œå®¢ä½“æ˜¯äº‹ç‰©ã€‚å½“äº‹ç‰©å¾ˆå°æ—¶ï¼Œäººå¯ä»¥å¾ˆè½»æ¾çš„è§£å†³ï¼›ä½†æ˜¯å½“äº‹ç‰©è¿œå¤§äºäººèƒ½å¤„ç†çš„èŒƒå›´æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘å¯¹å®ƒè¿›è¡Œæ¨¡å—åŒ–åˆ†è§£ã€‚æ¨¡å—åŒ–æ˜¯ä¸€ç§è§£å†³å¤æ‚é—®é¢˜çš„æ–¹å¼ï¼Œæ”¾ä¹‹å››æµ·è€Œçš†å¯ç”¨ï¼Œä»¥ä¸‹å°±ä¸¾å‡ ä¸ªä¾‹å­èŠèŠæ¨¡å—åŒ–\nåˆ†å°åˆ¶ å•†æœä¹‹å‰ï¼Œç»Ÿæ²»è€…ä¸€ä¸ªäººç®¡ç†ç¡•å¤§çš„ç–†åŸŸï¼Œæ•´ä¸ªç–†åŸŸå¤§å¤§å°å°äº‹éƒ½è¦è‡ªå·±æ“å¿ƒäº²åŠ›äº²ä¸ºï¼Œåƒå•†æœä¸å°±æ˜¯æœ€åè¢«å·å®¶äº†ï¼Œæ‰‹åŠ¨ç‹—å¤´ã€‚å› æ­¤å‘¨æœçš„ç»Ÿæ²»è€…é‡‡ç”¨åˆ†å°åˆ¶è¿›è¡Œç®¡ç†ï¼Œåºå¤§çš„å¸å›½ä¸å¥½æ‰“ç†é‚£å°±åˆ’åˆ†æˆå¤šå—é¢†åŸŸä¹Ÿå°±æ˜¯å°†å¤§çš„ä¸œè¥¿åˆ†è§£æˆä¸é‚£ä¹ˆå¤§çš„ä¸œè¥¿åˆ†åˆ«è¿›è¡Œç®¡ç†ï¼Œè€Œéšåæ˜¥ç§‹æˆ˜å›½ç›´åˆ°ç§¦æœåï¼Œå¼€å§‹å®è¡Œéƒ¡å¿åˆ¶ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å°†æ¨¡å—åˆ†è§£æ›´åŠ ç²¾ç»†åŒ–ï¼Œè¿™æ ·æ‰“ç†æ•´ä¸ªåºå¤§çš„å¸å›½å°±æ–¹ä¾¿å¾ˆå¤šï¼Œå¹¶ä¸”éå¸¸å¤§å¹…æé«˜äº†æ•´ä½“çš„æ•ˆç‡ï¼Œè¿™ä¸åœ¨çŸ­çŸ­å‡ åå¹´ä¿®é•¿åŸã€ç»Ÿä¸€åº¦é‡è¡¡ã€æ–‡å­—ç­‰ç­‰ã€‚è¿™äº›äº‹æƒ…è¦æ˜¯æ”¾åœ¨ç§¦æœå‰é‚£å‡ ä¹æ˜¯éš¾ä»¥æƒ³è±¡çš„ï¼Œä½†å› ä¸ºæ¨¡å—åŒ–äº†ï¼Œç›¸å½“äºæ¯ä¸ªå¿éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒå…·å¤‡è‡ªæˆ‘ç®¡ç†çš„åŠŸèƒ½ï¼Œè€Œç»Ÿæ²»è€…åˆ°å¿ä¹‹é—´çš„è¿™äº›å±‚çº§æœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨åšæ”¿ä»¤çš„ä¼ è¾¾ä»¥åŠç»“æœåé¦ˆã€‚è¿™ç§è®¾è®¡å¦‚ä¸‹å›¾ï¼Œæ¨¡å—åŒ–çš„ç¬¦å·åŒ–å…¶å®å°±æ˜¯ä¸€é¢—å¤šå‰æ ‘ï¼ŒåŸæœ¬è¦ä¸€ä¸ªäººç®¡ç†çš„å›½å®¶åˆ†æˆäº†6ä¸ªå¿ï¼ŒåŸæœ¬ä¸€ä¸ªäººè¦æ‰“ç†çš„äº‹æƒ…åˆ†æˆäº†6ä¸ªäººå¤„ç†å¹¶ä¸”è¿™æ˜¯å¯ä»¥æ— é™æ‰©å±•çš„ã€‚æ¯ä¸€å±‚å„å¸å…¶èŒï¼Œä»è€Œæ•´ä½“è¾¾åˆ°æœ€å¤§çš„æ•ˆç‡ã€‚\nå¤§æ•°æ® å¤§æ•°æ®æ—¶ä»£è¿æ¥çš„æ•°æ®çš„çˆ†ç‚¸å¼å¢é•¿ï¼Œåºå¤§çš„æ•°æ®åœ¨å­˜å‚¨å’Œè®¡ç®—ä¸Šéƒ½æˆäº†å¾ˆå¤§çš„éš¾é¢˜ï¼Œå› æ­¤å¤§ä½¬ä»¬é€šè¿‡è®¾è®¡æœ€ç»ˆé‡‡ç”¨äº†ç›®å‰ä¸‹é¢è¿™ç§æ–¹æ¡ˆï¼Œå°†æ•°æ®è¿›è¡Œæ‹†è§£ï¼Œå„ä¸ªå°æ•°æ®é›†åˆå†è½åœ¨å…·ä½“çš„æŸå°Linuxæœºå™¨ä¸Šè¿›è¡Œå­˜å‚¨æˆ–è€…è®¡ç®—\næ€»ç»“ ä¸Šé¢å°±æ˜¯æ¨¡å—åŒ–çš„å¥½å¤„ï¼ŒåŸæœ¬çœ‹ä¼¼ä¸å¯èƒ½å®Œæˆçš„ä¸œè¥¿é€šè¿‡æ¨¡å—åŒ–åˆ†è§£åéƒ½æ˜¯å¯ä»¥å®Œæˆçš„ã€‚å› æ­¤åœ¨è¿™é‡Œæƒ³è¡¨è¾¾çš„æ˜¯ï¼Œè™½ç„¶å­¦æµ·æ— æ¶¯ï¼Œä½†æ˜¯å¯¹äºå’±ä»¬çƒ­çˆ±çš„äº‹æƒ…ï¼Œå¯ä»¥åˆ©ç”¨å¥½è¿™ä¸ªæ–¹å¼ï¼Œå°†è¦åšçš„å¤§ä»»åŠ¡æˆ–è€…è¦å­¦ä¹ çš„å¤§çš„æ–¹å‘è¿›è¡Œåˆ†è§£ï¼Œç„¶ååœ¨é€ä¸ªæ”»å…‹ä¸€ä¸ªä¸ªå°å•å…ƒï¼Œå› æ­¤ä¸ç”¨å®³æ€•ä»»ä½•äº‹æƒ…ï¼Œå¤§èƒ†æŠ˜è…¾èµ·æ¥\n","date":"2024-03-05T15:09:15+08:00","image":"https://sherlock-lin.github.io/p/%E4%B8%87%E7%89%A9%E7%9A%86%E5%8F%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E5%88%86%E8%A7%A3/image-20240920152044106_hu17856311937218138140.png","permalink":"https://sherlock-lin.github.io/p/%E4%B8%87%E7%89%A9%E7%9A%86%E5%8F%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E5%88%86%E8%A7%A3/","title":"ä¸‡ç‰©çš†å¯æ¨¡å—åŒ–åˆ†è§£"},{"content":"å¼•è¨€ Pulsar Functionä¸­æœ€é‡è¦çš„è§’è‰²æ˜¯Workerï¼Œè€ŒWorkerä¸­æœ€æ ¸å¿ƒçš„ç±»å°±æ˜¯è°ƒåº¦ç®¡ç†å™¨SchedulerManagerï¼Œæœ¬ç¯‡åšå®¢å°±ä¸“é—¨å¯¹å®ƒè¿›è¡Œå‰–æ\næ­£æ–‡ SchedulerManagerèŒè´£æœ‰ä»¥ä¸‹ä¸¤ç‚¹\nä»»åŠ¡è°ƒåº¦ é‡å¹³è¡¡ ä»»åŠ¡è°ƒåº¦æ˜¯SchedulerManageræœ€é‡è¦çš„é€»è¾‘ï¼Œå’±ä»¬é€šè¿‡ pulsar-admin functions create xxx å¯åŠ¨ä¸€ä¸ªfunctionå®ä¾‹æ—¶ï¼ŒPulsar å¦‚ä½•å†³å®šåœ¨å“ªå°workeræ‰€åœ¨èŠ‚ç‚¹å¯åŠ¨è¿™ä¸ªfunctionå®ä¾‹ï¼Œè¿™å°±æ˜¯ä»»åŠ¡è°ƒåº¦è¦åšçš„äº‹æƒ…ï¼Œé™¤æ­¤ä¹‹å¤–ä»»åŠ¡è°ƒåº¦è¿˜åŒ…å«functionæ›´æ–°ã€åˆ é™¤ä»¥åŠä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚è€Œé‡å¹³è¡¡æ˜¯ç¨³å®šæ€§ç›¸å…³çš„ï¼Œå½“å’±ä»¬çš„functionå®ä¾‹åˆ†å¸ƒä¸å‡è¡¡æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶çš„æ¶æ­»ï¼Œæ—±çš„æ—±æ­»ï¼Œå› æ­¤éœ€è¦å’±ä»¬åšfunctionå®ä¾‹çš„é‡æ–°åˆ†é…ï¼Œè¿™ä¹Ÿæ˜¯SchedulerManagerè¦åšçš„äº‹æƒ…\nä»»åŠ¡è°ƒåº¦ åœ¨å¼€å§‹è®²è§£ä»»åŠ¡è°ƒåº¦ä¹‹å‰ï¼Œå’±ä»¬å…ˆçœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾\nå›¾ä¸­çš„ä¸Šä¸‹æ–¹åˆ†åˆ«æ˜¯ä¸¤ä¸ªworkerè¿›ç¨‹å®ä¾‹ï¼Œåœ¨å’±ä»¬é€šè¿‡ bin/pulsar functions-worker å¯åŠ¨workerè¿›ç¨‹æ—¶æœåŠ¡å†…éƒ¨ä¼šå¯åŠ¨consumerå¹¶ä»¥failoveræ–¹å¼æ¥åœ¨Brokerè¿›è¡Œæ¶ˆæ¯è®¢é˜…æ¶ˆè´¹ï¼Œfailoveræœºåˆ¶ä¿è¯åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªConsumerèƒ½è¿›è¡Œè®¢é˜…ï¼Œå› æ­¤Workeré€šè¿‡è¿™ä¸ªæœºåˆ¶æ¥è¿›è¡Œé€‰ä¸»ï¼ŒæˆåŠŸè®¢é˜…çš„workeræ™‹å‡ä¸ºleaderè´Ÿè´£ä»»åŠ¡çš„æ´¾å‘ï¼ŒæœªæˆåŠŸè®¢é˜…çš„workerå˜ä¸ºfollwerå¹¶é€šè¿‡Readerç›‘å¬Brokerä¸­çš„ä»»åŠ¡ã€‚å…¶ä¸­Leaderå’ŒFollwerçš„ä¸»è¦é€»è¾‘åˆ†åˆ«å¦‚ä¸‹\nworker-leader é€šè¿‡Consumer-failveræœºåˆ¶æˆä¸ºleaderåï¼Œä¼šç«‹é©¬å¯åŠ¨ä¸€ä¸ªProducerè´Ÿè´£å¾€Brokerä¸­å‘é€ä»»åŠ¡æ¶ˆæ¯ï¼Œæ¯å½“æœ‰æ–°å»ºå¯åŠ¨functionè¯·æ±‚è¿›æ¥ï¼Œå°±ä¼šå¾€Brokerä¸­å†™å…¥ä¸€æ¡å¯¹åº”çš„ä»»åŠ¡æ¶ˆæ¯ã€‚é™¤æ­¤ä¹‹å¤–Leaderè¿˜ä¼šé€šè¿‡Consumeræ¶ˆè´¹Brokerä¸­ä¿å­˜çš„å…ƒæ•°æ®ï¼Œå¹¶ä»¥Mapæ•°æ®ç»“æ„å­˜åœ¨å†…å­˜ä¸­ä½œä¸ºLeaderçš„å…ƒæ•°æ®ç®¡ç†çš„æ•°æ®æ¥æºï¼Œè¿™é‡Œçš„æ•°æ®æœ‰Functionä¿¡æ¯ã€Instanceä¿¡æ¯ç­‰ï¼Œåœ¨æ¥å—åˆ°æˆ‘ä¸è¯·æ±‚æ˜¯ä¹Ÿä¼šåŒæ­¥æ›´æ–°è¿™é‡Œï¼ŒåŒæ—¶ä¹Ÿä¼šå®šæœŸçš„æ ¹æ®å…ƒæ•°æ®æ£€æŸ¥æ¥æ’æŸ¥å‡ºå¼‚å¸¸çš„Functionã€Instanceç­‰ã€‚\nworker-follwer åœ¨workeræˆä¸ºfolloweråï¼Œä¼šå¯åŠ¨Readerç›‘å¬Brokerä¸­çš„ä»»åŠ¡ï¼Œå½“ç›‘å¬åˆ°æœ‰æ–°ä»»åŠ¡æ—¶ä¼šè°ƒç”¨ä»»åŠ¡ç®¡ç†å™¨è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚åœ¨æœ‰æ–°å¢å¯åŠ¨Functionæ—¶ï¼Œå¦‚æœæ˜¯é…ç½®çš„çº¿ç¨‹çº§åˆ«åˆ™ä»¥çº¿ç¨‹æ–¹å¼å¯åŠ¨Instanceï¼Œå¦‚æœæ˜¯é…ç½®çš„è¿›ç¨‹çº§åˆ«åˆ™ä¼šæ‹‰èµ·ä¸€ä¸ªç‹¬ç«‹çš„Instanceè¿›ç¨‹è¿›è¡ŒFunctionä»»åŠ¡çš„æ‰§è¡Œã€‚\næºç è§£æ è°ƒåº¦é€»è¾‘çš„ä¸»è¦å…¥å£åœ¨SchedulerManagerçš„invokeScheduleræ–¹æ³•\nè·å–æ‰€æœ‰Function ä»¥åŠInstance åˆ é™¤æ‰€æœ‰ä¸å­˜åœ¨çš„Function/Instanceçš„åˆ†é…å™¨ï¼ŒåŒæ—¶æ›´æ–°åˆ†é…å™¨çš„ä¿¡æ¯ å¦‚æœå…ƒæ•°æ®ç®¡ç†å™¨ä¸­å­˜æœ‰Functionï¼Œä½†æ˜¯è¿™ä¸ªFunctionå¯¹åº”çš„InstanceIDä¸å­˜åœ¨äºRuntimeç®¡ç†å™¨çš„Runtimeåˆ—è¡¨ åˆ™ä»Masterå…ƒæ•°æ®ä¸­åˆ é™¤ï¼Œå¹¶é€šè¿‡å†…éƒ¨Topicå‘é€ä¸€æ¡æ¸…é™¤è¿™ä¸ªInstanceç»™Worker é€šè¿‡å…ƒæ•°æ®æ¯”è¾ƒè·å–éœ€è¦æ–°å¢çš„Instanceå¹¶åŒ…è£…æˆAssignmentï¼Œé€šè¿‡å†…éƒ¨Topicå‘é€è¿™æ¡æ–°å¢Instanceç»™Worker è·å–è¿˜æœªå¯åŠ¨çš„Instanceå®ä¾‹ï¼Œå¹¶é€šè¿‡RoundRobinSchedulerçš„scheduleæ–¹æ³•æ´¾å‘åˆ°å¯¹åº”çš„WorkerèŠ‚ç‚¹è¿›è¡Œå¯åŠ¨ å¾ªç¯é€šè¿‡FunctionRuntimeManager.processAssignmentå¯åŠ¨Instance 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 void invokeScheduler() { long startTime = System.nanoTime(); //è·å–å½“å‰workeré›†ç¾¤ä¸­å¯ç”¨çš„workerèŠ‚ç‚¹ä¿¡æ¯ Set\u0026lt;String\u0026gt; availableWorkers = getCurrentAvailableWorkers(); //è·å–æ‰€æœ‰Function List\u0026lt;FunctionMetaData\u0026gt; allFunctions = functionMetaDataManager.getAllFunctionMetaData(); //è·å–æ‰€æœ‰Instance Map\u0026lt;String, Function.Instance\u0026gt; allInstances = computeAllInstances(allFunctions, functionRuntimeManager.getRuntimeFactory().externallyManaged()); //è·å–å½“å‰æ¯ä¸ª workerId-\u0026gt;(InstanceIdâ€”\u0026gt;ä»»åŠ¡) Map\u0026lt;String, Map\u0026lt;String, Assignment\u0026gt;\u0026gt; workerIdToAssignments = functionRuntimeManager .getCurrentAssignments(); // åˆå§‹åŒ–è°ƒåº¦çŠ¶æ€è®°å½•å™¨ SchedulerStats schedulerStats = new SchedulerStats(workerIdToAssignments, availableWorkers); //delete assignments of functions and instances that don\u0026#39;t exist anymore Iterator\u0026lt;Map.Entry\u0026lt;String, Map\u0026lt;String, Assignment\u0026gt;\u0026gt;\u0026gt; it = workerIdToAssignments.entrySet().iterator(); while (it.hasNext()) { Map.Entry\u0026lt;String, Map\u0026lt;String, Assignment\u0026gt;\u0026gt; workerIdToAssignmentEntry = it.next(); Map\u0026lt;String, Assignment\u0026gt; functionMap = workerIdToAssignmentEntry.getValue(); // remove instances that don\u0026#39;t exist anymore functionMap.entrySet().removeIf(entry -\u0026gt; { String fullyQualifiedInstanceId = entry.getKey(); boolean deleted = !allInstances.containsKey(fullyQualifiedInstanceId); if (deleted) { Assignment assignment = entry.getValue(); MessageId messageId = publishNewAssignment(assignment.toBuilder().build(), true); // Directly update in memory assignment cache since I am leader log.info(\u0026#34;Deleting assignment: {}\u0026#34;, assignment); functionRuntimeManager.deleteAssignment(fullyQualifiedInstanceId); // update message id associated with current view of assignments map lastMessageProduced = messageId; // æ›´æ–°çŠ¶æ€ schedulerStats.removedAssignment(assignment); } return deleted; }); // update assignment instances in case attributes of a function gets updated for (Map.Entry\u0026lt;String, Assignment\u0026gt; entry : functionMap.entrySet()) { String fullyQualifiedInstanceId = entry.getKey(); Assignment assignment = entry.getValue(); Function.Instance instance = allInstances.get(fullyQualifiedInstanceId); if (!assignment.getInstance().equals(instance)) { functionMap.put(fullyQualifiedInstanceId, assignment.toBuilder().setInstance(instance).build()); Assignment newAssignment = assignment.toBuilder().setInstance(instance).build().toBuilder().build(); MessageId messageId = publishNewAssignment(newAssignment, false); // Directly update in memory assignment cache since I am leader log.info(\u0026#34;Updating assignment: {}\u0026#34;, newAssignment); functionRuntimeManager.processAssignment(newAssignment); // update message id associated with current view of assignments map lastMessageProduced = messageId; //update stats schedulerStats.updatedAssignment(newAssignment); } if (functionMap.isEmpty()) { it.remove(); } } } List\u0026lt;Assignment\u0026gt; currentAssignments = workerIdToAssignments .entrySet() .stream() .filter(workerIdToAssignmentEntry -\u0026gt; { String workerId = workerIdToAssignmentEntry.getKey(); // remove assignments to workers that don\u0026#39;t exist / died for now. // wait for failure detector to unassign them in the future for re-scheduling return availableWorkers.contains(workerId); }) .flatMap(stringMapEntry -\u0026gt; stringMapEntry.getValue().values().stream()) .collect(Collectors.toList()); //è·å–æœªåˆ†é…çš„Functionä»»åŠ¡ Pair\u0026lt;List\u0026lt;Function.Instance\u0026gt;, List\u0026lt;Assignment\u0026gt;\u0026gt; unassignedInstances = getUnassignedFunctionInstances(workerIdToAssignments, allInstances); workerStatsManager.scheduleStrategyExecTimeStartStart(); //è§¦å‘ä»»åŠ¡çœŸæ­£è°ƒåº¦æ´¾å‘çš„å…¥å£ List\u0026lt;Assignment\u0026gt; assignments = scheduler.schedule(unassignedInstances.getLeft(), currentAssignments, availableWorkers); workerStatsManager.scheduleStrategyExecTimeStartEnd(); assignments.addAll(unassignedInstances.getRight()); if (log.isDebugEnabled()) { log.debug(\u0026#34;New assignments computed: {}\u0026#34;, assignments); } isCompactionNeeded.set(!assignments.isEmpty()); //æ›´æ–°åˆ°Leaderå†…å­˜ä¸­çš„å…ƒæ•°æ® for (Assignment assignment : assignments) { MessageId messageId = publishNewAssignment(assignment, false); // Directly update in memory assignment cache since I am leader log.info(\u0026#34;Adding assignment: {}\u0026#34;, assignment); functionRuntimeManager.processAssignment(assignment); // update message id associated with current view of assignments map lastMessageProduced = messageId; // update stats schedulerStats.newAssignment(assignment); } log.info(\u0026#34;Schedule summary - execution time: {} sec | total unassigned: {} | stats: {}\\n{}\u0026#34;, (System.nanoTime() - startTime) / Math.pow(10, 9), unassignedInstances.getLeft().size(), schedulerStats.getSummary(), schedulerStats); } æ€»ç»“ ä»¥ä¸Šå°±æ˜¯Pulsarä¸­Workerçš„è°ƒåº¦è¿‡ç¨‹ï¼Œè¿™é‡Œä¸»è¦æ˜¯ä»¥Workerç‹¬ç«‹éƒ¨ç½²çš„æ–¹å¼è¿›è¡Œè®²è§£çš„ï¼ŒåŸºäºBrokerå¯åŠ¨çš„Workeræ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œè·Ÿè¸ªä¸‹ä»£ç ã€‚\n","date":"2024-03-05T10:34:57+08:00","image":"https://sherlock-lin.github.io/p/worker%E8%B0%83%E5%BA%A6%E7%AE%A1%E7%90%86%E5%99%A8%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/image-20240305140605827-9618768_hu15216224640484705908.png","permalink":"https://sherlock-lin.github.io/p/worker%E8%B0%83%E5%BA%A6%E7%AE%A1%E7%90%86%E5%99%A8%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/","title":"Workerè°ƒåº¦ç®¡ç†å™¨åŸç†è§£æ"},{"content":"å¼•è¨€ ã€Šçš®å›Šã€‹é‡Œå‘Šè¯‰æˆ‘ä»¬ï¼Œæ¯ä¸ªäººéƒ½æ˜¯ç”±ä¸€å‰¯çš®å›Šå’Œä¸€ä¸ªçµé­‚ç»„æˆï¼Œçš®å›Šå°±åƒä¸€è¾†æ±½è½¦ï¼Œçµé­‚å°±åƒè¿™è¾†æ±½è½¦çš„é©¾é©¶å‘˜ï¼Œä»æ¯äº²çš„ç¾Šæ°´ä¸­ç¦»å¼€é‚£ä¸€åˆ»å°±å¯åŠ¨æ±½è½¦ï¼Œè€Œç»ˆç‚¹å°±æ˜¯æˆ‘ä»¬ç¦»å¼€è¿™ä¸ªä¸–ç•Œçš„é‚£ä¸€åˆ»ã€‚ä½†è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ˜¯è¿™å‰¯çš®å›Šçš„ï¼Œé‚£ä¹ˆçµé­‚å‘¢ï¼Ÿå›´ç»•è¿™ä¸ªé—®é¢˜å‡ åƒå¹´æ¥çš„æ™ºè€…ä»¬å·²ç»ç»™å‡ºå¾ˆå¤šç»“è®ºï¼Œä»¥åŠæ ¹æ®ä¸€äº›ç†è®ºåˆ›åŠå¯¹åº”è‡ªæ´½çš„çš„å®—æ•™ä¿¡ä»°ï¼Œè¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯è¦è®¨è®ºæ˜¯å¦æœ‰æ¥ä¸–çš„é—®é¢˜(ä»¥æˆ‘ç›®å‰çš„çŸ¥è¯†é‡ä¹Ÿæ²¡æ³•æƒ³åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ç»“è®º)ï¼Œä½†è¿™ç¯‡æ–‡ç« æƒ³è¡¨è¾¾çš„æ˜¯ï¼Œåœ¨æ±½è½¦è¡Œé©¶çš„è¿™æ®µè·¯ç¨‹ï¼Œå’±ä»¬ä½œä¸ºé©¾é©¶å‘˜æœ‰å“ªäº›å€¼å¾—æˆ‘ä»¬æ€è€ƒçš„ã€‚\nçš®å›Š-çµé­‚ä¾èµ–åè½¬ äººå¼€è½¦ï¼Œç†æƒ³æƒ…å†µä¸‹åº”è¯¥æ˜¯å¼€å¾€äººæƒ³å»çš„åœ°æ–¹ï¼Œè€Œä¸æ˜¯ä»»ç”±è½¦â€œè‡ªåŠ¨é©¾é©¶â€ï¼Œæˆ–è€…æ˜¯å‚è€ƒè½¦æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Œå¼€äº†å¤šå°‘é‡Œç¨‹æ•°äº†æ¥å†³å®šè‡ªå·±æƒ³å»çš„åœ°æ–¹ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ç”¨å¹´é¾„ã€ç¯å¢ƒç­‰ä¸œè¥¿æ¥æ†ç»‘ä½è‡ªå·±çš„â€œçš®å›Šâ€å‘¢ï¼Œä¾‹å¦‚ä»¥ä¸‹é—®é¢˜\næˆ‘ä»Šå¹´å·²ç»ä¸‰åä¸€äº†ï¼Œå–œæ¬¢ç¼–ç¨‹æƒ³å­¦ç¼–ç¨‹æ˜¯ä¸æ˜¯æœ‰äº›æ™šäº† è¦æ˜¯ä¸‰å¹´å‰å°±XXXå°±å¥½äº† æˆ‘çƒ­çˆ±å¹¶ä¸”æƒ³åšAï¼Œä½†æ˜¯æˆ‘çš„å·¥ä½œå†…å®¹å´ä¸€ç›´æ˜¯Bï¼Œå¥½è‹¦æ¼ \u0026hellip;. æ›´å¤šçš„ä¾‹å­å°±ä¸ä¸€ä¸€ä¾‹ä¸¾äº†ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ç”¨çš®å›ŠæŸç¼šä½äº†çµé­‚ï¼Œå¦‚æœä½ æƒ³é€å½»äº†ä½ ä¼šå‘ç°è¿™ä»¶äº‹æƒ…æ²¡é‚£ä¹ˆå¤æ‚ï¼Œå–œæ¬¢å»åšå°±å®Œäº†ï¼Œå°±è¿™ ä¹ˆç®€å•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçµé­‚ä¸è¯¥ç»™çš®å›ŠæœåŠ¡æˆ–è®©æ­¥ï¼Œåº”è¯¥æŠ˜è…¾å¥½çš®å›Šï¼Œåˆ©ç”¨å®ƒæœåŠ¡å¥½æˆ‘ä»¬çš„çµé­‚\nä½¿å‘½æ„Ÿ \u0026ldquo;äººæ´»ç€æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿ\u0026quot;ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¬è¿‡æ— æ•°ä¸ªç­”æ¡ˆï¼Œå¬è¿‡ä¸€ä¸ªæ¯”è¾ƒè®¤åŒçš„å°±æ˜¯ï¼Œâ€œæ¯ä¸ªäººæ¥åˆ°è¿™ä¸ªä¸–ç•Œä¸Šéƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ªä½¿å‘½ï¼Œæ¯ä¸ªçµé­‚è¦åšçš„å°±æ˜¯å‘ç°è¿™ä¸ªä½¿å‘½ï¼Œå¹¶ä¸ºå®ƒå¥‰ä¸Šè‡ªå·±çš„ä¸€åˆ‡â€ã€‚è¿™å°±æ˜¯æˆ‘åœ¨è¿™é‡Œæƒ³æçš„ä½¿å‘½æ„Ÿï¼Œå¦‚ä»Šçš„ç”Ÿæ´»æ˜¯ä¸ªç‰©è´¨å……è£•ä½†ç²¾ç¥åŒ®ä¹çš„ä¸–ç•Œï¼Œè™½ç„¶ä¸å°‘æœ‹å‹å·²ç»è§£å†³æ¸©é¥±è¿‡ä¸Šæ‰€è°“çš„â€œå°èµ„â€ç”Ÿæ´»ï¼Œä½†æˆå¤©é—·é—·ä¸ä¹ï¼Œç”šè‡³æœ‰ä¸ªåˆ«æ‚£ä¸Šç²¾ç¥ç–¾ç—…å¦‚æŠ‘éƒç—‡ã€‚é’ˆå¯¹ç²¾ç¥é—®é¢˜æˆ‘ä¹Ÿæ›¾ç»é¥±å—å›°æ‰°ï¼Œç°å¦‚ä»Šé€æ¸é†’æ‚Ÿè¿‡æ¥ä¹Ÿå¸Œæœ›èƒ½å¤Ÿå¸®åˆ°ä½ ï¼Œæˆ‘çš„æ–¹å¼å°±æ˜¯æ‰¾åˆ°è‡ªå·±çƒ­çˆ±çš„ä¸œè¥¿ä¹Ÿå°±æ˜¯è‡ªå·±çš„ä½¿å‘½ï¼Œç„¶åå½»åº•è´¯å½»å®ƒï¼Œä½†ä½ å°†å…¨éƒ¨çš„ç²¾åŠ›é›†ä¸­åœ¨è¿™ä¸ªç‚¹æ—¶ï¼Œåˆ†æ•£åœ¨å…¶ä»–ä¸å¿«ä¹çš„ç²¾åŠ›å°±ä¼šå°‘å¾ˆå¤šå¾ˆå¤šï¼ŒåŒæ—¶ç”±äºä½ åœ¨åšä¸€ä»¶ä½ çƒ­çˆ±çš„äº‹æƒ…æ—¶ï¼Œä½ ä¸ä¼šå®¹æ˜“è§‰å¾—ç´¯ç”šè‡³ä¼šè§‰å¾—æœ‰æ— ç©·çš„ç²¾åŠ›ã€‚\næˆ‘çš„ä½¿å‘½ åœ¨å¤§å­¦æ¥è§¦ç¼–ç¨‹æ—¶ï¼Œä¹Ÿæ›¾å¹»æƒ³ç”¨ä»£ç æ”¹å˜ä¸–ç•Œï¼ŒåŒæ—¶ä¹Ÿåœ¨é’»ç ”æ²‰æ·€è‡ªå·±çš„ä¸“ä¸šæŠ€èƒ½ã€‚ä½†æ˜¯åœ¨å·¥ä½œåå‘ç°å…¬å¸æ˜¯ä¸ªç›ˆåˆ©çš„æœºæ„ï¼Œæœ‰æ—¶å€™å®ƒæ‰€è¿½æ±‚çš„ä¸œè¥¿ä¼šé™åˆ¶ä½ä½ çš„å‘æŒ¥ï¼Œç”šè‡³ä¼šæœ‰å¾ˆå¤šä½ ä¸å–œæ¬¢çš„ä¸œè¥¿å……æ–¥ç€ä½ çš„ç”Ÿæ´»ï¼Œå¼€ä¸å®Œçš„ä¼šã€å¹²ä¸å®Œçš„æ´»ä»¥åŠå¾ˆå¤šæ¶ˆè€—ä½ ç²¾æ°”ç¥çš„äº‹æƒ…ï¼Œç»è¿‡è¿™äº›ä¸œè¥¿æ¶ˆç£¨åä½ å‘ç°è‡ªå·±å¯¹æŠ€æœ¯çš„çƒ­æƒ…ä¸å†ï¼Œä½†æ˜¯å½“ä½ çœŸçš„ä¸€æ®µæ—¶é—´ä¸æ¥è§¦æŠ€æœ¯åä½ é™·å…¥äº†æ›´å¤§çš„ç—›è‹¦ï¼Œä»¿ä½›ä¸¢äº†ç½—ç›˜çš„èˆªæµ·èˆ¹ä¸€èˆ¬æµ‘æµ‘å™©å™©ã€‚\næœ€ç»ˆç»è¿‡åˆ†æå‘ç°ï¼Œå…¶å®æ˜¯è¿èƒŒäº†è‡ªå·±çš„ä½¿å‘½ä»¥åŠç»™è‡ªå·±çš„ä¸åŠªåŠ›æ‰¾å€Ÿå£ï¼Œå½“ä½ çœŸçš„çƒ­çˆ±ä¸€ä¸ªä¸œè¥¿çš„æ—¶å€™ï¼Œå³ä¾¿æ˜¯ç¥æ˜éƒ½æ— æ³•é˜»æŒ¡ä½ å»è¿½æ±‚å®ƒã€‚å¦‚ä»Šåœ¨æŠ€æœ¯å±‚é¢æˆ‘ä¸ä¼šå†å»æ€è€ƒè¿™ä¸ªä¸œè¥¿ä¼šä¸ä¼šç»™è‡ªå·±å¸¦æ¥æ”¶ç›Šï¼Œåªè¦æ„Ÿå…´è¶£çš„é‚£å°±å­¦ä»¥åŠæ·±æŒ–ï¼›åœ¨å½¢å¼ä¸Šï¼Œæˆ‘ä¸åœ¨å±€é™äºç»™å¼€æºç¤¾åŒºè´¡çŒ®ä»£ç ï¼Œåƒè¾“å‡ºæŠ€æœ¯æ–‡ç« ï¼Œè¾“å‡ºå¿ƒå¾—ä½“ä¼šä¹Ÿæ˜¯ä¸€ç§åˆ›é€ ä»·å€¼çš„æ–¹å¼ï¼Œåªè¦èƒ½å¤Ÿå¤šå½±å“åˆ°ä¸€ä¸ªå°±å¤Ÿäº†ï¼Œè¿™æ˜¯æˆ‘çš„åˆè¡·ï¼Œè‡³äºç»“æœä¼šæ˜¯ä»€ä¹ˆäº¤ç»™æœªæ¥å§ï¼Œåªè¦åšæŒåšè‡ªå·±çƒ­çˆ±çš„äº‹æƒ…å°±å¤Ÿäº†ã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘çš„ä½¿å‘½æ˜¯ä»€ä¹ˆå‘¢ï¼Œç®€å•çš„è¯´å°±æ˜¯åˆ›é€ ï¼Œå†™è½¯ä»¶æ”¹å˜ä¸–ç•Œä¹Ÿæ˜¯åˆ›é€ ï¼Œè¾“å‡ºæ–‡ç« å½±å“è¯»è€…ä¹Ÿæ˜¯ä¸€ç§åˆ›é€ ï¼Œè¿™å°±æ˜¯æˆ‘çƒ­çˆ±çš„äº‹æƒ…å¹¶ä¸æ–­åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æå‡è‡ªå·±çš„æ€ç»´ï¼Œç”¨çš®å›ŠæœåŠ¡äºçµé­‚ã€‚\næ€»ç»“ æœ€åä¸å„ä½è¯»è€…åˆ†äº«ä¸€å¥è¯ï¼šäººæœ‰ä¸¤æ¬¡ç”Ÿå‘½çš„è¯ç”Ÿï¼Œä¸€æ¬¡æ˜¯ä½ è‚‰ä½“å‡ºç”Ÿï¼Œä¸€æ¬¡æ˜¯ä½ çµé­‚è§‰é†’ã€‚\n","date":"2024-02-28T15:09:16+08:00","image":"https://sherlock-lin.github.io/p/%E4%B8%80%E5%89%AF%E7%9A%AE%E5%9B%8A%E7%9A%84%E4%BD%BF%E5%91%BD/image-20240228143652107_hu11282021279702529150.png","permalink":"https://sherlock-lin.github.io/p/%E4%B8%80%E5%89%AF%E7%9A%AE%E5%9B%8A%E7%9A%84%E4%BD%BF%E5%91%BD/","title":"ä¸€å‰¯çš®å›Šçš„ä½¿å‘½"},{"content":"å¼•è¨€ éšç€ç”Ÿæ´»æ°´å¹³çš„æé«˜ï¼Œä¸å°‘äººçš„ç›®æ ‡ä»åŸå…ˆçš„è§£å†³æ¸©é¥±è½¬å˜ä¸ºè¿½æ±‚å†…å¿ƒå……å®ï¼Œä½†ç”±äºç°åœ¨çš„æ—¶é—´è¿‡å¾—è¶Šæ¥è¶Šå¿«ä»¥åŠå…¶ä»–å¤–éƒ¨å› ç´ ï¼Œæˆ‘ä»¬ å¯¹å¾ˆå¤šä¸œè¥¿çš„è·å–è¶Šæ¥è¶Šæ²¡è€å¿ƒï¼Œä¾‹å¦‚ä¹¦åº—ç»å¸¸ä¼šçœ‹åˆ°ã€Š7å¤©ç²¾é€šJavaã€‹ã€ã€Š3å¤©æŒæ¡XXXã€‹ç­‰ç­‰ä¹‹ç±»çš„ä¹¦ç±ï¼Œç„¶åå¤§è‡´ç¿»é˜…åä»¥åŠç»è¿‡çŸ­æš‚çš„å®æ“åï¼Œå¤šå·´èƒºå……æ–¥ç€èº«ä½“ï¼Œåœ¨è·å¾—äº«å—ååˆè´ªå©ªçš„å°†ç›®å…‰è½¬å‘ä¸‹ä¸€ä¸ªç›®æ ‡ï½æˆ‘ä»¬æ€»åœ¨å¿™ï¼Œæ€»åœ¨ä¸æ–­çš„å­¦ï¼Œä½†æ˜¯æœ€åå¤§æ¦‚ç‡ä¼šè¢«ç¤¾ä¼šçš„æ£’å­æ‰“å›åŸå‹ï¼Œæˆ‘ä»¬å…¶å®ä»€ä¹ˆéƒ½ä¸ä¼šã€‚åœ¨è·å¾—è¿™æ ·çš„ç­”æ¡ˆåï¼Œæˆ‘ä»¬ä¼šå˜çš„æ›´è´ªå©ªï¼Œè§‰å¾—æ˜¯è‡ªå·±ä¸å¤ŸåŠªåŠ›ï¼Œäºæ˜¯æ›´åŠ çš„æ‹¼å‘½å­¦ï¼Œå‘¨è€Œå¤å§‹ç›´åˆ°ç²¾ç–²åŠ›ç«­ï¼Œæœ€åæ‚²æ„¤é«˜å‘¼â€œä¸–é“å¦‚æ­¤ï¼Œæ‚²å¤«XXXâ€ï¼Œå› æ­¤åœ¨è¿™ç¯‡æ–‡ç« æƒ³è¡¨è¾¾çš„æ˜¯ï¼Œâ€œæ¬²é€Ÿåˆ™ä¸è¾¾ï¼Œæ…¢å°±æ˜¯å¿«â€\næŠ€æœ¯è¿·å¼ ä¸‰çš„æ‚²å“€ å¼ ä¸‰æ˜¯ä¸ªå¯¹æŠ€æœ¯å……æ»¡çƒ­æƒ…çš„ç¨‹åºå‘˜ï¼Œåœ¨å¤§å­¦æ—¶æœŸå…ˆæ¥è§¦çš„Javaç¼–ç¨‹è¯­è¨€ï¼Œäºæ˜¯ç…§ç€ã€Š7å¤©ç²¾é€šJavaã€‹æ•²å®Œä¸Šé¢çš„ä¾‹å­åï¼Œæ„Ÿè§‰å·²ç»æŒæ¡äº†Javaã€‚äºæ˜¯çœ‹ç€å®‰å“é£åç«å¦‚è¼æ—¶ï¼Œä¹Ÿè·Ÿç€ä¸‹è½½ä¸ªAndroidStudioå¼€å‘ä¸€äº›å°çš„APPï¼Œå¼€å‘å‡ºä¸€äº›å°caseåæ„Ÿè§‰å®‰å“ä¹Ÿå·®ä¸å¤šæŒæ¡äº†ï¼Œä½†æ˜¯å¦‚æœå†ç»§ç»­ç²¾è¿›çš„è¯å°±è¦ä»˜å‡ºæ›´å¤šçš„ç²¾åŠ›ï¼Œäºæ˜¯åœ¨å…¨æ ˆæµè¡Œçš„æ—¶å€™ï¼Œåˆè·Ÿç€å­¦ä¹ å‰ç«¯WebçŸ¥è¯†ï¼Œè‡ªå·±æ­å»ºä¸€ä¸ªå®Œæ•´çš„WebæœåŠ¡ç­‰ç­‰ã€‚åœ¨æ¯•ä¸šæ—¶ï¼Œå½“ä»–ä¿¡å¿ƒæ»¡æ»¡çš„å»é¢è¯•æ—¶ï¼Œè¢«é¢è¯•å®˜ç‹ ç‹ çš„æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦ï½äºæ˜¯ä»–åªèƒ½é€‰æ‹©ä¸€ä¸ªä¸ä¸Šä¸ä¸‹çš„å…¬å¸å…ˆå¹²ç€ï¼Œè¿™ä¸ªæ—¶å€™å¤§æ•°æ®é£å¤´æ¥äº†ï¼Œäºæ˜¯ä»–è¶ç€é£å¤´è½¬äº†å¤§æ•°æ®è¡Œä¸šï¼Œç”±äºä¹‹å‰é¢è¯•çš„ç»éªŒå‘Šè¯‰å®ƒï¼Œå­¦æŠ€æœ¯ä¸€å®šè¦æ·±æŒ–ï¼Œäºæ˜¯å‘¼åœ¨ç®€å•å­¦ä¹ ä¸€äº›åŸºç¡€çŸ¥è¯†åï¼Œå°±ç«‹é©¬å­å“§å­å“§çš„å•ƒèµ·äº†å¤§æ•°æ®ç»„ä»¶çš„æºç ï¼Œå‘³æ¶©éš¾æ‡‚æ²¡å…³ç³»ï¼Œçœ‹ä¸æ‡‚å°±çœ‹åˆ«äººè®²è§£ç”šè‡³å°è¯•å»èƒŒï¼Œä»–è§‰å¾—åªè¦æŠŠè¿™äº›çƒ­é—¨çš„ç»„ä»¶çš„ä»£ç éƒ½â€œææ‡‚â€é‚£è‡ªå·±å°±æ˜¯é¦™é¥½é¥½äº†ï¼Œæœ€ç»ˆä»–å·¥ä½œä¸Šè¿˜æ˜¯å››å¤„ç¢°å£ï¼Œä»–ä¸æœæ°”ï¼Œè§‰å¾—æ˜¯è‡ªå·±æ‡‚å¾—ä¸å¤Ÿå¤šï¼Œäºæ˜¯ä¹å•ƒå®ŒHadoopã€å•ƒHBaseã€Kafkaã€RocksDBã€ClickHouseç­‰ç­‰ï¼Œç”šè‡³ç¼–ç¨‹è¯­è¨€è¿˜å»å­¦Pythonã€Rustã€Goç­‰ç­‰ï¼Œä»–è§‰å¾—è‡ªå·±å·²ç»è¿˜å¯ä»¥äº†ï¼Œä½†æ˜¯æœ€ç»ˆåœ¨ç¤¾ä¼šçš„æ¯’æ‰“ä¸­ï¼Œèº«å¿ƒç–²æƒ«çš„è½¬è¡Œåšå…¶ä»–çš„äº†\næ‚²ä»ä½•æ¥ å¼ ä¸‰å¾ˆå¿™ï¼Œä¹Ÿå¾ˆåŠªåŠ›ï¼Œä½†æ˜¯æ‚²å“€çš„æ˜¯ï¼Œä»–åœ¨æ¯ä¸€ä¸ªæ–¹å‘éƒ½åªå­¦äº†æœ€ç®€å•çš„çŸ¥è¯†ï¼Œå¹¶é”™è¯¯çš„è®¤ä¸ºè‡ªå·±ä»¥ä¸ºæŒæ¡äº†ï¼Œå®åˆ™åªæ˜¯å†°ä¸Šä¸€è§’ã€‚ å› æ­¤è™½ç„¶ä»–å¾ˆåŠªåŠ›ï¼Œä½†æ˜¯æ‚²å‰§æ˜¯å¿…ç„¶çš„ã€‚å¼ ä¸‰åªæ˜¯å®‡å®™ä¸­çš„ä¸€ç²’æ²™å­ï¼Œä»–çš„ç†æƒ³ä¼´éšç€å®‡å®™è§„å¾‹å ™ç­æ— äººçŸ¥æ™“ï¼Œä½†å¦‚æœæˆ‘ä»¬åœ¨ä»–èº«ä¸Šçœ‹åˆ°äº†è‡ªå·±çš„å½±å­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½éœ€è¦æ³¨æ„ä¸‹ï¼Œé¿å…è¿™ç§é€ƒé¿å›°éš¾çš„ç›²ç›®çš„åŠªåŠ›ï¼Œè¿™æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§â€œå¥¶å¤´ä¹â€ã€‚ç”¨å¼ ä¸€é¸£çš„è¯æ¥è¯´ï¼Œâ€œä»–ä»¬ä¸ºäº†é¿å¼€æ€è€ƒï¼Œæ„¿æ„ä»˜å‡ºä¸€åˆ‡åŠªåŠ›â€\nè§£æ³• é™ï¼Œå‹¿ç‡¥ è¿™è·Ÿ æœ‰ç‚¹çŸ›ç›¾ï¼Œä¸€å¥è¯è¯´æ¸…ä¸¤è€…çš„å…³ç³»â€œæˆ˜ç•¥ä¸Šè¦é™ï¼Œæˆ˜æœ¯ä¸Šè¦å¿«â€ã€‚æŒ‡å¯¼å‘˜åœ¨æŠ—æˆ˜æ—¶æœŸæå‡ºçš„â€œè®ºæŒä¹…æˆ˜â€å°±æ˜¯æˆ˜ç•¥ä¸Šçš„é™ï¼Œæˆ‘ä»¬çŸ¥é“ç›®çš„åœ°åœ¨é‚£é‡Œï¼Œä½†ä¹Ÿè¦æ‰¿è®¤è¿™æ®µè·¯æ˜¯æ¯”è¾ƒæ¼«é•¿çš„ï¼Œåªé å†²åˆºæ˜¯æ°¸è¿œåˆ°è¾¾ä¸äº†çš„ã€‚å› æ­¤åœ¨é•¿è¿œç›®æ ‡å®šä¸‹æ¥åï¼Œå¿ƒè¦é™ä¸‹æ¥ï¼Œç„¶åé’ˆå¯¹çœ¼å‰çš„ä¸€ä¸ªä¸ªè¦åšçš„äº‹æƒ…ï¼Œè½èµ·æ¥ï¼Œå¤§èƒ†å»åšï¼Œå› ä¸ºå³ä¾¿ä¸€ä¸¤ä»¶äº‹æå´©äº†ä¹Ÿè¿œä¸ä¼šå½±å“ä½ çš„æœ€ç»ˆç›®æ ‡ã€‚\nè§„åˆ’æ€§ åœ¨æœ‰ç›®æ ‡åï¼Œè¦å®šä¸€ä¸ªå¤§çº²æ¥è¿›è¡ŒæŒ‡å¯¼ï¼Œæ¯ä¸€ä¸ªé˜¶æ®µçš„å°æ–¹å‘æ˜¯ä»€ä¹ˆï¼Œå†åˆ°å°æ–¹å‘ä¸Šè¦åšçš„äº‹ï¼Œæœ€åå†é€ä¸ªæ”»å…‹ã€‚åœ¨æ”»å…‹çš„è¿‡ç¨‹ä¸­è¯†åˆ«åˆ°æ–°çš„ä¿¡æ¯åï¼Œå¯ä»¥åè¿‡æ¥è°ƒæ•´è®¡åˆ’ã€‚\nè·Ÿå¤–ç•Œä¿æŒè”ç³» è¦æ‰¿è®¤çš„ä¸€ä»¶äº‹ï¼Œæˆ‘ä»¬å¾ˆéš¾ç‹¬ç«‹äºè¿™ä¸ªä¸–ç•Œï¼Œæˆ‘ä»¬éœ€è¦å¾—åˆ°è¿™ä¸ªä¸–ç•Œçš„è®¤å¯ä»è€Œè·å¾—æ”¶ç›Šä¾‹å¦‚é‡‘é’±ã€æƒåŠ›ã€åèª‰ç­‰ç­‰ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½é—­é—¨é€ è½¦ã€‚è¦è·Ÿä¸–ç•Œä¿æŒè”ç³»ï¼Œä¾‹å¦‚å­¦æŸä¸ªæŠ€æœ¯ä¸è¦è‡ªå·±åŸ‹å¤´ç¡¬å•ƒï¼Œä¹Ÿè¦å…³æ³¨ä¸€ä¸‹åˆ«çš„å…¬å¸ä¸šåŠ¡æ˜¯å¦‚ä½•ç”¨çš„ï¼Œé‡åˆ°äº†å“ªäº›é—®é¢˜ï¼Œä¸€å®šè¦è®°ä½ä¸€ä»¶äº‹ï¼Œä½ å­¦ä¸€ä¸ªä¸œè¥¿ä¸€å®šæ˜¯è¦ç”¨æ¥è§£å†³æŸä¸ªâ€œé—®é¢˜çš„ï¼Œå› æ­¤ä½ è¦äº†è§£è¿™ä¸ªâ€œé—®é¢˜â€ã€‚å¦‚æœåªæ˜¯åŸ‹å¤´ç¡¬å•ƒé™¤äº†å¯èƒ½ä¼šè„±ç¦»ä¸šåŠ¡ï¼Œè¿˜å¯èƒ½ä¼šé’»å…¥ä¸€äº›ç‰›è§’å°–çš„åœ°æ–¹å¾’å¾’è€—è´¹æ—¶é—´ç­‰ï¼Œå› æ­¤åŠ¡å¿…è¦è·Ÿå¤–ç•Œä¿æŒè”ç³»\næ€»ç»“ åœ¨æœ€åï¼Œè·Ÿå¤§å®¶åˆ†äº«ä¸€å¥å¾ˆå–œæ¬¢çš„è¯ï¼Œâ€œå¦‚æœæœ‰ä¸€å¤©ï¼Œä½ ä¸å†å¯»æ‰¾çˆ±æƒ…ï¼Œåªæ˜¯å»çˆ±;ä½ ä¸å†æ¸´æœ›æˆåŠŸï¼Œåªæ˜¯å»åš;ä½ ä¸å†è¿½æ±‚ç©ºæ³›çš„æˆé•¿ï¼Œåªæ˜¯å¼€å§‹ä¿®å…»è‡ªå·±çš„æ€§æƒ…;ä½ çš„äººç”Ÿä¸€åˆ‡ï¼Œæ‰çœŸæ­£å¼€å§‹â€\n","date":"2024-02-20T15:09:17+08:00","image":"https://sherlock-lin.github.io/p/%E6%AC%B2%E9%80%9F%E5%88%99%E4%B8%8D%E8%BE%BE%E6%85%A2%E5%B0%B1%E6%98%AF%E5%BF%AB/image-20240920152413904_hu15743919184586671853.png","permalink":"https://sherlock-lin.github.io/p/%E6%AC%B2%E9%80%9F%E5%88%99%E4%B8%8D%E8%BE%BE%E6%85%A2%E5%B0%B1%E6%98%AF%E5%BF%AB/","title":"æ¬²é€Ÿåˆ™ä¸è¾¾ï¼Œæ…¢å°±æ˜¯å¿«ï¼"},{"content":"å¼•è¨€ éšç€çŸ¥è¯†é‡çš„å¢åŠ ï¼Œæœ‰æ—¶ä¼šå‡ä½æ‰§è¡ŒåŠ›ã€‚å°æ—¶å€™å¾ˆå¤šä¸œè¥¿ä¸çŸ¥é“ï¼Œä½†æ˜¯å°±å¾ˆè½ï¼Œå¤§èƒ†çš„æ’¬å¼€ç”µé£æ‰‡ï¼Œå“ªæ€•ç»„è£…å›æ¥å¤šäº†å‡ ä¸ªé›¶ä»¶ä¹Ÿå¾ˆè‡ªè±ªï¼›å°æ—¶å€™å¥½å¥‡æµ·çš„é‚£è¾¹æœ‰ä»€ä¹ˆï¼Œè·Ÿç€å°ä¼™ä¼´ä»¬æ²¿ç€æµ·å²¸çº¿è·‘ä¸€ä¸‹åˆéƒ½ä¸è§‰å¾—ç´¯ã€‚ä½†æ˜¯éšç€å¯¹è¿™ä¸ªä¸–ç•Œçš„äº†è§£çš„å¢åŠ ï¼Œæˆ‘ä»¬é€æ¸å˜å¾—â€œç†æ™ºâ€ï¼Œå–œæ¬¢çš„äººè¿˜æ²¡å¼€å§‹å»è¿½å°±å†…å¿ƒè§‰å¾—åæ­£ä¹ŸæˆåŠŸä¸äº†å°±æ”¾å¼ƒäº†ï¼Œæœ‰äº›å·¥ä½œè¿˜æ²¡å¼€å§‹å°±è§‰å¾—è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆè¡Œä¸é€šç”šè‡³å¼€å‘å¥½çš„ä»£ç è¿Ÿè¿Ÿä¸ä¸Šçº¿ï¼Œå› ä¸ºä¸å‘å¸ƒå°±ä¸ä¼šæœ‰é—®é¢˜ç­‰ç­‰å‘¢ä¸ªã€‚ä¸ºäº†é¿å…å¤±è´¥ï¼Œäºæ˜¯ä¹æ”¾å¼ƒæ‰€æœ‰å¼€å§‹ï¼Œä½†æ˜¯ä»Šå¤©æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œè½ï¼Œå°±å®Œäº‹æ‹‰~\nçŸ¥è¡Œåˆä¸€ ç¬¬ä¸€æ¬¡å¬åˆ°â€œçŸ¥è¡Œåˆä¸€â€è¿™ä¸ªè¯ï¼Œæ˜¯ä»ç‹é˜³æ˜ã€Šä¼ ä¹ å½•ã€‹é‡Œçœ‹åˆ°çš„ï¼Œä½†å¼€å§‹ç†è§£æ˜¯ä»è‘£å®‡è¾‰çš„ç›´æ’­ä¸Šï¼Œè€Œåœ¨è¿‘æœŸçœŸæ­£å®æˆ˜ä¸­æœ‰äº†è¿›ä¸€æ­¥çš„é¢†æ‚Ÿï¼Œå› æ­¤æŠŠå®ƒæ’åœ¨ç¬¬ä¸€ã€‚æˆ‘æ˜¯ä¸€ä¸ªå–œæ¬¢æ€è€ƒçš„äººï¼Œåœ¨å†…å¿ƒä¸­è§‰å¾—å‡ ä¹æ‰€æœ‰äº‹æƒ…éƒ½å¯ä»¥åœ¨å¿ƒä¸­çš„æ²™ç›˜è¿›è¡Œæ¨æ¼”ç„¶åå¾—å‡ºæœ€ä¼˜è§£ï¼Œæœ€åå†å°†æœ€ä¼˜è§£è¿›è¡Œè½åœ°ã€‚è¿™åœ¨ä¸Šå­¦æ—¶æœŸæ²¡é—®é¢˜ï¼Œä½†å·¥ä½œåå¦‚æœä½ ä¹Ÿè·Ÿæˆ‘ä¸€æ ·çš„è¯ï¼Œåœ¨å·¥ä½œä¸­ä¼šå¾ˆå®¹æ˜“åƒç˜ªï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™ä½†ä¸€é¡¹å·¥ä½œæ´¾ç»™ä½ æ—¶ï¼Œå¾ˆå¤šä¿¡æ¯æ˜¯ä¸ç¡®å®šçš„ï¼Œä½ æ— æ³•æ ¹æ®è¿™äº›ä¿¡æ¯è·å¾—æ‰€æœ‰çš„â€œæœ€ä¼˜è§£â€ï¼Œä¾‹å¦‚è¦å¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä½ å¦‚æœå…ˆèŠ±å¤§é‡æ—¶é—´å»åŸºäºæŠ€æœ¯å®ç°çš„è§’åº¦æ¥æ€è€ƒå“ªä¸ªæ–¹æ¡ˆæ›´å¥½ï¼Œé‚£ä¹ˆåœ¨å®ç°æ—¶å¤§æ¦‚ç‡ä¼šå—é˜»ã€‚æ¯”å¦‚è¿™ä¸ªæ–¹æ¡ˆåœ¨çœŸæ­£è½åœ°æ—¶å¾ˆæœ‰å¯èƒ½é‡åˆ°ä»¥ä¸‹é˜»åŠ›ï¼šâ‘  ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼Œä½†ç›®å‰å¤–éƒ¨è¿˜ä¸æ”¯æŒè¿™ç§åŠŸèƒ½ â‘¡ ä½ è®¾è®¡çš„æ˜¯å›è°ƒæ–¹å¼åŒæ­¥æ•°æ®ï¼Œä½†ç­‰ä½ è®¾è®¡å¥½è½åœ°æ—¶å‘ç°ç”±äºå®‰å…¨é—®é¢˜ç½‘ç»œçŸ¥è¯†å•å‘çš„ â‘¢ è¿™ä¸ªæ–¹æ¡ˆåœ¨å®ç°æ—¶å¤æ‚åº¦æ¯”åŸæ¥æƒ³çš„è¦é«˜çš„å¤šå¾—å¤šã€‚é™¤äº†ä¸Šè¯‰çš„å‡ ä¸ªåœºæ™¯ï¼Œç›¸ä¿¡ä½ å¯èƒ½è¿˜é‡åˆ°å…¶ä»–çš„ï¼Œæœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆå—ï¼Ÿ\nä¸Šè¯‰æœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼ŒèŠ±äº†è¿‡å¤šçš„æ—¶é—´åœ¨æ–¹æ¡ˆè®¾è®¡ä¸Šï¼Œé™¤éä¸€äº›ç‰¹åˆ«ç‰¹åˆ«æ ¸å¿ƒçš„ç‚¹ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ‹¿åˆ°æ´»äº†ç›´æ¥å¼€å¹²ï¼Œä»£ç èƒ½è·‘å°±è¡Œï¼Œå…ˆå®ç°èµ·æ¥è°ƒè¯•ï¼Œå› ä¸ºâ€œè¡Œâ€å°±æ˜¯â€œçŸ¥â€ï¼Œæˆ–è€…è¯´åªæœ‰å½“ä½ çœŸæ­£çš„è¡ŒåŠ¨èµ·æ¥ï¼Œä½ æ‰èƒ½è·å–æ›´å¤šç›¸å…³çš„ä¿¡æ¯ï¼Œè§†é‡æ‰èƒ½æ›´åŠ çš„å¼€é˜”èµ·æ¥ã€‚å•çº¯é æƒ³æ˜¯æ°¸è¿œéƒ½æƒ³ä¸æ˜ç™½ï¼Œä¸å…¶èŠ±å¤§é‡æ—¶é—´çº ç»“èµ°å“ªä¸€æ¡è·¯ï¼Œä¸å¦‚å…ˆæŒ‘ä¸€æ¡èµ°èµ·æ¥ï¼Œä¹Ÿè®¸ä½ èµ°ä¸ªå‡ åˆ†é’Ÿå°±å‘ç°è¿™æ¡è·¯èµ°ä¸ä¸‹å»æŠ˜è¿”å»å¦ä¸€æ¡è·¯å‘¢ï¼Œè¿™ä¸æ¯”ä½ èŠ±å‡ ä¸ªå°æ—¶åœ¨å“ªé‡Œçº ç»“å¼ºå—ï¼Ÿè¿™ä¸ªæ—¶å€™çš„â€œèµ°é”™è·¯â€éš¾é“æ˜¯çœŸçš„é”™å—ï¼Ÿä¸è§å¾—å§ã€‚å› æ­¤å½“ä½ çœŸçš„å†…å¿ƒæœ‰æƒ³æ³•æ—¶ï¼Œå¤§èƒ†å»å°è¯•ï¼›å½“è§‰å¾—æŸä¸ªæ–¹æ¡ˆæœ‰é—®é¢˜æ—¶ï¼Œå¤§èƒ†çš„æå‡ºæ¥ï¼›ä¸è¦è¢«æ‰€è°“çš„â€œçŠ¯é”™â€é™åˆ¶ä½äº†è‡ªå·±ï¼Œå“ªæ€•ä½ æƒ³æ³•æ˜¯é”™è¯¯çš„ï¼Œä½ ä¹Ÿåªæœ‰å°è¯•äº†ï¼Œæå‡ºæ¥äº†æ‰èƒ½è·å–åˆ°è¿™ä¸ªç»“è®ºä¸æ˜¯å—ï¼Œâ€œè¡Œâ€å°±æ˜¯â€œçŸ¥â€ã€‚æ‰€ä»¥å¦‚æœæœ‰å–œæ¬¢çš„ä¸œè¥¿ï¼Œè¶ç€çƒ­æƒ…è¿˜æ²¡æ¶ˆæ•£ï¼Œè½ä¸€ç‚¹ï¼Œç›¸ä¿¡ä½ ä¼šæœ‰ä¸ä¸€æ ·çš„ä½“éªŒ~\nä½ é‡è§çš„æ‰€æœ‰äººï¼Œéƒ½æ˜¯ä½ è‡ªå·± â€œä½ é‡è§çš„æ‰€æœ‰äººï¼Œéƒ½æ˜¯ä¸åŒå¹³è¡Œä¸–ç•Œé‡Œçš„è‡ªå·±ã€‚â€ è¿™å¥è¯é€ç»™å†…å‘å‹æ•æ„Ÿæ€§æ ¼çš„æœ‹å‹ï¼Œä¸ç”¨å®³æ€•ä»–ä»¬ï¼Œä»–ä»¬å…¶å®éƒ½æ˜¯â€œä½ â€ã€‚è¿™é‡Œçš„æ„æ€æ˜¯ï¼Œè¿™ä¸ªä¸–ç•Œä¸Šæ‰€æœ‰ä½ çœ‹åˆ°çš„äººéƒ½æ˜¯ç”±â€œä½ â€ç»„æˆçš„ï¼Œè¿™æ˜¯å±äºä½ çš„ä¸–ç•Œã€‚æ‰€ä»¥ä¸ç”¨åœ¨æ„â€œè‡ªå·±â€çš„çœ‹æ³•ï¼Œå¤§èƒ†å»å»åšä½ æƒ³åšçš„äº‹æƒ…ï¼Œå¯èƒ½ä¼šæœ‰äººè¯´ä¸‰é“å››ï¼Œä½†æ˜¯è®°ä½ï¼Œè¿™æ˜¯å¦ä¸€ä¸ªä¸–ç•Œçš„ä½ å¯¹å½“å‰çš„è¿™ä¸ªä½ çš„çœ‹æ³•ã€‚å°±å¦‚åŒæ˜¯ç°åœ¨çš„ä½ æ‰¹è¯„è¿‡å»æŸä¸ªé˜¶æ®µçš„è‡ªå·±ä¸€æ ·ï¼Œæ²¡ä»€ä¹ˆå·®åˆ«ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆæˆ‘è¦åœ¨è¿™é‡Œæä¸€ä¸‹å‘¢ï¼Œå› ä¸ºå†…å‘å‹æ•æ„Ÿæ€§æ ¼çš„äººï¼Œæœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ã€‚å¦‚æœè¿‡å¤šå»å…³æ³¨å¤–ç•Œçš„çœ‹æ³•ä¼šå¤§é‡æ¶ˆè€—è‡ªå·±çš„ç²¾æ°”ç¥ï¼Œä½†æ˜¯ç²¾æ°”ç¥è¿™ç©æ„æ˜¯å›ºå®šçš„ï¼Œå°‘äº†ä¹‹åå°±ä¼šé™ä½ä½ åšå…¶ä»–äº‹æƒ…çš„åŠ¨åŠ›ã€‚å†…å‘å‹æ•æ„Ÿäººæ ¼æœ‰è‡ªå·±çš„ä¼˜ç‚¹ï¼Œä»äº§å‡ºæœ€å¤§åŒ–çš„è§’åº¦æ¥çœ‹ï¼Œåº”è¯¥å°†æ›´å¤šçš„ç²¾åŠ›ä¸“æ³¨äºè‡ªå·±æ„Ÿå…´è¶£çš„äº‹æƒ…ä¸Šï¼Œè®°ä½ï¼Œæ˜¯æ„Ÿå…´è¶£çš„äº‹æƒ…ä¸Šè€Œä¸æ˜¯è‡ªå·±èº«ä¸Šã€‚ä¾‹å¦‚åº”è¯¥å…³æ³¨çš„æ˜¯è‡ªå·±çš„è¡¨è¾¾æ°´å¹³æ˜¯å¦æå‡è€Œä¸æ˜¯å…³æ³¨æœ‰äººè¯´ä½ ä¸è¿‘äººæƒ…ï¼Œåº”è¯¥å…³æ³¨æƒ³å­¦çš„ä¸œè¥¿ä¾‹å¦‚è‹±è¯­ä»Šå¤©èƒŒäº†å¤šå°‘è¯æ±‡é‡è€Œä¸æ˜¯å…³æ³¨è‡ªå·±çš„è¡£æœè„äº†ä¸€ç‚¹ä¹‹ç±»çš„ï¼Œå¤§è‡´æ„æ€ç›¸ä¿¡ä½ èƒ½æ˜ç™½\nçƒ­çˆ±ï¼Œå¯å…‹æœä¸€åˆ‡é˜»ç¢ é™¤äº†ä¸Šè¯‰ä¸¤ç‚¹ï¼Œæœ€åæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œä¿æŒä½ çƒ­çˆ±çš„ä¸œè¥¿ï¼Œè¿™æ˜¯ä½ åŠ¨åŠ›çš„æºæ³‰ï¼Œå¦‚æœä¸èƒ½ä¿æŒï¼Œé‚£å°±å°½é‡å»â€œçˆ±ä¸Šâ€ä½ åœ¨åšçš„äº‹æƒ…ã€‚å¾ˆå¤šä¸œè¥¿åšä¸€ä¸¤å¤©å®¹æ˜“ï¼Œä½†æ˜¯é•¿æœŸåšæŒçš„è¯ï¼Œå¦‚æœä¸æ˜¯å‘è‡ªå†…å¿ƒçš„çƒ­çˆ±ï¼Œé‚£å°±æ˜¯ä¸€ä»¶å¾ˆæŠ˜ç£¨äººçš„äº‹æƒ…ã€‚å¹¶ä¸”ç‰¹åˆ«æ˜¯åœ¨åšæŒä»¶äº‹çš„å‰ä¸¤å¹´ï¼Œç”±äºä¸ç†Ÿæ‚‰ä½ ä¼šé‡åˆ°å„ç§å„æ ·çš„é˜»ç¢ï¼Œè¿™æ˜¯åŠé€€å¤§éƒ¨åˆ†äººçš„æ—¶æœŸï¼Œä½†æ˜¯å¦‚æœä½ åšæŒä¸‹æ¥äº†ï¼Œæ”¶è·ä¸€èˆ¬ç›¸å¯¹ä¹Ÿæ¯”è¾ƒä¸°å¯Œï¼ŒåŒæ—¶ä½ å†…å¿ƒä¹Ÿä¼šå˜å¼ºã€‚è¿™æ ·å†å»åšå…¶ä»–æœ‰éš¾åº¦çš„äº‹æƒ…æ—¶ï¼Œä½ èƒ½æ¯”åˆ«äººæ›´çš®å®ã€‚ä¾‹å¦‚æç¬‘æ¥å¤§ä½¬å°æ—¶å€™è¢«é€¼ç€æŠ„æ–°åè¯å…¸ï¼Œç­‰çœŸçš„æŠ„å®Œåï¼Œä¹‹åä»–æ„Ÿè§‰é‡åˆ°çš„æ‰€æœ‰äº‹ä»¿ä½›éƒ½æ²¡é‚£ä¹ˆéš¾ç†¬äº†ã€‚å› æ­¤ä¿æŒçƒ­çˆ±ï¼Œå»åšæŒåšçš„æƒ³åšçš„äº‹æƒ…~\næ€»ç»“ ä»¥ä¸Šå°±æ˜¯æˆ‘æƒ³è¯´çš„ï¼Œæœ€åï¼Œè¿˜æ˜¯ç”¨æ ‡é¢˜æ¥ç»“å°¾ï¼Œå“¥ä»¬ï¼Œè½å°±å®Œäº‹äº†ï¼Œå¼€å¹²å§~\n","date":"2024-02-04T15:09:14+08:00","image":"https://sherlock-lin.github.io/p/%E8%8E%BD%E5%B0%B1%E5%AE%8C%E4%BA%8B%E5%95%A6/the-creative-exchange-d2zvqp3fpro-unsplash_hu5876398126655421130.jpg","permalink":"https://sherlock-lin.github.io/p/%E8%8E%BD%E5%B0%B1%E5%AE%8C%E4%BA%8B%E5%95%A6/","title":"è½ï¼Œå°±å®Œäº‹å•¦"},{"content":"å¼•è¨€ åœ¨è°ˆç»©æ•ˆåï¼Œæˆ‘æ”¶è·äº†ä¸€äº›å¿ƒå¾—ï¼Œåœ¨æ­¤æ¢³ç†å‡ºæ¥ï¼ŒåŠ æ·±å°è±¡å¹¶ä¸”å…±å‹‰\nåŸºæœ¬ä¿¡æ¯ åœ¨æ­¥å…¥èŒåœºåï¼Œä½ å¯èƒ½è·Ÿæˆ‘ä¸€æ ·è™½ç„¶æŠ€æœ¯æ°´å¹³æœ‰åœ¨ä¸Šå‡ï¼Œä½†æ˜¯åœ¨å¤„ç†ä¸€äº›äº‹æƒ…ä¸Šå¯èƒ½å¶å°”æ²¡èƒ½è·å¾—é¢„æœŸçš„æˆæœã€‚æˆ‘åœ¨é€šè¿‡ç»©æ•ˆæ²Ÿé€šä»¥åŠè‡ªæˆ‘åæ€åå¾—å‡ºä»¥ä¸‹å‡ ç‚¹ï¼Œå¦‚æœä½ ä¹Ÿæœ‰ç±»ä¼¼çš„æƒ…å†µå¯èƒ½éœ€è¦åŠ å¼ºäº›\næ²Ÿé€šæ–¹å¼ å·¥ä½œä¸­å®Œæ•´çš„æ²Ÿé€šé“¾è·¯ ä½•æ—¶æ²Ÿé€š é£é™©æ±‡æŠ¥ å¿ƒæ€æ–¹é¢ çš®å® å®¢è§‚ å¸ˆå‚…é¢†è¿›é—¨ äººæ— è¿œè™‘ï¼Œå¿…æœ‰è¿‘å¿§ æ²Ÿé€šæ–¹å¼ æ²Ÿé€šé“¾è·¯\nåœ¨å›½å†…å¤§éƒ¨åˆ†äº’è”ç½‘å…¬å¸ä¸ä¼šéœ€è¦ä½ æœ‰éå¸¸å¼ºæ‚çš„ä¸“ä¸šæŠ€èƒ½ï¼Œä½†å¦‚æœæƒ³æŠŠäº‹æƒ…åšå¥½é‚£å¿…ä¸å¯å°‘çš„å°±æ˜¯æ²Ÿé€šèƒ½åŠ›ï¼Œæ²Ÿé€šæŠ€èƒ½ä¸åƒç¼–ç é‚£æ ·æœ‰æ˜ç¡®çš„æµ‹é‡æŒ‡æ ‡ï¼Œä½†è¿™å¹¶ä¸ä»£è¡¨æ²¡æœ‰æ²Ÿé€šæ¨¡æ¿ã€‚ä¸‹é¢è¿™æ˜¯å·¥ä½œä¸­é€šç”¨çš„æ²Ÿé€šé“¾è·¯æ¨¡æ¿ï¼Œåˆ†åˆ«ç”±ä¸»ä½“ã€å®¢ä½“ä»¥åŠç›¸å…³æ–¹æ„æˆï¼Œåœ¨å·¥ä½œä¸­æˆ‘ä»¬å¸¸å¸¸æ‰®æ¼”å…¶ä¸­çš„ä¸€ä¸ªè§’è‰²\nä¸»ä½“ï¼šäº‹ä»¶çš„å‘èµ·è€…ï¼Œå·¥ä½œä¸­å¸¸è§çš„ä¾‹å¦‚ï¼šä½ çš„ç›´æ¥ä¸Šçº§ç»™ä½ æ´¾æ´»ã€æŸäº›ä¸“é¡¹çš„äº‹æƒ…éœ€è¦ä½ æ”¯æŒã€äº§å“/PMç­‰\nå®¢ä½“ï¼šä¸»ä½“å‘½ä»¤çš„æ‰§è¡Œè€…ï¼Œå·¥ä½œä¸­å¸¸è§çš„ä¾‹å¦‚ï¼šä½ ã€ä½ æ´¾å‘ä»»åŠ¡çš„é‚£ä¸ªäººç­‰\nç›¸å…³æ–¹ï¼šæ‰€æœ‰äº‹ä»¶æ¨è¿›è¿‡ç¨‹ä¸­éœ€è¦é…åˆçš„äººå‘˜ï¼Œä¾‹å¦‚ï¼šäº‹ä»¶å˜æ›´ä¼šå½±å“åˆ°çš„äººå‘˜ã€äº‹ä»¶æ¨è¿›ä¸­éœ€è¦é…åˆä½ ä»¬çš„äººå‘˜ç­‰\nç†æ¸…è¿™ä¸‰ä¸ªè§’è‰²åï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹æ­£å¸¸ä¸€ä¸ªäº‹ä»¶çš„å®Œæ•´æµç¨‹ï¼Œäº‹ä»¶å‡è®¾ä¸ºï¼šä½ ä»¬çš„å¤§æ•°æ®é›†ç¾¤ä¸‹ä¸ªæœˆéœ€è¦æ‰©å®¹\nä½ çš„ä¸Šçº§å°†è¿™ä¸ªä»»åŠ¡æ´¾å‘ç»™ä½ ï¼ŒæŒ‡å®šä¸‹ä¸ªæœˆè¦è¿›è¡Œå®Œæˆ æ”¶åˆ°ä¿¡æ¯è·Ÿä¸Šçº§ç¡®è®¤ç»†èŠ‚ä»¥åŠç›¸å…³äº‹é¡¹ï¼ŒåŒæ—¶ç»™ä¸Šçº§æ‰¿è¯ºå®Œæˆ æ¢³ç†å‡ºæœ¬æ¬¡å˜æ›´ä¸­ä¼šå½±å“åˆ°çš„ä¸‹æ¸¸ä½¿ç”¨æ–¹ã€è¿ç»´åŒå­¦ç­‰ç­‰ï¼Œå¹¶åŒæ­¥è¦å˜æ›´çš„ä¿¡æ¯ï¼ŒåŒæ—¶è¦æ˜ç¡®æ¯ä¸ªç›¸å…³æ–¹éƒ½æ”¶åˆ°é€šçŸ¥ åœ¨ç›¸å…³æ–¹å“åº”åï¼Œè¦è·Ÿä»–ä»¬ç¡®å®šéœ€è¦ä»–ä»¬åšæ“ä½œçš„äº‹ä»¶ï¼Œä¾‹å¦‚éœ€è¦è¿ç»´åŒå­¦åœ¨ä¸¤å‘¨åæå‰æ‰©å¥½æœºå™¨å¤‡ç”¨ç­‰å¹¶æ¨è¿› åœ¨è·Ÿç›¸å…³æ–¹éƒ½æ¢³ç†æ¸…æ¥šåè·Ÿä½ çš„ä¸Šçº§è¿›è¡ŒåŒæ­¥ï¼Œå¦‚æœæ¢³ç†çš„æ—¶é—´æ¯”è¾ƒé•¿å¯ä»¥æ¯éš”ä¸€æ®µæ—¶é—´è¿›è¡ŒåŒæ­¥ ä½ çš„ä¸Šçº§åœ¨ç¡®è®¤å¥½åï¼Œå¦‚æœæœ¬æ¬¡äº‹ä»¶çš„å½±å“æ˜¯æ¯”è¾ƒå¤§çš„è¯ã€‚åº”è¯¥è·Ÿç›¸å…³æ–¹æˆ–è€…ç›¸å…³æ–¹çš„ä¸Šçº§åœ¨checkä¸‹ ç›¸å…³æ–¹å¯¹è¿™ä»¶äº‹æƒ…åšäºŒæ¬¡ç¡®è®¤ï¼Œä¾‹å¦‚é‚®ä»¶ã€ç¾¤æ¶ˆæ¯æˆ–è€…æ–‡æ¡£è·Ÿè¿› ä»¥ä¸ŠåŸºæœ¬å°±æ˜¯ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿçš„å®Œæ•´é“¾è·¯ï¼Œä¸å¤æ‚ä½†æ˜¯å·¥ä½œä¸­å¾€å¾€ä¼šå¿˜è®°ï¼Œæµ“ç¼©æˆä¸€å¥å¿ƒå¾—å°±æ˜¯ï¼Œâ€œäº‹äº‹æœ‰ç€è½ï¼Œä»¶ä»¶æœ‰ç€è½â€\nä½•æ—¶æ±‡æŠ¥\nå¤§è‡´åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µ\næŸä¸€æ–¹ä¿¡æ¯æœ‰å˜åŠ¨æ—¶\nå½“ä½ çŸ¥é“çš„ä»»ä½•ä¸€æ–¹åŒ…æ‹¬ä½ è‡ªå·±å­˜åœ¨ä¿¡æ¯å˜åŠ¨æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿›è¡Œæ±‡æŠ¥ã€‚ä¾‹å¦‚ä½ ä¸‹ä¸ªæœˆçªç„¶æœ‰äº‹è¦è¯·å‡ï¼Œé‚£ä¹ˆä½ åº”è¯¥ç¬¬ä¸€æ—¶é—´è·Ÿä½ çš„ä¸Šçº§æ²Ÿé€šï¼Œçœ‹çœ‹è¿™ä¸ªäº‹æƒ…èƒ½å¤Ÿå‰ç½®æˆ–è€…åç½®ï¼Œæˆ–è€…èƒ½å¤Ÿæ¢ä¸ªäººæ¥æ¥æ›¿è¿™ä»¶äº‹æƒ…ç­‰\nå®šæœŸæ±‡æŠ¥\nä¾‹å¦‚åœ¨å‘¨ä¼šã€æ—¥ä¾‹ä¼šä¸Šè¿›è¡Œå®šæœŸè¿›å±•åŒæ­¥ï¼Œå¦‚æœè¿™ä»¶äº‹æ¯”è¾ƒé‡è¦å¯ä»¥å•ç‹¬æ‹‰ä¸ªä¸“é¡¹ï¼Œé’ˆå¯¹è¿™ä¸ªä¸“é¡¹å®šæœŸè¿›è¡Œå¼€ä¼šå¯¹è¿›å±•\nå­˜åœ¨é£é™©æ—¶\nå½“ä½ è¯†åˆ«åˆ°å¯èƒ½å­˜åœ¨é£é™©æ—¶ï¼Œä¾‹å¦‚è¦è¿ç»´æ‰©æœºå™¨ï¼Œä½†æ˜¯è·Ÿç¬¬ä¸‰æ–¹çš„å•†åŠ¡åˆçº¦è¿˜æ²¡è°ˆæ‹¢å¯¼è‡´æ— æ³•æŒ‰æœŸåˆ†é…æœºå™¨ï¼Œé‚£ä¹ˆè¿™æ ·çš„é£é™©å°±åº”è¯¥ç¬¬ä¸€æ—¶é—´åŒæ­¥ç»™ä½ çš„ä¸Šçº§ä»¥åŠç›¸å…³æ–¹\né£é™©æ±‡æŠ¥\né£é™©æ±‡æŠ¥åŠ¡å¿…è¦åšåˆ°å¿«ã€å‡†ã€å®¢è§‚ã€‚å¿«å°±æ˜¯ç¬¬ä¸€æ—¶é—´è¦ç«‹é©¬åŒæ­¥ï¼Œå‡†æ˜¯è¦å…ˆå¿«é€Ÿç¡®è®¤ä¸‹ä¿¡æ¯çš„å‡†ç¡®æ€§ï¼Œå®¢è§‚å°±æ˜¯é£é™©è·Ÿä½ ç›¸å…³æˆ–è€…ç”±ä½ å¼•èµ·çš„æ—¶å€™ï¼Œä¸è¦æ‹…å¿ƒæ‹…è´£æˆ–è€…è¢«è´£å¤‡ï¼Œåº”è¯¥ä¿æŒå®¢è§‚çš„å¿ƒæ€å»æ±‡æŠ¥è¿™ä¸ªäº‹æƒ…ã€‚ä¸€å®šè¦è°¨è®°ä¸€ä»¶å¿ƒå¾—ï¼Œå°±æ˜¯é¼“è¶³å¹²åŠ²æŠŠäº‹ä»¶åšå¥½æ‰æ˜¯æœ€é‡è¦çš„ï¼Œå…¶ä»–çš„éƒ½æ˜¯å…¶æ¬¡ã€‚\nå¿ƒæ€æ–¹é¢ çš®å®\nç®€å•æ¥è¯´é‡åˆ°å›°éš¾ã€è´£å¤‡ã€å¤ç›˜çš„æ—¶å€™ï¼Œè¦è€Cã€‚æ— è®ºç”Ÿæ´»å·¥ä½œæŠŠä½ æ‘åœ¨åœ°ä¸Šæ‘©æ“¦æˆä»€ä¹ˆæ ·ï¼Œä½ ç«™èµ·æ¥ç»§ç»­åšä½ è¯¥åšçš„äº‹æƒ…ã€‚ä½ è¦æ˜ç¡®è‡ªå·±æ¥è¿™é‡Œçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºé’±ã€ä¸ºæˆé•¿ã€ä¸ºå®ç°è‡ªæˆ‘ä»·å€¼ç­‰ï¼Œä½ è¦ç‰¢è®°è¿™ä¸€ç‚¹ï¼Œå·¥ä½œåªæ˜¯è¾…åŠ©å·¥å…·ï¼Œè¾…åŠ©ä½ å®ç°ä½ çš„ç›®çš„ã€‚å› æ­¤å³ä¾¿å·¥ä½œä¸€æ—¶åšä¸å¥½æˆ–è€…è¢«è´£å¤‡ï¼Œä¸è¦è§‰å¾—å¤©å¡Œäº†ï¼Œå…¶å®çœŸçš„æ²¡æœ‰é‚£ä¹ˆä¸¥é‡ï¼Œä½ ä½†å‡¡æŠŠè‡ªå·±äººç”Ÿçš„æ—¶é—´çº¿æ‹‰é•¿ä¸€äº›ä½ éƒ½ä¼šå‘ç°ï¼Œè¿‡å»æŸä¸ªæ—¶é—´æ®µä½ è§‰å¾—éå¸¸é‡è¦çš„äº‹æƒ…åœ¨ç°åœ¨çœ‹åˆ°æ˜¯ä¸æ˜¯åŸºæœ¬éƒ½æ˜¯é£è½»äº‘æ·¡äº†ï¼Ÿä¾‹å¦‚æœŸæœ«è€ƒè¯•è€ƒç ¸äº†ã€æ‰“æ¸¸æˆè¢«çˆ¶æ¯æŠ“åˆ°ã€å¤±æ‹ã€è¶³çƒæ¯”èµ›å¤±è¯¯ç­‰ç­‰ç­‰ç­‰ï¼Œå“ªä¸€ä»¶ä¸æ˜¯å½“æ—¶è§‰å¾—éå¸¸é‡è¦ç”šè‡³ä¸–ç•Œå´©äº†ï¼Œä½†æ˜¯å›é¦–éƒ½è½»çš„åƒæ˜¯ä¸€ç‰‡ç¾½æ¯›ï¼Œåƒæ˜¯åˆ«äººçš„æ•…äº‹ä¸€èˆ¬ï¼Œå°±åƒè‹ä¸œå¡çš„é‚£å¥â€œå›é¦–å‘æ¥è§ç‘Ÿå¤„ï¼Œä¹Ÿæ— é£é›¨ä¹Ÿæ— æ™´â€ã€‚å› æ­¤ç‰¢è®°è‡ªå·±çš„åˆå¿ƒï¼Œä½ ä¸€å®šå¯ä»¥è¶Šæ¥è¶Šè€Cï½\nä¸çš®å®å¯èƒ½å¯èƒ½ä¼šç»™ä½ å¸¦æ¥çš„ç¼ºç‚¹\nç”±äºå®³æ€•è´£å¤‡ï¼Œé‡è¦çš„äº‹æƒ…ä¸€æ‹–å†æ‹–ï¼Œé‡åˆ°é£é™©è¿Ÿè¿Ÿä¸æ•¢æ±‡æŠ¥ ç”±äºå®³æ€•åˆ«äººæŒ‡å‡ºè‡ªå·±çš„ç¼ºç‚¹ï¼Œä¼šè®®ä¸Šè¿Ÿè¿Ÿä¸æ•¢å‘è¡¨è‡ªå·±çš„æƒ³æ³• å·¥ä½œå¤ç›˜å‡ æ¬¡åï¼Œè‡ªå·±è§‰å¾—ä¸–ç•Œå¡Œäº†ï¼Œå·¥ä½œå¹²è„†å¼€å§‹æ‘†çƒ‚ æƒ…ç»ªå˜çš„æš´èºï¼Œä¼šè§‰å¾—æ˜¯å…¨ä¸–ç•Œçš„é”™ï¼Œçœ‹è°éƒ½ä¸çˆ½ï¼Œè·¯è¾¹çš„ç‹—éƒ½æƒ³ä¸Šå»æ‰‡ä¸¤ä¸ªè€³å…‰ï½ é™¤äº†ä»¥ä¸Šç§ç§è¿˜æœ‰å¾ˆå¤šï¼Œå°±åƒé‚£å¥è¯è¯´çš„ä¸€æ · â€œå‹‡æ•¢çš„äººå…ˆäº«å—ä¸–ç•Œï½â€ï¼Œä½ ä¸å¦¨å¤§èƒ†äº›å»è¯•è¯•ï¼Œæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªä¸–ç•Œå…¶å®æ²¡æœ‰å¤ªå¤šäººå…³æ³¨ä½ ï¼Œä½ ä¸ºå•¥ä¸follwerè‡ªå·±çš„å†…å¿ƒï¼Œåšè‡ªå·±æƒ³åšçš„äº‹æƒ…å‘¢\nå®¢è§‚\nè¿™ä¸ªè¯å¯èƒ½ä¸æ˜¯å¾ˆå‡†ç¡®çš„è¡¨è¾¾ï¼Œå¤§è‡´æ„æ€å°±æ˜¯æˆ‘ä»¬åœ¨çœ‹å¾…å¾ˆå¤šè·Ÿè‡ªå·±ç›¸å…³çš„äº‹æƒ…çš„æ—¶å€™è¦å°½é‡å®¢è§‚ï¼Œä¾‹å¦‚è‡ªå·±çš„é¡¹ç›®æç ¸äº†ï¼Œè‡ªå·±å¯èƒ½å­˜åœ¨çš„é‚£éƒ¨åˆ†å°±æ˜¯åšå¾—ä¸å¥½ï¼Œæ²¡æœ‰ä»€ä¹ˆå¥½ç‹¡è¾©çš„ï¼Œè¿™é‡ŒæŒ‡çš„ç‹¡è¾©ä¸æ˜¯å¯¹ä»»ä½•äººï¼Œè€Œæ˜¯å¯¹ä½ è‡ªå·±ï¼Œä½ è‡ªå·±å¿ƒé‡Œè¦æ¸…æ¥šè‡ªå·±ä¸è¶³çš„åœ°æ–¹ä»¥åŠç§¯ææ”¹è¿›ï¼Œå¦åˆ™æ¯æ¬¡äº‹æƒ…åšä¸å¥½éƒ½æ€¨è¿™æ€¨é‚£çš„æœ€ç»ˆè‡ªå·±æ²¡æœ‰å¾—åˆ°ä»»ä½•çš„æå‡\nå¸ˆå‚…é¢†è¿›é—¨\nè¿™ä¸ªä¹Ÿå¯ä»¥ç†è§£ä¸ºç‹¬ç«‹åšäº‹èƒ½åŠ›ï¼Œå¾ˆå¤šäº‹æƒ…ä¸è¦è¿‡å¤šä¾èµ–åˆ«äººï¼Œä¾‹å¦‚æ’æŸ¥åˆ°ä¸€ä¸ªè·Ÿæ•°æ®åº“ç›¸å…³çš„é—®é¢˜ï¼Œä¸è¦ç›´æ¥ä¸¢ç»™dbaï¼Œè¦è‡ªå·±æ£€æŸ¥ä¸‹SQLå†™çš„æ˜¯å¦æœ‰é—®é¢˜ï¼Œè¿æ¥mysqlçš„å‚æ•°æ˜¯å¦æœ‰è¯¯ç­‰ç­‰ï¼Œå¦‚æœé‡åˆ°äº‹æƒ…å°±è¦ä¾èµ–åˆ«äººï¼Œä¸ä»…è‡ªå·±å¾—ä¸åˆ°æˆé•¿ï¼Œè¿˜ä¼šé€€åŒ–ï¼Œæœ€åä»»ä½•äº‹æƒ…éƒ½è¦åˆ«äººæ‰‹æŠŠæ‰‹æŒ‡å¯¼ï¼Œè¿™ææ€•ä¹Ÿä¸æ˜¯ä½ æƒ³æˆä¸ºçš„é‚£ä¸ªäººå§ï¼Ÿå¦‚æœé‡åˆ°äº‹æƒ…è‡ªå·±ç§¯æä¸»åŠ¨å¤„ç†ï¼Œä¼šè®©ä½ ä¸æ–­çš„æ‰©å……è‡ªå·±çš„çŸ¥è¯†ï¼Œæå‡è‡ªå·±çš„åšäº‹èƒ½åŠ›ï¼Œå½¢æˆä¸€ä¸ªè‰¯æ€§å¾ªç¯\näººæ— è¿œè™‘ï¼Œå¿…æœ‰è¿‘å¿§\næˆ‘ä»¬å·¥ä½œä¸­ç»å¸¸ä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥é€è¿‡ç°è±¡çœ‹æœ¬è´¨ï¼ŒçŸ¥é“æœ¬è´¨çš„é—®é¢˜æ˜¯ä»€ä¹ˆåå°½å¯èƒ½çš„ä»æœ¬è´¨ä¸Šå¤„ç†äº†ã€‚ä¾‹å¦‚ä½ è´Ÿè´£çš„Aé¡¹ç›®çš„æŸä¸ªæ¨¡å—ç»å¸¸å‡ºé—®é¢˜ï¼Œä½ æ’æŸ¥åå‘ç°ä»£ç è®¾è®¡ä¸€å¡Œç³Šæ¶‚ï¼Œé‚£ä¹ˆä¸å…¶ä¸åœçš„è¯æ—¶é—´ä¸æ–­çš„ä¿®bugï¼Œé‚£ä¸ºå•¥ä¸ç›´æ¥æŠ½æ—¶é—´æ¢³ç†æ¸…æ¥šé€»è¾‘ç„¶åé‡æ„ä¸‹å‘¢ï¼Ÿå¤´ç–¼åŒ»å¤´è„šç–¼åŒ»è„šæ°¸è¿œä¸ä¼šå¥åº·ï¼Œå¾ˆå¤šæ—¶å€™åšäº‹æƒ…çœ¼å…‰ä¹Ÿè¦æ”¾é•¿è¿œäº›\nå†™åœ¨æœ€å æœ¬ç¯‡å†™ç»™è‡ªå·±ä»¥åŠæ‰€æœ‰å¯èƒ½è·Ÿæˆ‘ä¸€æ ·ï¼Œæœ‰æ—¶å€™è¿‡å¤šä¸“æ³¨äºç¼–ç ï¼Œå¿½ç•¥äº†ä¸€äº›è½¯æŠ€èƒ½å¯¼è‡´å·¥ä½œæ²¡æœ‰è¾¾æˆé¢„æœŸçš„æœ‹å‹ï¼ŒåŒæ—¶ä¹Ÿæ„Ÿè°¢ä¸€è·¯ä¸Šç»™æˆ‘æä¾›æŠ€æœ¯æŒ‡å¯¼ã€åšäº‹æŒ‡å¯¼çš„æœ‹å‹ä»¬\n","date":"2024-01-25T15:09:13+08:00","image":"https://sherlock-lin.github.io/p/%E5%B7%A5%E4%BD%9C%E8%BD%AF%E6%8A%80%E8%83%BD%E7%AC%AC%E4%B8%80%E5%BC%B9%E5%85%B3%E4%BA%8E%E8%81%8C%E5%9C%BA%E6%B2%9F%E9%80%9A%E6%88%90%E9%95%BF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/image-20240920151741705_hu3661236691741607602.png","permalink":"https://sherlock-lin.github.io/p/%E5%B7%A5%E4%BD%9C%E8%BD%AF%E6%8A%80%E8%83%BD%E7%AC%AC%E4%B8%80%E5%BC%B9%E5%85%B3%E4%BA%8E%E8%81%8C%E5%9C%BA%E6%B2%9F%E9%80%9A%E6%88%90%E9%95%BF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/","title":"å·¥ä½œè½¯æŠ€èƒ½ç¬¬ä¸€å¼¹ï¼Œå…³äºèŒåœºæ²Ÿé€šã€æˆé•¿çš„é‚£äº›äº‹"},{"content":"åœ¨å„ç§æ­¦ä¾ æ–‡åŒ–çš„æ¸²æŸ“ä¸‹ï¼Œæˆ‘ä»å°èŒç”Ÿäº†ä¸€ç§å¥‡æ€ªçš„æƒ³æ³•ï¼Œå°±æ˜¯å¼„ä»»ä½•äº‹éƒ½è¦å·å·æ‘¸æ‘¸çš„é’»ç ”ï¼Œæœ€åæƒŠè‰³æ‰€æœ‰äººï¼›å› æ­¤æ— è®ºæ˜¯å¤§å­¦è¿˜æ˜¯æ¯•ä¸šå·¥ä½œä¸­ï¼Œå¾ˆå¤šäº‹æƒ…éƒ½å¸Œæœ›åšåˆ°â€œå®Œç¾â€å†åŒæ­¥ç»™â€œå¤–ç•Œâ€ï¼Œå¦‚ä»¥ä¸‹å‡ ä¸ªä¾‹å­\nå­¦ä¹ SpringMVCï¼Œæƒ³è¯´ç­‰å­¦é€äº†å†è¾“å‡ºæ–‡ç« åšå®¢ åšæŸé¡¹ä»»åŠ¡ï¼Œæƒ³è¯´ç­‰æ‹¿åˆ°è‡ªå·±è§‰å¾—åˆæ ¼çš„æˆæœå†åŒæ­¥ç»™ä¸Šçº§ åšæŠ€æœ¯åˆ†äº«ï¼Œç”±äºæƒ³åšå¾—å¥½ä¸€äº›ï¼Œæ—¢è¦..åˆè¦..è¿˜è¦..ç­‰ç­‰ï¼Œç»“æœå¯¼è‡´åˆ†äº«æ— é™ \u0026hellip; ä½†æ˜¯ä»¥ä¸Šç§ç§æœ€ç»ˆéƒ½æ²¡æœ‰è¾¾åˆ°å¾ˆå¥½çš„æ•ˆæœï¼Œå¦‚ä½•ç®—å­¦é€ï¼Ÿä½ æ°¸è¿œéƒ½ä¸ä¼šå½»åº•å‡†å¤‡å¥½çš„ï¼Œå°±åƒè‘£å®‡è¾‰è¯´çš„ï¼Œç»™ä½ ä¸‰å¹´ä½ å‡†å¤‡ä¸å¥½é«˜è€ƒï¼Œå°±ç®—ç»™ä½ ä¸‰åå¹´ä¹Ÿå‡†å¤‡ä¸å¥½çš„ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯è¾¹å­¦è¾¹è¾“å‡ºåšå®¢ï¼Œé€šè¿‡è¾“å‡ºæ¥åæ€è‡ªå·±æ‰€å­¦çš„å†…å®¹ï¼›æ‹¿åˆ°ä»»åŠ¡è¦å®šæœŸæ±‡æŠ¥ç»™ä¸Šçº§ï¼Œæˆ‘ä»¬æ‰€ç”Ÿæ´»çš„ä¸–ç•Œæ˜¯ä¸€ä¸ªé”™ç»¼å¤æ‚çš„ä½“ç³»ï¼Œä¹Ÿè®¸è¿‡äº†å‡ å¤©è¿™ä¸ªä»»åŠ¡å·²ç»å˜å¾—â€œä¸é‡è¦â€äº†ï¼Œä½ å¦‚æœæ—©ç‚¹ä¸ä¸Šçº§æ±‡æŠ¥ä¸æ²Ÿé€šå°±ä¼šæ—©ç‚¹æŠŠæ›´å¤šç²¾åŠ›æŠ•å…¥åˆ°æ›´æœ‰ç”¨çš„ä»»åŠ¡ä¸Šï¼Œæˆ–è€…è¯´åœ¨å¾—åˆ°ä¸Šçº§çš„å¸®åŠ©ï¼Œä½ å¯ä»¥æ›´åŠ å¿«é€Ÿçš„æ”»å…‹è¿™ä¸ªä»»åŠ¡ï¼Œå†ä¸æµä½ ä¹Ÿè¦è®©ä¸Šçº§çŸ¥é“è¿™äº›äº‹æƒ…çš„è¿›å±•ç­‰ã€‚ä»¥ä¸Šç§ç§æ€è€ƒçš„æ¨¡å¼æ˜¯ä¸€ç§å•å‘çš„æ–¹å¼ï¼Œä¸ªäººè®¤ä¸ºæ˜¯ä¸å¤ªå¥åº·çš„ï¼Œç†æƒ³çš„æƒ…å†µä¸‹åº”è¯¥æ˜¯ä¸€ä¸ªèºæ—‹ç¯çŠ¶çš„ç»“æ„ï¼Œå¦‚ä¸‹å›¾ é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œä»å¼€å§‹åˆ°ç»“æŸé‚£ä¹ˆä¸€é•¿æ¡çº¿éƒ½æ˜¯ä¸€æ¡å­¤ç‹¬çš„è·¯ï¼Œå¦‚æœåªæ˜¯è‡ªå·±åŸ‹å¤´ä»å¤´åˆ°å°¾å»åšä¸€ä»¶äº‹å¾ˆæœ‰å¯èƒ½æ˜¯æ¯ç‡¥ã€ç—›è‹¦çš„äº‹ï¼Œè¿™ä¼šå¯¼è‡´å¾ˆå¤šäººä¸­é€”æ”¾å¼ƒï¼Œè¿™ä¹Ÿæ˜¯ä¸Šé¢å‡ ä¸ªä¾‹å­å¤±è´¥çš„æœ€ä¸»è¦æ ¹å› ï¼›å› æ­¤å†æ¥çœ‹ç¬¬äºŒç§æ–¹å¼ï¼Œåœ¨æœ‰ç›®æ ‡ä¹‹åçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å…ˆå°†å…¶æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ä¸€ä¸ªä¸ªå°ä»»åŠ¡ï¼Œæ¯æ”»å…‹ä¸€ä¸ªå°ç‚¹æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€‚å½“åšä¸‹è¾“å‡ºï¼Œæ— è®ºæ˜¯è¾“å‡ºæŠ€æœ¯åšå®¢ã€è¿˜æ˜¯æŠ€æœ¯åˆ†äº«æˆ–è€…æ˜¯å…¶ä»–æ–¹å¼ï¼Œåœ¨æ¥å—åˆ°â€œé²œèŠ±ä¸æŒå£°â€åæˆ‘ä»¬ä¼šæ‹¥æœ‰æ›´å¤šçš„åŠ¨åŠ›å¯¹ä¸‹ä¸€ä¸ªâ€œå ¡å’â€å‘èµ·è¿›æ”»ï¼Œåœ¨æ¥å—â€œé²œèŠ±ä¸æŒå£°â€çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¬åˆ°æ›´å¤šçš„åé¦ˆï¼Œä¾‹å¦‚å¯èƒ½ä¼šè¯„è®ºè¯´ä½ å¯¹IOCçš„æŸä¸ªç†è§£æ˜¯é”™è¯¯çš„ã€é¢†å¯¼è§‰å¾—ä½ çš„è¿™ä¸ªæ–¹æ¡ˆä¸€å¯èƒ½å­˜åœ¨æŸä¸ªç¼ºé™·ç­‰ç­‰ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªåŸºç¡€ä¸‹ï¼Œä½ åœ¨å¼€å¯ä¸‹ä¸€ä¸ªç¯æ˜¯æœ‰ä¸ªæ›´å¤šçš„â€œæ³¨æ„äº‹é¡¹â€ï¼Œè¿™èƒ½è®©ä½ æ›´æœ‰æ¡ä¸ç´Šçš„æœç€æœ€ç»ˆç›®æ ‡å‰è¡Œã€‚\né™¤äº†å¤§ç›®æ ‡è¦è¿›è¡Œæ‹†åˆ†ï¼Œæˆ‘ä»¬ä¹Ÿè¦é‡è§†å¤–ç•Œåé¦ˆçš„â€œä½œç”¨â€ï¼Œæ›¾ç»æˆ‘è§‰å¾—åˆ«äººçš„çœ‹æ³•ä¸é‡è¦ï¼Œç­‰è‡ªå·±æŠŠå¤§ç›®æ ‡åšå¥½äº†å¤§å®¶å¯¹ä½ çš„çœ‹æ³•è‡ªç„¶è€Œç„¶çš„å°±ä¼šå˜å¥½ã€‚è¿™äº›ä¹Ÿæ²¡é”™ä½†æ˜¯å¤§éƒ¨åˆ†äººéƒ½æ˜¯æ™®é€šäººï¼Œéƒ½æ˜¯â€œä¿—äººâ€ï¼Œè¢«äººè¡¨æ‰¬ä¼šå¼€å¿ƒï¼Œæ”¶åˆ°ç‚¹èµä¼šå…´å¥‹ï¼Œå› æ­¤æˆ‘ä»¬è¦åˆç†çš„åº”ç”¨è‡ªå·±çš„â€œäººæ€§â€çš„è¿™ä¸ªåˆ©å™¨ã€‚ä¸ç”¨å®³æ€•æš´éœ²è‡ªå·±ï¼Œæ”¶åˆ°æ­£å‘åé¦ˆå°±æŠŠå®ƒå½“ä½œæ˜¯â€œç‡ƒæ–™â€ç»§ç»­é©±åŠ¨è‡ªå·±æœç€ç›®æ ‡æ–¹å‘é£è¡Œï¼Œæ”¶åˆ°è´Ÿé¢åé¦ˆå°±é€‚å½“åæ€æœ‰æ²¡æœ‰éœ€è¦è°ƒæ•´çš„ï¼Œå¦‚æœä¸æ˜¯å°±ä¸ç”¨å¤ªè¿‡åœ¨æ„ã€‚ä¸‹é¢æ˜¯æˆ‘ç»˜åˆ¶çš„â€œä¸ªä½“â€ä¸â€œå¤–ç•Œâ€çš„å…³ç³»å›¾\nå°é—­ä¸–ç•ŒæŒ‡çš„æ˜¯æˆ‘ä»¬æ¯ä¸ªäººçš„å†…å¿ƒä¸–ç•Œï¼Œè€Œæ— é™å®‡å®™æŒ‡çš„æ˜¯é™¤äº†è‡ªèº«ä»¥å¤–çš„ä¸€åˆ‡äº‹ç‰©ã€‚ å°é—­ä¸–ç•Œ ä¼˜ç‚¹\nè¿™ä¸ªä¸–ç•Œçš„ä»»ä½•ä¸œè¥¿åªè¦ä½ æƒ³å¯ä»¥éšä¾¿æ”¹åŠ¨ å½“è¿›å…¥å¿ƒæµçŠ¶æ€æ—¶ï¼Œä½ å¤§è„‘ä¼šè¿è½¬å¾—é£å¿«ï¼Œä¸€äº›å›°éš¾ç‚¹å¯ä»¥å¿«é€Ÿæ”»å…‹ä»¥åŠå¿«é€Ÿå¼„æ˜ç™½å¾ˆå¤šçŸ¥è¯†ç‚¹ ç¼ºç‚¹\nå­¤ç‹¬ åæ‰§ æ— é™å®‡å®™ ä¼˜ç‚¹\nåé¦ˆ ç¼ºç‚¹\nå˜ˆæ‚ è¿‡å¤šæ— æ³•æ”¹å˜çš„äº‹ç‰© é€šè¿‡ç®€å•æ¯”è¾ƒå¹¶ä¸æ˜¯æƒ³è¡¨è¾¾å“ªä¸ªæ›´ä¼˜ç§€ï¼Œè€Œæ˜¯æˆ‘ä»¬ä¸ªä½“åº”è¯¥è·Ÿè¿™ä¸ªä¸–ç•Œâ€œé“¾æ¥â€èµ·æ¥ï¼Œå€Ÿç”¨â€œæ— é™å®‡å®™â€ä¸­å¼ºå¤§çš„åé¦ˆèƒ½åŠ›é©±åŠ¨â€œå°é—­ä¸–ç•Œâ€ï¼Œæ¶ˆé™¤ç”±äºå­¤ç‹¬å¸¦æ¥çš„æ‰§è¡ŒåŠ›ä½ä¸‹ï¼Œä¿®æ­£ç”±äºä¸ªä½“è§†è§’æ‰€å¸¦æ¥çš„åæ‰§ï¼ŒåŒæ—¶å†åˆ©ç”¨å¥½â€œå°é—­ä¸–ç•Œâ€çš„ä¼˜ç‚¹ã€‚å¯ä»¥è®©æˆ‘ä»¬å°±åƒé©±ä½¿ä¸€è¾†æ— é™ç‡ƒæ–™çš„é£èˆ¹ï¼Œæœ‰æ¡ä¸ç´Šçš„æœç€æˆ‘ä»¬æ¢¦æƒ³çš„æ˜Ÿçƒé£å»ï½\n","date":"2024-01-10T15:09:16+08:00","image":"https://sherlock-lin.github.io/p/%E4%BB%B0%E6%9C%9B%E6%98%9F%E7%A9%BA%E4%B9%9F%E8%A6%81%E9%B2%9C%E8%8A%B1%E4%B8%8E%E6%8E%8C%E5%A3%B0/image-20240109182221111-4795743_hu1133924793650014166.png","permalink":"https://sherlock-lin.github.io/p/%E4%BB%B0%E6%9C%9B%E6%98%9F%E7%A9%BA%E4%B9%9F%E8%A6%81%E9%B2%9C%E8%8A%B1%E4%B8%8E%E6%8E%8C%E5%A3%B0/","title":"ä»°æœ›æ˜Ÿç©ºï¼Œä¹Ÿè¦é²œèŠ±ä¸æŒå£°"},{"content":"æ¦‚è¿° è¿™å‡ å¹´åœ¨è¿·èŒ«ä¸­çœ‹äº†ä¸å°‘èµ„æ–™ï¼Œæœ‰è§‰å¾—å†™å¾—å¾ˆæ£’çš„ï¼Œä¹Ÿæœ‰å†™çš„å¾ˆç³Ÿç³•çš„ã€‚æ‰€ä»¥ä¸€ç›´æƒ³å†™è¿™å—çš„æ€»ç»“æ¥è¿›è¡Œå½’çº³ï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›èƒ½ç»™å…¶ä»–å¤„äºè¿·èŒ«ä¸­çš„æœ‹å‹æä¾›ä¸€ä»½é«˜è´¨é‡çš„èµ„æ–™åˆ—è¡¨(ä¹Ÿè®¸ä¸€ä¸ªè¯»è€…ä¹Ÿæ²¡æœ‰)ï¼Œä»¥ä¸‹æ¸…å•ä¸ªäººè§‰å¾—å€¼å¾—åå¤çœ‹ä»¥åŠæ€è€ƒ\nå…³äºå­¦ä¹ è¿™ä»¶äº‹ åšä¸»è§‰å¾—è‡ªå·±å¯¹å­¦ä¹ çš„çƒ­æƒ…æœ€é«˜çš„æ—¶å€™æ°æ°æ˜¯åœ¨å°å­¦äºŒä¸‰å¹´çº§å·¦å³ï¼Œå…¥å­¦çš„ç¬¬ä¸€å¤©ï¼Œå¤§å®¶éƒ½ååœ¨åº§ä½ä¸Šï¼Œçœ¼å·´å·´çš„çœ‹ç€éš”å£ç­çš„åŒå­¦é¢†ç€ä¹¦è¿‡å»ï¼Œè¿«ä¸åŠå¾…çš„ç­‰ç€è€å¸ˆå‘æ–°è¯¾æœ¬ã€‚åœ¨å¬åˆ°è€å¸ˆç‚¹åˆ°è‡ªå·±åå­—æ—¶ä¼šå…´å¥‹çš„è·‘åˆ°è®²å°ï¼Œç„¶åæ¿€åŠ¨çš„æŠ±ç€å±äºè‡ªå·±çš„ä¸€å’ä¹¦ğŸ“šåœ¨å…¶ä»–äººçš„ç›®å…‰ä¸‹åƒä¸ªå‡¯æ—‹çš„å¤§å°†å†›ï¼Œå›åˆ°åº§ä½ä¸ŠååƒçŒè±¹è´ªå©ªçš„å¸ç€è‡ªå·±çš„çŒç‰©ä¸€èˆ¬é—»ç€æ–°ä¹¦çš„å‘³é“ï¼Œç„¶åä¸€é¡µé¡µç¿»å¼€æ–°ä¹¦ï¼Œçœ‹ç€ä¸Šé¢è®²é˜…çš„æ–°çš„æ•…äº‹ï¼Œä»¥åŠæœ‰è¶£å¥½ç©çš„æ’ç”»ï¼Œä»¿ä½›è‡ªå·±ä¹Ÿç½®èº«å…¶ä¸­ï¼Œç­‰å›è¿‡ç¥æ¥å·²ç»æ˜¯ä¸‹è¯¾é“ƒäº†ã€‚ä½†éšç€å¹´çºªçš„å¢é•¿ä»¥åŠåº”è¯•æ•™è‚²çš„èƒŒæ™¯ä¸‹ï¼Œå­¦ä¹ é€æ¸æˆä¸ºäº†ä¸€ä»¶åŠŸåˆ©å¿ƒå¾ˆå¼ºçš„äº‹æƒ…ï¼Œå­¦ä¹ â€”\u0026gt; åˆ†æ•°â€”\u0026gt; å­¦åºœâ€”\u0026gt; good å…¬å¸â€”\u0026gt; moneyã€‚è¿™æ¡é“¾è·¯å¾ˆç›´è§‚ä¹Ÿå¾ˆç°å®ï¼Œç‰¹åˆ«æ˜¯å¯¹ä¸€äº›å®¶å¢ƒä¸å¤ªå¥½çš„äººæ¥è¯´æ˜¯ä¸€æ¡â€œå¿…é¡»â€èµ°çš„è·¯ã€‚æ­¥å…¥ç¤¾ä¼šåï¼Œé€šè¿‡å‡ å¹´é€æ­¥ç†Ÿæ‚‰å·¥ä½œå†…å®¹åï¼Œæ…¢æ…¢çš„è¿›å…¥äº†æ‰€è°“çš„èˆ’é€‚åœˆã€‚æ¯å¤©æ—¥å¤ä¸€æ—¥åšç€é‡å¤çš„å·¥ä½œï¼Œå½“ç„¶ä¹Ÿèµšåˆ°äº†ä¸€äº›é’±ï¼Œå°±è®¤ä¸ºè¿™æ¡é“¾è·¯å·²ç»åˆ°è¾¾å°½å¤´äº†è¿™è¾ˆå­éƒ½ä¸éœ€è¦å­¦ä¹ äº†ï¼Œå°±åƒä¸€ä¸ªå·¥å…·æ„Ÿè§‰ç”¨ä¸åˆ°äº†å°±ç›´æ¥ä¸¢å¼ƒã€‚åšä¸»å†™è¿™ç¯‡åšå®¢ç›®çš„å¹¶ä¸æ˜¯åŠå­¦ï¼Œä»…ä»…å•çº¯ä»è‡ªå·±çš„è§†è§’åšäº›åˆ†æï¼Œå­°å¯¹å­°é”™ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯åœ¨åˆ†ææˆ–è€…è®¨è®ºåå¯¹å’±ä»¬è‡ªèº«çš„æ€ç»´æƒ³æ³•æœ‰ä»€ä¹ˆä½œç”¨ä¸æ˜¯å—ï¼Ÿ\nå…³äºå¦‚ä½•å­¦ä¹ è¿™ä»¶äº‹ åœ¨åˆšå¼€å§‹å­¦ä¹ æ—¶ï¼Œæœ¬äººä»¥ä¸ºå­¦ä¹ æ˜¯æœ‰æ·å¾„çš„ï¼Œä½†åœ¨ç»è¿‡æŠ•æœºå–å·§è¢«ç°å®æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦åå¹¶è¢«å‘ŠçŸ¥å­¦ä¹ æ˜¯æ²¡æœ‰æ·å¾„çš„ï¼Œå”¯ä¸€çš„æ·å¾„å°±æ˜¯åŠªåŠ›ã€‚ä¹‹åå°±å„ç§æ— è„‘å·ï¼Œæ­»è®°ç¡¬èƒŒï¼Œå„ç§å‹æ¦¨æ—¶é—´æŠ•å…¥åˆ°é‡Œé¢ã€‚åœ¨ç»è¿‡å¤šå¹´åï¼Œç°åœ¨åšä¸»æƒ³è¯´ï¼Œå­¦ä¹ ï¼Œtmdæ˜¯çœŸçš„æœ‰æ·å¾„çš„ï¼\nä¸Šé¢è¿™å¼ å›¾å°±æ˜¯æˆ‘æ€»ç»“çš„å››æ­¥ï¼Œä¸”æ„æˆå¾ªç¯\næå‡æ•ˆç‡ æ•ˆç‡è¿™å—åˆ†ä¸ºå·¥ä½œå’Œå­¦ä¹ ä¸¤æ–¹é¢ï¼›å¦‚æœä½ å·²ç»åœ¨å·¥ä½œäº†ï¼ŒåŠ¡å¿…å…ˆæå‡å·¥ä½œè¿™æ–¹é¢çš„æ•ˆç‡ï¼Œè¿™æ ·åœ¨å®Œæˆå·¥ä½œåä½ æ‰èƒ½è…¾å‡ºè¶³å¤Ÿå¤šçš„æ—¶é—´ç²¾åŠ›æ¥æå‡å­¦ä¹ æ–¹é¢çš„æ•ˆç‡\nå·¥ä½œæ•ˆç‡çš„æå‡\nåœ¨èŠå·¥ä½œæ•ˆç‡ä¹‹å‰ä½ è¦æƒ³æ˜ç™½å·¥ä½œçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Œæ— ä»–ï¼Œå°±æ˜¯è¦è§£å†³ä½ ä¸Šçº§çš„é—®é¢˜(åŒ…æ‹¬ä½ ä¸Šçº§è‡ªå·±å¯èƒ½éƒ½æ²¡æ„è¯†åˆ°çš„)ï¼Œå„è¡Œå„ä¸šçš†æ˜¯å¦‚æ­¤åŒ…æ‹¬ä½ ä¸Šçº§ï¼Œä»–ä¸€æ ·ä¹Ÿè¦ç»™ä»–çš„ä¸Šçº§è§£å†³é—®é¢˜ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœä½ å¸®ä½ ä¸Šçº§è§£å†³äº†é‡è¦çš„é—®é¢˜ï¼Œé‚£ä¹ˆå¦‚æœæœ‰å‡èŒåŠ è–ªçš„æœºä¼šä»–ä¼šä¸ä¼šä¼˜å…ˆè€ƒè™‘ä½ å‘¢ã€‚æ–¹å‘å¯¹äº†ä¹‹åï¼Œä¸‹ä¸€æ­¥å‘¢ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªäº§å“çš„å¼€å‘ï¼Œé‚£ä¹ˆä½ å°±åº”è¯¥å¯¹è¿™ä¸ªäº§å“è¶³å¤Ÿäº†è§£ä»¥åŠäº†è§£ä¸šå†…çš„ç©æ³•ã€‚è¿™æ ·åœ¨äº§å“æå‡ºä¸€äº›è€—æ—¶å¹¶ä¸”ä¸åˆç†çš„è®¾è®¡æ—¶ï¼Œä½ æ˜¯ä¸æ˜¯å°±èƒ½åˆç†çš„æ‹’ç»æˆ–è£å‰ªå‘¢ï¼›å¦‚æœä¸€å®šè¦åšï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥åé¦ˆè¿™ä¸ªæˆæœ¬å¹¶ä¸”åŠ å…¥è‡ªå·±çš„ä¸€äº›æƒ³æ³•è®©äº§å“åštrade offå‘¢ï¼›å…¶æ¬¡ï¼Œåœ¨å…·ä½“çš„æ—¥å¸¸å·¥ä½œæ—¶ï¼Œå’±ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨å¥½è‡ªå·±ç¨‹åºå‘˜çš„èº«ä»½ï¼Œå°†ä¸€äº›ç¹ççš„å·¥ä½œè¿›è¡Œè‡ªåŠ¨åŒ–/åŠè‡ªåŠ¨åŒ–å‘¢ã€‚æœ€åè¦å¼ºè°ƒçš„ä¸€ç‚¹ä¹Ÿå°±æ˜¯å¾ˆå¤šç¨‹åºå‘˜å®¹æ˜“å¿½ç•¥çš„ï¼Œå°±æ˜¯åŠ¡å¿…è¦æå¥½äººé™…å…³ç³»ï¼Œè¿™å¯¹å·¥ä½œçš„é¡ºåˆ©å±•å¼€çš„å¸®åŠ©æ˜¯éå¸¸å¤§çš„ä¹Ÿèƒ½é¿å…ä¸€äº›æ— æ•ˆå†…è€—ã€‚éšç€ç°åœ¨ç»æµè¿™ä¸ªæƒ…å†µï¼Œå„ä¸ªå…¬å¸éƒ½åœ¨å¼ºè°ƒé™æœ¬å¢æ•ˆï¼Œå…¶å®åšä¸»è§‰å¾—ï¼Œæœ€åº”è¯¥é™æœ¬å¢æ•ˆçš„æ˜¯å’±ä»¬å¼€å‘ï¼Œè¿™é‡Œåšä¸»æ¨èçš„æ˜¯ã€Šç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“ã€‹ä»¥åŠæå®¢æ—¶é—´çš„ã€Š10xç¨‹åºå‘˜å·¥ä½œæ³•ã€‹\nå­¦ä¹ æ•ˆç‡çš„æå‡\nå­¦ä¹ æ•ˆç‡è¿™å—å¯ä»¥å‚è€ƒä¸‹é¢â€œå…³äºå¡bugçš„è¿™ä»¶äº‹â€çš„å†…å®¹ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†å±•å¼€\nåŸ¹å…»å¥½ä¹ æƒ¯ å¥½ä¹ æƒ¯è¿™å—æˆ‘è§‰å¾—ã€Šè®¤çŸ¥è§‰é†’ã€‹ä¸­å°±æ€»ç»“å¾—å¾ˆå¥½ï¼Œåœ¨å¾®ä¿¡è¯»ä¹¦å°±èƒ½çœ‹ï¼Œåšä¸»åœ¨è¿™é‡Œå°±ä¸æ¿é—¨å¼„æ–§äº†ã€‚åšä¸»å°±åˆ†äº«ä¸¤ä¸ªè‡ªå·±å¸¸ç”¨çš„ä¸¤ç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯â€œåªåšä¸€ä¸ªâ€ï¼Œæ¯”å¦‚è¦åšæŒåšä¿¯å§æ’‘ï¼Œé‚£ä¹ˆæ¯å¤©åªåšæŒåšä¸€ä¸ªå°±ç®—å®Œæˆç›®æ ‡ï¼Œå¦‚æœè¦å¤šåšå°±å½“é™„èµ çš„ï¼›å¦ä¸€ç‚¹å°±æ˜¯â€œå¿ƒç†æš—ç¤ºâ€ï¼Œå¯¹äºè¦åŸ¹å…»çš„ä¹ æƒ¯å¯ä»¥é€‚å½“çš„å¿ƒç†æš—ç¤ºï¼Œæ¯”å¦‚è¦åšæŒç»ƒå°æç´ï¼Œå¯ä»¥å¿ƒç†æš—ç¤ºè‡ªå·±â€œæˆ‘æ¯”è°éƒ½çƒ­çˆ±å°æç´â€ã€â€œæˆ‘æ˜¯å°æç´ä¸“ä¸šé€‰æ‰‹â€ç­‰ç­‰ï¼Œè¿™æ ·é¢‘ç¹æš—ç¤ºä¹‹åç­‰å†å»åšçš„æ—¶å€™å°±è§‰å¾—è¿™ä¸€åˆ‡éƒ½æ˜¯ç†æ‰€åº”å½“çš„\nå¼€é˜”çœ¼ç•Œã€æå‡æ€ç»´ è¿™ä¸€ç‚¹åº”è¯¥æ˜¯æœ€è®©åšä¸»æ„Ÿæ…¨å¹¶ä¸”åæ€•çš„ï¼Œåœ¨è¿™äº›å¹´çš„èŒä¸šç”Ÿæ¶¯ä¸­æ¥è§¦è¿‡å¾ˆå¤šåŒäº‹ï¼Œæœ‰ä¼˜ç§€åˆ°è®©åšä¸»æƒ³çŒ®ä¸Šè†ç›–çš„æŠ€æœ¯å¤§ä½¬å¦‚äºæŸå‰è¾ˆï¼Œä¹Ÿæœ‰ä¸äº†è§£æŠ€æœ¯ä½†æ˜¯æ€ç»´å¾ˆæ¸…æ™°ï¼Œåˆ†æé—®é¢˜èƒ½å…¥ç›®ä¸‰åˆ†çš„äº§å“å‰è¾ˆï¼›ä½†å…¶ä¸­ä¹Ÿæœ‰ä¸å°‘çš„åŒäº‹çš„çœ¼ç•Œå’Œæ€ç»´è®©åšä¸»æ„Ÿåˆ°æœ‰äº›æƒŠè®¶ã€‚æœ‰ä¸ªå·¥ä½œå°†è¿‘åå¹´çš„æµ‹è¯•å‰è¾ˆï¼Œç»å¸¸ä¸€ä¸ªå°é—®é¢˜è¦åå¤è·Ÿä½ æ°æ‰¯äºŒä¸‰ååˆ†é’Ÿtaæ‰æ˜ç™½ï¼Œæ€ç»´å¤„äºä¸€ç§æ··æ²Œçš„çŠ¶æ€ã€‚ä¹Ÿæœ‰ä¸€äº›åŒäº‹ä¸€ä»¶äº‹æƒ…ç»™ä½ æè¿°åŠå¤©ä½ éƒ½æ— æ³•çŸ¥é“taè¡¨è¾¾ä»€ä¹ˆï¼›æ›´æœ‰ä¸ªåˆ«åŒäº‹å·¥ä½œå¤šå¹´ä¸çŸ¥é“å€’æ’ç´¢å¼•ã€åˆ†å¸ƒå¼ç­‰çŸ¥è¯†ã€‚åšä¸»æè¿™äº›å¹¶ä¸æ˜¯è¦æŒ‡è´£ä»»ä½•äººï¼Œåœ¨ç”Ÿæ´»ä¸­ä»–ä»¬éƒ½æ˜¯å¾ˆå¥½çš„äººå¹¶ä¸”ç›¸å¤„å¾—ä¹Ÿå¾ˆæ„‰å¿«ã€‚ä½†æ˜¯åšä¸»åœ¨è¿™é‡Œæå‡ºæ¥ä¸»è¦æ˜¯æƒ³è¡¨è¾¾ â€œæœ‰é“æ— æœ¯ï¼Œæœ¯å¯æ±‚ï¼›æœ‰æœ¯æ— é“æ­¢äºæœ¯â€ è¿™ä¸ªè§‚ç‚¹ï¼Œå¦‚æœåšæŠ€æœ¯çŸ¥è¯†æ··å£é¥­åƒé‚£æ— æ‰€è°“ï¼Œä½†å¦‚æœä½ æ˜¯ä¸€ä¸ªå¯¹æŠ€æœ¯æœ‰è¿½æ±‚çš„çƒ­è¡€é’å¹´ï¼Œåˆ°è€äº†å¿™ç¢Œä¸€è¾ˆå­ä»¥ä¸ºæ˜¯æŠ€æœ¯çš„ä¸œè¥¿åŸæ¥åªæ˜¯çš®æ¯›ï¼Œæ­¤æ—¶é†’æ‚Ÿä¼šä¸ä¼šæœ‰äº›æ‚²å‡‰ã€‚è¿™ä¹Ÿæ˜¯åšä¸»è‡ªå·±åæ€•çš„ç‚¹ï¼Œå…·ä½“çš„è§£æ³•å¯ä»¥çœ‹ä¸‹é™ˆè€å¸ˆçš„ åˆ«è®©è‡ªå·±â€œå¢™â€äº†è‡ªå·±\næˆäº‹ï¼Œå¹¶æ„æˆå¾ªç¯ æˆäº‹ç®€å•æ¥è¯´å°±æ˜¯å°†ä¸€ä»¶äº‹æƒ…åšå¥½ï¼Œå“ªæ€•æ˜¯ä¸€ä»¶å°äº‹ã€‚è¿™ç‚¹æ˜¯åšä¸»å››ä¸ªé‡Œé¢åšçš„æœ€çƒ‚çš„ï¼Œè¿™ä¹Ÿç›´æ¥å¯¼è‡´äº†åšä¸»é¢ ç°¸çš„èŒä¸šç”Ÿæ¶¯ã€‚æ— è®ºä¸Šçº§ç»™ä½ äº¤ä»£ä»€ä¹ˆäº‹æƒ…ï¼ŒåŠ¡å¿…è¦äº‹äº‹æœ‰ç€è½ï¼Œäº‹äº‹æœ‰å›å“ï¼Œå“ªæ€•æ˜¯åšä¸äº†ä¹Ÿè¦ç¬¬ä¸€æ—¶é—´åŒæ­¥ã€‚åœ¨èŒåœºä¸­ï¼Œä½ çš„ç»©æ•ˆä¸ä¼šè·Ÿä½ çš„æŠ€æœ¯æŒ‚é’©ï¼Œåªä¼šè·Ÿä½ çš„æˆäº‹å‘ˆæ­£ç›¸å…³ã€‚å€Ÿç”¨æ˜“ç»çš„è¯â€œå¤©è¡Œå¥ï¼Œå›å­ä»¥è‡ªå¼ºä¸æ¯ï¼›åœ°åŠ¿å¤ï¼Œå›å­ä»¥åšå¾·è½½ç‰©â€ï¼Œæ— è®ºä½ æŠ€æœ¯å†ç‰›ï¼Œå¦‚æœä¸Šçº§ç»™ä½ æ´¾çš„æ´»ä½ æ€»æ˜¯åšå¾—å¾ˆç³Ÿç³•è®©ä»–ä¸çœå¿ƒï¼Œé‚£æƒ³å¿…ä»–ä»¥åä¹Ÿä¸æ•¢å†æ´¾é‡è¦çš„ä»»åŠ¡ç»™ä½ å¹¶ä¸”ä¹Ÿä¸ä¼šç»™ä½ å¤ªå¥½çœ‹çš„ç»©æ•ˆã€‚å› æ­¤åœ¨èŒåœºä¸­å¾·è¡Œæ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™é‡Œé¢å°±åŒ…æ‹¬ä¸Šçº§å¯¹ä½ çš„ä¿¡ä»»ã€‚é€šè¿‡ä¸æ–­æˆäº‹æ¥å¢å¼ºä¸Šçº§å¯¹ä½ çš„ä¿¡å¿ƒã€ä¾èµ–ï¼Œä½ ä¼šè·å¾—æ›´å¤šä¸°åšçš„èµ„æº(é™¤äº†å·¥èµ„è¿˜åŒ…æ‹¬èƒ½è®©ä½ æå‡æ‰“ç£¨æŠ€æœ¯çš„ä»»åŠ¡ç­‰)ã€‚åœ¨ä¸æ–­ç§¯ç´¯è¿™äº›ç»éªŒåï¼Œè·ç¦»ä¸‹ä¸€ä¸ªè·ƒè¿ä¹Ÿæ˜¯å¾ˆå¿«çš„ä¸€ä»¶äº‹ã€‚åœ¨è¿™é‡Œæ¨èã€Šå†¯å”æˆäº‹å¿ƒæ³•ã€‹ä»¥åŠã€Šè·ƒè¿: æˆä¸ºé«˜æ‰‹çš„æŠ€æœ¯ã€‹\nå…³äºå¡bugçš„è¿™ä»¶äº‹ å¦‚æœä½ è¦é—®æˆ‘è¿™ä¸ªä¸–ç•Œèƒ½ä¸èƒ½å¡bugï¼Œæˆ‘ä¼šæ¯«ä¸çŠ¹è±«çš„å‘Šè¯‰ä½ ï¼Œèƒ½ã€‚å¤§è‡´ä¸¾å‡ ç‚¹\npsï¼šåšä¸»å¯¹å¡bugçš„å®šä¹‰æ˜¯ï¼Œå¦‚æœåˆ«äººå­¦ä¹ ä¸€ä¸ªä¸œè¥¿è¦åå¤©ï¼Œä½ é€šè¿‡è¿™ä¸ªæ–¹å¼åªè¦äº”å¤©é‚£å°±æ˜¯ï¼›å¦‚æœåˆ«äººæˆä¸ºä¸“ä¸šçš„è¦8å¹´ï¼Œä½ é€šè¿‡è¿™ä¸ªæ–¹å¼åªè¦5å¹´ç”šè‡³æ›´å°‘ï¼Œé‚£å°±æ˜¯ã€‚\nå¢å¼ºå›è·¯ è¿™ä¸ªè¯æ˜¯åœ¨ã€Šè®¤çŸ¥è§‰é†’ã€‹ä¸­æ¥è§¦åˆ°çš„ï¼Œç®€å•æ¥è¯´å°±æ˜¯äººä½“æœ¬èº«æ˜¯å­˜åœ¨ä¸€å®šçš„æœºåˆ¶ï¼Œåœ¨ä½ ä¸æ–­çš„åˆ»æ„è®­ç»ƒæŸé¡¹èƒ½åŠ›ï¼Œå®ƒä¼šä¸åœçš„å¢å¼ºï¼Œç”šè‡³æœ‰æ—¶å€™å¢å¼ºçš„å¹…åº¦æ˜¯è·ƒè¿çº§åˆ«çš„ã€‚é‚£å¦‚æœå’±ä»¬å°†è¿™ä¸ªæœºåˆ¶ç”¨åœ¨å­¦ä¹ æŸäº›ä¸“ä¸šèƒ½åŠ›å¾ˆå¼ºçš„æŠ€èƒ½ç‚¹ä¸Šï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è·å¾—æ„å‘ä¸åˆ°çš„ç»“æœï¼Ÿ\nä¹Ÿè®¸æœ‰è¯»è€…è¦å¼€å–·äº†ï¼Œè¿™ä¸æ˜¯åºŸè¯å—ï¼Œæˆ‘ä¸æ–­çš„ä»˜å‡ºè‚¯å®šæ˜¯ä¸æ–­çš„æœ‰æ”¶è·å•Š~\nä½†è¯·æ³¨æ„ï¼Œåšä¸»è¿™é‡Œæƒ³å¼ºè°ƒçš„æ˜¯å¢é•¿çš„å¹…åº¦ï¼Œå¯èƒ½ä¸æ˜¯å¹³æ—¶å¤§å®¶æ‰€æƒ³çš„çº¿æ€§å¢é•¿ï¼Œå®ƒæœ‰æ—¶å€™å¯èƒ½æ˜¯å‘ˆç°çˆ†ç‚¸å¼çš„è·³è·ƒå¢é•¿ã€‚ä»¥å‰æœ‰çœ‹è¿‡æ•…äº‹ï¼Œå°±ä¸€ä¸ªæ‰“é“åŒ æ—¥å¤ä¸€æ—¥çš„æ‰“é“è¿‡å»äº†å¥½å¤šå¹´ï¼Œçªç„¶æœ‰ä¸€å¤©ä»–æ‚Ÿäº†ç„¶åå°±æœ‰äº†ç»ä¸–ç¥åŠŸ(ä¸çŸ¥é“ç¼–å‰§æ˜¯æ€ä¹ˆæƒ³çš„å“ˆå“ˆå“ˆ)ã€‚ä¸è¿‡åšä¸»æœ‰æ¯”è¾ƒæ·±çš„ä½“ä¼šï¼Œåšä¸»åˆšæ¯•ä¸šé‚£ä¼šåšæŒé˜…è¯»æºç ï¼Œä¸€å¼€å§‹æ™¦æ¶©éš¾æ‡‚ï¼Œè™½ç„¶ä¸­é€”ä¹Ÿæ–­è¿‡å‡ æ¬¡ï¼Œä½†å¹¸è¿çš„æ˜¯ä¸€ç›´éƒ½åšæŒè¿‡æ¥äº†ã€‚å°±åœ¨æ¯•ä¸šçš„ç¬¬ä¸‰å¹´é‚£æ ·çªç„¶å°±æ‚Ÿäº†ï¼Œå¯¹æºç ä¸å†ææƒ§ã€‚å“ªæ€•æ˜¯ä¸€ä¸ªå…¨æ–°çš„ä»æ²¡çœ‹è¿‡çš„å¤§æ•°æ®æ–°ç»„ä»¶ï¼Œä¹Ÿèƒ½å¾ˆå¿«çš„é€šè¿‡çœ‹æºç ç†æ¸…å…¶å†…éƒ¨åŸç†ã€‚åæ¥è·³æ§½çš„æ—¶å€™å¤§æ¦‚å¾ˆå¿«ä¸Šæ‰‹äº†ä¸€ä¸ªç¨å¾®å¤æ‚çš„é¡¹ç›®ï¼Œä¸Šçº§ç•¥ä¸ºæƒŠè®¶ï¼Œæ®Šä¸çŸ¥è¿™çº¯çº¯çš„é™ç»´æ‰“å‡»ã€‚\nè‡ªå·±ä¹Ÿä»”ç»†åœ¨è¿™æ–¹é¢åšè¿‡æ€»ç»“ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆç„å­¦ã€‚å…¶å®åœ¨æˆ‘ä»¬ä¸åœçš„å­¦æŸä¸ªé¢†åŸŸçš„æ–°ä¸œè¥¿æ—¶ï¼Œå’±ä»¬è‡ªèº«ä¼šå¯¹å…¶è¿›è¡ŒæŠ½è±¡å½’çº³ã€‚åœ¨å’±ä»¬å¸æ”¶è¿™ä¸ªæŠ½è±¡æ¨¡å‹åï¼Œå†å»å­¦è¿™ä¸ªé¢†åŸŸçš„æ–°ä¸œè¥¿æ—¶ï¼Œä¼šè‡ªåŠ¨çš„ç”¨ä¸Šè¿™ä¸ªæŠ½è±¡æ¨¡å‹ï¼Œé‚£é€Ÿåº¦ç›¸æ¯”æ–°å­¦ä¸€ä¸ªä¸œè¥¿è‚¯å®šæ˜¯è¦å¿«ä¸Šå¾ˆå¤šã€‚\nä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœç°åœ¨å†è®©åšä¸»å»å­¦ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚åšä¸»ä¼šåˆ†ä¸‰æ­¥ï¼Œç¬¬ä¸€æ­¥é˜…è¯»å®˜æ–¹æ–‡æ¡£/åšå®¢ï¼Œä¸»è¦çœ‹éƒ½æœ‰å“ªäº›åŠŸèƒ½ä»¥åŠæœºåˆ¶ï¼›ç¬¬äºŒæ­¥è‡ªå·±æ­å»ºèµ·æ¥ç©ä¸€ä¸‹å„ä¸ªåŠŸèƒ½é¡ºå¸¦éªŒè¯å·©å›ºç¬¬ä¸€æ­¥çš„çŸ¥è¯†ï¼›ç¬¬ä¸‰æ­¥å°±æ˜¯ç¿»çœ‹æºç çœ‹çœ‹åŠŸèƒ½ã€æœºåˆ¶æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œéƒ½æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ç­‰ç­‰ã€‚è¿™ä¸‰æ¿æ–§ä¸‹å»ä¸æ•¢è¯´ç²¾é€šä½†è‡³å°‘è¯´ç†Ÿç»ƒè¿˜æ˜¯æ²¡ä»€ä¹ˆå¤§é—®é¢˜çš„ã€‚\nå€Ÿç”¨å‘¨æ€»ç†çš„è¯ï¼Œä¸ä¼šå’±ä»¬å¯ä»¥å­¦å˜›ï¼Œå³ä¾¿å†éš¾å€Ÿç”¨å¥½å¢å¼ºå›è·¯æœºåˆ¶ä¸€å®šä¹Ÿèƒ½æ”»å…‹\nå¤åˆ© è¿™ä¸ªè¯æ˜¯æŠ•èµ„é‡Œé¢ç»å¸¸æåˆ°çš„è¯ï¼Œæ¯”å¦‚æ¯å¹´æŠ•èµ„èµš10%ï¼Œå¦‚æœæƒ³è¦èµ„äº§ç¿»å€å¹¶ä¸éœ€è¦10å¹´ï¼Œè€Œæ˜¯å…«å¹´ã€‚è¿™å°±æ˜¯å¤åˆ©çš„ä½œç”¨\né‚£åœ¨å­¦ä¹ ç”Ÿæ¶¯ä¸­æ˜¯å¦ä¹Ÿå¯ä»¥åˆ©ç”¨å¤åˆ©çš„èƒ½åŠ›å‘¢ï¼Œä»”ç»†å»æ¨ç®—å¤åˆ©å¢é•¿çš„æ ¸å¿ƒå°±ä¼šçŸ¥é“ï¼Œé™¤äº†æœ¬é‡‘æ›´é‡è¦çš„å°±æ˜¯æ—¶é—´ï¼Œæ—¶é—´å¯ä»¥æ”¾å¤§å¾ˆå¤šä¸œè¥¿ï¼Œé™¤äº†å’±ä»¬çš„èµ„äº§ï¼Œè¿˜å¯ä»¥æ”¾å¤§å’±ä»¬å¾—å­¦è¯†ã€‚å¹¶ä¸”æ›´é‡è¦çš„å°±æ˜¯è¦åšæŒï¼Œåœ¨å¤åˆ©ä¸­å¦‚æœæ–­æ–­ç»­ç»­çš„æŠ•èµ„æ•ˆæœä¼šå¤§æ‰“æŠ˜æ‰£ï¼Œå­¦ä¹ ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ›´ä½•å†µè¿˜è¦è€ƒè™‘åˆ°ã€Šè·ƒè¿: æˆä¸ºé«˜æ‰‹çš„æŠ€æœ¯ã€‹ä¸­æ‰€è¯´çš„èµ„æºå€¾æ–œé—®é¢˜ï¼Œé‚£æ”¶ç›Šå°±ä¼šæŸå¤±å¾—æ›´å¤šã€‚å› æ­¤å­¦ä¹ æœ€é‡è¦çš„å°±æ˜¯è¦åšæŒï¼Œè¶Šåˆ°åæœŸæ•ˆæœä¼šè¶ŠåŠ æ˜¾è‘—ï¼Œç›¸ä¿¡åˆ°æ—¶å€™çš„æ”¶ç›Šä¸€å®šä¸ä¼šè®©ä½ å¤±æœ›\nå…ƒè®¤çŸ¥ è¿™ä¸ªè¯ä¹Ÿæ˜¯åœ¨ã€Šè®¤çŸ¥è§‰é†’ã€‹ä¸­æ¥è§¦åˆ°çš„ï¼Œå½¢è±¡ä¸€ç‚¹è¯´å°±æ˜¯åˆ†è£‚å‡ºä¸€ä¸ªè‡ªå·±åƒèœ˜è››ä¾ ä¸€æ ·ç²˜åœ¨å¤©èŠ±æ¿ä¸Šä¿¯è§†ä¸€åˆ‡ï¼Œè¿™ä¸ªåˆ†è£‚å‡ºæ¥çš„è‡ªå·±åªåšä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯è§‚æµ‹ä¸‹é¢å‘ç”Ÿçš„æ‰€æœ‰äº‹æƒ…ï¼ŒåŒ…æ‹¬å®¿ä¸»çš„ä¸€ä¸¾ä¸€åŠ¨ï¼Œä¸€è¨€ä¸€è¡Œä»¥åŠæ€è€ƒçš„å†…å®¹ã€‚ä½ çš„çµé­‚åœ¨è¿™ä¸¤å¹…èº¯å£³ä¸­æ¥å›è¿›è¡Œåˆ‡æ¢ï¼Œä½ ä¾ç„¶åƒå¹³æ—¶ä¸€æ ·æ”¹å¹²å˜›å¹²å˜›ã€‚åªä¸è¿‡æ¯éš”åå¤šåˆ†é’Ÿå·¦å³éƒ½è¦æœ‰æ„çš„åˆ‡æ¢åˆ°\u0026quot;èœ˜è››ä¾ \u0026quot;ä¸Šè¿›è¡Œè§‚æµ‹ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯å•¥å˜ï¼Œå…¶å®å°±æ˜¯ä¸ºäº†è‡ªæˆ‘çº æ­£ï¼Œè‡ªæˆ‘ä¿®å¤ã€‚æ¯”å¦‚è¯´ä½ è™½ç„¶ååœ¨ä¹¦æ¡Œå‰æ‹¿ç€æœ¬ä¹¦ï¼Œä½†æ˜¯å¯èƒ½ä½ çš„æ€ç»ªå·²ç»æ•…å›½ç¥æ¸¸äº†ï¼Œåœ¨ä½ åˆ‡æ¢çµé­‚åå°±èƒ½çœ‹åˆ°å®¿ä¸»èº¯å£³è¿™å¹…å‚»æ¨¡æ ·å¹¶ä¸”åˆ‡æ¢å›å»åä¸“æ³¨å›æ¥ç»§ç»­çœ‹ä¹¦ï¼›æ¯”å¦‚è¯´ä½ åœ°é“ä¸Šé‡åˆ°ç´ è´¨å·®çš„äººè®©ä½ æƒ…ç»ªæš´èºæƒ³å†²ä¸Šå»è·Ÿä»–æ‰“ä¸€æ¶ï¼Œåœ¨ä½ åˆ‡æ¢çµé­‚åå°±å¯ä»¥æ¸…æ™°å†·é™çš„åˆ†æ åŒæ–¹çš„ä½“å‹å·®è·ã€æ˜¯å¦æœ‰æ‘„åƒå¤´ã€é™¤äº†åŠ¨æ‰‹æ˜¯å¦è¿˜æœ‰å…¶ä»–æ›´ä¼˜è§£ç­‰ç­‰ï¼›æ¯”å¦‚è¯´åœ¨ç»™å¤§å®¶è®²ä¸œè¥¿çš„æ—¶å€™ï¼Œé€‚å½“çš„åˆ‡æ¢çµé­‚çœ‹çœ‹å®¿ä¸»ç°åœ¨è®²è¯è¯­é€Ÿæ˜¯å¦è¿‡å¿«ï¼Œæ˜¯å¦ç®€å•çš„çŸ¥è¯†å¤æ‚åŒ–ç­‰ç­‰æ¥è¿›è¡Œè‡ªæˆ‘è°ƒæ•´ã€‚\nç®€å•æ¥è¯´å°±æ˜¯è°ƒæ•´è‡ªèº«çš„çŠ¶æ€æé«˜åšäº‹æƒ…çš„æ•ˆç‡ä»¥åŠè·å¾—æ›´å¥½çš„ç»“æœã€‚å½“ç„¶ä»¥ä¸Šåªæ˜¯åšä¸»å¯¹è¿™ä¸ªæ¦‚å¿µçš„è§è§£ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥é˜…è¯»åŸè‘—\nè¯»ä¹¦é£è½® ä¸¤å¹´å‰åœ¨å­¦ä¹ â€œå­¦ä¹ æ–¹æ³•â€æ—¶åˆ·åˆ°è¿™ä¸ªï¼š ä¹¦é­”çš„å­¦ä¹ æ–¹æ³•-1:è¯»ä¹¦çš„é£è½® ï¼Œå½“æ—¶çš„ç¬¬ä¸€ä¸ªæ„Ÿè§‰å°±æ˜¯ç›¸è§æ¨æ™šï¼Œå³ä¾¿æ˜¯ç°åœ¨å†çœ‹ä¹Ÿä¸€æ ·ä¼šå¾ˆæ¿€åŠ¨ã€‚è¿™å¯¹åšä¸»è¿™ç§å…·æœ‰ä¸¥é‡çš„æ‹–å»¶ç—‡ç®€ç›´å°±æ˜¯ä¸€å‰‚å¼ºå¿ƒå‰‚ï¼Œåšä¸»å­¦ä¹ åšäº‹ç»å¸¸ä¼šå—å›°äºæƒ³å¤ªå¤šï¼Œè¿™ä¸ªä¸œè¥¿å­¦äº†ä¼šä¸ä¼šä»¥åæ°¸ä¸ä¸Šï¼Œè¿™æœ¬ä¹¦å’Œé‚£æœ¬ä¹¦åº”è¯¥çœ‹å“ªä¸€æœ¬ï¼Œé’»ç ”è¿™ä¸ªäº‹æƒ…è¿˜æ˜¯ç•™åˆ°æŸä¸ªé•¿å‡å†å­¦ç­‰ç­‰ã€‚ä½†è¿™ç¯‡åšå®¢æŒ‡å¯¼ä½ ï¼Œåˆ«æ€•ï¼Œå¤§èƒ†å»å­¦ï¼Œä¸ä»…è¦å­¦è¿˜è¦é£å¿«çš„å­¦ã€‚æ—¶é—´ä¼šè‡ªåŠ¨è¿‡æ»¤æ‰ç”¨ä¸ä¸Šçš„ï¼Œä½ æœ€é‡è¦çš„æ˜¯è¦å­¦èµ·æ¥ï¼Œä¿æŒå­¦ä¹ çš„åŠ²å¤´(æ˜¯ä¸æ˜¯å¯¹åº”ä¸Šå›è·¯å¢å¼ºå’Œå¤åˆ©äº†)ã€‚ä½†ä½ ä¿æŒå­¦ä¹ çš„åŠ²å¤´åï¼Œä½ ä¼šå‘ç°ä¸œè¥¿è¶Šå­¦è¶Šå¿«ï¼ŒåŒæ ·çš„æ—¶é—´ä½ èƒ½çœ‹å®Œæ›´å¤šçš„ä¹¦ï¼Œå¼„æ‡‚æ›´å¤šçŸ¥è¯†ã€‚\nå¿ƒæµ è¿™ä¸ªè¯æ˜¯åœ¨ã€Šå¿ƒæµã€‹ä¹¦ç±é‡Œæ¥è§¦çš„ï¼Œå…¶å®å°±æ˜¯è¿›å…¥æŸç§çŠ¶æ€ï¼Œåœ¨è¿™ä¸ªçŠ¶æ€ä¸­ä½ å…¨èº«å¿ƒçš„æŠ•å…¥çš„å½“å‰çš„è¿™ä¸ªäº‹æƒ…ï¼Œæ­¤æ—¶çš„æ•ˆç‡æ˜¯æœ€é«˜çš„ã€‚\nç›¸ä¿¡å¾ˆå¤šäººéƒ½æœ‰è¿‡è¿™æ ·çš„æ„Ÿè§‰ï¼Œåšä¸»å°è±¡æœ€æ·±çš„å°±æ˜¯é«˜ä¸­åšæ•°å­¦é¢˜çš„æ—¶å€™ï¼Œæˆ´ä¸Šè€³æœºæ‘’å¼ƒå¤–ç•Œä¸€åˆ‡å¹²æ‰°ã€‚åˆ·é¢˜åˆ·ç€åˆ·ç€ä»¿ä½›è¿›å…¥äº†ä¸€ä¸ªç©ºç™½çš„ä¸–ç•Œï¼Œåœ¨è¿™ä¸ªä¸–ç•Œä¸­ä½ å¯ä»¥é€šè¿‡æ„å¿µç»˜åˆ¶ç«‹ä½“å›¾å½¢ï¼Œç„¶åå†é€šè¿‡æ„å¿µè¡¥è¶³è¾…åŠ©çº¿ï¼Œå†åœ¨ç©ºæ°”ä¸­åˆ—å‡ºå…¬å¼æ±‚å¯¼å¾—å‡ºå€¼ï¼Œokï¼Œæ¸…ç©ºä¸–ç•Œå†å¼€å§‹ä¸‹ä¸€é¢˜ã€‚æ­¤æ—¶æˆ‘æ„Ÿè§‰ä¸åˆ°ä½ æˆ‘ä»–ä»¥åŠå¤–éƒ¨ä¸€åˆ‡ï¼Œå¤§è„‘å°±åƒä¸€å°é«˜é€Ÿè¿è½¬çš„cpuä¸€æ ·ï¼Œå¯¼å…¥é¢˜åå¿«é€Ÿé¢„è®¾å¥½çš„é€»è¾‘å¯¹æ•°æ®è¿›è¡ŒåŠ å·¥å¤„ç†ç„¶åè¾“å…¥ï¼Œå¦‚æœå¤„ç†ä¸æ¥å°±æŸ¥é˜…å¤–éƒ¨å­˜å‚¨(ä¹¦ç±)è¿›è¡Œåˆ†æå¹¶è‡ªæˆ‘å®Œå–„ã€‚ç­‰ååº”è¿‡æ¥å·²ç»æ˜¯å¤©é»‘äº†ï¼Œè™½ç„¶è§‰å¾—æ—¶é—´è¿‡å¾—å¾ˆå¿«ï¼Œä½†åŒæ—¶ä¹Ÿè§‰å¾—è‡ªå·±å¼„æ‡‚äº†ä¸å°‘ä¸œè¥¿ã€‚\nåœ¨å·¥ä½œä¸­é‡åˆ°ä¸€äº›éš¾é¢˜æ—¶ï¼Œæˆ‘ä¹Ÿå¸¸å¸¸ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œæ‰¾ä¸ªå®‰é™çš„ä¼šè®®å®¤æˆ–è€…å›å®¶è·¯ä¸Šï¼Œè¿›å…¥è¿™ä¸ªè‡ªæˆ‘ä¸–ç•Œï¼Œæ¸…ç©ºä¸€åˆ‡æ‚å¿µï¼Œç„¶åè¾“å…¥å·²çŸ¥ä¿¡æ¯ï¼Œå¹¶ä¸æ–­åœ°å¿«é€Ÿæ¨å¯¼å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹å¼æ›¿æˆ‘è§£å†³äº†ä¸å°‘é—®é¢˜ã€‚å¦‚æœç¹æ‚çš„å·¥ä½œç¯å¢ƒä¸‹æ²¡æ³•å¾—å‡ºç­”æ¡ˆï¼Œå¯ä»¥è¯•è¯•è¿™ä¸ªæ–¹å¼ã€‚\nå½“ç„¶è¿™ä¸ªæ–¹å¼æ›´å¤šçš„å¯ä»¥åº”ç”¨åœ¨å­¦ä¹ ä¸Šï¼Œå°½é‡é¿å…è¿‡å¤šçš„å¹²æ‰°ç‰©ã€‚å¯ä»¥è€ƒè™‘å»å›¾ä¹¦é¦†æˆ–è€…ä¸€äº›è‡ªä¹ å®¤æ²‰æµ¸å¼çš„å­¦ä¹ ï¼Œå½“ä½ è¿›å…¥è¿™ä¸ªçŠ¶æ€æ—¶å­¦ä¹ çš„é€Ÿåº¦å’Œæ·±åº¦å¾€å¾€ä¼šè¿œè¶…å¹³æ—¶çš„çŠ¶æ€ã€‚\nè¯åˆè¯´å›æ¥ï¼Œä½ è¯´ä¸ºå•¥å¤æ—¶å€™æˆ–è€…æ­¦ä¾ å°è¯´é‡ŒåŠ¨ä¸åŠ¨å°±å»å±±æ´é‡Œä¿®ç‚¼ï¼Œè¦æˆ‘è¯´å¾ˆå¤§ç¨‹åº¦ä¸Šå°±æ˜¯è¦è¿›å…¥å¿ƒæµçŠ¶æ€æ¥è¾¾åˆ°é«˜æ•ˆçš„ç»“æœã€‚ç‹å®ˆä»åœ¨é¾™åœºæ‚Ÿé“æˆ‘ç›¸ä¿¡ä¹Ÿæ˜¯åœ¨å¿ƒæµçš„åŸºç¡€ä¸Šï¼Œä¹Ÿè®¸ä»–æ‰€è¿›å…¥çš„é‚£ä¸ªä¸–ç•ŒçœŸçš„æœ‰è€å­ã€å­”å¤«å­ã€æœ±ç†¹ç­‰ç­‰è·Ÿä»–èšåœ¨ä¸€å—æ¢è®¨ä¸–ç•Œçš„å¥¥ç§˜ã€‚ä¸è¿‡è¿™äº›å°±æ‰¯è¿œäº†ï¼Œä½†å¯¹äºå’±ä»¬æ™®é€šäººæ¥è¯´ï¼Œåˆç†åˆ©ç”¨å¿ƒæµä¸€å®šæ˜¯å­¦ä¹ è·¯ä¸Šçš„ä¸€å¤§æ€å™¨ã€‚\næ³¨æ„äº‹é¡¹ åˆ‡è®°é™·å…¥è‡ªæˆ‘æ»¡è¶³çš„å­¦ä¹ ï¼Œå¦‚æœä½ é‡è¯»ä¹¦è½»æŠ€èƒ½ã€é‡è¾“å…¥è½»è¾“å‡ºçš„è¯å¾ˆæœ‰å¯èƒ½ä½ çš„å­¦ä¹ æ˜¯ä¸è¢«è¿™ä¸ªä¸–ç•Œè®¤å¯å¹¶æ— æ³•è·å¾—å¯¹åº”çš„â€œé…¬åŠ³â€ åˆ‡è®°ä¸è¦é—­é—¨é€ è½¦ï¼Œå¾ˆæœ‰å¯èƒ½ä½ é—·å¤´åšäº†å‡ å¹´çš„ä¸œè¥¿å†ä¸šå†…å·²ç»æœ‰äº†å¾ˆå¥½çš„äº§å“æˆ–è€…è¯´æ–¹å‘æœ‰å¯èƒ½æ˜¯å¤•é˜³æ–¹å‘ï¼Œç›¸ä¿¡æˆ‘è¿™ä¸å€¼å¾—ï¼Œä½ çš„çƒ­è¡€å€¼å¾—æŒ¥æ´’åœ¨äºä½ è€Œè¨€æ›´æœ‰ä»·å€¼çš„ä¸œè¥¿å¹¶ä¸”ä½ çš„åŠªåŠ›ç†åº”è·å¾—æ›´å¤šçš„å›æŠ¥ã€‚å¯ä»¥è¯•è¯•åŠ ä¸€äº›æŠ€æœ¯äº¤æµç¾¤ã€æ‹¥æŠ±å¼€æºç¤¾åŒºã€ä»¥åŠçœ‹ä¸€äº›é«˜è´¨é‡çš„æŠ€æœ¯ç½‘ç«™å¦‚ï¼šmedium.comã€InfoQç­‰ï¼Œä¸”å°½é‡ç”¨googleæ¥è¿›è¡ŒçŸ¥è¯†çš„æ¢ç´¢ åˆ‡è®°å­¦ä¸œè¥¿æµ…å°è¾„æ­¢ï¼Œå­¦ä»»ä½•ä¸œè¥¿éƒ½ä¸è¦ä»…ä»…åœç•™åœ¨çš®æ¯›ï¼Œé‚£æ ·åªä¼šæµªè´¹ä½ çš„å¤§å¥½æ—¶å…‰ä»¥åŠæ¶ˆç£¨ä½ çš„æŠ€æœ¯çƒ­æƒ…ã€‚å­¦ä»»ä½•ä¸œè¥¿éƒ½åˆ† é“æœ¯å™¨ä¸‰ä¸ªå±‚æ¬¡ï¼Œå¯¹äºä½ çƒ­çˆ±çš„ä¸œè¥¿ç†åº”ä¸æ–­æ‰“ç£¨ï¼Œä¸æ–­åœ°æ¢ç´¢ä¸‹ä¸€ä¸ªå±‚æ¬¡ã€‚è¦æ—¶ä¸æ—¶å°†çµé­‚è·³å‡ºè‚‰èº«ï¼Œä¿¯è§†å½“å‰çš„è¿™ä¸ªäººæ€ç»´æ‰€å¤„çš„ç¯å¢ƒæ˜¯é‚£ä¸ªçº§åˆ«ï¼Œæ˜¯å¦è¿‡äºæ­»æ‰£ç»†èŠ‚è€Œå¿½ç•¥åŸç†ç­‰ã€‚ç›¸ä¿¡ä½ è·Ÿæˆ‘ä¸€æ ·ï¼Œå¯¹äºå¤§éƒ¨åˆ†ç²—ç³™çœ‹çš„ä¸œè¥¿éƒ½å¿˜å¾—å·®ä¸å¤šäº†ï¼Œä½†ä½ ä¸€å®šæ¸…æ™°å¾—è®°å¾—ï¼Œåœ¨ä½ è‹¦æ€å†¥æƒ³åˆ†æçš„é‚£ä¸ªbugçš„æ ¹å› æ˜¯ä»€ä¹ˆï¼Œåœ¨ä½ æŒ‘ç¯å¤œè¯»æ‰€æ¢ç´¢æŸä¸ªæŠ€æœ¯çš„åŸç†æ˜¯ä»€ä¹ˆï¼Œè¿™äº›å“ªæ€•åˆ°äº†é€€ä¼‘éƒ½ä¼šæ¸…æ¥šçš„è®°å¾—ã€‚å› ä¸ºè¿™æ˜¯ä½ åœ¨è„‘æµ·é‡Œåå¤æ¨æ•²è¿‡çš„ä¸œè¥¿ï¼Œè¿™äº›ä¸œè¥¿æ‰æ˜¯çœŸæ­£å±äºä½ çš„ã€‚è€Œå¤–é¢ç†™ç†™æ”˜æ”˜çš„é‚£äº›æ‰€è°“çœ‹äº†å¾ˆå¤šçš„çŸ¥è¯†å…¶å®å¹¶ä¸å±äºä½ ï¼Œå®ƒä»¬ä¸ä½ è€Œè¨€åªæ˜¯åŒ†åŒ†èµ¶è·¯æ—¶çš„ä¸€æŠ¹æ™¯è‰²ï¼Œå¹¶ä¸æ˜¯ä½ å¿ƒä¸­çš„ä¸œè¥¿ã€‚å› æ­¤å­¦ä¹ åŠ¡å¿…è¦æœ‰æ·±åº¦ åˆ‡å‹¿æ‹–å»¶ï¼Œå®Œç¾ä¸»ä¹‰æ˜¯æˆäº‹çš„å¤©æ•Œã€‚åƒåšä¸»ä¹‹å‰æ¯ä»¶äº‹éƒ½æƒ³åšåˆ°æè‡´ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½æƒ³å½»åº•å¼€å‘å¥½å†ä¸Šçº¿ï¼Œæ¯ä¸ªä¼˜åŒ–éƒ½æƒ³ä¼˜åŒ–åˆ°æè‡´å†ä¸Šçº¿ç­‰ï¼Œè¿™äº›åœ¨èŒåœºä¸Šéƒ½æ˜¯è‡´å‘½çš„ï¼Œè¦å­¦ä¼šæ‹¥æŠ±ç‘•ç–µã€‚è¦çŸ¥é“å¯¹äºå…¬å¸ä»€ä¹ˆæœ€é‡è¦ï¼ŒåŠŸèƒ½å¯å¦è¿­ä»£å‘å¸ƒï¼Œå…ˆä¸Šçº¿ç”¨æˆ·æ€¥è¿«éœ€è¦çš„é‚£éƒ¨åˆ†å¼€æ”¾å‡ºå»ï¼Œåœ¨æ…¢æ…¢å¼€å‘å‰©ä¸‹çš„ï¼Ÿä¼˜åŒ–æ˜¯å¦å¯ä»¥ä¼˜åŒ–æå‡æœ€æ˜¾è‘—çš„é‚£éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„åœ¨æ…¢æ…¢æï¼Ÿä½ å­¦ä¹ å¯ä»¥æ²¡æœ‰è¾“å‡ºæˆ–è€…æ™šç‚¹è¾“å‡ºï¼Œä½†æ˜¯å…¬å¸ä¸è¡Œï¼Œå½’æ ¹ç»“åº•å…¬å¸æ˜¯ä¸ªè¥åˆ©ç»„ç»‡ï¼Œæ˜¯ä»¥ç»“æœä¸ºå¯¼å‘çš„ã€‚æƒ³èµ·å¤§æ°”å¸å›½å´›èµ·ä¸­å¬´é©·å¯¹å¬´åè¯´çš„ â€œä½•ä¸ºæˆ˜ä¹‹æœ¬ï¼Ÿæ›°ï¼Œä¸ºå›½å–åˆ©ç›Šâ€ï¼›é‚£ä¹ˆä½•ä¸º å·¥ä½œä¹‹æœ¬ï¼Ÿæ›°ï¼Œä¸ºå…¬å¸å–åˆ©ã€‚å³ä¾¿ä½ çš„è®¾è®¡ã€ä»£ç ä¸å®Œç¾ï¼Œåªè¦èƒ½è§£å†³å…¬å¸çš„é—®é¢˜é‚£ä¹ˆå°±å¯ä»¥å…ˆä¸Šçº¿ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–çš„äº‹å¯¹å…¬å¸æ¥è¯´è‡³å°‘æ²¡é‚£ä¹ˆç´§æ€¥é‡è¦ã€‚å…ˆè§£å†³é—®é¢˜ï¼Œå…ˆæˆäº‹æ‰æ˜¯å¤´ç­‰å¤§äº‹ã€‚ å¯¹äºæœªæ¥æˆ‘æƒ³è¯´çš„ å¯¹äºæœªæ¥ï¼Œæˆ‘æƒ³è¯´æŒç»­ä¿æŒçƒ­çˆ±ï¼Œä¸å¿˜åˆå¿ƒï¼Œå°±åƒäºŒä¸‰å¹´çº§æ—¶å€™æ‹¿åˆ°è¯¾æœ¬é‚£èˆ¬çƒ­æƒ…å»å­¦ä¹ æ–°çš„çŸ¥è¯†ã€‚åœ¨è¿™é‡Œå®‰åˆ©ä¸‹æ­¤ä¸“è®¿ï¼Œæ¯å½“æˆ‘å¶å°”è¿·èŒ«æ—¶éƒ½ä¼šç¿»æ¥çœ‹ï¼Œæ—¶åˆ»æé†’è‡ªå·±ï¼Œåªè¦è¿™æ˜¯ä½ çƒ­çˆ±çš„ä¸œè¥¿å°±å»åšï¼Œå½“åšä¸€è¾ˆå­çš„äº‹æƒ…é‚£æ ·å»åš ä¸“è®¿â€œMySQL ä¹‹çˆ¶â€ï¼šæˆ‘æ›¾åˆ›é€  MySQLï¼Œä¹Ÿå°†é¢ è¦† MySQL ã€‚è‡³äºè·¯æ€ä¹ˆèµ°ç»§ç»­å‚è€ƒé™ˆçš“è€å¸ˆçš„ å¦‚ä½•è¶…è¿‡å¤§å¤šæ•°äºº ä»¥åŠæŠ€æœ¯äººå‘˜çš„å‘å±•ä¹‹è·¯ã€‚\næ€»ç»“ çœ‹å®Œçš„è¯»è€…ä¼šå‘ç°ï¼Œåšä¸»é€šç¯‡æ²¡æœ‰ç»™ä»»ä½•ä¸œè¥¿å®šä¹‰å¯¹é”™ã€‚åº”è¯•æ•™è‚²ã€åŠŸåˆ©å¿ƒå¼ºã€æ¯•ä¸šäº†èµšåˆ°é’±ä¸å­¦ä¹ ã€æŠ•æœºå–å·§èµ°æ·å¾„ã€åªè¯»ä¹¦ä¸è½¬åŒ–ä¸ºæŠ€èƒ½ã€ä¸çœ‹å®Œè¿™ç¯‡åšå®¢æˆ–è€…å¦å®šè¿™ç¯‡åšå®¢ä¸­æ‰€æœ‰çš„è§‚ç‚¹ï¼Œå¯èƒ½éƒ½æ˜¯â€œå¯¹â€çš„ã€‚ä½†æ‰€è°“çš„å¯¹é”™çœŸçš„é‡è¦å—ï¼Ÿäººç”Ÿæ˜¯ä¸€åœºæ±‚ä»å¾—ä»çš„è·¯ç¨‹ï¼Œä½ è¿½æ±‚çš„æ˜¯ä»€ä¹ˆå¹¶ä¸”æœ€ç»ˆå¾—åˆ°ç›¸ä¿¡ä½ çš„å†…å¿ƒä¸€å®šæ˜¯å¯Œè¶³çš„(å‰ææ˜¯ä½ ä»¥ä¸ºä½ è¦çš„çœŸçš„æ˜¯ä½ å†…å¿ƒçœŸæ­£çš„è¿½æ±‚)ã€‚æœ‰äººè¿½æ±‚é‡‘é’±ã€æœ‰äººè¿½æ±‚åæœ›ã€ä¹Ÿæœ‰äººå¿ƒæ€€å¤©ä¸‹ç­‰ç­‰éƒ½æ²¡é”™ï¼Œå†™è¿™ç¯‡åšå®¢åªæ˜¯æƒ³ç»™èµ¶è·¯çš„ä½ æˆ‘æ•´ç†ä¸€ç¯‡â€œç« æ³•â€ã€‚è¿™ä¸ªä¸–ç•Œæ˜¯ç¬¦åˆä¸€å®šè§„å¾‹çš„ï¼Œä½ æˆ‘ç½®èº«å…¶ä¸­å²‚èƒ½å¤–ä¹ï¼Ÿå› æ­¤ä¸€å®šæ˜¯æœ‰æŸä¸ªå­è§„å¾‹ï¼Œåœ¨ç¬¦åˆå®ƒæ—¶èƒ½æ”¾å¤§ä½ åŠªåŠ›çš„æ”¶ç›Šï¼Œè¿™é‡Œæ‰€è¯´çš„â€œç« æ³•â€å°±æ˜¯è¿™ä¸ªå­è§„å¾‹ã€‚åœ¨â€œç« æ³•â€è¿™å—å…¶å®å·²ç»æœ‰å¾ˆå¤šä¼˜ç§€çš„èµ„æ–™äº†ï¼Œåšä¸»å†™å¾—ç®—ä¸ä¸Šå¥½ï¼Œä½†å³ä¾¿å¦‚æ­¤åšä¸»è¿˜æ˜¯è¦å†™ï¼Œå€Ÿç”¨ä¸€å¥è¯—æ¥è¡¨è¾¾æ‰€æƒ³ï¼Œâ€œä»–å¼ºä»»ä»–å¼ºï¼Œæ¸…é£æ‹‚å±±å²—â€ã€‚æœ€åï¼Œç¥ä½ æˆ‘åœ¨äººç”Ÿçš„æœ€ç»ˆé˜¶æ®µï¼Œéƒ½èƒ½ä¸ç•™é—æ†¾ã€‚çˆ±ä½ æ‰€çˆ±ï¼Œè¡Œä½ æ‰€è¡Œï¼Œå¬ä»ä½ å¿ƒï¼Œæ— é—®è¥¿ä¸œï¼\nå‚è€ƒåšå®¢/ä¹¦ç± ä¹¦é­”çš„å­¦ä¹ æ–¹æ³•-1:è¯»ä¹¦çš„é£è½®\nåˆ«è®©è‡ªå·±â€œå¢™â€äº†è‡ªå·±\nç¨‹åºå‘˜å¦‚ä½•æŠŠæ§è‡ªå·±çš„èŒä¸š\nå¦‚ä½•è¶…è¿‡å¤§å¤šæ•°äºº\næŠ€æœ¯äººå‘˜çš„å‘å±•ä¹‹è·¯\nä¸“è®¿â€œMySQL ä¹‹çˆ¶â€ï¼šæˆ‘æ›¾åˆ›é€  MySQLï¼Œä¹Ÿå°†é¢ è¦† MySQL\nã€Šè®¤çŸ¥è§‰é†’ã€‹\nã€Šè®¤çŸ¥é©±åŠ¨ã€‹\nã€Šå†¯å”æˆäº‹å¿ƒæ³•ã€‹\nã€Šæ›¾å›½è—©å®¶ä¹¦ã€‹\nã€Šè·ƒè¿: æˆä¸ºé«˜æ‰‹çš„æŠ€æœ¯ã€‹\n","date":"2024-01-05T15:09:13+08:00","image":"https://sherlock-lin.github.io/p/%E5%AD%A6%E4%B9%A0%E5%BD%95/the-creative-exchange-d2zvqp3fpro-unsplash_hu5876398126655421130.jpg","permalink":"https://sherlock-lin.github.io/p/%E5%AD%A6%E4%B9%A0%E5%BD%95/","title":"å­¦ä¹ å½•"},{"content":"å¼•è¨€å°æ•…äº‹ å¼ ä¸‰åœ¨ä¸€å®¶å°å‹äº’è”ç½‘å…¬å¸ä¸Šç­ï¼Œç”±äºå…¬å¸å®è¡Œçš„996ï¼Œå› æ­¤ç»å¸¸æœ‰åŒäº‹â€œä¸è¾è€Œåˆ«â€ï¼Œä¸ºäº†å·¥ä½œçš„æ­£å¸¸æ¨è¿›ï¼Œå›¢é˜Ÿå†…è¾¾æˆäº†æŸç§é»˜å¥‘ï¼Œè¿™ç§é»˜å¥‘å°±æ˜¯é€šè¿‡æŸä¸ªè§„åˆ™æ¥é€‰å‡ºä¸€ä¸ªåŒäº‹ï¼Œè¿™ä¸ªåŒäº‹é™¤äº†å·¥ä½œä¹‹ä½™è¿˜æœ‰é¢å¤–çœ‹çœ‹æ¯å¤©æ˜¯å¦æœ‰åŒäº‹â€œä¸è¾è€Œåˆ«â€ï¼Œå½“å‘ç°æœ‰åŒäº‹æå››ç¦»èŒæ—¶ï¼Œå°±ä¼šå»æŠŠæå››è´Ÿè´£çš„å·¥ä½œçš„å†…å®¹è¿›è¡Œæ‹†åˆ†ç»™å…¶ä»–çš„åŒäº‹è¿›è¡Œå¤„ç†ã€‚æ•´ä¸ªè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹å›¾\nç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°è¿™ä¸ªå…¬å¸é€šè¿‡ä¸€ä¸ªç­¾åˆ°æœ¬å’Œå·¥ä½œè¿›åº¦è¡¨æ¥å®Œæˆæ•´ä¸ªæµç¨‹ï¼Œæ¯ä¸ªåŒäº‹ä¸Šç­æ—¶éƒ½è¦åœ¨ç­¾åˆ°æœ¬ä¸Šè¿›è¡Œç­¾åˆ°ï¼Œæ¯å¤©ä¸‹ç­å‰è¦åœ¨å·¥ä½œè¿›åº¦è¡¨ä¸ŠåŒæ­¥ä»Šå¤©çš„å·¥ä½œè¿›å±•ï¼›ä¾‹å¦‚ä»Šå¤©æå››â€œä¸è¾è€Œåˆ«â€æºœäº†ï¼Œå¼ ä¸‰åœ¨ç­¾åˆ°æœ¬ä¸Šçœ‹åˆ°æå››æ²¡æœ‰ç­¾åˆ°è®°å½•ï¼Œå°±åˆ¤å®šè¿™å®¶ä¼™ä¸å¹²äº†åŒæ—¶åœ¨å·¥ä½œè¿›åº¦è¡¨ä¸­æŠŠæå››çš„ä»»åŠ¡è¿›è¡Œæ‹†åˆ†ç»™å¤§ç‹—å’ŒäºŒç‹—æ¥åš\u0026hellip;\né€šè¿‡ä¸Šé¢çš„æ•…äº‹ä¼šå‘ç°æœ‰å‡ ä¸ªé—®é¢˜\nå¼ ä¸‰æ˜¯é€šè¿‡ä»€ä¹ˆè§„åˆ™è¢«é€‰æˆâ€œç›‘ç£è€…â€çš„ï¼Ÿ å¦‚æœå¼ ä¸‰ä¹Ÿä¸è¾è€Œåˆ«å‘¢ï¼Ÿ ä¸ºå•¥è¦é€šè¿‡ç­¾åˆ°æœ¬çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯å¼ ä¸‰ç›´æ¥å»æŒ¨ä¸ªæŒ¨ä¸ªçœ‹ï¼Ÿ \u0026hellip;. å’±ä»¬å¯ä»¥å¸¦ç€è¿™äº›ç§ç§å¿ƒé‡Œçš„ç–‘æƒ‘çœ‹ä¸‹é¢çš„æ–‡ç« ï¼Œè¿™ä¸ªæ•…äº‹å…¶å®æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ç»„ä»¶çš„é›å½¢ï¼Œåˆšåˆšæ‰€è®¨è®ºçš„é‚£äº›é—®é¢˜ä¹Ÿæ˜¯è¿™äº›ç»„ä»¶æ‰€ä¼šé‡åˆ°çš„ä¸”å¤§éƒ¨åˆ†éƒ½æ˜¯æœ‰è§£æ³•çš„ï¼Œæ‰€ä»¥å’±ä»¬æ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹bookkeeperè¿™ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ç»„ä»¶æ˜¯å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜çš„\nbookkeeperåŸºç¡€ â€œç¡¬ä»¶æ— æ³•ä¿è¯ä¸æ•…éšœâ€ï¼Œåœ¨è¿™ä¸ªå¤§å‰æä¸‹ï¼Œæ‰€æœ‰è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šçš„å­˜å‚¨ç»„ä»¶éƒ½ä¸€å®šä¼šåšä¸€ä»¶å¾ˆé‡è¦çš„äº‹æƒ…ï¼Œè¿™ä»¶äº‹å°±æ˜¯æ•°æ®æ¢å¤ï¼Œè¦ä¹ˆæ˜¯åœ¨ç»„ä»¶å†…éƒ¨æ¥åšï¼Œè¦ä¹ˆæ˜¯åœ¨ç»„ä»¶å¤–éƒ¨æ¥åšã€‚\nbkæ˜¯ä¸€ä¸ªå…·æœ‰å®¹é”™çš„åˆ†å¸ƒå¼å­˜å‚¨ç»„ä»¶ï¼ŒåŒä¸€ä»½æ•°æ®ä¼šæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œåˆ†åˆ«å­˜åœ¨å¤šä¸ªbookieä¸­æ¥æä¾›å®¹é”™ä¿è¯ï¼Œé‚£ä¹ˆå½“ä¸€å°bookieä¸å¯ç”¨æ—¶ï¼Œå…¶ä¸Šé¢ä¿å­˜çš„æ•°æ®éƒ½å°‘äº†ä¸€ä¸ªå‰¯æœ¬ï¼Œå¦‚æœä¸è¿›è¡Œæ•°æ®æ¢å¤/å¤åˆ¶çš„è¯å†æœ‰å…¶ä»–çš„bookieä¸å¯ç”¨å°±å¾ˆå®¹æ˜“é€ æˆæ•°æ®çš„ä¸¢å¤±ã€‚å› æ­¤bkè‡ªèº«å†…éƒ¨æä¾›äº†æ•°æ®æ¢å¤çš„æœºåˆ¶ï¼Œä»Šå¤©é€šç¯‡å¤§è®ºéƒ½æ˜¯å›´ç»•bkçš„è¿™ä¸ªæœºåˆ¶è¿›è¡Œå±•å¼€çš„\næ•°æ®æ¢å¤ä¸€èˆ¬åˆ†ä¸ºæ‰‹åŠ¨å’Œè‡ªåŠ¨ï¼ŒbkåŒæ—¶æ”¯æŒè¿™ä¸¤ç§æ–¹å¼ï¼Œæ¥ä¸‹æ¥å°±çœ‹çœ‹å…·ä½“æ€ä¹ˆæ“ä½œçš„\næ‰‹åŠ¨æ¢å¤\n1 2 bin/bookkeeper shell recover 192.168.1.10:3181 æŒ‡å®šbookieæœºå™¨æ¥æ¢å¤ bin/bookkeeper shell recover 192.168.1.10:3181 --ledger ledgerID æŒ‡å®šbookieæœºå™¨ä¸Šçš„æŸä¸ªledgerIdè¿›è¡Œæ¢å¤ åœ¨æ‰§è¡Œæ‰‹åŠ¨æ¢å¤æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹å››ä¸ªæ­¥éª¤\nå®¢æˆ·ç«¯ä»zookeeperè¯»å–Ledgerä¿¡æ¯ æ ¹æ®Ledgerä¿¡æ¯ç¡®å®šéœ€è¦åšæ•°æ®å¤åˆ¶çš„Ledger(æ ¹æ®Ledgerä¸­å­˜æœ‰è¢«å“ªäº›bookieå­˜å‚¨çš„å…ƒä¿¡æ¯æ¥ç¡®å®š) åœ¨å®¢æˆ·ç«¯å¯åŠ¨ä¸€ä¸ªåšæ•°æ®æ¢å¤çš„è¿›ç¨‹ï¼Œé’ˆå¯¹éœ€è¦åšæ•°æ®å¤åˆ¶çš„Ledgerè¿›è¡Œæ•°æ®æ¢å¤ ä¸€æ—¦æ‰€æœ‰Ledgerè¢«æ ‡è®°ä¸ºå…¨å‰¯æœ¬äº†ï¼Œåˆ™æ¢å¤åŠ¨ä½œå®Œæˆ è‡ªåŠ¨æ¢å¤\n1 2 3 bin/bookkeeper autorecovery bookie é›†ç¾¤å¼€å¯è‡ªåŠ¨æ¢å¤æœºåˆ¶ bin/bookkeeper shell autorecovery -disable å…³é—­è‡ªåŠ¨æ¢å¤æœºåˆ¶ bin/bookkeeper shell autorecovery -enable å…³é—­æ¢å¤åå†é‡æ–°å¼€å¯ é™¤äº†é€šè¿‡æŒ‡ä»¤çš„æ–¹å¼å¯åŠ¨ï¼Œbkè¿˜æ”¯æŒé…ç½®çš„æ–¹å¼ï¼Œåªéœ€è¦åœ¨bookieèŠ‚ç‚¹é…ç½®autoRecoveryDaemonEnabledä¸ºfalseï¼Œè¿™ä¸ªbookieèŠ‚ç‚¹åœ¨å¯åŠ¨çš„æ—¶å€™ä¹ŸåŒæ ·ä¼šå¯åŠ¨autorecoveryæœåŠ¡\nautorecoveryæœºåˆ¶ ä¸Šä¸€ç« èŠ‚è®²äº†æ€ä¹ˆä½¿ç”¨ï¼Œæœ¬ç« èŠ‚ä¸»è¦è®²æ˜autorecoveryè¿™ä¸ªæœºåˆ¶\nè‡ªåŠ¨æ¢å¤æœºåˆ¶ä¸­æœ‰ä¸¤ä¸ªè§’è‰²Auditorå’Œreplication workerï¼Œåœ¨å¯åŠ¨è‡ªåŠ¨æ¢å¤æœºåˆ¶åï¼Œä¼šåœ¨æ¯ä¸ªbookieå®ä¾‹ä¸­å¯åŠ¨è¿™ä¸¤ä¸ªè§’è‰²\nAuditor\nbké›†ç¾¤ä¸­çš„Auditorä»¬ä¼šé€šè¿‡zookeeperé€‰ä¸¾äº§ç”Ÿä¸€ä½leaderï¼Œè¿™ä¸ªleaderè´Ÿè´£ç›‘å¬ zookeeper /ledgers/available èŠ‚ç‚¹å˜åŒ–æƒ…å†µæ¥åˆ¤å®šæ˜¯å¦è¦åšæ•°æ®æ¢å¤åŠ¨ä½œï¼Œå› ä¸ºæ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨éƒ½ä¼šæ³¨å†Œåœ¨ä¸Šé¢ï¼Œå¦‚æœæœ‰æœåŠ¡ä¸å¯ç”¨ç”±äºzookeeperçš„ä¸´æ—¶ç›®å½•æœºåˆ¶ï¼Œä¼šè‡ªåŠ¨åˆ é™¤åœ¨æ­¤ç›®å½•ä¸‹è‡ªå·±èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå› æ­¤leaderé€šè¿‡watchæœºåˆ¶å¯ä»¥è½»æ¾æ„ŸçŸ¥åˆ°æœ‰èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œå½“Auditor leaderæ„ŸçŸ¥åˆ°æœ‰èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œä¼šå°†æ­¤bookieæ‰€è´Ÿè´£çš„æ‰€æœ‰LedgeråŠ åœ¨zookeeper /ledgers/underreplicated è·¯å¾„ä¸‹ï¼Œé€šè¿‡è¿™ç§æ–¹å¼é€šçŸ¥replication workeråšæ•°æ®æ¢å¤è¿‡ç¨‹\nreplication worker\næ¯ä¸ªreplication workeréƒ½ä¼šç›‘å¬ /ledgers/underreplicated åœ°å€ï¼Œåœ¨ç›‘å¬åˆ°æœ‰æ•°æ®æ¢å¤ä»»åŠ¡æ—¶ï¼Œä¼šåœ¨ /ledgers/underreplication/locksä¸‹æ·»åŠ é”ä»è€Œé¿å…å¹¶å‘é—®é¢˜ï¼›å¦‚æœåœ¨å¼€å§‹æ¢å¤å‰å‘ä¸‹å½“å‰Ledgerçš„Fragmentè¿˜å¤„äºå†™å…¥ä¸­çš„çŠ¶æ€ï¼Œreplication workerä¼šå…ˆå°è¯•ç­‰å¾…å®ƒå†™å®Œå†åšæ•°æ®æ¢å¤åŠ¨ä½œï¼Œä½†å¦‚æœç­‰äº†ä¸€æ®µæ—¶é—´è¿˜æ²¡å†™å®Œä¼šé€šè¿‡Fenceæœºåˆ¶å¤„ç†å†åšå¤åˆ¶ï¼ŒåŒæ—¶å¼€å¯ä¸€ä¸ªæ–°çš„Fragmentç»™å®¢æˆ·ç«¯åšæ•°æ®çš„ç»§ç»­å†™å…¥\nå¯åŠ¨å·¥ä½œæµç¨‹\nå‚ç…§ä¸Šå›¾ï¼Œåœ¨æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œbin/bookkeeper autorecovery bookieåä¼šå‘ç”Ÿä»¥ä¸‹æ­¥éª¤\né€šè¿‡exec shellæŒ‡ä»¤è°ƒç”¨æ“ä½œç³»ç»Ÿæ‹‰èµ·AutoRecoveryMain è¿™ä¸ªJavaè¿›ç¨‹ AutoRecoveryMainè¿›ç¨‹å¯åŠ¨æ—¶ä¼šåŒæ—¶å¯åŠ¨Auditorçº¿ç¨‹å’ŒReplicationWorkerçº¿ç¨‹ï¼Œç”±äºç¯å¢ƒä¸­å¯èƒ½ä¼šå¯åŠ¨å¤šä¸ªAutoRecoveryMainè¿›ç¨‹æ¥åšHAé«˜å¯ç”¨ï¼Œå› æ­¤å¤šä¸ªAuditorçº¿ç¨‹ä¼šé€šè¿‡zookeeperé€‰ä¸¾æ¥äº§ç”Ÿä¸€ä¸ªAuditor Leader ç”±äºbookieé›†ç¾¤ç”¨zookeeperæ¥åšé›†ç¾¤æ„ŸçŸ¥ï¼Œå› æ­¤Auditor Leaderåªéœ€è¦é€šè¿‡watchç›‘å¬zookeeperä¸Š bookieæ‰€æ³¨å†Œçš„åœ°å€å°±èƒ½æ„ŸçŸ¥åˆ°æ˜¯å¦æœ‰bookieèŠ‚ç‚¹ä¸å¯ç”¨ï¼›å½“bookieèŠ‚ç‚¹ä¸å¯ç”¨æ—¶ä¸€èˆ¬å°±ä¸ä¼šä¸ŠæŠ¥å¿ƒè·³ç»™zookeeperï¼Œzookeeperå°±ä¼šå°†è¯¥èŠ‚ç‚¹åˆ›å»ºçš„ä¸´æ—¶ç›®å½•è¿›è¡Œåˆ é™¤å¹¶å‘ŠçŸ¥æ·»åŠ watchçš„Auditor Leader Auditor Leaderæ”¶åˆ°é€šçŸ¥åä¼šå»zookeeperæŸ¥è¯¢è¯¥ä¸å¯ç”¨bookieæ‰€è´Ÿè´£çš„Ledgeråˆ—è¡¨ï¼Œç†è®ºä¸Šè¿™äº›Ledgeréƒ½æ˜¯éœ€è¦åšæ•°æ®æ¢å¤çš„ï¼Œå› æ­¤ä¼šå°†å®ƒä»¬æ”¾åœ¨zookeeperçš„/ledgers/underreplicated ç›®å½•ä¸‹æ¥é€šçŸ¥ReplicationWorker ReplicationWorkeré€šè¿‡watchç›‘å¬åˆ°æ­¤ç›®å½•æœ‰éœ€è¦åšæ•°æ®æ¢å¤çš„Ledgeråï¼Œä¼šå…ˆåœ¨zkåŠ é”å†è¿›è¡Œæ•°æ®æ¢å¤é€»è¾‘ï¼›é€šè¿‡å°†Ledgeråˆ’åˆ†ä¸ºå¤šä¸ªFragmentæ¥è½®è®­è¿›è¡Œæ•°æ®æ¢å¤ï¼Œé€šè¿‡è¯»å–å…¶ä»–æ­£å¸¸bookieä¸Šè¯¥Ledgerçš„æ•°æ®å¹¶å†™åˆ°å…¶ä»–æ²¡æœ‰è¯¥æ•°æ®çš„bookieçš„èŠ‚ç‚¹ä¸Šä»è€Œä¿è¯æ¯ä»½æ•°æ®éƒ½æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œç›´åˆ°å°†/ledgers/underreplicated ä¸‹çš„æ‰€æœ‰Ledgerè¿›è¡Œå¤åˆ¶å®Œï¼Œæœ¬æ¬¡ autorecoveryå°±ç®—å®Œæˆäº†ã€‚è€ŒAuditorçº¿ç¨‹å’ŒReplicationWorkerçº¿ç¨‹ä¼šä¸åœçš„ç›‘å¬zookeeperç›´åˆ°ä¸‹ä¸€ä¸ªbookieèŠ‚ç‚¹ä¸å¯ç”¨ é€šè¿‡æ­¤æœºåˆ¶ç»™bookkeeperæé«˜äº†ç¨³å®šæ€§ä»¥åŠé«˜å¯ç”¨èƒ½åŠ›ï¼Œåœ¨æœ‰ä¸ªåˆ«èŠ‚ç‚¹æŒ‚æ‰çš„æ—¶å€™ä¾ç„¶èƒ½è‡ªåŠ¨åšåˆ°æ•°æ®å®Œå¤‡ä¸ä¸¢ï¼Œè¿™ç§è®¾è®¡æ˜¯ä¸€ä¸ªæˆç†Ÿçš„ç»„ä»¶è¯¥å…·å¤‡çš„èƒ½åŠ›\nautorecoveryå¯åŠ¨æºç  æºç ä¸»è¦åˆ† å¯åŠ¨æµç¨‹ä»¥åŠå·¥ä½œæµç¨‹è¿›è¡Œè®²è§£ï¼ŒåŒæ—¶åœ¨è¿™é‡Œç»™éœ€è¦é˜…è¯»çš„æœ‹å‹æä¾›ä¸€ä¸ªå¯èƒ½ä¼šç”¨ä¸Šçš„â€œè¯å…¸â€\n1 2 3 4 5 6 7 8 9 10 AutoRecoveryMainæ ¸å¿ƒç±», ä¸»è¦è´Ÿè´£å¯åŠ¨AutoRecoveryæœåŠ¡ AutoRecoveryServiceæ ¸å¿ƒç±»ï¼Œä¸»è¦è´Ÿè´£AutoRecoveryç›¸å…³çš„æœåŠ¡ LedgerManager å¯¹å¤–æä¾›ä¸€ä¸ªç®¡ç†ledgerçš„apiï¼Œå¯¹å†…è´Ÿè´£å¦‚ä½•å°†ledgerçš„å…ƒæ•°æ®å­˜å‚¨åœ¨kvå­˜å‚¨ä¸Šã€‚æä¾›å¢åˆ ã€è¯»å†™ã€æ³¨å†Œ/æ³¨é”€å…­ä¸ªæ ¸å¿ƒæ¥å£ AbstractZkLedgerManager æŠ½è±¡ç±» LedgerIdGeneratorï¼šåŸºäºzkå®ç°å…¨å±€å”¯ä¸€é€’å¢çš„ledgerId ZkLedgerUnderreplicationManagerï¼šç®¡ç†æœªå®Œæˆå¤åˆ¶çš„Ledger ZkLedgerAuditorManagerï¼šç®¡ç†Auditor ReplicationWorkerï¼šè´Ÿè´£ä»ZkLedgerUnderreplicationManagerä¸­è·å–æœªå®Œæˆå¤åˆ¶çš„Ledgerå¹¶è¿›è¡Œå¤åˆ¶ï¼Œæ¯éš”rwRereplicateBackoffMsè§¦å‘ä¸€æ¬¡ LedgerFragmentï¼šç»„æˆLedgerçš„å•å…ƒï¼Œä¹Ÿæ˜¯æ¢å¤å¤åˆ¶çš„å•å…ƒ EmbeddedServerï¼šå¯åŠ¨bkå®ä¾‹çš„èŠ‚ç‚¹ ä»ç°åœ¨å¼€å§‹è·Ÿè¸ªå¯åŠ¨çš„æºç ï¼Œåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ bin/bookkeeper autorecovery bookie åä¼šèµ°åˆ° bookkeeper/bin/bookkeeper è¿™ä¸ªè„šæœ¬ä¸‹é¢çš„è¿™è¡Œé€»è¾‘\n1 2 if [ ${COMMAND} == \u0026#34;autorecovery\u0026#34; ]; then exec \u0026#34;${JAVA}\u0026#34; ${OPTS} ${JMX_ARGS} org.apache.bookkeeper.replication.AutoRecoveryMain --conf ${BOOKIE_CONF} $@ é€»è¾‘éå¸¸æ¸…æ™°ï¼Œå…¶å®å°±æ˜¯é€šè¿‡shellå¯åŠ¨AutoRecovery è¿™æ ·ä¸€ä¸ªç‹¬ç«‹çš„Javaè¿›ç¨‹ï¼Œä¸“é—¨è´Ÿè´£åšæ•…éšœæ•°æ®æ¢å¤ã€‚JVMä¼šä»å¯åŠ¨ç±»çš„mainæ–¹æ³•è¿›è¡Œå¼•å¯¼æ‰§è¡Œï¼Œå› æ­¤å’±ä»¬æ¥ä¸‹æ¥ä»AutoRecoveryMainçš„mainæ–¹æ³•ä½œä¸ºå…¥å£æ¥çœ‹çœ‹åé¢ä¼šå‘ç”Ÿå“ªäº›äº‹æƒ…\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 public static void main(String[] args) { //è°ƒç”¨çœŸæ­£æ‰§è¡Œçš„æ–¹æ³•ï¼Œå¼€æºé¡¹ç›®ä¸­çœŸæ­£æ‰§è¡ŒæŸä¸ªæ“ä½œä¼šä»¥doå‰ç¼€æ¥è¿›è¡Œä¿®é¥° int retCode = doMain(args); .... } static int doMain(String[] args) { ServerConfiguration conf; try { //æ ¹æ®shellå¯åŠ¨å‘½ä»¤ä¸­æŒ‡å®šçš„é…ç½®åœ°å€åŠ è½½æˆé…ç½®å¯¹è±¡ conf = parseArgs(args); } catch (IllegalArgumentException iae) { .... } LifecycleComponent server; try { //æ„å»ºAutoRecoveryServerå¯¹è±¡ï¼Œæ¯”è¾ƒé‡è¦çš„æ–¹æ³• server = buildAutoRecoveryServer(new BookieConfiguration(conf)); } catch (Exception e) { .... } try { //å¯åŠ¨AutoRecoveryServerå¯¹è±¡ ComponentStarter.startComponent(server).get(); } catch (InterruptedException ie) { .... } return ExitCode.OK; } é€šè¿‡è¿™é‡Œå¯ä»¥å‘ç°AutoRecoveryMainçš„mainæ–¹æ³•åªæ˜¯åšä¸€ä¸ªå¼•å¯¼çš„åŠ¨ä½œï¼Œæœ€ç»ˆå¯åŠ¨çš„æ˜¯AutoRecoveryServerå¯¹è±¡ã€‚å› æ­¤è®©æˆ‘ä»¬æ·±å…¥çœ‹çœ‹è¿™ä¸ªæœåŠ¡çš„æ„é€ ä»¥åŠå¯åŠ¨çš„æµç¨‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public static LifecycleComponentStack buildAutoRecoveryServer(BookieConfiguration conf) throws Exception { LifecycleComponentStack.Builder serverBuilder = LifecycleComponentStack.newBuilder() .withName(\u0026#34;autorecovery-server\u0026#34;); // 1. åˆ›å»ºStatsProviderServiceå¯¹è±¡ï¼Œä¸»è¦ç”¨æ¥è®°å½•AutoRecoveryæœåŠ¡çš„å„é¡¹æŒ‡æ ‡çŠ¶æ€ StatsProviderService statsProviderService = new StatsProviderService(conf); .... // 2. é€šè¿‡æ„é€ å‡½æ•°çš„æ–¹å¼åˆ›å»ºAutoRecoveryServiceå¯¹è±¡ï¼Œè¿™æ˜¯æ ¸å¿ƒçš„ä»£ç  AutoRecoveryService autoRecoveryService = new AutoRecoveryService(conf, rootStatsLogger); .... // 3. åˆ›å»ºBKHttpServiceProviderå¯¹è±¡ï¼Œä¸»è¦ç”¨æ¥å¯¹å¤–æä¾›httpæœåŠ¡ï¼Œæ”¯æŒé€šè¿‡httpæ–¹å¼è¯»å–å†…éƒ¨çŠ¶æ€ä¿¡æ¯ç­‰ if (conf.getServerConf().isHttpServerEnabled()) { BKHttpServiceProvider provider = new BKHttpServiceProvider.Builder() .setAutoRecovery(autoRecoveryService.getAutoRecoveryServer()) .setServerConfiguration(conf.getServerConf()) .setStatsProvider(statsProviderService.getStatsProvider()).build(); HttpService httpService = new HttpService(provider, conf, rootStatsLogger); .... } return serverBuilder.build(); } å†çœ‹AutoRecoveryServiceçš„æ„é€ å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 public AutoRecoveryService(BookieConfiguration conf, StatsLogger statsLogger) throws Exception { super(NAME, conf, statsLogger); //é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºAutoRecoveryMainï¼ŒAutoRecoveryMainæ˜¯AutoRecoveryServiceçš„æˆå‘˜å˜é‡ //è¿›å…¥çœ‹çœ‹å®ƒçš„å®ç° this.main = new AutoRecoveryMain( conf.getServerConf(), statsLogger); } public AutoRecoveryMain(ServerConfiguration conf, StatsLogger statsLogger) throws IOException, InterruptedException, KeeperException, UnavailableException, CompatibilityException { .... //åˆ›å»ºAuditorElectorå¯¹è±¡ï¼Œè´Ÿè´£é€‰ä¸¾äº§ç”ŸAuditor Leader auditorElector = new AuditorElector( BookieImpl.getBookieId(conf).toString(), conf, bkc, statsLogger.scope(AUDITOR_SCOPE), false); //åˆ›å»ºReplicationWorkerå¯¹è±¡ï¼Œè´Ÿè´£åšæ•°æ®çš„æ‹·è´å·¥ä½œ replicationWorker = new ReplicationWorker( conf, bkc, false, statsLogger.scope(REPLICATION_WORKER_SCOPE)); deathWatcher = new AutoRecoveryDeathWatcher(this); } æœåŠ¡æ„é€ çš„é€»è¾‘å·®ä¸å¤šå°±è·Ÿåˆ°è¿™äº†ï¼Œæˆ‘ä»¬çŸ¥é“æœ€ç»ˆæ˜¯ä¸ºäº†åˆ›å»ºAuditorElectorå’ŒReplicationWorkerè¿™ä¸¤ä¸ªå¯¹è±¡å°±å¤Ÿäº†ã€‚æœåŠ¡å¯åŠ¨è¿™å—ä»ä¸Šé¢çš„ ComponentStarter.startComponent(server).get(); è¿›è¡Œè·Ÿè¸ª\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public static CompletableFuture\u0026lt;Void\u0026gt; startComponent(LifecycleComponent component) { .... //è°ƒç”¨startæ–¹æ³•ï¼Œè¿™é‡Œæ¶‰åŠä¸Šé‡‡ç”¨äº†æ¨¡ç‰ˆæ–¹æ³•è®¾è®¡æ¨¡å¼ä»¥åŠé—­åŒ…ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å°±æ˜¯è°ƒç”¨åˆ›å»ºçš„ //StatsProviderServiceã€\tAutoRecoveryServiceã€HttpServiceè¿™ä¸‰ä¸ªæœåŠ¡çš„doStartæ–¹æ³• component.start(); .... } protected void doStart() { //è¿˜æ˜¯è°ƒçš„AutoRecoveryMainæ–¹æ³•çš„startæ–¹æ³• this.main.start(); } public void start() { //å¯åŠ¨auditorElectoræœåŠ¡ auditorElector.start(); //å¯åŠ¨replicationWorkeræœåŠ¡ replicationWorker.start(); .... deathWatcher.start(); } ç»“åˆä¸Šé¢çš„å¯ä»¥å‘ç°AutoRecoveryçš„å¯åŠ¨æœ¬è´¨ä¸Šå°±æ˜¯å¯åŠ¨AuditorElectorå’ŒReplicationWorkerè¿™ä¸¤ä¸ªæœåŠ¡ï¼Œå› æ­¤æ¥ä¸‹æ¥å’±ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªæœåŠ¡çš„startè¿‡ç¨‹ï¼Œå…ˆæ¥çœ‹çœ‹AuditorElector\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 public Future\u0026lt;?\u0026gt; start() { running.set(true); //æäº¤é€‰ä¸¾ä»»åŠ¡ return submitElectionTask(); } Future\u0026lt;?\u0026gt; submitElectionTask() { Runnable r = new Runnable() { @Override public void run() { .... //åˆ›å»ºä¸€ä¸ªAuditorå¯¹è±¡å¹¶è¿›è¡Œå¯åŠ¨ auditor = new Auditor(bookieId, conf, bkc, false, statsLogger); auditor.start(); } }; try { //å¼‚æ­¥æ‰§è¡Œä»¥ä¸Šé€»è¾‘ return executor.submit(r); } catch (RejectedExecutionException e) { .... } } åœ¨è¿™é‡Œå…¶å®å°±æ˜¯å¯¹Auditorå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ä»¥åŠå¯åŠ¨ï¼Œå†è¿›ä¸€æ­¥è·Ÿè¸ª\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 public Auditor(final String bookieIdentifier, ServerConfiguration conf, BookKeeper bkc, boolean ownBkc, BookKeeperAdmin admin, boolean ownAdmin, StatsLogger statsLogger) throws UnavailableException { .... //è°ƒç”¨åˆå§‹åŒ–Auditorå¯¹è±¡é€»è¾‘ initialize(conf, bkc); .... } private void initialize(ServerConfiguration conf, BookKeeper bkc) throws UnavailableException { try { LedgerManagerFactory ledgerManagerFactory = bkc.getLedgerManagerFactory(); ledgerManager = ledgerManagerFactory.newLedgerManager(); this.bookieLedgerIndexer = new BookieLedgerIndexer(ledgerManager); this.ledgerUnderreplicationManager = ledgerManagerFactory .newLedgerUnderreplicationManager(); .... lostBookieRecoveryDelayBeforeChange = this.ledgerUnderreplicationManager.getLostBookieRecoveryDelay(); } catch (CompatibilityException ce) { .... } } çœ‹å®Œäº†åˆå§‹åŒ–é€»è¾‘ï¼Œå†ç»§ç»­çœ‹ä¸‹Auditorçš„å¯åŠ¨é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 public void start() { LOG.info(\u0026#34;I\u0026#39;m starting as Auditor Bookie. ID: {}\u0026#34;, bookieIdentifier); synchronized (this) { .... try { //1. ç›‘å¬bookieå˜æ›´äº‹ä»¶ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åœ¨zk /ledgers/available ç›®å½•ä¸‹å¢åŠ watchç›‘å¬èŠ‚ç‚¹çš„å˜åŠ¨ //è¿™é‡Œè¿˜ä¼šç›‘å¬ åªè¯»bookie èŠ‚ç‚¹çš„å˜åŠ¨ watchBookieChanges(); //ä»zkè·å–å¤„äºå¯ç”¨çš„bkèŠ‚ç‚¹åˆ—è¡¨ knownBookies = getAvailableBookies(); } catch (BKException bke) { .... } try { //1. åœ¨æ„ŸçŸ¥åˆ°æœ‰bookieèŠ‚ç‚¹ä¸å¯ç”¨æ—¶å›è°ƒLostBookieRecoveryDelayChangedCbè¿›è¡Œé€»è¾‘å¤„ç† this.ledgerUnderreplicationManager .notifyLostBookieRecoveryDelayChanged(new LostBookieRecoveryDelayChangedCb()); } catch (UnavailableException ue) { .... } try { //1. æ„ŸçŸ¥åˆ°æœ‰Ledgerçš„å‰¯æœ¬å°‘æ—¶è§¦å‘ï¼Œè·Ÿä¸Šé¢ä¸€æ ·ä¹Ÿæ˜¯é€šè¿‡å›è°ƒæ–¹å¼è¿›è¡Œå¤„ç† this.ledgerUnderreplicationManager.notifyUnderReplicationLedgerChanged( new UnderReplicatedLedgersChangedCb()); } catch (UnavailableException ue) { .... } scheduleBookieCheckTask(); //å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥Ledgerçš„çŠ¶æ€ scheduleCheckAllLedgersTask(); schedulePlacementPolicyCheckTask(); scheduleReplicasCheckTask(); } } è¿™äº›å°±æ˜¯Auditorå¯åŠ¨çš„é€»è¾‘ï¼Œæ¥ä¸‹æ¥å†çœ‹çœ‹ReplicationWorkerçš„å¯åŠ¨é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 public void start() { //workerThreadå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªBookieThreadå¯¹è±¡ this.workerThread.start(); } public void run() { workerRunning = true; while (workerRunning) { try { //æ ¸å¿ƒé€»è¾‘å°±æ˜¯å¾ªç¯è°ƒç”¨rereplicateæ–¹æ³• if (!rereplicate()) { LOG.warn(\u0026#34;failed while replicating fragments\u0026#34;); waitBackOffTime(rwRereplicateBackoffMs); } } catch (InterruptedException e) { .... } } LOG.info(\u0026#34;ReplicationWorker exited loop!\u0026#34;); } private boolean rereplicate() throws InterruptedException, BKException, UnavailableException { //è·å–éœ€è¦åšæ•°æ®æ¢å¤çš„Ledger long ledgerIdToReplicate = underreplicationManager .getLedgerToRereplicate(); Stopwatch stopwatch = Stopwatch.createStarted(); boolean success = false; try { //è¿›è¡Œæ•°æ®æ¢å¤ success = rereplicate(ledgerIdToReplicate); } finally { .... } return success; } autorecoveryå·¥ä½œæºç  è¿™å—ç”±äºé€»è¾‘ç›¸å¯¹è¾ƒå¤šï¼Œå› æ­¤é’ˆå¯¹autorecoveryå·¥ä½œæµç¨‹å•ç‹¬å¼€ä¸€ç« ã€‚ç»è¿‡ä¸Šé¢æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çŸ¥é“åœ¨ç»è¿‡å¯åŠ¨åéƒ½å‘ç”Ÿäº†å“ªäº›äº‹æƒ…ï¼Œæ¥ä¸‹æ¥å’±ä»¬çœ‹çœ‹autorecoveryçœŸæ­£å·¥ä½œçš„é€»è¾‘ã€‚åœ¨Auditor startçš„æ—¶å€™ï¼Œä¼šé€šè¿‡ç›‘å¬zookeeperæ¥æ„ŸçŸ¥æ•°æ®çš„åŠ¨æ€å˜åŒ–\n1 2 3 4 5 6 7 8 public void start() { //æ„ŸçŸ¥bookieèŠ‚ç‚¹ä¸‹çº¿ï¼Œå°†è¿™äº›bookieä¸Šç®¡ç†çš„Ledgeræ ‡è®°ä¸ºéœ€è¦å¤‡ä»½æ”¾åˆ°zookeeperä¸Š this.ledgerUnderreplicationManager .notifyLostBookieRecoveryDelayChanged(new LostBookieRecoveryDelayChangedCb()); //æ„ŸçŸ¥Ledgerå‰¯æœ¬å˜åŠ¨ï¼Œç»Ÿè®¡åˆ°æŒ‡æ ‡é‡Œ this.ledgerUnderreplicationManager.notifyUnderReplicationLedgerChanged( new UnderReplicatedLedgersChangedCb()); } ä¸Šè¿°ä¸¤ä¸ªå”¤é†’æ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡watchæ„ŸçŸ¥zookeeperäº‹ä»¶ï¼Œæ‰€ä»¥å’±ä»¬ä¸»è¦çœ‹å›è°ƒç±»é‡Œé¢çš„å¤„ç†é€»è¾‘ï¼Œå…ˆçœ‹ä¸‹LostBookieRecoveryDelayChangedCbç±»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 private class LostBookieRecoveryDelayChangedCb implements GenericCallback\u0026lt;Void\u0026gt; { @Override public void operationComplete(int rc, Void result) { .... Auditor.this.ledgerUnderreplicationManager .notifyLostBookieRecoveryDelayChanged(LostBookieRecoveryDelayChangedCb.this); .... //æäº¤äº‹ä»¶å˜åŠ¨å¤„ç†ä»»åŠ¡ï¼Œè¿›å»çœ‹çœ‹ Auditor.this.submitLostBookieRecoveryDelayChangedEvent(); } } synchronized Future\u0026lt;?\u0026gt; submitLostBookieRecoveryDelayChangedEvent() { return executor.submit(() -\u0026gt; { int lostBookieRecoveryDelay = -1; try { waitIfLedgerReplicationDisabled(); lostBookieRecoveryDelay = Auditor.this.ledgerUnderreplicationManager .getLostBookieRecoveryDelay(); .... //æ ¸å¿ƒé€»è¾‘,è¿›å»çœ‹çœ‹éƒ½åšäº†äº›ä»€ä¹ˆ auditorBookieCheckTask.startAudit(false); } else if (auditTask != null) { LOG.info(\u0026#34;lostBookieRecoveryDelay has been set to {}, so rescheduling AuditTask accordingly\u0026#34;, lostBookieRecoveryDelay); auditTask = executor.schedule(() -\u0026gt; { auditorBookieCheckTask.startAudit(false); auditTask = null; bookiesToBeAudited.clear(); }, lostBookieRecoveryDelay, TimeUnit.SECONDS); auditorStats.getNumBookieAuditsDelayed().inc(); } } catch (InterruptedException ie) { .... } finally { if (lostBookieRecoveryDelay != -1) { lostBookieRecoveryDelayBeforeChange = lostBookieRecoveryDelay; } } }); } void startAudit(boolean shutDownTask) { try { //çœ‹èµ·æ¥æ˜¯å¼€å§‹åšAuditorçš„ä¸»è¦ä»»åŠ¡äº†ï¼Œç»§ç»­å¾€ä¸‹ auditBookies(); shutDownTask = false; } catch (BKException bke) { .... } } void auditBookies() throws ReplicationException.BKAuditException, InterruptedException, BKException { .... List\u0026lt;String\u0026gt; availableBookies = getAvailableBookies(); // find lost bookies Set\u0026lt;String\u0026gt; knownBookies = ledgerDetails.keySet(); //é€šè¿‡ä¹‹å‰å†…å­˜ä¸­å­˜çš„bookieé›†åˆå‡å» zkå½“å‰bookieé›†åˆå³å¯å¾—å‡ºéƒ½æœ‰å“ªäº›bookieèŠ‚ç‚¹ä¸å¯ç”¨äº† Collection\u0026lt;String\u0026gt; lostBookies = CollectionUtils.subtract(knownBookies, availableBookies); .... //å¦‚æœæœ¬æ¬¡å˜åŠ¨æ¶‰åŠåˆ°bookieèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œåˆ™è°ƒç”¨handleLostBookiesAsyncæ–¹æ³•å¤„ç†ä¸å¯ç”¨çš„èŠ‚ç‚¹ if (lostBookies.size() \u0026gt; 0) { try { FutureUtils.result( handleLostBookiesAsync(lostBookies, ledgerDetails), ReplicationException.EXCEPTION_HANDLER); } catch (ReplicationException e) { .... } .... } .... } private CompletableFuture\u0026lt;?\u0026gt; handleLostBookiesAsync(Collection\u0026lt;String\u0026gt; lostBookies, Map\u0026lt;String, Set\u0026lt;Long\u0026gt;\u0026gt; ledgerDetails) { LOG.info(\u0026#34;Following are the failed bookies: {},\u0026#34; + \u0026#34; and searching its ledgers for re-replication\u0026#34;, lostBookies); return FutureUtils.processList( Lists.newArrayList(lostBookies), //çœ‹æ–¹æ³•åå¤§æ¦‚èƒ½çŒœå¾—å‡ºæ¥è®¡ç®—è¿™äº›bookieä¸Šçš„Ledgerï¼Œå¹¶é’ˆå¯¹è¿™äº›Ledgerè¿›è¡Œæ•°æ®æ¢å¤ //ç”±äºä¹‹å‰æœ‰å­˜èŠ‚ç‚¹è·ŸLedgerçš„æ˜ å°„å…³ç³»ï¼Œå› æ­¤ç›´æ¥é€šè¿‡ledgerDetailsæ˜ å°„è¡¨æ¥è·å–è¿™äº›ä¸å¯ç”¨èŠ‚ç‚¹æ‰€è´Ÿè´£çš„Ledger bookieIP -\u0026gt; publishSuspectedLedgersAsync( Lists.newArrayList(bookieIP), ledgerDetails.get(bookieIP)), null ); } protected CompletableFuture\u0026lt;?\u0026gt; publishSuspectedLedgersAsync(Collection\u0026lt;String\u0026gt; missingBookies, Set\u0026lt;Long\u0026gt; ledgers) { .... LongAdder underReplicatedSize = new LongAdder(); FutureUtils.processList( Lists.newArrayList(ledgers), ledgerId -\u0026gt; //é€šè¿‡è¯»å–è¿™äº›Ledgerçš„å…ƒæ•°æ®ï¼Œæ–¹ä¾¿åç»­çš„æ•°æ®æ¢å¤åŠ¨ä½œ ledgerManager.readLedgerMetadata(ledgerId).whenComplete((metadata, exception) -\u0026gt; { if (exception == null) { underReplicatedSize.add(metadata.getValue().getLength()); } }), null).whenComplete((res, e) -\u0026gt; { .... }); return FutureUtils.processList( Lists.newArrayList(ledgers), //ä¸»æµç¨‹ï¼Œç»§ç»­å¾€ä¸‹ ledgerId -\u0026gt; ledgerUnderreplicationManager.markLedgerUnderreplicatedAsync(ledgerId, missingBookies), null ); } public CompletableFuture\u0026lt;Void\u0026gt; markLedgerUnderreplicatedAsync(long ledgerId, Collection\u0026lt;String\u0026gt; missingReplicas) { .... final String znode = getUrLedgerZnode(ledgerId); //æ ‡è®°éœ€è¦åšå¤‡ä»½çš„Ledger tryMarkLedgerUnderreplicatedAsync(znode, missingReplicas, zkAcls, createFuture); return createFuture; } private void tryMarkLedgerUnderreplicatedAsync(final String znode, final Collection\u0026lt;String\u0026gt; missingReplicas, final List\u0026lt;ACL\u0026gt; zkAcls, final CompletableFuture\u0026lt;Void\u0026gt; finalFuture) { .... //å°†éœ€è¦åšæ•°æ®æ¢å¤çš„å‰¯æœ¬è¿›è¡Œè¿›è¡Œprotoç¼–ç  missingReplicas.forEach(builder::addReplica); .... ZkUtils.asyncCreateFullPathOptimistic( zkc, znode, urLedgerData, zkAcls, CreateMode.PERSISTENT, (rc, path, ctx, name) -\u0026gt; { if (Code.OK.intValue() == rc) { FutureUtils.complete(finalFuture, null); } else if (Code.NODEEXISTS.intValue() == rc) { //è¦åœ¨zookeeperå°†è¿™äº›Ledgeræ ‡è®°ä¸ºéœ€è¦åšæ•°æ®æ¢å¤ handleLedgerUnderreplicatedAlreadyMarked(znode, missingReplicas, zkAcls, finalFuture); } else { FutureUtils.completeExceptionally(finalFuture, KeeperException.create(Code.get(rc))); } }, null); } private void handleLedgerUnderreplicatedAlreadyMarked(final String znode, final Collection\u0026lt;String\u0026gt; missingReplicas, final List\u0026lt;ACL\u0026gt; zkAcls, final CompletableFuture\u0026lt;Void\u0026gt; finalFuture) { // get the existing underreplicated ledger data zkc.getData(znode, false, (getRc, getPath, getCtx, existingUrLedgerData, getStat) -\u0026gt; { if (Code.OK.intValue() == getRc) { // deserialize existing underreplicated ledger data final UnderreplicatedLedgerFormat.Builder builder = UnderreplicatedLedgerFormat.newBuilder(); try { TextFormat.merge(new String(existingUrLedgerData, UTF_8), builder); } catch (ParseException e) { .... } UnderreplicatedLedgerFormat existingUrLedgerFormat = builder.build(); boolean replicaAdded = false; for (String missingReplica : missingReplicas) { if (existingUrLedgerFormat.getReplicaList().contains(missingReplica)) { continue; } else { builder.addReplica(missingReplica); replicaAdded = true; } } .... //ç›²çŒœè¿™é‡Œåœ¨zkå°†Ledgeræ ‡å¿—ä¸ºéœ€è¦åšæ•°æ®åŒæ­¥ zkc.setData(znode, newUrLedgerData, getStat.getVersion(), (setRc, setPath, setCtx, setStat) -\u0026gt; { if (Code.OK.intValue() == setRc) { FutureUtils.complete(finalFuture, null); } else if (Code.NONODE.intValue() == setRc) { tryMarkLedgerUnderreplicatedAsync(znode, missingReplicas, zkAcls, finalFuture); } else if (Code.BADVERSION.intValue() == setRc) { handleLedgerUnderreplicatedAlreadyMarked(znode, missingReplicas, zkAcls, finalFuture); } else { FutureUtils.completeExceptionally(finalFuture, KeeperException.create(Code.get(setRc))); } }, null); } else if (Code.NONODE.intValue() == getRc) { tryMarkLedgerUnderreplicatedAsync(znode, missingReplicas, zkAcls, finalFuture); } else { FutureUtils.completeExceptionally(finalFuture, KeeperException.create(Code.get(getRc))); } }, null); } ä»ReplicationWorkerçš„rereplicateæ–¹æ³•å¼€å§‹å°±æ˜¯çœŸæ­£åšæ•°æ®æ¢å¤çš„è¿‡ç¨‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 private boolean rereplicate(long ledgerIdToReplicate) throws InterruptedException, BKException, UnavailableException { .... //è·å–éœ€è¦åšæ•°æ®æ¢å¤çš„Ledgerçš„å¤„ç†å¯¹è±¡LedgerHandle try (LedgerHandle lh = admin.openLedgerNoRecovery(ledgerIdToReplicate)) { //é€šè¿‡å¯¹Ledgerè¿›è¡Œåˆ†è§£æˆæ›´å°æ•°æ®æ¢å¤å•ä½LedgerFragmentï¼Œåç»­åˆ†åˆ«å¯¹LedgerFragmentè¿›è¡Œæ•°æ®æ¢å¤ Set\u0026lt;LedgerFragment\u0026gt; fragments = getUnderreplicatedFragments(lh, conf.getAuditorLedgerVerificationPercentage()); .... for (LedgerFragment ledgerFragment : fragments) { .... try { //å¯¹LedgerFragmentè¿›è¡Œæ•°æ®æ¢å¤ admin.replicateLedgerFragment(lh, ledgerFragment, onReadEntryFailureCallback); numFragsReplicated++; if (ledgerFragment.getReplicateType() == LedgerFragment .ReplicateType.DATA_NOT_ADHERING_PLACEMENT) { numNotAdheringPlacementFragsReplicated++; } } catch (BKException.BKBookieHandleNotAvailableException e) { .... } } .... fragments = getUnderreplicatedFragments(lh, conf.getAuditorLedgerVerificationPercentage()); .... } catch (BKNoSuchLedgerExistsOnMetadataServerException e) { .... } finally { .... } } ç»§ç»­è¿›ä¸€æ­¥çœ‹admin.replicateLedgerFragmentçš„å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 public void replicateLedgerFragment(LedgerHandle lh, final LedgerFragment ledgerFragment, final BiConsumer\u0026lt;Long, Long\u0026gt; onReadEntryFailureCallback) throws InterruptedException, BKException { .... //ç»§ç»­å¾€ä¸‹è·Ÿè¸ª replicateLedgerFragment(lh, ledgerFragment, targetBookieAddresses, onReadEntryFailureCallback); } private void replicateLedgerFragment(LedgerHandle lh, final LedgerFragment ledgerFragment, final Map\u0026lt;Integer, BookieId\u0026gt; targetBookieAddresses, final BiConsumer\u0026lt;Long, Long\u0026gt; onReadEntryFailureCallback) throws InterruptedException, BKException { .... //åœ¨è¿™é‡Œçœ‹åˆ°è¿™ä¸ªæ¢å¤å…¶å®æ˜¯å¼‚æ­¥å¤„ç†çš„è¿‡ç¨‹ï¼Œç»§ç»­å¾€ä¸‹ asyncRecoverLedgerFragment(lh, ledgerFragment, cb, targetBookieSet, onReadEntryFailureCallback); .... } private void asyncRecoverLedgerFragment(final LedgerHandle lh, final LedgerFragment ledgerFragment, final AsyncCallback.VoidCallback ledgerFragmentMcb, final Set\u0026lt;BookieId\u0026gt; newBookies, final BiConsumer\u0026lt;Long, Long\u0026gt; onReadEntryFailureCallback) throws InterruptedException { //å‘ç°ä¼šè°ƒç”¨LedgerFragmentReplicatorå¯¹è±¡è¿›è¡Œæ•°æ®æ¢å¤ï¼Œç»§ç»­å¾€ä¸‹ lfr.replicate(lh, ledgerFragment, ledgerFragmentMcb, newBookies, onReadEntryFailureCallback); } void replicate(final LedgerHandle lh, final LedgerFragment lf, final AsyncCallback.VoidCallback ledgerFragmentMcb, final Set\u0026lt;BookieId\u0026gt; targetBookieAddresses, final BiConsumer\u0026lt;Long, Long\u0026gt; onReadEntryFailureCallback) throws InterruptedException { Set\u0026lt;LedgerFragment\u0026gt; partionedFragments = splitIntoSubFragments(lh, lf, bkc.getConf().getRereplicationEntryBatchSize()); .... //ç»§ç»­å¾€ä¸‹çœ‹å®ç° replicateNextBatch(lh, partionedFragments.iterator(), ledgerFragmentMcb, targetBookieAddresses, onReadEntryFailureCallback); } private void replicateNextBatch(final LedgerHandle lh, final Iterator\u0026lt;LedgerFragment\u0026gt; fragments, final AsyncCallback.VoidCallback ledgerFragmentMcb, final Set\u0026lt;BookieId\u0026gt; targetBookieAddresses, final BiConsumer\u0026lt;Long, Long\u0026gt; onReadEntryFailureCallback) { if (fragments.hasNext()) { try { //æ¥äº†ï¼Œä¸€èˆ¬æœ‰Internalçš„åœ°æ–¹éƒ½ä¼šæœ‰å®ç°çš„å¹²è´§ï¼Œç»§ç»­è¿›å» replicateFragmentInternal(lh, fragments.next(), new AsyncCallback.VoidCallback() { @Override public void processResult(int rc, String v, Object ctx) { if (rc != BKException.Code.OK) { ledgerFragmentMcb.processResult(rc, null, null); } else { replicateNextBatch(lh, fragments, ledgerFragmentMcb, targetBookieAddresses, onReadEntryFailureCallback); } } }, targetBookieAddresses, onReadEntryFailureCallback); } catch (InterruptedException e) { ..... } } else { ledgerFragmentMcb.processResult(BKException.Code.OK, null, null); } } private void replicateFragmentInternal(final LedgerHandle lh, final LedgerFragment lf, final AsyncCallback.VoidCallback ledgerFragmentMcb, final Set\u0026lt;BookieId\u0026gt; newBookies, final BiConsumer\u0026lt;Long, Long\u0026gt; onReadEntryFailureCallback) throws InterruptedException { .... //é’ˆå¯¹æ¯ä¸ªEntryå¯¹è±¡å¾ªç¯åšæ•°æ®æ¢å¤ï¼ŒEntryæ˜¯BKé‡Œæœ€å°çš„æ•°æ®å•å…ƒ for (final Long entryId : entriesToReplicate) { recoverLedgerFragmentEntry(entryId, lh, ledgerFragmentEntryMcb, newBookies, onReadEntryFailureCallback); } } private void recoverLedgerFragmentEntry(final Long entryId, final LedgerHandle lh, final AsyncCallback.VoidCallback ledgerFragmentEntryMcb, final Set\u0026lt;BookieId\u0026gt; newBookies, final BiConsumer\u0026lt;Long, Long\u0026gt; onReadEntryFailureCallback) throws InterruptedException { .... long startReadEntryTime = MathUtils.nowInNano(); /* * Read the ledger entry using the LedgerHandle. This will allow us to * read the entry from one of the other replicated bookies other than * the dead one. */ //åˆ°äº†çœŸæ­£è¯»å–Entryçš„é€»è¾‘ï¼Œç»§ç»­å¾€ä¸‹ lh.asyncReadEntries(entryId, entryId, new ReadCallback() { .... } }, null); } public void asyncReadEntries(long firstEntry, long lastEntry, ReadCallback cb, Object ctx) { .... //è°ƒç”¨å¼‚æ­¥è¯»å–é€»è¾‘ asyncReadEntriesInternal(firstEntry, lastEntry, cb, ctx, false); } void asyncReadEntriesInternal(long firstEntry, long lastEntry, ReadCallback cb, Object ctx, boolean isRecoveryRead) { if (!clientCtx.isClientClosed()) { //ç»§ç»­å¾€ä¸‹è·Ÿè¸ª readEntriesInternalAsync(firstEntry, lastEntry, isRecoveryRead) .whenCompleteAsync(new FutureEventListener\u0026lt;LedgerEntries\u0026gt;() { .... }, clientCtx.getMainWorkerPool().chooseThread(ledgerId)); } else { cb.readComplete(Code.ClientClosedException, LedgerHandle.this, null, ctx); } } CompletableFuture\u0026lt;LedgerEntries\u0026gt; readEntriesInternalAsync(long firstEntry, long lastEntry, boolean isRecoveryRead) { //æ„é€ è¯»æ•°æ®çš„å¯¹è±¡ PendingReadOp op = new PendingReadOp(this, clientCtx, firstEntry, lastEntry, isRecoveryRead); //è¿è¡Œèµ·æ¥ï¼Œè·Ÿè¿›å»ç…ç… op.run(); return op.future(); } public void run() { //æ— ä»–ï¼Œç»§ç»­å¾€ä¸‹ initiate(); } void initiate() { .... do { //å†³å®šæ˜¯ä¸²è¡Œè¯»å–æ•°æ®è¿˜æ˜¯å¹¶è¡Œè¯»å–æ•°æ® if (parallelRead) { entry = new ParallelReadRequest(ensemble, lh.ledgerId, i); } else { entry = new SequenceReadRequest(ensemble, lh.ledgerId, i); } seq.add(entry); i++; } while (i \u0026lt;= endEntryId); // read the entries. for (LedgerEntryRequest entry : seq) { //æ ¸å¿ƒé€»è¾‘ï¼Œè¿™é‡Œè¿›è¡Œæ•°æ®è¯»å–æ“ä½œ entry.read(); } } void read() { //ç»§ç»­å¾€ä¸‹çœ‹ sendNextRead(); } synchronized BookieId sendNextRead() { .... try { BookieId to = ensemble.get(bookieIndex); //å‘é€è¯»å–è¯·æ±‚çš„æ“ä½œ sendReadTo(bookieIndex, to, this); .... } catch (InterruptedException ie) { .... } } void sendReadTo(int bookieIndex, BookieId to, LedgerEntryRequest entry) throws InterruptedException if (isRecoveryRead) { .... } else { //è°ƒç”¨BKå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®çš„è¯»å– clientCtx.getBookieClient().readEntry(to, lh.ledgerId, entry.eId, this, new ReadContext(bookieIndex, to, entry), BookieProtocol.FLAG_NONE); } } default void readEntry(BookieId address, long ledgerId, long entryId, ReadEntryCallback cb, Object ctx, int flags) { //ç»§ç»­å¾€ä¸‹ readEntry(address, ledgerId, entryId, cb, ctx, flags, null); } default void readEntry(BookieId address, long ledgerId, long entryId, ReadEntryCallback cb, Object ctx, int flags, byte[] masterKey) { //ç»§ç»­å¾€ä¸‹ readEntry(address, ledgerId, entryId, cb, ctx, flags, masterKey, false); } public void readEntry(final BookieId addr, final long ledgerId, final long entryId, final ReadEntryCallback cb, final Object ctx, int flags, byte[] masterKey, final boolean allowFastFail) { //è·å–è¦è®¿é—®çš„å®¢æˆ·ç«¯å¯¹è±¡ final PerChannelBookieClientPool client = lookupClient(addr); .... client.obtain((rc, pcbc) -\u0026gt; { if (rc != BKException.Code.OK) { completeRead(rc, ledgerId, entryId, null, cb, ctx); } else { //è°ƒç”¨è¯»å–é€»è¾‘ pcbc.readEntry(ledgerId, entryId, cb, ctx, flags, masterKey, allowFastFail); } }, ledgerId); } public void readEntry(final long ledgerId, final long entryId, ReadEntryCallback cb, Object ctx, int flags, byte[] masterKey, boolean allowFastFail) { //çœ‹åˆ°Internalå°±çŸ¥é“è¦æœ‰ä¸œè¥¿äº†ï¼Œç»§ç»­å¾€ä¸‹ readEntryInternal(ledgerId, entryId, null, null, false, cb, ctx, (short) flags, masterKey, allowFastFail); } private void readEntryInternal(final long ledgerId, final long entryId, final Long previousLAC, final Long timeOutInMillis, final boolean piggyBackEntry, final ReadEntryCallback cb, final Object ctx, int flags, byte[] masterKey, boolean allowFastFail) { .... //æ„é€ è¯·æ±‚å¯¹è±¡ ReadRequest.Builder readBuilder = ReadRequest.newBuilder() .setLedgerId(ledgerId) .setEntryId(entryId); .... request = withRequestContext(Request.newBuilder()) .setHeader(headerBuilder) .setReadRequest(readBuilder) .build(); .... //ç»§ç»­å¾€ä¸‹ writeAndFlush(channel, completionKey, request, allowFastFail); } private void writeAndFlush(final Channel channel, final CompletionKey key, final Object request, final boolean allowFastFail) { .... try { .... //è·Ÿåˆ°è¿™é‡Œå°±çŸ¥é“æœ€ç»ˆè°ƒç”¨äº†Nettyçš„å®¢æˆ·ç«¯æ¥å‘èµ·è¯·æ±‚ channel.writeAndFlush(request, promise); } catch (Throwable e) { .... } } åˆ°è¿™é‡Œæ•°æ®å°±å‘å‡ºå»äº†ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çŸ¥é“AutoRecoveryè¿›ç¨‹æ˜¯é€šè¿‡Nettyå‘BKçš„æœåŠ¡ç«¯è¿›è¡Œæ•°æ®è¯»å–ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯åœ¨æ¥æ”¶åˆ°è¯·æ±‚ååˆæ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Œè¿™é‡Œå’±ä»¬ä»æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚çš„é€»è¾‘å¼€å§‹è·Ÿï¼Œç”±äºBKæœ¬èº«ä¹Ÿæ˜¯é€šè¿‡Nettyå®ä¾‹è¿›è¡Œç½‘ç»œè¯·æ±‚å¤„ç†çš„ï¼Œå› æ­¤å¯ä»¥è½»æ¾æ‰¾åˆ°BookieRequestHandlerçš„channelReadæ–¹æ³•ç›‘å¬å¤–éƒ¨ç½‘ç»œè¯·æ±‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception { .... //èŒè´£åˆ†ç¦»åšå¾—å¾ˆå¥½ï¼ŒBookieRequestHandleråªè´Ÿè´£æ¥æ”¶è¯·æ±‚ï¼Œé€»è¾‘å¤„ç†ç›¸å…³çš„å…¨æƒäº¤ç»™requestProcessorå¯¹è±¡ requestProcessor.processRequest(msg, this); } public void processRequest(Object msg, BookieRequestHandler requestHandler) { Channel channel = requestHandler.ctx().channel(); if (msg instanceof BookkeeperProtocol.Request) { BookkeeperProtocol.Request r = (BookkeeperProtocol.Request) msg; restoreMdcContextFromRequest(r); try { BookkeeperProtocol.BKPacketHeader header = r.getHeader(); //éå¸¸å¥½çš„ä¸€ç§è®¾è®¡ï¼Œkafkaçš„KafkaApisç±»é‡Œä¹Ÿæ˜¯è¿™æ ·è®¾è®¡ï¼ŒæœåŠ¡ç«¯æ”¯æŒçš„æ“ä½œåœ¨è¿™é‡Œå°±èƒ½å¾ˆæ¸…æ™°çš„çœ‹åˆ° switch (header.getOperation()) { case ADD_ENTRY: processAddRequestV3(r, requestHandler); break; case READ_ENTRY: //åœ¨è¿™é‡Œå¯ä»¥å¤„ç†çš„è¯»å–è¯·æ±‚ï¼Œä»è¿™é‡Œè¿›å»çœ‹çœ‹ processReadRequestV3(r, requestHandler); break; case FORCE_LEDGER: processForceLedgerRequestV3(r, requestHandler); break; .... case WRITE_LAC: processWriteLacRequestV3(r, requestHandler); break; case READ_LAC: processReadLacRequestV3(r, requestHandler); break; case GET_BOOKIE_INFO: processGetBookieInfoRequestV3(r, requestHandler); break; case START_TLS: processStartTLSRequestV3(r, requestHandler); break; case GET_LIST_OF_ENTRIES_OF_LEDGER: processGetListOfEntriesOfLedgerProcessorV3(r, requestHandler); break; default: .... break; } } finally { MDC.clear(); } } else { .... } } private void processReadRequestV3(final BookkeeperProtocol.Request r, final BookieRequestHandler requestHandler) { //èƒ½çœ‹åˆ°BKä¹ŸåŒæ—¶æ”¯æŒé•¿è½®è¯¢çš„æ–¹å¼è¯»å–æ•°æ® if (RequestUtils.isLongPollReadRequest(r.getReadRequest())) { .... read = new LongPollReadEntryProcessorV3(r, requestHandler, this, fenceThread, lpThread, requestTimer); } else { read = new ReadEntryProcessorV3(r, requestHandler, this, fenceThread); .... } if (null == threadPool) { //è·Ÿè¿›å»çœ‹çœ‹å®ç° read.run(); } else { .... } } public void run() { .... //æ‰§è¡Œè¯»å–æ“ä½œ executeOp(); } protected void executeOp() { //è¿™é‡Œæ„Ÿè§‰è®¾è®¡å¾—ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œåº”è¯¥å…ˆè¯»å–æ•°æ®å‡ºæ¥å†æ„é€ è¿”å›å¯¹è±¡çš„ï¼Œä½ ä»¬è§‰å¾—å‘¢ï¼Ÿ ReadResponse readResponse = getReadResponse(); if (null != readResponse) { sendResponse(readResponse); } } protected ReadResponse getReadResponse() { // è¯»å–Entryæ•°æ®çš„åœ°æ–¹ï¼Œåœ¨æ­¤å¤„æ·±å…¥æ¢ç´¢ä¸‹ return readEntry(readResponse, entryId, startTimeSw); } catch (Bookie.NoLedgerException e) { .... } } protected ReadResponse readEntry(ReadResponse.Builder readResponseBuilder, long entryId, Stopwatch startTimeSw) throws IOException, BookieException { //ç»§ç»­æ·±å…¥ return readEntry(readResponseBuilder, entryId, false, startTimeSw); } protected ReadResponse readEntry(ReadResponse.Builder readResponseBuilder, long entryId, boolean readLACPiggyBack, Stopwatch startTimeSw) throws IOException, BookieException { //è°ƒç”¨Bookieçš„readEntryæ¥è¯»å–æ•°æ® ByteBuf entryBody = requestProcessor.getBookie().readEntry(ledgerId, entryId); .... } public ByteBuf readEntry(long ledgerId, long entryId) throws IOException, NoLedgerException, BookieException { .... try { LedgerDescriptor handle = handles.getReadOnlyHandle(ledgerId); .... //è°ƒç”¨çœŸæ­£è¯»æ•°æ®çš„é€»è¾‘ï¼Œå› ä¸ºåœ¨è¿™é‡Œèƒ½çœ‹åˆ°è·å–çš„å€¼entryä¹Ÿæ˜¯å¯¹å¤–è¿”å›çš„ //è¿™é‡Œè°ƒç”¨çš„æ˜¯LedgerDescriptorç±»çš„readEntryæ–¹æ³• ByteBuf entry = handle.readEntry(entryId); .... return entry; } finally { .... } } ByteBuf readEntry(long entryId) throws IOException, BookieException { //è°ƒç”¨LedgerStorageæ¥å£ï¼ŒSingleDirectoryDbLedgerStorageå®ç°ç±»æ¥è¯»å–Entry return ledgerStorage.getEntry(ledgerId, entryId); } public ByteBuf getEntry(long ledgerId, long entryId) throws IOException, BookieException { long startTime = MathUtils.nowInNano(); try { //ç»§ç»­å¾€ä¸‹è·Ÿè¸ª ByteBuf entry = doGetEntry(ledgerId, entryId); recordSuccessfulEvent(dbLedgerStorageStats.getReadEntryStats(), startTime); return entry; } catch (IOException e) { .... } } private ByteBuf doGetEntry(long ledgerId, long entryId) throws IOException, BookieException { .... //å°è¯•ä»BKæœ¬åœ°ç¼“å­˜ä¸­è¯»å–æ•°æ® ByteBuf entry = localWriteCache.get(ledgerId, entryId); //å°è¯•ä»æœ¬åœ°ç¼“å­˜flushä¸­è¿›è¡Œæ•°æ®å‘½ä¸­æ•°æ® entry = localWriteCacheBeingFlushed.get(ledgerId, entryId); // å°è¯•ä»è¯»ç¼“å­˜ä¸­è¿›è¡Œæ•°æ®è¯»å– entry = readCache.get(ledgerId, entryId); //ä»ç£ç›˜æ–‡ä»¶ä¸­è¿›è¡Œæ•°æ®è¯»å–, è°ƒç”¨çš„æ˜¯EntryLoggeræ¥å£ï¼ŒDefaultEntryLoggerå¯¹è±¡çš„readEntryæ–¹æ³• entry = entryLogger.readEntry(ledgerId, entryId, entryLocation); //å†™åˆ°è¯»ç¼“å­˜ä¸­ readCache.put(ledgerId, entryId, entry); .... return entry; } public ByteBuf readEntry(long ledgerId, long entryId, long entryLocation) throws IOException, Bookie.NoEntryException { //å†è¿›ä¸€æ­¥æ¢ç´¢ return internalReadEntry(ledgerId, entryId, entryLocation, true /* validateEntry */); } private ByteBuf internalReadEntry(long ledgerId, long entryId, long location, boolean validateEntry) throws IOException, Bookie.NoEntryException { //è·å–entryæ‰€åœ¨çš„LogId long entryLogId = logIdForOffset(location); long pos = posForOffset(location); BufferedReadChannel fc = null; int entrySize = -1; try { fc = getFCForEntryInternal(ledgerId, entryId, entryLogId, pos); ByteBuf sizeBuff = readEntrySize(ledgerId, entryId, entryLogId, pos, fc); entrySize = sizeBuff.getInt(0); if (validateEntry) { validateEntry(ledgerId, entryId, entryLogId, pos, sizeBuff); } } catch (EntryLookupException e) { .... } ByteBuf data = allocator.buffer(entrySize, entrySize); //è¿›è¡Œæ•°æ®è¯»å– int rc = readFromLogChannel(entryLogId, fc, data, pos); .... data.writerIndex(entrySize); return data; } private int readFromLogChannel(long entryLogId, BufferedReadChannel channel, ByteBuf buff, long pos) throws IOException { BufferedLogChannel bc = entryLogManager.getCurrentLogIfPresent(entryLogId); .... //ç»§ç»­å¾€ä¸‹ return channel.read(buff, pos); } public int read(ByteBuf dest, long pos) throws IOException { //ç»§ç»­å¾€ä¸‹ return read(dest, pos, dest.writableBytes()); } public synchronized int read(ByteBuf dest, long pos, int length) throws IOException { .... while (length \u0026gt; 0) { // Check if the data is in the buffer, if so, copy it. if (readBufferStartPosition \u0026lt;= currentPosition \u0026amp;\u0026amp; currentPosition \u0026lt; readBufferStartPosition + readBuffer.readableBytes()) { int posInBuffer = (int) (currentPosition - readBufferStartPosition); int bytesToCopy = Math.min(length, readBuffer.readableBytes() - posInBuffer); dest.writeBytes(readBuffer, posInBuffer, bytesToCopy); currentPosition += bytesToCopy; length -= bytesToCopy; cacheHitCount++; } else { // We don\u0026#39;t have it in the buffer, so put necessary data in the buffer readBufferStartPosition = currentPosition; int readBytes = 0; //ä»ç£ç›˜è¯»å–æ•°æ®åˆ°readBufferä¸­ï¼Œå†å°†readBufferçš„æ•°æ®å†™åˆ° destä¸­ä½œä¸ºè¿”å›å€¼ //è¿™é‡Œè°ƒç”¨çš„æ˜¯Java NIO FileChannelç±»çš„readæ–¹æ³•æ¥ä»ç£ç›˜è¿›è¡Œæ•°æ®çš„è¯»å– if ((readBytes = validateAndGetFileChannel().read(readBuffer.internalNioBuffer(0, readCapacity), currentPosition)) \u0026lt;= 0) { throw new IOException(\u0026#34;Reading from filechannel returned a non-positive value. Short read.\u0026#34;); } readBuffer.writerIndex(readBytes); } } return (int) (currentPosition - pos); } æ€»ç»“ åœ¨è¿™é‡Œè§£ç­”ä¸‹å¼•è¨€å°æ•…äº‹\nå¼ ä¸‰æ˜¯é€šè¿‡ä»€ä¹ˆè§„åˆ™è¢«é€‰æˆâ€œç›‘ç£è€…â€çš„ï¼Ÿ\nå¼ ä¸‰æ˜¯é€šè¿‡zookeeperçš„Paxosç®—æ³•é€‰ä¸¾äº§ç”Ÿçš„\nå¦‚æœå¼ ä¸‰ä¹Ÿä¸è¾è€Œåˆ«å‘¢ï¼Ÿ\nå¤§ç‹—å’ŒäºŒç‹—ä¹Ÿä¼šé€šè¿‡zookeeperç›‘å¬å¼ ä¸‰çš„çŠ¶æ€ï¼Œå¦‚æœå¼ ä¸‰ä¸è¾è€Œåˆ«çš„è¯ï¼Œå¤§ç‹—äºŒç‹—ä¼šé€šè¿‡zookeeperé€‰ä¸¾æˆä¸ºæ–°çš„â€œç›‘ç£è€…â€\nä¸ºå•¥è¦é€šè¿‡ç­¾åˆ°æœ¬çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯å¼ ä¸‰ç›´æ¥å»æŒ¨ä¸ªæŒ¨ä¸ªçœ‹ï¼Ÿ\né€šè¿‡ç­¾åˆ°æœ¬çš„æ–¹å¼æ¯”è¾ƒèŠ‚çº¦å¼ ä¸‰çš„æ—¶é—´ï¼Œå¦åˆ™å½“å‘˜å·¥æ¯”è¾ƒå¤šçš„æ—¶å€™å¹¶ä¸”å¯¹æ„ŸçŸ¥æ—¶é—´æ¯”è¾ƒå¿«çš„æ—¶å€™ï¼Œå¼ ä¸‰å°±è¦æ¯éš”å‡ åˆ†é’Ÿå°±è¦è·‘å»æŒ¨ä¸ªæŒ¨ä¸ªçœ‹ï¼Œè¿™æ ·æ²¡å¤šä¹…å¼ ä¸‰ä¹Ÿè¦â€œä¸è¾è€Œåˆ«â€äº†ã€‚é€šè¿‡ç­¾åˆ°æœ¬å¦‚æœæŸä¸ªåŒäº‹ä¸ç­¾åˆ°äº†å¼ ä¸‰å°±èƒ½å¾ˆè½»æ¾æ„ŸçŸ¥åˆ°å¹¶åšç›¸å¯¹åº”çš„å¤„ç†äº†\nå‚è€ƒèµ„æ–™ https://bookkeeper.apache.org/docs/admin/autorecovery/ bké¡¹ç›® site3/website/docs/admin/* æŒ‡ä»¤ä½¿ç”¨è¯´æ˜ ","date":"2024-01-04T12:00:10+08:00","image":"https://sherlock-lin.github.io/p/%E8%AF%A6%E8%A7%A3bookkeeper%E4%B9%8Bautorecovery%E6%9C%BA%E5%88%B6/image-20231215102118251_hu13366877165211677337.png","permalink":"https://sherlock-lin.github.io/p/%E8%AF%A6%E8%A7%A3bookkeeper%E4%B9%8Bautorecovery%E6%9C%BA%E5%88%B6/","title":"è¯¦è§£bookkeeperä¹‹AutoRecoveryæœºåˆ¶"},{"content":"ä¸çŸ¥ä¸è§‰ä¸€å¹´åˆå¿«ç»“æŸäº†ï¼Œä»Šå¤©å†™äº†ä¸å°‘æ–‡ç« ï¼Œé‚£å°±ä¸“é—¨å†™ä¸€ä»½ç»™è‡ªå·±çš„ä¿¡\nå·¥ä½œ 2023å¹´æ•´ä½“è¿‡å¾—è¿˜ç®—å¹³ç¨³ï¼Œå…ˆè¯´è¯´å·¥ä½œä¸Šçš„äº‹ï¼Œå²—ä½ä¸Šé¡ºåˆ©å‡èŒï¼Œæœ‰ä¸ªæ¯”è¾ƒå¤§çš„æ„Ÿæ…¨ï¼Œå°±æ˜¯å†™å¥½PPTæ˜¯çœŸçš„å¾ˆæœ‰å¿…è¦çš„ï¼Œçœ‹äº†ä¸€äº›å¤§ä½¬ä»¬çš„æ™‹å‡PPTå‘ç°äººå®¶å¯¹äº§å“çš„å‰–æéå¸¸æ¸…æ™°å¹¶ä¸”å¾ˆå¤šç»“æœéƒ½æ˜¯æœ‰æ•°æ®æŒ‡æ ‡æ¥æ”¯æ’‘çš„ï¼Œé€šè¿‡PPTå°±èƒ½æ˜æ˜¾æ„Ÿè§‰åˆ°å¤§ä½¬å¯¹äº§å“çš„ç†è§£æ˜¯å¾ˆé€å½»çš„ã€‚å› æ­¤è‡ªå·±ä¹Ÿç»™è‡ªå·±å®šäº†ä¸ªä»»åŠ¡ï¼Œå°±æ˜¯æ¯å¹´éƒ½è¦ç»™è‡ªå·±å†™å½“å¹´çš„ç­”è¾©PPTä»¥åŠç®€å†ï¼Œé€šè¿‡å†™è¿™äº›ä¸œè¥¿èƒ½å¤Ÿå¸®ä½ æ€è€ƒæç‚¼è¿™ä¸ªå¹´åº¦çš„æ”¶è·ä»¥åŠæŒ‡å¯¼æœªæ¥çš„æ–¹å‘ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸‰ä¸ªè§‰å¾—æ¯”è¾ƒå€¼å¾—å†™å¾—ç‚¹\nå¯¹ä¸šåŠ¡åŠ¡å¿…è¦æ·±å…¥äº†è§£ å¯¹ä¸šåŠ¡ç†è§£è¿™ä¸ªå¥½å¤„æœ‰3ç‚¹ï¼Œç¬¬ä¸€å°±æ˜¯å½“ä½ å¯¹ä¸šåŠ¡æœ‰è¶³å¤Ÿçš„äº†è§£æ—¶ï¼Œæ— è®ºå‘ç”Ÿä»»ä½•äº‹æƒ…ä½ éƒ½å¿ƒé‡Œæœ‰åº•ï¼Œå³ä¾¿æœ‰æ•…éšœå¦‚æœä½ èƒ½æ¸…æ™°çš„çŸ¥é“æ²¡æœ‰å½±å“åˆ°çº¿ä¸Šæµé‡é‚£å°±ä¸ç”¨å¤ªæ‹…å¿ƒï¼Œ ç¬¬äºŒå°±æ˜¯å½“å¯¹ä¸šåŠ¡è¶³å¤Ÿäº†è§£æ—¶ï¼Œåœ¨è®¾è®¡ç¨‹åºä»¥åŠè·Ÿäº§å“battleæ—¶èƒ½å¤Ÿæ›´å¥½çš„æŠ“ä¸»è¦çŸ›ç›¾ï¼Œæœ‰çš„æ”¾çŸ¢ï¼Œä»è€Œè®¾è®¡å‡ºæ›´é€‚åˆä¸šåŠ¡çš„è½¯ä»¶ã€‚ ç¬¬ä¸‰å°±æ˜¯å½“ä½ å¯¹ä¸šåŠ¡è¶³å¤Ÿäº†è§£æ—¶ï¼Œæœ‰äº›å·¥ä½œ(éäº§å“)ä¸Šä½ å¯ä»¥å¤§èƒ†çš„è·Ÿå„ç§å¤§ä½¬ä»¬æé™æ‹‰æ‰¯ï¼Œæ‹‰æ‰¯èµ¢äº†æœ‰äº›éå¿…è¦å¹¶ä¸”è€—è´¹ç²¾åŠ›çš„äº‹æƒ…å°±å¯ä»¥ä¸åšæˆ–è€…æ…¢æ…¢åš å…ˆç´§åé©° è¿™ç‚¹æ˜¯æˆ‘éœ€è¦æ”¹è¿›çš„ç‚¹ï¼Œåœ¨æ¥åˆ°ä»»åŠ¡æ—¶æˆ‘å–œæ¬¢æ…¢æ…¢å±•å¼€ï¼Œå–œæ¬¢èŠ±æ›´å¤šå‰æœŸçš„æ—¶é—´å»ç†Ÿæ‚‰ä»»åŠ¡ä»¥åŠæ”¾æ¾ä¸€ä¸‹ï¼Œè¿™æœ‰æ—¶ä¼šå½±å“ä»»åŠ¡çš„æ¨è¿›ã€‚å› æ­¤åœ¨æ¥æ‰‹ä¸€äº›é‡è¦çš„ä»»åŠ¡æ—¶ï¼Œ åº”è¯¥å°½å¿«çš„è¿›è¡Œä»»åŠ¡çš„å±•å¼€ï¼Œä¸ç”¨å¯ä»¥è¿½æ±‚å®Œç¾ï¼Œå…ˆåšäº†å†è¯´ï¼Œä¸å¯¹å†åœ¨åšçš„è¿‡ç¨‹ä¸­åšè°ƒæ•´ï¼Œè¡Œå°±æ˜¯çŸ¥ï¼ŒçŸ¥å°±æ˜¯è¡Œï¼Œä¸¤è€…æœ¬å°±æ˜¯ä¸€ä½“çš„ï¼Œæœ‰äº›ä¸œè¥¿ä¸å»åšæ˜¯æ°¸è¿œä¹Ÿæƒ³ä¸æ˜ç™½çš„ å®šæœŸreset è¿™æ˜¯å¬äº†éƒ­å®‡å¤§ä½¬çš„ä¸“è®¿åå¾—å‡ºçš„ä½“ä¼šï¼Œå¦‚æœæ¯å¤©éƒ½æ—¥å¤ä¸€æ—¥çš„å·¥ä½œï¼Œä¼šå‘ç°æ—¶é—´è¿‡å¾—å¾ˆå¿«å¹¶ä¸”å¿ƒæƒ…ä¹Ÿå®¹æ˜“çƒ¦èºï¼Œåº”è¯¥å®šæœŸçš„ç»™è‡ªå·±é‡ç½®ä¸‹ï¼Œä¾‹å¦‚èŠ±ä¸¤ä¸‰å¤©å»ä¸€ä¸ªé™Œç”Ÿ åŸå¸‚æ”¾ç©ºè‡ªå·±ï¼Œå¿˜è®°è‡ªå·±çš„å·¥ä½œä¸ç”Ÿæ´»ï¼Œå°±è·Ÿè‡ªå·±è·Ÿä¸–ç•Œå¯¹è¯ï¼Œç„¶ååƒçœ‹å…¶ä»–äººçš„äººç”Ÿä¸€æ ·çœ‹è‡ªå·±è¿™æ®µæ—¶é—´çš„ç»å†ï¼Œå®¢è§‚çš„æ€è€ƒå“ªäº›æ˜¯è‡ªå·±è¿½æ±‚çš„ï¼Œå“ªäº›æ˜¯è‡ªå·±ä¸éœ€è¦çš„ ç­‰ç­‰ã€‚æ¯å¹´éƒ½è¦å¦‚æ­¤å‡ æ¬¡ï¼Œé€šè¿‡è¿™æ ·æ¥è°ƒæ•´è‡ªå·±çš„èŠ‚å¥ï¼Œè®©è‡ªå·±æ•´ä½“æœ‰æ¡ä¸çµ®çš„å¾€è‡ªå·±çš„ç»ˆæç›®æ ‡å‰è¿› å­¦ä¹  è¯´å®Œå·¥ä½œï¼Œå†èŠèŠå­¦ä¹ ä¸Šçš„äº‹æƒ…ï¼Œä»Šå¹´æ¯”è¾ƒå¤§çš„æ”¶è·æ˜¯åšæŒäº†åŠå¹´çš„èƒŒå•è¯ï¼Œæ¯å¤©ä¿æŒèƒŒ50ï½70ä¸ªå•è¯ï¼Œä¸è¿½æ±‚æ¯ä¸ªéƒ½èƒŒä¸‹æ¥ï¼Œæ›´å¤šçš„æ˜¯èƒŒä¸€ä¸ªæ„Ÿè§‰ï¼Œå°±æ˜¯çœ‹åˆ°è¿™ä¸ªå•è¯èƒ½çŒœåˆ°ä¸€ä¸ªå¤§æ¦‚ï¼Œè¿™æ˜¯ä»â€œå­¦ä¹ é£è½®â€é‚£ç‰‡æ–‡ç« ä¸Šå¾—åˆ°çš„çµæ„Ÿï¼Œå°±æ˜¯æœ‰äº›ä¸œè¥¿ä¸€å®šè¦å¿«èµ·æ¥ï¼ŒèƒŒå•è¯ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸å…¶è¿½æ±‚å®Œç¾å¯¼è‡´æ­¢æ­¥ä¸å‰ï¼Œä¸å¦‚å…ˆä¿æŒèƒŒçš„ä¹ æƒ¯ä»¥åŠå¯¹å¤§éƒ¨åˆ†å•è¯æœ‰ä¸ªè®¤è¯†ï¼Œåç»­è¦ç”¨åˆ°çš„å•è¯ä¹Ÿä¼šé¢‘ç¹çš„å‡ºç°åœ¨è‡ªå·±é¢å‰åŠ æ·±è‡ªå·±çš„å°è±¡ã€‚é™¤äº†èƒŒå•è¯ä¹‹å¤–è¿˜æœ‰æ¯”è¾ƒå¥½çš„ç‚¹æ˜¯ç»ˆäºé‡æ–°æ‹¾èµ·å†™åšå®¢çš„ä¹ æƒ¯ï¼Œç›¸æ¯”äºå‰ä¸¤å¹´çš„çŠ¹è±«ä¸å†³ï¼Œä»Šå¹´çš„è‡ªå·±ç®—æ˜¯ä»è¿·èŒ«é€æ¸èµ°å‘åšå®šï¼Œè™½ç„¶è‡ªå·±ç°åœ¨è¿˜æ²¡æƒ³æ˜ç™½è‡ªå·±çš„ä½¿å‘½ï¼Œä½†æ˜¯å¯ä»¥ç¡®å®šçš„äº‹å°±æ˜¯ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿç»§ç»­æ·±æŒ–æŠ€æœ¯èƒ½åŠ›ï¼Œä¸è®¾è¾¹ç•Œï¼Œä»»ä½•ç¼–ç¨‹è¯­è¨€ï¼Œä»»ä½•é¢†åŸŸçŸ¥è¯†åªè¦æ„Ÿå…´è¶£éƒ½å¯ä»¥å­¦ä¹ ä»¥åŠæ·±æŒ–ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¸»è¦çœ‹çš„æ˜¯è¿™ä¸ªé¢†åŸŸçš„å¤§ä½¬æ˜¯å¦‚ä½•è®¾è®¡è§£å†³æ–¹æ¡ˆæ¥è§£å†³å¯¹åº”åœºæ™¯çš„é—®é¢˜çš„ã€‚å› æ­¤åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹å¸Œæœ›è‡ªå·±èƒ½å¤Ÿå¤šè¾“å‡ºé«˜è´¨é‡çš„æ–‡ç« ï¼Œä¸ä»…èƒ½å¤Ÿå€’é€¼è‡ªå·±å­¦ä¹ ã€æ€è€ƒæç‚¼ï¼Œè¿˜èƒ½å¤Ÿé€šè¿‡è¿™ç§æ–¹å¼å½±å“æ›´å¤šçš„äººï¼Œè®©è¯»è€…èƒ½å¤Ÿçˆ±ä¸Šç¼–ç¨‹ã€çˆ±ä¸Šå¤§æ•°æ®ã€çˆ±ä¸Šè®¾è®¡ã€çˆ±ä¸Šç”Ÿæ´»\u0026hellip;. é™¤äº†è¿™äº›ä»¥å¤–è¿˜å‘ç°äº†ä¸€ä¸ªæ‹¦è·¯è™ï¼Œå°±æ˜¯å†™æ–‡ç« å–œæ¬¢æ‹–å»¶ï¼Œå¾ˆå¤šä¸œè¥¿æƒ³ä¸€ä¸‹å­å†™åˆ°æœ€åï¼Œç„¶ååå¤æ¨æ•²æŸä¸ªç‚¹ï¼Œæˆ–è€…å¸Œæœ›èƒ½å¤Ÿç­‰ç»˜åˆ¶å‡ºæ›´è¯¦ç»†çš„å›¾è¾…åŠ©è¯´æ˜ç­‰ç­‰å¯¼è‡´æ— é™æœŸæ‹–å»¶ï¼Œä»Šå¹´å°±æœ‰åå¤šç¯‡æ–‡ç« å› ä¸ºè¿™ä¸ªå¯¼è‡´æ— é™å»¶æœŸï¼Œå› æ­¤æ˜å¹´å¸Œæœ›è‡ªå·±åœ¨è¿™æ–¹é¢èƒ½å¤Ÿå¿«é€Ÿé—­ç¯ï¼Œæœ‰åˆé€‚çš„æƒ³æ³•çš„æ—¶å€™å†™å¾—å·®ä¸å¤šå°±å‘å‡ºæ¥ï¼Œå…ˆé—­ç¯ï¼Œç­‰åç»­æœ‰æ–°çš„è§è§£å¯ä»¥å†æ›´æ–°æˆ–è€…è¾“å‡ºæ–°çš„æ–‡ç« ç­‰ï¼Œç®€å•æ¥è¯´è¿˜æ˜¯è¦çŸ¥è¡Œåˆä¸€ï¼Œæœ‰æ—¶å€™ä¸å‘å‡ºæ¥ä½ ä¹Ÿä¼šæ°¸è¿œä¸çŸ¥é“å·®åœ¨å“ªé‡Œ\nå¼€å¿ƒä¸é—æ†¾ åœ¨è¿™é‡Œç½—åˆ—ä¸‰ä»¶å¼€å¿ƒå’Œé—æ†¾çš„äº‹ï¼Œå…ˆè¯´è¯´å¼€å¿ƒçš„äº‹ï¼Œç¬¬ä¸€ä»¶æ˜¯ç»ˆäºæƒ³æ¸…æ¥šè¦è®¤çœŸå­¦ä¹ ä»¥åŠè¾“å‡ºæ–‡ç« è¿™ä»¶äº‹äº†ï¼Œç›¸æ¯”å‰ä¸¤å¹´çŠ¹è±«è¦ä¸è¦æ”¾å¼ƒç¼–ç¨‹ï¼Œä¹Ÿè®¸è®¾è®¡ä»£ç è¿™ä»¶äº‹æƒ…æ›´ç¬¦åˆè‡ªå·±å†…å¿ƒçš„è¿½æ±‚ï¼Œè®¤çœŸå­¦æŠ€æœ¯ä»¥åŠè¾“å‡ºæ–‡ç« ä¹Ÿç®—æ˜¯ follower è‡ªå·±çš„å†…å¿ƒäº†ã€‚ç¬¬äºŒä»¶å°±æ˜¯æ”¹ç”¨VSCodeæ¥å†™æ–‡ç« ï¼Œè¿™ä¸ªçœŸçš„å¤ªçˆ½äº†ï¼Œä¸ç”¨å†çº ç»“markdownçš„è¯­æ³•ï¼Œä¸ç”¨çº ç»“äºæ–‡ä»¶ä¸å¥½ç®¡ç†ç»´æŠ¤ç­‰ç­‰ï¼Œå°±æ²‰æµ¸äºç å­—ï¼Œç”¨å­—å°†è‡ªå·±çš„æ€ç»ªä¸²è”èµ·æ¥ç„¶åé€šè¿‡æ‰‹æŒ‡æ•²åŠ¨ä»¥å­—èŠ‚æµçš„æ–¹å¼æŒä¹…åŒ–åˆ°è®¾å¤‡ä¸Šï¼Œæœ‰æ—¶èƒ½è¿›å…¥å¿ƒæµçš„çŠ¶æ€ï¼Œè¿™ç§æ„Ÿè§‰å¯èƒ½åªæœ‰æ‡‚å¾—æ‰æ‡‚ã€‚ç¬¬ä¸‰ä»¶å°±æ˜¯è¦å»æ¹–å—æµé˜³è·¨å¹´äº†ï¼Œä¹Ÿå°±æ˜¯åå¤©ï¼Œåœ¨æ¼«å¤©çš„çƒŸèŠ±ä¸­é€èµ°2023å¹´ï¼Œå¹¶è¿æ¥æ–°çš„ä¸€å¹´çš„è‡ªå·±ï¼Œå¯¹äºå¤šå¹´æ²¡çœ‹åˆ°çƒŸèŠ±ä»¥åŠè‡ªå·±æ”¾çƒŸèŠ±çš„è‡ªå·±æ¥è¯´è¿™æ˜¯ è«å¤§å€¼å¾—æ¿€åŠ¨çš„äº‹æƒ…ï½ è¯´äº†å¼€å¿ƒçš„äº‹ï¼Œå†è¯´è¯´é—æ†¾çš„äº‹å§ï¼Œç¬¬ä¸€ä»¶æ˜¯è‡ªå·±ä»Šå¹´å§‹ç»ˆæ²¡æœ‰å‹‡æ•¢çš„è¿ˆå‡ºé‚£ä¸€æ­¥ï¼Œå¤§å­¦å®¤å‹å‹‡æ•¢çš„å»è‡ªå·±åˆ›ä¸šå¼€å¥¶èŒ¶åº—ï¼ŒåŒäº‹è±ªå“¥ä¹Ÿå»å°è¯•è‡ªå·±å–œæ¬¢ç”Ÿæ„ï¼Œè€Œæˆ‘è¿˜æ˜¯é€‰æ‹©äº†ç›¸å¯¹ç¨³å®šå·¥ä½œï¼Œå¸Œæœ›æ˜å¹´æˆ‘ä¹Ÿèƒ½å‹‡æ•¢çš„å»å°è¯•æ›´å¤šè‡ªå·±å–œæ¬¢çš„äº‹æƒ…ã€‚ç¬¬äºŒä»¶å°±æ˜¯åœ¨å›½åº†æ—¶å€™è·Ÿå®¶äººå»é¦™æ¸¯æ¾³é—¨æ¸¸ç©ï¼Œç”±äºè‡ªå·±æ²¡æœ‰æå‰åšå¥½æ”»ç•¥ï¼Œæ„Ÿè§‰æœ‰äº›åœ°æ–¹æœ‰äº›é—æ†¾ï¼Œæ¯•ç«Ÿå®¶äººå¾ˆå°‘ç¦»å¼€å°å²›ã€‚ç¬¬ä¸‰ä»¶äº‹å°±æ˜¯æ”¹è¡¥çš„ç‰™ç”±äºå¿™å¯¼è‡´ä¸€ç›´æ‹–ç€ï¼Œç°åœ¨çš„ç‰™æ´é€æ¸æ‰©å±•ï¼Œå†…å¿ƒå¼€å§‹æœ‰äº›ç´§å¼ äº†ï¼Œè¿˜æ˜¯ç©¿äº†åˆè¦åšæ ¹ç®¡æ²»ç–—äº†ï½\nå±•æœ› ç„¶åä¹Ÿå¸Œæœ›æ˜å¤©çš„è¿™ä¸ªæ—¶å€™ï¼Œèƒ½å¤Ÿåœ¨æ›´å¤šè‡ªå·±å–œæ¬¢çš„é¢†åŸŸæ·±è€•å¹¶è¾“å‡ºæ›´å¤šä¼˜è´¨çš„æ–‡ç« ï¼Œç„¶åæœ€åæƒ³ç»™å¤§å®¶åˆ†äº«çš„æ˜¯ï¼Œå¤§èƒ†å»åšä½ æƒ³åšçš„é‚£ä¸ªäººå§ï¼ŒæŠŠä½ çš„æƒ³æ³•å†™å‡ºæ¥ç„¶å å»å®ç°ï¼Œä¸ç”¨åœ¨ä¹åˆ«äººçš„çœ‹æ³•è¯´æ³•ï¼Œé¦–å…ˆçœŸçš„æ²¡æœ‰é‚£ä¹ˆå¤šçš„äººå»å…³æ³¨æˆ‘ä»¬ï¼Œå…¶æ¬¡ï¼Œåœ¨æˆ‘ä»¬çš„ä¸–ç•Œæˆ‘ä»¬æ‰æ˜¯ä¸»è§’ï¼Œåšè®©è‡ªå·±å¼€å¿ƒçš„äº‹å°±å¥½äº†ã€‚èµ°æ­£ç¡®çš„è·¯ï¼Œ å°±æ˜¯åšè‡ªå·±çœŸæ­£çƒ­çˆ±çš„äº‹ï¼Œå“ªæ¡æ˜¯æ­£ç¡®çš„è·¯ï¼Ÿåªæœ‰è‡ªå·±èƒ½å®šä¹‰ã€‚è·¯ä¸æ­¢ä¸€æ¡ï¼ŒåšæŒåšä½ åœ¨ä¹çš„äº‹ï¼Œèµ°å‡ºè‡ªå·±åœ¨ä¹çš„è·¯ï¼Œç»™å‡ºä½ å¯¹è¿™ä¸ªä¸–ç•Œç‹¬æœ‰çš„å›ç­”ï¼\nå†è§2023ï¼Œä½ å¥½2024ï¼\n","date":"2023-12-25T15:09:16+08:00","image":"https://sherlock-lin.github.io/p/%E4%B8%80%E5%B0%81%E5%86%99%E7%BB%99%E5%B9%B4%E6%9C%AB%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BF%A1/matt-le-SJSpo9hQf7s-unsplash_hu10664154974910995856.jpg","permalink":"https://sherlock-lin.github.io/p/%E4%B8%80%E5%B0%81%E5%86%99%E7%BB%99%E5%B9%B4%E6%9C%AB%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BF%A1/","title":"ä¸€å°å†™ç»™å¹´æœ«è‡ªå·±çš„ä¿¡"},{"content":"å¼•è¨€ è·ç¦»ç¬¬ä¸€æ¬¡å†™åšå®¢å·²ç»è¿‡å»å°†è¿‘10å¹´æ—¶é—´äº†ï¼Œä»Šå¹´å°±ä¸“é—¨ä»¥é—®ç­”å½¢å¼å†™å†™ä¸ºä»€ä¹ˆè¦å†™ä¸‹è¿™äº›ç©æ„\næ­£æ–‡ ä¸ºä»€ä¹ˆè¦å†™è¿™äº›ç©æ„ ä½œè€…æ˜¯ä¸€ä¸ªä»€ä¹ˆäº‹æƒ…éƒ½å–œæ¬¢æ€è€ƒæœ‰æ²¡æœ‰æ„ä¹‰çš„åŠŸåˆ©æ€§çš„äººï¼Œä½†æœ¬æ¬¡å†™ä½œçš„æºå¤´å´äº‹å‡ºåå¸¸ï¼Œå°±å•çº¯è§‰å¾—æŠŠå¼„æ‡‚çš„ä¸œè¥¿ä»¥æŸç§åª’ä»‹è®°å½•ä¸‹æ¥ï¼Œåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹å›è¿‡å¤´æ¥çœ‹ä»¥æ—¶é—´è½´å°†è¿™äº›æ€æƒ³ç©¿èµ·æ¥çš„è¿™æ ·ä¸€éƒ¨â€œç”µå½±â€ä¸€å®šå¾ˆæœ‰æ„æ€ï¼Œå¦‚æœè¯¸å›æ„Ÿå…´è¶£ä¹Ÿå¯ä¸€åŒè§‚çœ‹\næ‰“ç®—å†™å“ªäº›æ–¹å‘çš„æ–‡ç«  è¿™å—æ²¡æœ‰ç»™è‡ªå·±è®¾é™ï¼Œç›®å‰ä¸ªäººçŸ¥è¯†æ–¹å‘ä¸»è¦æ˜¯ ç¼–ç¨‹ã€å¤§æ•°æ®ã€æ“ä½œç³»ç»Ÿã€å†å²ã€ä»¥åŠè¯»ä¹¦å¿ƒå¾—è¿™å‡ ä¸ªæ–¹å‘ï¼Œæ­£å¦‚ä¸€åƒä¸ªè¯»è€…æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹ï¼Œä½œè€…ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå³ä¾¿æ˜¯ç°åœ¨å·²ç»æœ‰å¾ˆå¤šç°æˆçš„æ–‡ç« äº†ï¼Œä½†é€šè¿‡ä¸åŒä½œè€…çš„è§†è§’ä¸‹çœ‹åˆ°çš„ä¸œè¥¿å¯èƒ½ä¹Ÿä¸å¤ªä¸€æ ·ã€‚æœ¬äººæ“…é•¿æŠ½è±¡ä»¥åŠæç‚¼ï¼Œå¯¹ä¸å°‘ä¸œè¥¿éƒ½æœ‰è‡ªå·±çš„ä¸€ç•ªè§è§£ï¼Œå› æ­¤æœ‰ä¿¡å¿ƒå°†ä¸€äº›æ™®ç½—å¤§ä¼—è§‰å¾—å¤æ‚çš„ä¸œè¥¿ æç‚¼æˆç®€å•çš„å›¾æˆ–è€…æ•…äº‹æ¥ç»™è‡ªå·±ä»¥åŠè¯»è€…è§£æƒ‘ã€‚ä¸è¦æ±‚æ–‡ç« å¤šï¼Œä½†ä¸€å®šæ˜¯è¦ç»è¿‡è‡ªå·±å¤§è„‘æ€è€ƒã€å’€åš¼æ¶ˆåŒ–è¿‡åçš„ä¸œè¥¿ï¼Œæµæ°´è´¦çš„ä¸œè¥¿å°½é‡ä¸å†™æˆ–å°‘äº›ã€‚ä¸€è¨€ä»¥è”½ä¹‹ï¼Œå°±æ˜¯å†™å€¼å¾—å†™çš„ä¸œè¥¿\nä½¿å‘½æ„Ÿ æœ€è¿‘åœ¨è·Ÿæœ‹å‹èŠå¤©æœ‰èŠåˆ°è¿™ä¸ªï¼Œä»–å¸Œæœ›è‡ªå·±èƒ½æ‰¾åˆ°è‡ªå·±æ¥åˆ°è¿™ä¸ªä¸–ç•Œçš„ä½¿å‘½ï¼Œæœ¬äººå…¶å®ä¹Ÿä¸€æ ·åœ¨å¯»æ‰¾ï¼Œå†™æ–‡ç« ä¸æ˜¯ä½¿å‘½æ„Ÿé©±åŠ¨çš„ï¼Œæ›´å¤šçš„æ˜¯ä½œä¸ºæ‰¾åˆ°ä½¿å‘½å‰çš„â€œå†ç»ƒâ€ï¼Œå¦‚æœè¦åŠŸåˆ©ç‚¹ç®—çš„è¯ï¼Œé‚£å°±æ˜¯é€šè¿‡å†™ä½œæ¥ç£¨ç»ƒè‡ªå·±çš„æ€ç»´æ¡†æ¶è¿™æŠŠåˆ©å‰‘ï¼Œå¹¶å°†å®ƒé€ç»™æœªæ¥æ‰¾åˆ°ä½¿å‘½çš„è‡ªå·±ï¼Œä¹Ÿè®¸å†™ç€å†™ç€å°±æ‰¾åˆ°äº†ä¹Ÿè¯´ä¸å®šå‘¢\nä¼šä¸ä¼šè§‰å¾—æµªè´¹æ—¶é—´ è¯´å®è¯ï¼Œæ›¾ç»æœ‰æ®µæ—¶é—´è§‰å¾—æŒºæµªè´¹æ—¶é—´çš„ï¼Œå†™äº†è‡ªå·±ä¹Ÿä¸æ€ä¹ˆä¼šçœ‹ï¼Œä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆè¯»è€…å»çœ‹ï¼Œé‚£å†™è¿™äº›ä¸œè¥¿çš„æ„ä¹‰ä½•åœ¨å‘¢ï¼Ÿæ‰€ä»¥æœ€ç»ˆæ”¾å¼ƒäº†ä¸€æ®µæ—¶é—´ï¼Œä½†åæ¥å‘ç°ä¸å†™æ–‡ç« çš„æ—¶é—´è¦ä¹ˆä¹Ÿæ˜¯åˆ·çŸ­è§†é¢‘ã€æ‰“æ¸¸æˆã€å‘å‘†ç­‰ç­‰ï¼Œé‚£å¥½åƒæ›´æ²¡å•¥æ„ä¹‰ï¼Œå¯¹äºé‚£äº›æ—¥å¤ä¸€æ—¥å¹´å¤ä¸€å¹´æ²¡ä»»ä½•ç§¯ç´¯çš„ä¸œè¥¿ï¼Œå†™ä½œåè€Œå¯çˆ±å¾—åƒä¸ªå…»æˆæ¸¸æˆï¼Œæ¯å¤©é™ªä¼´å®ƒä¸€ä¼šï¼Œå®ƒå°±ä¼šèŒå£®æˆé•¿ï¼Œé•¿æˆä¸€é¢—è‹å¤©å¤§æ ‘ï¼Œä¾›è‡ªå·±å®‰æ”¾é‚£é¢—èºåŠ¨çš„å¿ƒä»¥åŠç»™è¡Œäººé®é˜´å‡‰\nå­¤ç‹¬å— æœ‰å¥è¯è¯´ï¼Œæ¯ä¸ªä½œè€…éƒ½æ˜¯å­¤ç‹¬çš„ã€‚æœ¬äººä¹Ÿä¸ä¾‹å¤–ï¼Œä½†å¾ˆå¹¸è¿çš„æ˜¯å¯ä»¥é€šè¿‡æ–‡å­—è¿™ç§å·¥å…·æ¥è·¨æ—¶ç©ºåœ°åŸŸè·Ÿå¾ˆå¤šäººèŠå¤©ï¼Œåƒè¿œåœ¨è´µé˜³é¾™åœºçš„ç‹é˜³æ˜ï¼Œåœ¨å²³é˜³æ¥¼ä¸Šå†™ä¸‹â€œåšï¼Œä¸€ä»‹ä¹¦ç”Ÿï¼Œä¸‰å°ºå¾®å‘½â€çš„é‚£ä¸ªå°‘å¹´ï¼Œâ€œä¹Ÿæ— é£é›¨ä¹Ÿæ— æ™´â€çš„ä¸œå¡å…ˆç”Ÿï¼Œç”šè‡³æœ‰é‚£ä¹ˆä¸€åˆ»ï¼Œæˆ‘æ˜¯æˆ‘ï¼Œä¹Ÿæ˜¯ä»–ä»¬ï¼Œä¹Ÿæ‡‚äº†ä»–ä»¬çš„å­¤ç‹¬ã€æƒ†æ€…ã€æ— å¥ˆï¼Œå¦‚ä»Šç»å†å¾—è¶Šå¤šé‚£ä»½æƒ…ç»ªå°±æ›´åŠ æµ“éƒå‡ åˆ†ã€‚ç°å¦‚ä»Šï¼Œæˆ‘ä¹Ÿæƒ³é€šè¿‡æ–‡å­—è·Ÿä¸åŒæ—¶ç©ºçš„è‡ªå·±æ²Ÿé€šï¼Œä»¥åŠå¦ä¸€ä¸ªæ—¶ç©ºçš„ä½ ï¼Œå› ä¸ºæˆ‘ï¼Œå°±æ˜¯ä½ å•Š\nå°ç»“ å¥½åƒå†™ç€å†™ç€æœ‰äº›è·‘é¢˜äº†ï¼Œä¸»è¦æ˜¯ç»“åˆè¿‘æœŸæ€è€ƒçš„çŸ¥è¯†å›ç­”ä¸‹ä¸€äº›è‡ªå·±å¿ƒä¸­çš„ç–‘é—®ï¼ŒåŒæ—¶ä¹Ÿæé†’è‡ªå·±å‹¿å¿˜åˆå¿ƒå¹¶ä¿æŒå†™ä½œæ€è€ƒçš„èŠ‚å¥\n","date":"2023-12-12T15:09:15+08:00","image":"https://sherlock-lin.github.io/p/%E4%B8%BA%E5%95%A5%E8%A6%81%E5%86%99%E8%BF%99%E4%BA%9B%E7%8E%A9%E6%84%8F/the-creative-exchange-d2zvqp3fpro-unsplash_hu5876398126655421130.jpg","permalink":"https://sherlock-lin.github.io/p/%E4%B8%BA%E5%95%A5%E8%A6%81%E5%86%99%E8%BF%99%E4%BA%9B%E7%8E%A9%E6%84%8F/","title":"ä¸ºå•¥è¦å†™è¿™äº›ç©æ„"},{"content":"å†™åœ¨å‰é¢ è¿‡å»çš„åå¤šå¹´ï¼Œéšç€å›½å†…äº’è”ç½‘çš„è“¬å‹ƒå‘å±•ï¼Œä¿¡æ¯å‘ˆç°çˆ†ç‚¸å¼å¢é•¿ï¼›ä¸€æ–¹é¢ï¼Œå’±ä»¬æ¥å—ä¿¡æ¯çš„æ¸ é“å˜å¾—å¤šæ ·åŒ–å¦‚æœç´¢å¼•æ“ã€åšå®¢ã€æœ‹å‹åœˆã€çŸ­è§†é¢‘ç­‰ç­‰ï¼Œå¦ä¸€æ–¹é¢ï¼ŒæŠ•å…¥åˆ¶é€ è¿™äº›å†…å®¹çš„äººä¹Ÿå¤šäº†ï¼Œæ•ˆç‡ä¹Ÿæ›´é«˜äº†ï¼Œå› æ­¤æˆ‘ä»¬æ¯å¤©æ¥å—çš„ä¿¡æ¯æ•°ä¸èƒœæ•°ã€‚æœ‰äº› åˆ¶é€ è€… ä¸ºäº†è‡ªå·±çš„å†…å®¹èƒ½å¤Ÿåœ¨ä¼—å¤šå†…å®¹ä¸­è„±é¢–è€Œå‡ºï¼Œå› æ­¤è¯ç”Ÿäº†ä¸å°‘ æ ‡é¢˜å…šã€è´©å–ç„¦è™‘çš„åˆ¶é€ è€…ã€‚è¿™äº›å†…å®¹ä¼šåœ¨ç”¨æˆ·åˆ·æ‰‹æœºæ—¶ï¼Œä»…é€šè¿‡0.5ç§’çš„æ—¶é—´å°±èƒ½æŠ“ä½ç”¨æˆ·çš„çœ¼çƒæˆ–è€…å‡»ä¸­ç”¨æˆ·çš„å¿ƒç†ï¼Œä»è€Œåˆ›é€ æµé‡è¿›è€Œä»ä¸­è·åˆ©ã€‚ä¹…è€Œä¹…ä¹‹å°±æˆäº†è¿™æ‰¹äººåœ¨ç”¨æˆ·çš„å¤§è„‘å†…åœˆåœ°è·‘é©¬ï¼Œå¾€ç”¨æˆ·å¤§è„‘å†…æ³¨å…¥è‡ªå·±å¤§é‡çš„ä¿¡æ¯ä»¥åŠæš—ç¤ºï¼Œæœ€æœ€é‡è¦çš„æ˜¯ä»–ä»¬æ³¨å…¥çš„éƒ½æ˜¯ç»è¿‡ä»–ä»¬è¿›è¡Œâ€œæ¶ˆåŒ–â€è¿‡çš„Næ‰‹çŸ¥è¯†ï¼Œç”¨æˆ·å¦‚æœé•¿æœŸä¹ æƒ¯äºè¿™ç§â€œè¢«æŠ•å–‚â€çš„æ–¹å¼ï¼Œé€æ¸ä¼šä¸§å¤±ç‹¬ç«‹æ€è€ƒèƒ½åŠ›ï¼Œä»è€Œå½»åº•ä¾èµ–äºä»–ä»¬ã€‚å€Ÿç”¨ã€Šè‚–ç”³å…‹çš„æ•‘èµã€‹é‡Œçš„ä¸€å¥è¯ï¼Œâ€œä¸€å¼€å§‹ï¼Œä½ ç—›æ¨å‘¨å›´çš„é«˜å¢™ï¼Œæ»¡æ»¡åœ°ï¼Œä½ ä¹ æƒ¯äº†ç”Ÿæ´»åœ¨å…¶ä¸­ï¼Œæœ€ç»ˆä½ ä¼šå‘ç°è‡ªå·±ä¸å¾—ä¸ä¾é å®ƒè€Œç”Ÿæ´»â€ã€‚\nç»å† è¯´è¯´è‡ªå·±çš„ç»å†å§ï¼Œå‡ å¹´å‰åœ¨æˆ¿ä»·è…¾é£çš„æ—¶å€™ï¼Œå½“æ—¶å¾ˆæµè¡Œä¸€å¥—æ–¹æ¡ˆï¼Œâ€œå€Ÿé’±ä»˜é¦–ä»˜ï¼Œç„¶åæˆ¿ç§ŸæŠµæœˆä¾›ï¼Œç„¶åæ¯ä¸ªæœˆçš„å·¥èµ„ç”¨æ¥è¿˜å€Ÿçš„é¦–ä»˜ï¼Œè¿‡å‡ å¹´å–äº†æˆ¿å­ç›¸å½“äºç™½èµšå‡ åä¸‡â€ï¼Œé€šè¿‡è¿™ç§ç©ºæ‰‹å¥—ç™½ç‹¼çš„æ–¹å¼æ¥è¾¾åˆ°å¿«é€Ÿèµšé’±ã€‚å½“æ—¶äººäº‘äº¦äº‘ï¼Œç›¸ä¿¡ä¸å°‘æœ‹å‹é‚£ä¸ªæ—¶å€™å‘¨å›´æˆ–å¤šæˆ–å°‘éƒ½æœ‰è¿™æ ·çš„å£°éŸ³ï¼Œåšä¸»å½“æ—¶ä¹Ÿæ˜¯æ·±ä¿¡ä¸ç–‘ï¼Œä¸€æ–¹é¢æ˜¯å¤§å®¶éƒ½è¿™ä¹ˆè¯´ä¹…è€Œä¹…ä¹‹å¤§è„‘å†…éƒ¨ä¹Ÿæ·±åº¦ç›¸ä¿¡è¿™ä¸ªç†è®ºï¼Œå¦ä¸€æ–¹é¢æ˜¯éšç€æˆ¿ä»·xiuxiuxiuå¾€ä¸Šæ¶¨è‡ªå·±ä¹Ÿè¯´æœè‡ªå·±ï¼Œè¿™ä¸æ˜¯ç°å®éªŒè¯ç†è®ºå—ï¼Œä½†éšåå‡ å¹´å°±ç»™å¤§ä¼—å•ªå•ªå•ªæ‰“è„¸äº†ï¼Œç”šè‡³ä¹Ÿä¸å°‘äººè¡€æœ¬æ— äºã€‚ç°åœ¨åæ€è¿™ä¸ªäº‹æƒ…ï¼Œå¤§å®¶éƒ½èƒ½æ¸…æ¥šçš„çŸ¥é“ï¼Œè¿™å¥—æ–¹æ¡ˆçš„æˆç«‹æ˜¯æœ‰å¤§å‰æçš„ï¼Œâ€œç»æµè¦ä¸€ç›´è“¬å‹ƒå‘å±•â€ï¼Œæ²¡æœ‰ä»€ä¹ˆç¨³èµšä¸èµ”çš„ä¹°å–ã€‚ä½†å½“æ—¶æ²¡æœ‰çœ‹æ¸…çš„æœ€ä¸»è¦åŸå› å°±æ˜¯ï¼Œæ²¡æœ‰ä»€ä¹ˆç‹¬ç«‹æ‰¹åˆ¤çš„èƒ½åŠ›ï¼Œåˆ«äººè¯´ä»€ä¹ˆï¼Œåªè¦è¯´çš„é¢‘ç¹ä»¥åŠè¯´çš„äººå¤šï¼Œè‡ªå·±å°±å…¨ä¿¡ï¼Œè¿™æ ·çš„äººå‡ºäº†ç¤¾ä¼šå¾€å¾€å°±æˆäº†æ‰€è°“çš„â€œéŸ­èœâ€ã€‚åœ¨ç°å¦‚ä»Šï¼Œè¿™æ ·çš„ç¾¤é‡Œä¾ç„¶ä¸åœ¨å°‘æ•°ï¼Œäººäº‘äº¦äº‘ï¼Œä½ åªè¦ç¨å¾®å¤šé—®å‡ ä¸ªé—®é¢˜ä»–å°±ç­”ä¸ä¸Šæ¥ï¼Œæˆ–è€…è¯´çš„å…¨æ˜¯â€œæ ‡å‡†ç­”æ¡ˆâ€ã€‚å¦‚æœè¯´æ¯ä¸ªäººéƒ½æ˜¯ä¸€è¾†è¡Œé©¶çš„æ±½è½¦ï¼Œé‚£è¿™æ ·åšæ— ç–‘æ˜¯å°†æ–¹å‘ç›˜æ¯«æ— ç–‘é—®çš„äº¤ç»™ä¸€ä¸ªæœªçŸ¥çš„äººï¼Œä½ å¸Œæœ›è¿™æ ·å—ï¼Ÿ\næ€è€ƒ å‰ä¸¤æ®µä¸»è¦æè¿°çš„æ˜¯æˆ‘ä»¬é‡åˆ°çš„æƒ…å†µï¼Œè¿™ä¸€æ®µä¸»è¦æ˜¯èŠèŠå¦‚ä½•å»åº”å¯¹ã€‚é¦–å…ˆæœ€é‡è¦çš„æ˜¯ï¼Œä¸€å®šè¦ä¿æŒå……ç”µä¹Ÿå°±æ˜¯çŸ¥è¯†çš„å­¦ä¹ ï¼Œæ–¹å¼ä¸é‡è¦ï¼Œå…¶ä¸­åŒ…æ‹¬ä½†ä¸ä»…é™äº ä¹¦ç±ã€è§†é¢‘ã€ä¸äººæ¢è®¨ç­‰ç­‰ï¼Œæœ€ä¸»è¦çš„æ˜¯è¦è‡ªå·±æ­å»ºå±äºè‡ªå·±çš„ä¸€å¥—â€œçŸ¥è¯†ç³»ç»Ÿâ€å¹¶ä¸”ä¸æ–­è‡ªæˆ‘å®Œå–„ã€‚åœ¨æœ‰æ–°çš„çŸ¥è¯†æˆ–è€…æ–°çš„é£å£è·³å‡ºæ¥æ—¶ï¼Œä½ å¯ä»¥åŸºäºè‡ªå·±çš„â€œçŸ¥è¯†ç³»ç»Ÿâ€å¯¹å…¶è¿›è¡Œæ‰¹åˆ¤æ€§çš„å­¦ä¹ ä»¥åŠäº†è§£ï¼Œä¸è¦äººäº‘äº¦äº‘ï¼Œä»Šå¤©è¿½é€çŸ­è§†é¢‘ã€æ˜å¤©è¿½é€gptï¼Œè¿™æ ·é™¤äº†äº†è§£æ–°ä¸œè¥¿çš„çš®æ¯›ï¼Œæœ€ç»ˆåªå‰©ä¸‹ä¸€é¢—ç„¦è™‘çš„å¿ƒï¼Œå› ä¸ºä½ ä¼šå‘ç°è™½ç„¶ä¸æ–­çš„å­¦æ–°ä¸œè¥¿ï¼Œä¸åœçš„è¿½é€æ–°äº‹ç‰©ï¼Œä½†å±äºä½ æ‰‹ä¸­ï¼Œè„‘ä¸­çš„ä¸œè¥¿ä¼šè¶Šæ¥è¶Šå°‘ï¼Œä¸æ—¥ä¿±å¢çš„åªæœ‰æ— ç©·çš„ç©ºè™šä»¥åŠç„¦è™‘ã€‚\nä¿æŒå……ç”µï¼Œæ„å»ºè‡ªå·±çš„â€œçŸ¥è¯†ç³»ç»Ÿâ€ åˆ‡å¿Œç›²ç›®è¿½é€æ–°äº‹ç‰©ï¼Œæ–°ä¸œè¥¿æœ‰æ–°ä¸œè¥¿çš„å¥½ï¼Œè€ä¸œè¥¿æœ‰è€ä¸œè¥¿çš„å¥½ï¼Œæ¯•ç«Ÿç»å…¸çš„ä¸œè¥¿éƒ½æ˜¯ç»è¿‡æ—¶é—´æ´—ç¤¼çš„ï¼Œå‡å°‘è¯•é”™æˆæœ¬ ä¿æŒæ‰¹åˆ¤èƒ½åŠ›ï¼Œä»»åŠ¡äº‹ç‰©ä¸€å®šä¸€å®šä¸€å®šæœ‰ä¸¤é¢æ€§ï¼Œå°±åƒ é“å®¶çš„é˜´é˜³é±¼ä¸€æ ·ï¼Œæœ‰é˜³å…‰çš„åœ°æ–¹å°±ä¼šæœ‰é˜´å½±ã€‚åˆ«äººè¶Šæ˜¯å¤§è‚†å®£æ‰¬ä»€ä¹ˆï¼Œæˆ‘ä»¬è¶Šæ˜¯è¦è°¨æ…æ€è€ƒä»–æ²¡è¯´çš„é‚£éƒ¨åˆ†ï¼Œè¦ç³»ç»Ÿæ€§å…¨é¢çš„å»æ€è€ƒæŸä¸ªè§‚ç‚¹ï¼Œè€Œä¸æ˜¯æ”¾å¼ƒæ€è€ƒå®Œå…¨è·Ÿç€åˆ«äººèµ° é¿å…è¿‡å¤šçš„æ²‰æººäºâ€œå¤šå·´èƒºé™·é˜±â€ï¼Œæ¯”å¦‚èŠ±è¿‡å¤šçš„æ—¶é—´åœ¨çŸ­è§†é¢‘ã€æ¸¸æˆç­‰ç­‰ä¸Šé¢ å®šæœŸé”»ç‚¼ï¼Œä¿æŒæ„‰æ‚¦ç§¯æçš„å¿ƒæ€ æ€»ç»“ æœ€åï¼Œè™½ç„¶æœ¬ç¯‡åšå®¢æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œå·²ç»æå‡ºäº†è‡ªè®¤ä¸ºçš„â€œåº”å¯¹æ–¹æ³•â€ï¼Œä½†ä¹Ÿä¸æ˜¯æ¯ä¸ªäººéƒ½å¿…é¡»è¿™ä¹ˆå»åšçš„ã€‚é¦–å…ˆç¬¬ä¸€ç‚¹ï¼Œéšæ³¢é€æµå’Œç‹¬ç«‹æ€è€ƒä¹Ÿæœ‰å„è‡ªçš„ä¸¤é¢æ€§ï¼Œæœ‰äº›äººé€‰æ‹©éšæ³¢é€æµä¸€æ ·å¯ä»¥è¿‡å¾—å¥½å¥½ï¼Œè¿™å°±çœ‹ä¸ªäººé€‰æ‹©ã€‚ç¬¬äºŒç‚¹ï¼Œé€‰æ‹©ç‹¬ç«‹æ€è€ƒçš„èƒŒæ™¯ä¸‹ï¼Œåº”å¯¹åšå®¢æå‡ºçš„é—®é¢˜å…¶å®ä¹Ÿæœ‰å¾ˆå¤šè§£æ³•ï¼Œå»ºè®®è¯»è€…ä¹Ÿæ‰¹åˆ¤æ€§çš„çœ‹å¾…è¿™ç¯‡åšå®¢ï¼Œå¦‚æœè§‰å¾—è¿™ç¯‡åšå®¢ä¹Ÿæ˜¯â€œæ ‡é¢˜å…šâ€æˆ–è€…â€œåˆ¶é€ ç„¦è™‘â€ä¹Ÿæ­£å¸¸ï¼Œé‡è¦çš„æ˜¯ï¼Œä¿æŒç‹¬ç«‹æ€è€ƒï¼Œç‰¹åˆ«æ˜¯æ·±åº¦æ€è€ƒï¼Œåœ¨æ²‰æµ¸å…¶ä¸­æ—¶ï¼Œä½ ä¼šå¿˜äº†æ—¶é—´ã€å¿˜äº†ä¸€åˆ‡ï¼Œä»…ä»…æ²‰æµ¸äºä½ çš„ä¸–ç•Œï¼Œå»æ„é€ å±äºä½ è‡ªå·±çš„ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ä½ è‡ªå·±ã€‚æœ€åï¼Œç¥å¤§å®¶éƒ½èƒ½æˆä¸ºè‡ªå·±æƒ³æˆä¸ºçš„é‚£ç§äººã€‚\n","date":"2023-08-07T15:09:15+08:00","image":"https://sherlock-lin.github.io/p/%E9%9A%8F%E6%B3%A2%E9%80%90%E6%B5%81or%E7%8B%AC%E7%AB%8B%E6%80%9D%E8%80%83/matt-le-SJSpo9hQf7s-unsplash_hu10664154974910995856.jpg","permalink":"https://sherlock-lin.github.io/p/%E9%9A%8F%E6%B3%A2%E9%80%90%E6%B5%81or%E7%8B%AC%E7%AB%8B%E6%80%9D%E8%80%83/","title":"éšæ³¢é€æµorç‹¬ç«‹æ€è€ƒ"}]